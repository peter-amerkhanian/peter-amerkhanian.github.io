<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2024-09-01">

<title>Working with IPUMS microdata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#microdata-via-ipums" id="toc-microdata-via-ipums" class="nav-link active" data-scroll-target="#microdata-via-ipums">Microdata via IPUMS</a></li>
  <li><a href="#an-ipums-usa-example" id="toc-an-ipums-usa-example" class="nav-link" data-scroll-target="#an-ipums-usa-example">An IPUMS USA example</a>
  <ul class="collapse">
  <li><a href="#geographies-in-acs-microdata" id="toc-geographies-in-acs-microdata" class="nav-link" data-scroll-target="#geographies-in-acs-microdata">Geographies in ACS microdata</a></li>
  <li><a href="#granularity-and-weights-in-the-acs" id="toc-granularity-and-weights-in-the-acs" class="nav-link" data-scroll-target="#granularity-and-weights-in-the-acs">Granularity and weights in the ACS</a></li>
  <li><a href="#comparing-results-to-census-aggregates" id="toc-comparing-results-to-census-aggregates" class="nav-link" data-scroll-target="#comparing-results-to-census-aggregates">Comparing results to census aggregates</a></li>
  <li><a href="#estimation-with-replicate-weights" id="toc-estimation-with-replicate-weights" class="nav-link" data-scroll-target="#estimation-with-replicate-weights">Estimation with Replicate Weights</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Working with IPUMS microdata</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Data Management</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Peter Amerkhanian </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Webscraping</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Amazing support from <a href="https://www.bwilden.com/">Bert Wilden</a></p>
<p>What is the median household income in Oakland, California?</p>
<p>I don’t like the IPUMS option for getting single year data points, for that I like tidycensus</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can use tidycensus to easily access aggregate measures from the census.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median household income</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total population for poverty status determination</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="microdata-via-ipums" class="level2">
<h2 class="anchored" data-anchor-id="microdata-via-ipums">Microdata via IPUMS</h2>
<p>One of the most popular sources for downloading census microdata is the University of Minesota’s Integrated Public Use Microdata Series (IPUMS). The IPUMS team provides the following products, all for free! - A centralized API for downloading census microdata - Comprehensive documentation for working with census microdata - Harmonized variables across time.</p>
<p><span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 9</a>)</span>.</p>
<p>Here I’ll load the <code>ipumsr</code> library and set an API key for submitting requests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://tech.popdata.org/ipumsr/"><code>ipumsr</code> website</a> provides details on what degree of support the package has for various IPUMS products, though it’s also possible to check using the <code>ipums_data_collections()</code> function. I prefer the function so that I can see exactly what code I’ll need to plug into the API (see <code>api_support</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">collection_name</th>
<th style="text-align: left;">collection_type</th>
<th style="text-align: left;">code_for_api</th>
<th style="text-align: left;">api_support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IPUMS USA</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">usa</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS CPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">cps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS International</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ipumsi</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS ATUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">atus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS AHTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ahtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">mtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHIS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">nhis</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MEPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">meps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHGIS</td>
<td style="text-align: left;">aggregate data</td>
<td style="text-align: left;">nhgis</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>For any analysis of populations in the U.S., the IPUMS USA (annual surveys) and IPUMS CPS (monthly surveys) collections are of particular interest. I’ll look at IPUMS USA:</p>
<blockquote class="blockquote">
<p>IPUMS USA collects, preserves and harmonizes U.S. census microdata and provides easy access to this data with enhanced documentation. Data includes decennial censuses from 1790 to 2010 and American Community Surveys (ACS) from 2000 to the present <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p>
</blockquote>
<p>We can check out the newest products they have in the USA collection as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">us2022d</td>
<td style="text-align: left;">2018-2022, PRCS 5-year</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2022c</td>
<td style="text-align: left;">2018-2022, ACS 5-year</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022b</td>
<td style="text-align: left;">2022 PRCS</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2022a</td>
<td style="text-align: left;">2022 ACS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2021d</td>
<td style="text-align: left;">2017-2021, PRCS 5-year</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="an-ipums-usa-example" class="level2">
<h2 class="anchored" data-anchor-id="an-ipums-usa-example">An IPUMS USA example</h2>
<p>What is the median household income in Oakland, California?</p>
<p>I’ll define a function, <code>retrieve_ca_sample()</code> that accomplishes that and only run the IPUMS request if I don’t already have the data locally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>retrieve_ca_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="st">"CA Incomes by PUMA"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">list</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"PUMA"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"AGE"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SEX"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EDUC"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"HHINCOME"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"INCTOT"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"REPWT"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"REPWTP"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>, <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I will run the retrieval conditionally, so that if I already have the file, I don’t re-download it</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_ca_sample</span>(<span class="st">"us2022a"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Use of data from IPUMS USA is subject to conditions including that users should cite the data appropriately. Use command `ipums_conditions()` for more details.</code></pre>
</div>
</div>
<p>We will return to replicate weights later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_no_rep <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"REPWT"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>data_no_rep <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74692</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6509</td>
<td style="text-align: right;">650906</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">14500</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74693</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6501</td>
<td style="text-align: right;">650106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74694</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8101</td>
<td style="text-align: right;">810106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74695</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8303</td>
<td style="text-align: right;">830306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">9000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74696</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6712</td>
<td style="text-align: right;">671206</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">48000</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74697</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7301</td>
<td style="text-align: right;">730106</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">24000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="geographies-in-acs-microdata" class="level3">
<h3 class="anchored" data-anchor-id="geographies-in-acs-microdata">Geographies in ACS microdata</h3>
<p>The smallest geographic area explicitly identified in the microdata is public use microdata area (PUMA), a geographic area defined based on population. Each PUMA includes about 100,000 residents. IPUMS geographers are sometimes able to infer other small geographic areas, such as city, metro area, and county, from PUMA, depending on how the boundaries of PUMAs and these other geographic areas correspond. As a result, some cities, metro areas, and counties are not able to be identified in the microdata. https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2</p>
<p>What are PUMAS?</p>
<p>GEOCORR</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="geocorr.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption>Geocorr 2022</figcaption>
</figure>
</div>
<p>The Geocorr (geographic correspondence engine) application generates files and/or reports — called correlation lists — showing relationships between two or more geographic coverages in the United States.</p>
<p>For example, suppose you have county-level data for California and would like to convert that data to the ZIP code level. Geocorr can show how each county relates to the ZIP code(s) that intersect it. It can tell you, for each of those ZIP/county intersections, what the size of that intersection is and what portion of the ZIP’s total population is in that intersection. https://mcdc.missouri.edu/applications/docs/geocorr2022-help.html</p>
<p>PUMAs are typically completely inside of counties, but they sometimes cross them. GEO Corr allows you to “crosswalk.” If a puma crosses a county line, geocorr gives you a crosswalk with every Puma-county combo that exists. There’s an allocation factor for each Puma that shows how much it should allocated, e.g.&nbsp;.3, .7. You can weight it by household. You can also cross walk to places, metro areas. Puma-&gt;Place.</p>
<p>Here I’ll define a function, <code>geocorr_2022()</code> that queries GEOCORR 2022 and retrieves a .csv file establishing the relationships between geographies in California.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span>     <span class="co"># Assuming there is only one link on the page</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url) <span class="co"># Convert to absolute URL if necessary</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll use that function to establish the relationships between California’s 2022 PUMAs and places, using individual population to weight the relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With that, we can whether Oakland can be represented as a collection of PUMAs, and, if so, which PUMAs make up the city.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 68%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">puma22</th>
<th style="text-align: left;">PlaceName</th>
<th style="text-align: left;">PUMA22name</th>
<th style="text-align: left;">pop20</th>
<th style="text-align: left;">afact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">00111</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (Downtown/West Oakland/North Oakland)</td>
<td style="text-align: left;">106433</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00112</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (Oakland Hills)</td>
<td style="text-align: left;">106896</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00113</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (West)–Oakland City (Elmhurst/Central/East Oakland)</td>
<td style="text-align: left;">125840</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00114</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (West)–San Leandro, Alameda, Emeryville &amp; Piedmont Cities</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00123</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (San Antonio/Fruitvale)</td>
<td style="text-align: left;">101468</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The AFACT (allocation factor) column shows the proportion of the source area contained in the target area – this case the proportion of the PUMA population that belongs to Oakland. In this case, 100% of the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of PUMA 114. To be clear, GEOCORR believes that 9 individuals from 114 do live in Oakland, but based on the AFACT I’ll feel comfortable dropping that PUMA.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data_no_rep <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74718</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74737</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">480</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74738</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1200</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75005</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">41300</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75119</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5800</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75131</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">12306</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="granularity-and-weights-in-the-acs" class="level3">
<h3 class="anchored" data-anchor-id="granularity-and-weights-in-the-acs">Granularity and weights in the ACS</h3>
<blockquote class="blockquote">
<p><code>SERIAL</code> is an identifying number unique to each household record in a given sample. All person records are assigned the same serial number as the household record that they follow. (Person records also have their own unique identifiers - see <code>PERNUM.</code>)</p>
</blockquote>
<p>Households: The combination of <code>SAMPLE</code> and <code>SERIAL</code> provides a unique identifier for every household in the IPUMS<br>
Individuals: The combination of <code>SAMPLE</code>, <code>SERIAL</code>, and <code>PERNUM</code> provides a unique identifier for every person in the IPUMS<br>
https://usa.ipums.org/usa-action/variables/SERIAL</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-granularity" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Oakland Dataset Granularity by PUMA
</figcaption>
<div aria-describedby="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">n_rows</th>
<th style="text-align: right;">n_individuals</th>
<th style="text-align: right;">n_households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">111</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">578</td>
</tr>
<tr class="even">
<td style="text-align: right;">112</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">547</td>
</tr>
<tr class="odd">
<td style="text-align: right;">113</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">385</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">389</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Thus, <code>oak</code> is at the individual level. Here I’ll make a <code>oak_households</code> dataframe that is at the household level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SEX, AGE, HHINCOME, INCTOT, PERWT, HHWT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-example-hh" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: An example household
</figcaption>
<div aria-describedby="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">HHWT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9300</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">18000</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">62</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Now that I have the households-level dataset, I’ll look at how we define household income:</p>
<p><code>INCTOT</code> reports each respondent’s total pre-tax personal income or losses from all sources for the previous year. The censuses collected information on income received from these sources during the previous calendar year; […] the reference period was the past 12 months. https://usa.ipums.org/usa-action/variables/INCTOT</p>
<p><code>HHINCOME</code> reports the total money income of all household members age 15+ during the previous year. The amount should equal the sum of all household members’ individual incomes, as recorded in the person-record variable INCTOT. https://usa.ipums.org/usa-action/variables/HHINCOME</p>
<p>Missing variables–<br>
For both INCTOT and HHINCOME, 9999999 = N/A For INCTOT: 9999998 = Unknown</p>
<blockquote class="blockquote">
<p>To apply sample weights to an IPUMS file, users should follow one of the following procedures:</p>
<ol type="1">
<li>For household-level analyses using the […] ACS/PRCS samples, weight the households using the HHWT variable. HHWT gives the number of households in the general population represented by each household in the sample.</li>
<li>For person-level analyses using the […] ACS/PRCS samples, apply the PERWT variable. PERWT gives the population represented by each individual in the sample.</li>
</ol>
</blockquote>
<p>https://usa.ipums.org/usa/intro.shtml#weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHINCOME =</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(HHINCOME)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>median_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_median</th>
<th style="text-align: right;">weighted_median_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">89000</td>
<td style="text-align: right;">4354.201</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>count_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">n</th>
<th style="text-align: right;">n_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">430052</td>
<td style="text-align: right;">4812.793</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="comparing-results-to-census-aggregates" class="level3">
<h3 class="anchored" data-anchor-id="comparing-results-to-census-aggregates">Comparing results to census aggregates</h3>
<p>But recall that our IPUMS estimates were slightly different:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> median_table <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Median HH Income"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> count_table <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Population"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table)<span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">ipums_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Population</td>
<td style="text-align: right;">430052</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median HH Income</td>
<td style="text-align: right;">89000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>What gives?</p>
<blockquote class="blockquote">
<p>The public use samples of the ACS and PRCS are extracted from the Census Bureau’s larger internal data files and are thus subject to additional sampling error and further data processing (such as imputation and allocation). […] individual variables, such as income and housing values, are Top coded. […] Weights included with the ACS PUMS for the household and person-level data adjust for the mixed geographic sampling rates, nonresponse adjustments, and individual sampling probabilities. Estimates from the ACS IPUMS samples may not be consistent with summary table ACS estimates due to the additional sampling error.</p>
</blockquote>
<p>https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS</p>
</section>
<section id="estimation-with-replicate-weights" class="level3">
<h3 class="anchored" data-anchor-id="estimation-with-replicate-weights">Estimation with Replicate Weights</h3>
<p>Note: Look at the Walker textbook chapter on ACS microdata!!!</p>
<p>1 year is higher variance, but less bias because we are just taking stuff from that year. time series with the 1 year acs.</p>
<p>Replicate weights are a way of estimating the uncertainty around each weighted observation. They estimate the uncertainty of the weights?</p>
<p>replicate weights take into account the uncertainty around the household/person weights.</p>
<p>Bert uses the replicate weights to estimate the eligible population for benefits.</p>
<p>Why is it cooler to get microdata?</p>
<p>survey and srvyr – if you do any sort of summing, it will know to use the weights and use the replicate weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html" class="uri">https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors and order as in your original code</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="dv">4</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate the mean income for each education level</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_income &lt;- individuals_w_income %&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(educ_attain) %&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(mean_INCTOT = weighted.mean(INCTOT, w = PERWT)) %&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(educ_attain = factor(educ_attain, levels = order))</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with jitter and mean points</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order), <span class="at">y =</span> INCTOT, <span class="at">weight =</span> PERWT)) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width=</span>.<span class="dv">2</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size=</span>.<span class="dv">9</span>, <span class="at">outliers =</span> <span class="cn">FALSE</span>, <span class="at">linewidth=</span>.<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)) <span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Income"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>raw, <span class="sc">~</span>clean, <span class="sc">~</span>fmt,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model_ols1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span> AGE <span class="sc">+</span> <span class="fu">I</span>(AGE<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span> AGE <span class="sc">+</span> <span class="fu">I</span>(AGE<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">relevel</span>(educ_attain, <span class="at">ref=</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(model_ols1, model_ols2, model_ols3),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map =</span> gof_stuff, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_385vecy7vcg48ezgfka8(i, j, css_id) {
        var table = document.getElementById("tinytable_385vecy7vcg48ezgfka8");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_385vecy7vcg48ezgfka8');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_385vecy7vcg48ezgfka8(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_385vecy7vcg48ezgfka8");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(0, 0, 'tinytable_css_id0bipq2oc1isjvn6p8uit') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(0, 1, 'tinytable_css_idp8b8t1vnhnwsdfnp8oqr') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(0, 2, 'tinytable_css_idp8b8t1vnhnwsdfnp8oqr') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(0, 3, 'tinytable_css_idp8b8t1vnhnwsdfnp8oqr') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(1, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(1, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(1, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(1, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(2, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(2, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(2, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(2, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(3, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(3, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(3, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(3, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(4, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(4, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(4, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(4, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(5, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(5, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(5, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(5, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(6, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(6, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(6, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(6, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(7, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(7, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(7, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(7, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(8, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(8, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(8, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(8, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(9, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(9, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(9, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(9, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(10, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(10, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(10, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(10, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(11, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(11, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(11, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(11, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(12, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(12, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(12, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(12, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(13, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(13, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(13, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(13, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(14, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(14, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(14, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(14, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(15, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(15, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(15, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(15, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(16, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(16, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(16, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(16, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(17, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(17, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(17, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(17, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(18, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(18, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(18, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(18, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(19, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(19, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(19, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(19, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(20, 0, 'tinytable_css_id53hy7ssaznavl8elhqdz') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(20, 1, 'tinytable_css_idsauvv4cs1di7r0ax54uy') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(20, 2, 'tinytable_css_idsauvv4cs1di7r0ax54uy') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(20, 3, 'tinytable_css_idsauvv4cs1di7r0ax54uy') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(21, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(21, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(21, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(21, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(22, 0, 'tinytable_css_idq48nyufbrg2zk3byau5m') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(22, 1, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(22, 2, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
window.addEventListener('load', function () { styleCell_385vecy7vcg48ezgfka8(22, 3, 'tinytable_css_id9580mdyr03x4bu0bl7cw') })
    </script>

    <style>
    .table td.tinytable_css_id0bipq2oc1isjvn6p8uit, .table th.tinytable_css_id0bipq2oc1isjvn6p8uit {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idp8b8t1vnhnwsdfnp8oqr, .table th.tinytable_css_idp8b8t1vnhnwsdfnp8oqr {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idq48nyufbrg2zk3byau5m, .table th.tinytable_css_idq48nyufbrg2zk3byau5m {  text-align: left; }
    .table td.tinytable_css_id9580mdyr03x4bu0bl7cw, .table th.tinytable_css_id9580mdyr03x4bu0bl7cw {  text-align: center; }
    .table td.tinytable_css_id53hy7ssaznavl8elhqdz, .table th.tinytable_css_id53hy7ssaznavl8elhqdz {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idsauvv4cs1di7r0ax54uy, .table th.tinytable_css_idsauvv4cs1di7r0ax54uy {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_385vecy7vcg48ezgfka8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
                <th scope="col">(2)</th>
                <th scope="col">(3)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                                                       </td>
                  <td>37064.571 </td>
                  <td>6006.148  </td>
                  <td>3805.220 </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(1229.397)</td>
                  <td>(1044.872)</td>
                  <td>(584.301)</td>
                </tr>
                <tr>
                  <td>factor(SEX)Male                                                   </td>
                  <td>1.251     </td>
                  <td>1.214     </td>
                  <td>1.378    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(0.058)   </td>
                  <td>(0.055)   </td>
                  <td>(0.054)  </td>
                </tr>
                <tr>
                  <td>AGE                                                               </td>
                  <td>          </td>
                  <td>1.089     </td>
                  <td>1.074    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.008)   </td>
                  <td>(0.007)  </td>
                </tr>
                <tr>
                  <td>I(AGE^2)                                                          </td>
                  <td>          </td>
                  <td>0.999     </td>
                  <td>0.999    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.000)   </td>
                  <td>(0.000)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Associate's degree</td>
                  <td>          </td>
                  <td>          </td>
                  <td>1.466    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.139)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Bachelor's degree </td>
                  <td>          </td>
                  <td>          </td>
                  <td>2.880    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.161)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Graduate degree   </td>
                  <td>          </td>
                  <td>          </td>
                  <td>4.377    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.256)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")No schooling      </td>
                  <td>          </td>
                  <td>          </td>
                  <td>0.743    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.081)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some college      </td>
                  <td>          </td>
                  <td>          </td>
                  <td>1.171    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.086)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some school       </td>
                  <td>          </td>
                  <td>          </td>
                  <td>0.774    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>          </td>
                  <td>(0.060)  </td>
                </tr>
                <tr>
                  <td>N                                                                 </td>
                  <td>3131      </td>
                  <td>3131      </td>
                  <td>3131     </td>
                </tr>
                <tr>
                  <td>R²                                                                </td>
                  <td>0.007     </td>
                  <td>0.058     </td>
                  <td>0.308    </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level=</span>order), <span class="at">color =</span> <span class="fu">factor</span>(SEX), <span class="at">fill =</span> <span class="fu">factor</span>(SEX), <span class="at">weight =</span> PERWT)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">boundary =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="fu">aes</span>(<span class="at">x =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..))) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Sex"</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"lightgrey"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">size=</span>.<span class="dv">2</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->


</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ruggles_ipums_2024" class="csl-entry" role="listitem">
Ruggles, Steven, Sarah Flood, Matthew Sobek, Daniel Backman, Annie Chen, Grace Cooper, Stephanie Richards, Renae Rogers, and Megan Schouweiler. 2024. <span>“<span>IPUMS</span> <span>USA</span>: <span>Version</span> 15.0.”</span> Minneapolis, MN: IPUMS. <a href="https://doi.org/10.18128/D010.V15.0">https://doi.org/10.18128/D010.V15.0</a>.
</div>
<div id="ref-walker_analyzing_2023" class="csl-entry" role="listitem">
Walker, Kyle. 2023. <em>Analyzing <span>US</span> <span>Census</span> <span>Data</span></em>. 1st edition. Boca Raton: Chapman; Hall/CRC.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Were the AFACT higher, e.g.&nbsp;1%, I would randomly sample 1% of the individuals from that PUMA and include them in my Oakland sample.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Working with IPUMS microdata"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../blog.bib"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Peter Amerkhanian"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-9-1"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> thumbnail.png</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ['R', 'Data Management']</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Webscraping</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>Amazing support from <span class="co">[</span><span class="ot">Bert Wilden</span><span class="co">](https://www.bwilden.com/)</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>What is the median household income in Oakland, California?</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>I don't like the IPUMS option for getting single year data points, for</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>that I like tidycensus</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>I can use tidycensus to easily access aggregate measures from the</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>census.</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median household income</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total population for poverty status determination</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## Microdata via IPUMS</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>One of the most popular sources for downloading census microdata is the</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>University of Minesota's Integrated Public Use Microdata Series (IPUMS).</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>The IPUMS team provides the following products, all for free! - A</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>centralized API for downloading census microdata - Comprehensive</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>documentation for working with census microdata - Harmonized variables</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>across time.</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@walker_analyzing_2023, chapter 9</span><span class="co">]</span>.</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>Here I'll load the <span class="in">`ipumsr`</span> library and set an API key for submitting</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>requests.</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">`ipumsr` website</span><span class="co">](https://tech.popdata.org/ipumsr/)</span> provides</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>details on what degree of support the package has for various IPUMS</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>products, though it's also possible to check using the</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a><span class="in">`ipums_data_collections()`</span> function. I prefer the function so that I can</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>see exactly what code I'll need to plug into the API (see</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a><span class="in">`api_support`</span>).</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>For any analysis of populations in the U.S., the IPUMS USA (annual</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>surveys) and IPUMS CPS (monthly surveys) collections are of particular</span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>interest. I'll look at IPUMS USA:</span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; IPUMS USA collects, preserves and harmonizes U.S. census microdata and</span></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; provides easy access to this data with enhanced documentation. Data</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; includes decennial censuses from 1790 to 2010 and American Community</span></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Surveys (ACS) from 2000 to the present </span><span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span><span class="at">.</span></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a>We can check out the newest products they have in the USA collection as</span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a>follows:</span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## An IPUMS USA example</span></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a>What is the median household income in Oakland, California?</span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a>I'll define a function, <span class="in">`retrieve_ca_sample()`</span> that accomplishes that</span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a>and only run the IPUMS request if I don't already have the data locally.</span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a>retrieve_ca_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample){</span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="st">"CA Incomes by PUMA"</span>,</span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">list</span>(</span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a>      <span class="st">"PUMA"</span>,</span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a>      <span class="st">"AGE"</span>,</span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SEX"</span>,</span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EDUC"</span>,</span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a>      <span class="st">"HHINCOME"</span>,</span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a>      <span class="st">"INCTOT"</span>,</span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a>      <span class="st">"REPWT"</span>,</span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a>      <span class="st">"REPWTP"</span>,</span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a>      <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>, <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-172"><a href="#cb28-172" aria-hidden="true" tabindex="-1"></a>Now I will run the retrieval conditionally, so that if I already have</span>
<span id="cb28-173"><a href="#cb28-173" aria-hidden="true" tabindex="-1"></a>the file, I don't re-download it</span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb28-180"><a href="#cb28-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb28-181"><a href="#cb28-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-183"><a href="#cb28-183" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-184"><a href="#cb28-184" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_ca_sample</span>(<span class="st">"us2022a"</span>)</span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a>We will return to replicate weights later.</span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a>data_no_rep <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb28-197"><a href="#cb28-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"REPWT"</span>))</span>
<span id="cb28-198"><a href="#cb28-198" aria-hidden="true" tabindex="-1"></a>data_no_rep <span class="sc">%&gt;%</span></span>
<span id="cb28-199"><a href="#cb28-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb28-200"><a href="#cb28-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-201"><a href="#cb28-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-202"><a href="#cb28-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geographies in ACS microdata</span></span>
<span id="cb28-203"><a href="#cb28-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-204"><a href="#cb28-204" aria-hidden="true" tabindex="-1"></a>The smallest geographic area explicitly identified in the microdata is</span>
<span id="cb28-205"><a href="#cb28-205" aria-hidden="true" tabindex="-1"></a>public use microdata area (PUMA), a geographic area defined based on</span>
<span id="cb28-206"><a href="#cb28-206" aria-hidden="true" tabindex="-1"></a>population. Each PUMA includes about 100,000 residents. IPUMS</span>
<span id="cb28-207"><a href="#cb28-207" aria-hidden="true" tabindex="-1"></a>geographers are sometimes able to infer other small geographic areas,</span>
<span id="cb28-208"><a href="#cb28-208" aria-hidden="true" tabindex="-1"></a>such as city, metro area, and county, from PUMA, depending on how the</span>
<span id="cb28-209"><a href="#cb28-209" aria-hidden="true" tabindex="-1"></a>boundaries of PUMAs and these other geographic areas correspond. As a</span>
<span id="cb28-210"><a href="#cb28-210" aria-hidden="true" tabindex="-1"></a>result, some cities, metro areas, and counties are not able to be</span>
<span id="cb28-211"><a href="#cb28-211" aria-hidden="true" tabindex="-1"></a>identified in the microdata.</span>
<span id="cb28-212"><a href="#cb28-212" aria-hidden="true" tabindex="-1"></a>https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2</span>
<span id="cb28-213"><a href="#cb28-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-214"><a href="#cb28-214" aria-hidden="true" tabindex="-1"></a>What are PUMAS?</span>
<span id="cb28-215"><a href="#cb28-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-216"><a href="#cb28-216" aria-hidden="true" tabindex="-1"></a>GEOCORR</span>
<span id="cb28-217"><a href="#cb28-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-218"><a href="#cb28-218" aria-hidden="true" tabindex="-1"></a><span class="al">![Geocorr 2022](geocorr.png)</span>{width="80%"}</span>
<span id="cb28-219"><a href="#cb28-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-220"><a href="#cb28-220" aria-hidden="true" tabindex="-1"></a>The Geocorr (geographic correspondence engine) application generates</span>
<span id="cb28-221"><a href="#cb28-221" aria-hidden="true" tabindex="-1"></a>files and/or reports — called correlation lists — showing relationships</span>
<span id="cb28-222"><a href="#cb28-222" aria-hidden="true" tabindex="-1"></a>between two or more geographic coverages in the United States.</span>
<span id="cb28-223"><a href="#cb28-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-224"><a href="#cb28-224" aria-hidden="true" tabindex="-1"></a>For example, suppose you have county-level data for California and would</span>
<span id="cb28-225"><a href="#cb28-225" aria-hidden="true" tabindex="-1"></a>like to convert that data to the ZIP code level. Geocorr can show how</span>
<span id="cb28-226"><a href="#cb28-226" aria-hidden="true" tabindex="-1"></a>each county relates to the ZIP code(s) that intersect it. It can tell</span>
<span id="cb28-227"><a href="#cb28-227" aria-hidden="true" tabindex="-1"></a>you, for each of those ZIP/county intersections, what the size of that</span>
<span id="cb28-228"><a href="#cb28-228" aria-hidden="true" tabindex="-1"></a>intersection is and what portion of the ZIP's total population is in</span>
<span id="cb28-229"><a href="#cb28-229" aria-hidden="true" tabindex="-1"></a>that intersection.</span>
<span id="cb28-230"><a href="#cb28-230" aria-hidden="true" tabindex="-1"></a>https://mcdc.missouri.edu/applications/docs/geocorr2022-help.html</span>
<span id="cb28-231"><a href="#cb28-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-232"><a href="#cb28-232" aria-hidden="true" tabindex="-1"></a>PUMAs are typically completely inside of counties, but they sometimes</span>
<span id="cb28-233"><a href="#cb28-233" aria-hidden="true" tabindex="-1"></a>cross them. GEO Corr allows you to "crosswalk." If a puma crosses a</span>
<span id="cb28-234"><a href="#cb28-234" aria-hidden="true" tabindex="-1"></a>county line, geocorr gives you a crosswalk with every Puma-county combo</span>
<span id="cb28-235"><a href="#cb28-235" aria-hidden="true" tabindex="-1"></a>that exists. There's an allocation factor for each Puma that shows how</span>
<span id="cb28-236"><a href="#cb28-236" aria-hidden="true" tabindex="-1"></a>much it should allocated, e.g. .3, .7. You can weight it by household.</span>
<span id="cb28-237"><a href="#cb28-237" aria-hidden="true" tabindex="-1"></a>You can also cross walk to places, metro areas. Puma-<span class="sc">\&gt;</span>Place.</span>
<span id="cb28-238"><a href="#cb28-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-239"><a href="#cb28-239" aria-hidden="true" tabindex="-1"></a>Here I'll define a function, <span class="in">`geocorr_2022()`</span> that queries GEOCORR 2022</span>
<span id="cb28-240"><a href="#cb28-240" aria-hidden="true" tabindex="-1"></a>and retrieves a .csv file establishing the relationships between</span>
<span id="cb28-241"><a href="#cb28-241" aria-hidden="true" tabindex="-1"></a>geographies in California.</span>
<span id="cb28-242"><a href="#cb28-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-245"><a href="#cb28-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-246"><a href="#cb28-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-247"><a href="#cb28-247" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb28-248"><a href="#cb28-248" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb28-249"><a href="#cb28-249" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb28-250"><a href="#cb28-250" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb28-251"><a href="#cb28-251" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb28-252"><a href="#cb28-252" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb28-253"><a href="#cb28-253" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb28-254"><a href="#cb28-254" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb28-255"><a href="#cb28-255" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span></span>
<span id="cb28-256"><a href="#cb28-256" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-257"><a href="#cb28-257" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb28-258"><a href="#cb28-258" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb28-259"><a href="#cb28-259" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb28-260"><a href="#cb28-260" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb28-261"><a href="#cb28-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb28-262"><a href="#cb28-262" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb28-263"><a href="#cb28-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span>     <span class="co"># Assuming there is only one link on the page</span></span>
<span id="cb28-264"><a href="#cb28-264" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-265"><a href="#cb28-265" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-266"><a href="#cb28-266" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url) <span class="co"># Convert to absolute URL if necessary</span></span>
<span id="cb28-267"><a href="#cb28-267" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb28-268"><a href="#cb28-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb28-269"><a href="#cb28-269" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-270"><a href="#cb28-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-271"><a href="#cb28-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-272"><a href="#cb28-272" aria-hidden="true" tabindex="-1"></a>We'll use that function to establish the relationships between</span>
<span id="cb28-273"><a href="#cb28-273" aria-hidden="true" tabindex="-1"></a>California's 2022 PUMAs and places, using individual population to</span>
<span id="cb28-274"><a href="#cb28-274" aria-hidden="true" tabindex="-1"></a>weight the relationships.</span>
<span id="cb28-275"><a href="#cb28-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-278"><a href="#cb28-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-279"><a href="#cb28-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb28-280"><a href="#cb28-280" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb28-281"><a href="#cb28-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-282"><a href="#cb28-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-283"><a href="#cb28-283" aria-hidden="true" tabindex="-1"></a>With that, we can whether Oakland can be represented as a collection of</span>
<span id="cb28-284"><a href="#cb28-284" aria-hidden="true" tabindex="-1"></a>PUMAs, and, if so, which PUMAs make up the city.</span>
<span id="cb28-285"><a href="#cb28-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-288"><a href="#cb28-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-289"><a href="#cb28-289" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb28-290"><a href="#cb28-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place)) <span class="sc">%&gt;%</span></span>
<span id="cb28-291"><a href="#cb28-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span>
<span id="cb28-292"><a href="#cb28-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-293"><a href="#cb28-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-294"><a href="#cb28-294" aria-hidden="true" tabindex="-1"></a>The AFACT (allocation factor) column shows the proportion of the source</span>
<span id="cb28-295"><a href="#cb28-295" aria-hidden="true" tabindex="-1"></a>area contained in the target area -- this case the proportion of the</span>
<span id="cb28-296"><a href="#cb28-296" aria-hidden="true" tabindex="-1"></a>PUMA population that belongs to Oakland. In this case, 100% of the</span>
<span id="cb28-297"><a href="#cb28-297" aria-hidden="true" tabindex="-1"></a>populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of</span>
<span id="cb28-298"><a href="#cb28-298" aria-hidden="true" tabindex="-1"></a>PUMA 114. To be clear, GEOCORR believes that 9 individuals from 114 do</span>
<span id="cb28-299"><a href="#cb28-299" aria-hidden="true" tabindex="-1"></a>live in Oakland, but based on the AFACT I'll feel comfortable dropping</span>
<span id="cb28-300"><a href="#cb28-300" aria-hidden="true" tabindex="-1"></a>that PUMA.<span class="ot">[^1]</span></span>
<span id="cb28-301"><a href="#cb28-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-302"><a href="#cb28-302" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Were the AFACT higher, e.g. 1%, I would randomly sample 1% of the</span>
<span id="cb28-303"><a href="#cb28-303" aria-hidden="true" tabindex="-1"></a>    individuals from that PUMA and include them in my Oakland sample.</span>
<span id="cb28-304"><a href="#cb28-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-307"><a href="#cb28-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-308"><a href="#cb28-308" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb28-309"><a href="#cb28-309" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data_no_rep <span class="sc">%&gt;%</span></span>
<span id="cb28-310"><a href="#cb28-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas)</span>
<span id="cb28-311"><a href="#cb28-311" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb28-312"><a href="#cb28-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-313"><a href="#cb28-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-314"><a href="#cb28-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Granularity and weights in the ACS</span></span>
<span id="cb28-315"><a href="#cb28-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-316"><a href="#cb28-316" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="in">`SERIAL`</span><span class="at"> is an identifying number unique to each household record in a</span></span>
<span id="cb28-317"><a href="#cb28-317" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; given sample. All person records are assigned the same serial number</span></span>
<span id="cb28-318"><a href="#cb28-318" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; as the household record that they follow. (Person records also have</span></span>
<span id="cb28-319"><a href="#cb28-319" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; their own unique identifiers - see </span><span class="in">`PERNUM.`</span><span class="at">)</span></span>
<span id="cb28-320"><a href="#cb28-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-321"><a href="#cb28-321" aria-hidden="true" tabindex="-1"></a>Households: The combination of <span class="in">`SAMPLE`</span> and <span class="in">`SERIAL`</span> provides a unique</span>
<span id="cb28-322"><a href="#cb28-322" aria-hidden="true" tabindex="-1"></a>identifier for every household in the IPUMS\</span>
<span id="cb28-323"><a href="#cb28-323" aria-hidden="true" tabindex="-1"></a>Individuals: The combination of <span class="in">`SAMPLE`</span>, <span class="in">`SERIAL`</span>, and <span class="in">`PERNUM`</span></span>
<span id="cb28-324"><a href="#cb28-324" aria-hidden="true" tabindex="-1"></a>provides a unique identifier for every person in the IPUMS\</span>
<span id="cb28-325"><a href="#cb28-325" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa-action/variables/SERIAL</span>
<span id="cb28-326"><a href="#cb28-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-329"><a href="#cb28-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-330"><a href="#cb28-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-granularity</span></span>
<span id="cb28-331"><a href="#cb28-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Oakland Dataset Granularity by PUMA"</span></span>
<span id="cb28-332"><a href="#cb28-332" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb28-333"><a href="#cb28-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb28-334"><a href="#cb28-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb28-335"><a href="#cb28-335" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb28-336"><a href="#cb28-336" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-337"><a href="#cb28-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-338"><a href="#cb28-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-339"><a href="#cb28-339" aria-hidden="true" tabindex="-1"></a>Thus, <span class="in">`oak`</span> is at the individual level. Here I'll make a</span>
<span id="cb28-340"><a href="#cb28-340" aria-hidden="true" tabindex="-1"></a><span class="in">`oak_households`</span> dataframe that is at the household level:</span>
<span id="cb28-341"><a href="#cb28-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-344"><a href="#cb28-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-345"><a href="#cb28-345" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-346"><a href="#cb28-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-347"><a href="#cb28-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-350"><a href="#cb28-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-351"><a href="#cb28-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-hh</span></span>
<span id="cb28-352"><a href="#cb28-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example household"</span></span>
<span id="cb28-353"><a href="#cb28-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-354"><a href="#cb28-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-355"><a href="#cb28-355" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb28-356"><a href="#cb28-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb28-357"><a href="#cb28-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-358"><a href="#cb28-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-359"><a href="#cb28-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb28-360"><a href="#cb28-360" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb28-361"><a href="#cb28-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-362"><a href="#cb28-362" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-363"><a href="#cb28-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SEX, AGE, HHINCOME, INCTOT, PERWT, HHWT))</span>
<span id="cb28-364"><a href="#cb28-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-365"><a href="#cb28-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-366"><a href="#cb28-366" aria-hidden="true" tabindex="-1"></a>Now that I have the households-level dataset, I'll look at how we define</span>
<span id="cb28-367"><a href="#cb28-367" aria-hidden="true" tabindex="-1"></a>household income:</span>
<span id="cb28-368"><a href="#cb28-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-369"><a href="#cb28-369" aria-hidden="true" tabindex="-1"></a><span class="in">`INCTOT`</span> reports each respondent's total pre-tax personal income or</span>
<span id="cb28-370"><a href="#cb28-370" aria-hidden="true" tabindex="-1"></a>losses from all sources for the previous year. The censuses collected</span>
<span id="cb28-371"><a href="#cb28-371" aria-hidden="true" tabindex="-1"></a>information on income received from these sources during the previous</span>
<span id="cb28-372"><a href="#cb28-372" aria-hidden="true" tabindex="-1"></a>calendar year; <span class="sc">\[</span>...<span class="sc">\]</span> the reference period was the past 12 months.</span>
<span id="cb28-373"><a href="#cb28-373" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa-action/variables/INCTOT</span>
<span id="cb28-374"><a href="#cb28-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-375"><a href="#cb28-375" aria-hidden="true" tabindex="-1"></a><span class="in">`HHINCOME`</span> reports the total money income of all household members age</span>
<span id="cb28-376"><a href="#cb28-376" aria-hidden="true" tabindex="-1"></a>15+ during the previous year. The amount should equal the sum of all</span>
<span id="cb28-377"><a href="#cb28-377" aria-hidden="true" tabindex="-1"></a>household members' individual incomes, as recorded in the person-record</span>
<span id="cb28-378"><a href="#cb28-378" aria-hidden="true" tabindex="-1"></a>variable INCTOT. https://usa.ipums.org/usa-action/variables/HHINCOME</span>
<span id="cb28-379"><a href="#cb28-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-380"><a href="#cb28-380" aria-hidden="true" tabindex="-1"></a>Missing variables--\</span>
<span id="cb28-381"><a href="#cb28-381" aria-hidden="true" tabindex="-1"></a>For both INCTOT and HHINCOME, 9999999 = N/A For INCTOT: 9999998 =</span>
<span id="cb28-382"><a href="#cb28-382" aria-hidden="true" tabindex="-1"></a>Unknown</span>
<span id="cb28-383"><a href="#cb28-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-384"><a href="#cb28-384" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; To apply sample weights to an IPUMS file, users should follow one of</span></span>
<span id="cb28-385"><a href="#cb28-385" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the following procedures:</span></span>
<span id="cb28-386"><a href="#cb28-386" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb28-387"><a href="#cb28-387" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 1.  For household-level analyses using the </span><span class="sc">\[</span><span class="at">...</span><span class="sc">\]</span><span class="at"> ACS/PRCS samples,</span></span>
<span id="cb28-388"><a href="#cb28-388" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;     weight the households using the HHWT variable. HHWT gives the</span></span>
<span id="cb28-389"><a href="#cb28-389" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;     number of households in the general population represented by each</span></span>
<span id="cb28-390"><a href="#cb28-390" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;     household in the sample.</span></span>
<span id="cb28-391"><a href="#cb28-391" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 2.  For person-level analyses using the </span><span class="sc">\[</span><span class="at">...</span><span class="sc">\]</span><span class="at"> ACS/PRCS samples,</span></span>
<span id="cb28-392"><a href="#cb28-392" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;     apply the PERWT variable. PERWT gives the population represented</span></span>
<span id="cb28-393"><a href="#cb28-393" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;     by each individual in the sample.</span></span>
<span id="cb28-394"><a href="#cb28-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-395"><a href="#cb28-395" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa/intro.shtml#weights</span>
<span id="cb28-396"><a href="#cb28-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-399"><a href="#cb28-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-400"><a href="#cb28-400" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb28-401"><a href="#cb28-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb28-402"><a href="#cb28-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-403"><a href="#cb28-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-406"><a href="#cb28-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-407"><a href="#cb28-407" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb28-408"><a href="#cb28-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHINCOME =</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(HHINCOME)</span>
<span id="cb28-409"><a href="#cb28-409" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-410"><a href="#cb28-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-411"><a href="#cb28-411" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb28-412"><a href="#cb28-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb28-413"><a href="#cb28-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME))</span>
<span id="cb28-414"><a href="#cb28-414" aria-hidden="true" tabindex="-1"></a>median_table</span>
<span id="cb28-415"><a href="#cb28-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-416"><a href="#cb28-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-419"><a href="#cb28-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-420"><a href="#cb28-420" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb28-421"><a href="#cb28-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb28-422"><a href="#cb28-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>()</span>
<span id="cb28-423"><a href="#cb28-423" aria-hidden="true" tabindex="-1"></a>count_table</span>
<span id="cb28-424"><a href="#cb28-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-425"><a href="#cb28-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-426"><a href="#cb28-426" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing results to census aggregates</span></span>
<span id="cb28-427"><a href="#cb28-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-428"><a href="#cb28-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-429"><a href="#cb28-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-430"><a href="#cb28-430" aria-hidden="true" tabindex="-1"></a>But recall that our IPUMS estimates were slightly different:</span>
<span id="cb28-431"><a href="#cb28-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> median_table <span class="sc">%&gt;%</span></span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Median HH Income"</span>,</span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> count_table <span class="sc">%&gt;%</span></span>
<span id="cb28-441"><a href="#cb28-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Population"</span>,</span>
<span id="cb28-442"><a href="#cb28-442" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb28-443"><a href="#cb28-443" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb28-444"><a href="#cb28-444" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table)<span class="sc">%&gt;%</span> </span>
<span id="cb28-445"><a href="#cb28-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate))</span>
<span id="cb28-446"><a href="#cb28-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-447"><a href="#cb28-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-448"><a href="#cb28-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-451"><a href="#cb28-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-452"><a href="#cb28-452" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span>
<span id="cb28-453"><a href="#cb28-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-454"><a href="#cb28-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-455"><a href="#cb28-455" aria-hidden="true" tabindex="-1"></a>What gives?</span>
<span id="cb28-456"><a href="#cb28-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-457"><a href="#cb28-457" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The public use samples of the ACS and PRCS are extracted from the</span></span>
<span id="cb28-458"><a href="#cb28-458" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Census Bureau's larger internal data files and are thus subject to</span></span>
<span id="cb28-459"><a href="#cb28-459" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; additional sampling error and further data processing (such as</span></span>
<span id="cb28-460"><a href="#cb28-460" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; imputation and allocation). </span><span class="sc">\[</span><span class="at">...</span><span class="sc">\]</span><span class="at"> individual variables, such as</span></span>
<span id="cb28-461"><a href="#cb28-461" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; income and housing values, are Top coded. </span><span class="sc">\[</span><span class="at">...</span><span class="sc">\]</span><span class="at"> Weights included</span></span>
<span id="cb28-462"><a href="#cb28-462" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; with the ACS PUMS for the household and person-level data adjust for</span></span>
<span id="cb28-463"><a href="#cb28-463" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the mixed geographic sampling rates, nonresponse adjustments, and</span></span>
<span id="cb28-464"><a href="#cb28-464" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; individual sampling probabilities. Estimates from the ACS IPUMS</span></span>
<span id="cb28-465"><a href="#cb28-465" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; samples may not be consistent with summary table ACS estimates due to</span></span>
<span id="cb28-466"><a href="#cb28-466" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the additional sampling error.</span></span>
<span id="cb28-467"><a href="#cb28-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-468"><a href="#cb28-468" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS</span>
<span id="cb28-469"><a href="#cb28-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-470"><a href="#cb28-470" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimation with Replicate Weights</span></span>
<span id="cb28-471"><a href="#cb28-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-472"><a href="#cb28-472" aria-hidden="true" tabindex="-1"></a>Note: Look at the Walker textbook chapter on ACS microdata!!!</span>
<span id="cb28-473"><a href="#cb28-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-474"><a href="#cb28-474" aria-hidden="true" tabindex="-1"></a>1 year is higher variance, but less bias because we are just taking</span>
<span id="cb28-475"><a href="#cb28-475" aria-hidden="true" tabindex="-1"></a>stuff from that year. time series with the 1 year acs.</span>
<span id="cb28-476"><a href="#cb28-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-477"><a href="#cb28-477" aria-hidden="true" tabindex="-1"></a>Replicate weights are a way of estimating the uncertainty around each</span>
<span id="cb28-478"><a href="#cb28-478" aria-hidden="true" tabindex="-1"></a>weighted observation. They estimate the uncertainty of the weights?</span>
<span id="cb28-479"><a href="#cb28-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-480"><a href="#cb28-480" aria-hidden="true" tabindex="-1"></a>replicate weights take into account the uncertainty around the</span>
<span id="cb28-481"><a href="#cb28-481" aria-hidden="true" tabindex="-1"></a>household/person weights.</span>
<span id="cb28-482"><a href="#cb28-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-483"><a href="#cb28-483" aria-hidden="true" tabindex="-1"></a>Bert uses the replicate weights to estimate the eligible population for</span>
<span id="cb28-484"><a href="#cb28-484" aria-hidden="true" tabindex="-1"></a>benefits.</span>
<span id="cb28-485"><a href="#cb28-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-486"><a href="#cb28-486" aria-hidden="true" tabindex="-1"></a>Why is it cooler to get microdata?</span>
<span id="cb28-487"><a href="#cb28-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-488"><a href="#cb28-488" aria-hidden="true" tabindex="-1"></a>survey and srvyr -- if you do any sort of summing, it will know to use</span>
<span id="cb28-489"><a href="#cb28-489" aria-hidden="true" tabindex="-1"></a>the weights and use the replicate weights.</span>
<span id="cb28-490"><a href="#cb28-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-493"><a href="#cb28-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-494"><a href="#cb28-494" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb28-495"><a href="#cb28-495" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb28-496"><a href="#cb28-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-497"><a href="#cb28-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-498"><a href="#cb28-498" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb28-499"><a href="#cb28-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb28-500"><a href="#cb28-500" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb28-501"><a href="#cb28-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-502"><a href="#cb28-502" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb28-503"><a href="#cb28-503" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb28-504"><a href="#cb28-504" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb28-505"><a href="#cb28-505" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb28-506"><a href="#cb28-506" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb28-507"><a href="#cb28-507" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb28-508"><a href="#cb28-508" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb28-509"><a href="#cb28-509" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb28-510"><a href="#cb28-510" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb28-511"><a href="#cb28-511" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-512"><a href="#cb28-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-513"><a href="#cb28-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-514"><a href="#cb28-514" aria-hidden="true" tabindex="-1"></a><span class="ot">&lt;https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html&gt;</span></span>
<span id="cb28-515"><a href="#cb28-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-518"><a href="#cb28-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-519"><a href="#cb28-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-520"><a href="#cb28-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-521"><a href="#cb28-521" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors and order as in your original code</span></span>
<span id="cb28-522"><a href="#cb28-522" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="dv">4</span>]</span>
<span id="cb28-523"><a href="#cb28-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-524"><a href="#cb28-524" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb28-525"><a href="#cb28-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb28-526"><a href="#cb28-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb28-527"><a href="#cb28-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb28-528"><a href="#cb28-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb28-529"><a href="#cb28-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-530"><a href="#cb28-530" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate the mean income for each education level</span></span>
<span id="cb28-531"><a href="#cb28-531" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_income &lt;- individuals_w_income %&gt;%</span></span>
<span id="cb28-532"><a href="#cb28-532" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(educ_attain) %&gt;%</span></span>
<span id="cb28-533"><a href="#cb28-533" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(mean_INCTOT = weighted.mean(INCTOT, w = PERWT)) %&gt;%</span></span>
<span id="cb28-534"><a href="#cb28-534" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(educ_attain = factor(educ_attain, levels = order))</span></span>
<span id="cb28-535"><a href="#cb28-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-536"><a href="#cb28-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with jitter and mean points</span></span>
<span id="cb28-537"><a href="#cb28-537" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order), <span class="at">y =</span> INCTOT, <span class="at">weight =</span> PERWT)) <span class="sc">+</span></span>
<span id="cb28-538"><a href="#cb28-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width=</span>.<span class="dv">2</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb28-539"><a href="#cb28-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size=</span>.<span class="dv">9</span>, <span class="at">outliers =</span> <span class="cn">FALSE</span>, <span class="at">linewidth=</span>.<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb28-540"><a href="#cb28-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb28-541"><a href="#cb28-541" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb28-542"><a href="#cb28-542" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)) <span class="sc">+</span></span>
<span id="cb28-543"><a href="#cb28-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb28-544"><a href="#cb28-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>,</span>
<span id="cb28-545"><a href="#cb28-545" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Income"</span>,</span>
<span id="cb28-546"><a href="#cb28-546" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb28-547"><a href="#cb28-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-548"><a href="#cb28-548" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb28-549"><a href="#cb28-549" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb28-550"><a href="#cb28-550" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb28-551"><a href="#cb28-551" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>))</span>
<span id="cb28-552"><a href="#cb28-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-553"><a href="#cb28-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-554"><a href="#cb28-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-557"><a href="#cb28-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-558"><a href="#cb28-558" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-559"><a href="#cb28-559" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb28-560"><a href="#cb28-560" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>raw, <span class="sc">~</span>clean, <span class="sc">~</span>fmt,</span>
<span id="cb28-561"><a href="#cb28-561" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb28-562"><a href="#cb28-562" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb28-563"><a href="#cb28-563" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-564"><a href="#cb28-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-565"><a href="#cb28-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-568"><a href="#cb28-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-569"><a href="#cb28-569" aria-hidden="true" tabindex="-1"></a>model_ols1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb28-570"><a href="#cb28-570" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb28-571"><a href="#cb28-571" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span> AGE <span class="sc">+</span> <span class="fu">I</span>(AGE<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb28-572"><a href="#cb28-572" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb28-573"><a href="#cb28-573" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span> AGE <span class="sc">+</span> <span class="fu">I</span>(AGE<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">relevel</span>(educ_attain, <span class="at">ref=</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb28-574"><a href="#cb28-574" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income, <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb28-575"><a href="#cb28-575" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(model_ols1, model_ols2, model_ols3),</span>
<span id="cb28-576"><a href="#cb28-576" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map =</span> gof_stuff, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-577"><a href="#cb28-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-578"><a href="#cb28-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-579"><a href="#cb28-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-582"><a href="#cb28-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-583"><a href="#cb28-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-584"><a href="#cb28-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-585"><a href="#cb28-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-586"><a href="#cb28-586" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb28-587"><a href="#cb28-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-588"><a href="#cb28-588" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb28-589"><a href="#cb28-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-590"><a href="#cb28-590" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level=</span>order), <span class="at">color =</span> <span class="fu">factor</span>(SEX), <span class="at">fill =</span> <span class="fu">factor</span>(SEX), <span class="at">weight =</span> PERWT)) <span class="sc">+</span></span>
<span id="cb28-591"><a href="#cb28-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">boundary =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="fu">aes</span>(<span class="at">x =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..))) <span class="sc">+</span></span>
<span id="cb28-592"><a href="#cb28-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb28-593"><a href="#cb28-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb28-594"><a href="#cb28-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb28-595"><a href="#cb28-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb28-596"><a href="#cb28-596" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb28-597"><a href="#cb28-597" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb28-598"><a href="#cb28-598" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb28-599"><a href="#cb28-599" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Sex"</span>) <span class="sc">+</span></span>
<span id="cb28-600"><a href="#cb28-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-601"><a href="#cb28-601" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"lightgrey"</span>,</span>
<span id="cb28-602"><a href="#cb28-602" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">size=</span>.<span class="dv">2</span>,</span>
<span id="cb28-603"><a href="#cb28-603" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb28-604"><a href="#cb28-604" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb28-605"><a href="#cb28-605" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-606"><a href="#cb28-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>