<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2024-03-17">

<title>Basic Concepts in Forecasting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V95HGLKTEB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V95HGLKTEB', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../memos.html"> 
<span class="menu-text">Memos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Basic Concepts in Forecasting</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Statistics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Amerkhanian </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 17, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title"><a href="#" class="nav-link">Basic Concepts in Forecasting</a></h2>
     
    <ul>
    <li><a href="#benchmark-forecasts" id="toc-benchmark-forecasts" class="nav-link active" data-scroll-target="#benchmark-forecasts">Benchmark Forecasts</a>
    <ul class="collapse">
    <li><a href="#predicting-the-mean" id="toc-predicting-the-mean" class="nav-link" data-scroll-target="#predicting-the-mean">Predicting the mean</a></li>
    <li><a href="#random-walk" id="toc-random-walk" class="nav-link" data-scroll-target="#random-walk">Random Walk</a></li>
    </ul></li>
    <li><a href="#exponential-smoothing" id="toc-exponential-smoothing" class="nav-link" data-scroll-target="#exponential-smoothing">Exponential Smoothing</a></li>
    </ul>
  </nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<script>
  document.getElementById('toc-title').addEventListener('click', function(event) {
  event.preventDefault(); // Prevent default behavior of anchor tag
  const firstHeader = document.querySelector('body'); // Select the first h2 element
  if (firstHeader) {
    firstHeader.scrollIntoView({ behavior: 'smooth', block: "start", inline: "nearest"}); // Scroll to the first header smoothly
  }
});
</script>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span></code></pre></div>
</div>
<p>Let’s say we are analyzing the data in the BART time series that I’ve been using a various blog posts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>parquet_directory <span class="ot">&lt;-</span> <span class="st">"../dask-data-io/data/parquet_data"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(parquet_directory)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df_daily <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">daily_riders=</span><span class="fu">sum</span>(Riders)) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(date, daily_riders)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>df_daily <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">daily_riders</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2011-01-01</td>
<td style="text-align: right;">124971</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011-01-02</td>
<td style="text-align: right;">94276</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011-01-03</td>
<td style="text-align: right;">286747</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011-01-04</td>
<td style="text-align: right;">323233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011-01-05</td>
<td style="text-align: right;">327972</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011-01-06</td>
<td style="text-align: right;">330048</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>I’ll create a <code>tstibble</code> of monthly BART riders, 2011 through the end of 2018 and run through some exercises where I try to forecast how many monthly riders there will be in 2019.</p>
<p>Here’s the groundtruth dataset for <span class="math inline">\([2011, 2019]\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_daily_ts <span class="ot">&lt;-</span> df_daily <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"2011-01-01"</span> <span class="sc">~</span> <span class="st">"2018-12-31"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="ot">&lt;-</span> df_daily_ts <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_key</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">year_month =</span> <span class="sc">~</span> <span class="fu">yearmonth</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_riders =</span> <span class="fu">sum</span>(daily_riders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">year_month</th>
<th style="text-align: right;">monthly_riders</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2011 Jan</td>
<td style="text-align: right;">8203562</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011 Feb</td>
<td style="text-align: right;">7933264</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011 Mar</td>
<td style="text-align: right;">9049039</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011 Apr</td>
<td style="text-align: right;">8824840</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011 May</td>
<td style="text-align: right;">8940380</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011 Jun</td>
<td style="text-align: right;">9210691</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the date dynamically</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>earliest_date <span class="ot">&lt;-</span> <span class="fu">min</span>(df_monthly_ts<span class="sc">$</span>year_month)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>latest_date <span class="ot">&lt;-</span> <span class="fu">max</span>(df_monthly_ts<span class="sc">$</span>year_month)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>formatted_string <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%s through %s"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">format</span>(earliest_date, <span class="st">"%b %Y"</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">format</span>(latest_date, <span class="st">"%b %Y"</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plot_bart_series <span class="ot">&lt;-</span> <span class="cf">function</span>(title, subtitle) {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> monthly_riders)) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> .<span class="dv">9</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#619CFF"</span>)   <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="cf">if</span> (<span class="fu">missing</span>(subtitle)) {</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        subtitle</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Riders"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Month"</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Monthly Bart Rides"</span>, formatted_string)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>When analyzing a time series, we often want to produce a forecast, <span class="math inline">\(\hat{y}_{T+h|T}\)</span>. I found this to be a weird looking term when I first saw it in <span class="citation" data-cites="hyndman_forecasting_2021">(<a href="#ref-hyndman_forecasting_2021" role="doc-biblioref">Hyndman and Athanasopoulos 2021</a>)</span>, so I’ll break down what it’s referring to here:</p>
<ol type="1">
<li><span class="math inline">\(\hat{y}\)</span>: The “hat” symbol (^) over the (<span class="math inline">\(y\)</span>) indicates that this is an estimated value.</li>
<li><span class="math inline">\(T\)</span>: This represents the most recent observation from the time series.</li>
<li><span class="math inline">\(h\)</span>: This is the “forecast horizon”, indicating how many time steps ahead from (T) we are forecasting.</li>
<li><span class="math inline">\(|T\)</span>: The vertical bar (<span class="math inline">\(|\)</span>) followed by (<span class="math inline">\(T\)</span>) signifies that the forecast is conditional on the information available up to time (T).</li>
</ol>
<p>Thus,<span class="math inline">\(\hat{y}_{T+h|T}\)</span> is a forecast of the time series, <span class="math inline">\(y\)</span> at time <span class="math inline">\(T+h\)</span>, given the information available up to and including time <span class="math inline">\(T\)</span>.</p>
<section id="benchmark-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="benchmark-forecasts">Benchmark Forecasts</h2>
<section id="predicting-the-mean" class="level3">
<h3 class="anchored" data-anchor-id="predicting-the-mean">Predicting the mean</h3>
<p>One of the most straightforward prediction models in the mean, a single scalar that minimizes mean-squared error across the data.</p>
<p><span class="math display">\[
\hat{y}_{T+h|T} = \frac{1}{T} \sum_{i=1}^T y_{i}
\]</span> We can calculate that on our BART data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_monthly_ts<span class="sc">$</span>monthly_riders)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pred</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10023511</code></pre>
</div>
</div>
<p>So if we are forecasting with the mean, we’ll simply predict always predict $=$10,023,511 as the monthly rider total for all months going forward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Mean =</span> <span class="fu">MEAN</span>(monthly_riders))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"dotted"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<section id="model-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="model-evaluation">Model Evaluation</h4>
<p>If we want to evaluate that prediction, we would look at its residuals, <span class="math inline">\(\hat{y}-y\)</span>, across the observed data. Here we’ll take a look at the distribution of these residuals, which will be important for both model evaluation and model inference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> df_monthly_ts<span class="sc">$</span>monthly_riders <span class="sc">-</span> pred</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-2090248  -617574    19581        0   711366  1742004 </code></pre>
</div>
</div>
<p>The most important checks on these are that their mean is 0 and that the residuals are not auto-correlated – if those two conditions don’t hold, that means that <strong>the model can be improved</strong>. In addition to those essential properties, it is also preferable that the residuals exhibit constant variance (homoscedasticity) and are normally distributed, but a model that fails on those last two conditions cannot necessarily be improved <span class="citation" data-cites="hyndman_forecasting_2021">(<a href="#ref-hyndman_forecasting_2021" role="doc-biblioref">Hyndman and Athanasopoulos 2021</a>, chap 5.4)</span>.</p>
<p>We can use <code>gg_tsresiduals()</code> from the <code>feast</code> package to get some simple visuals that let us evaluate these diagnostics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>From these visuals, I’ll informally conclude that:</p>
<ol type="1">
<li>The mean is 0</li>
<li>There is significant autocorrelation</li>
<li>The residuals <em>look</em> kind of normally distributed</li>
<li>The variance of the residuals is not constant – we start out systematically overestimating ridership</li>
</ol>
<p>Given that we failed on autocorrelation, we conclude that this model can be improved, and this is unsurprising given that we were just predicting the mean. However, we’ll keep working with this model as we establish how to do inference on this forecast and produce prediction intervals, rather than just a point estimate forecast.</p>
</section>
<section id="model-inference" class="level4">
<h4 class="anchored" data-anchor-id="model-inference">Model Inference</h4>
<p>If we <strong>assume that the distribution of future observations is normal</strong>, a 95% prediction interval would be computed as follows:<br>
<span class="math display">\[
\hat{y}_{T+h|T} \pm 1.96 \hat\sigma_h
\]</span> This follows from the fact that 95% of the area under a Gaussian curve lies within ~1.96 standard deviations, or, <span class="math inline">\(1.96 \hat\sigma_h\)</span>, of the mean (<a href="https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule#Proof">see proof</a>). 1.96 can be switched out with a different multiplier depending on the desired interval (<a href="https://otexts.com/fpp3/prediction-intervals.html#prediction-intervals-1">see table</a>). When we are forecasting, the standard deviation of the forecast distribution is estimated using the <a href="https://en.wikipedia.org/wiki/Standard_deviation#Corrected_sample_standard_deviation">corrected sample standard deviation</a> of the residuals. <span class="math display">\[
\begin{equation}
  \hat{\sigma} = \sqrt{\frac{1}{T-K-M}\sum_{t=1}^T e_t^2}
\end{equation}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>sample_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( (<span class="dv">1</span> <span class="sc">/</span> (T <span class="sc">-</span> K <span class="sc">-</span> M)) <span class="sc">*</span> <span class="fu">sum</span>(residuals<span class="sc">^</span><span class="dv">2</span>) )</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>interval_95 <span class="ot">&lt;-</span> <span class="fl">1.96</span> <span class="sc">*</span> sample_sd</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>interval_95</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1575196</code></pre>
</div>
</div>
<p>So for our mean forecast, the prediction interval would be 10,023,511 <span class="math inline">\(\pm\)</span> 1,575,196</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">12</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fc_mean)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>We can also relax some of the assumptions necessary for theoretical inference by using bootstrapping, where we only have to assume that the residuals are uncorrelated and have constant variance. To be fair, both of these conditions are violated in this example model, but we’ll still bootstrap this as an example.</p>
<p>When we bootstrap a time series forecast, we use the following equation:</p>
<p>$$ <span class="math display">\[\begin{align*}
y^*_{T+1} &amp;= y_{T} + e^*_{T+1} \\
y^*_{T+2} &amp;= y_{T+1}^* + e^*_{T+2} \\
\vdots \\
y^*_{T+h} &amp;= y_{T+h-1}^* + e^*_{T+h} \\

\end{align*}\]</span> $$</p>
<p>Where each <span class="math inline">\(e^*_{T+h}\)</span> is a random sample with replacement from the residuals distribution.</p>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bootstrapped_fs <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">h =</span> <span class="dv">12</span>, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> bootstrapped_fs, <span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">linewidth=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">y =</span> .sim, <span class="at">colour =</span> <span class="fu">as.factor</span>(.rep) )) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">12</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>, <span class="at">times =</span> <span class="dv">5000</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fc_mean) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Bootstrap Simulations, b=1</figcaption>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Bootstrapped Prediction Interval, b=5000</figcaption>
<p><img src="index_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="random-walk" class="level3">
<h3 class="anchored" data-anchor-id="random-walk">Random Walk</h3>
<p><span class="math display">\[
\hat{y}_{T+h|T} = y_T
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Naive =</span> <span class="fu">NAIVE</span>(monthly_riders))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"solid"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(monthly_riders))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"solid"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exponential-smoothing" class="level2">
<h2 class="anchored" data-anchor-id="exponential-smoothing">Exponential Smoothing</h2>
<p>Exponential Smoothing is a popular forecasting method where the forecast is simply a weighted average of past observations, with weights decreasing exponentially as observations get older <span class="citation" data-cites="hyndman_forecasting_2021">(<a href="#ref-hyndman_forecasting_2021" role="doc-biblioref">Hyndman and Athanasopoulos 2021, chap. 8</a>)</span>.</p>
<p><span class="citation" data-cites="hyndman_forecasting_2021">(<a href="#ref-hyndman_forecasting_2021" role="doc-biblioref">Hyndman and Athanasopoulos 2021, chap. 9</a>)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>algeria_economy <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Algeria"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>algeria_economy </span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Country</th>
<th style="text-align: left;">Code</th>
<th style="text-align: right;">Year</th>
<th style="text-align: right;">GDP</th>
<th style="text-align: right;">Growth</th>
<th style="text-align: right;">CPI</th>
<th style="text-align: right;">Imports</th>
<th style="text-align: right;">Exports</th>
<th style="text-align: right;">Population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1960</td>
<td style="text-align: right;">2723648552</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">67.14363</td>
<td style="text-align: right;">39.04317</td>
<td style="text-align: right;">11124888</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1961</td>
<td style="text-align: right;">2434776646</td>
<td style="text-align: right;">-13.6054413</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">67.50377</td>
<td style="text-align: right;">46.24456</td>
<td style="text-align: right;">11404859</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">2001468868</td>
<td style="text-align: right;">-19.6850418</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">20.81865</td>
<td style="text-align: right;">19.79387</td>
<td style="text-align: right;">11690153</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1963</td>
<td style="text-align: right;">2703014867</td>
<td style="text-align: right;">34.3137288</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">36.82552</td>
<td style="text-align: right;">24.68468</td>
<td style="text-align: right;">11985136</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1964</td>
<td style="text-align: right;">2909351793</td>
<td style="text-align: right;">5.8394130</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">29.43976</td>
<td style="text-align: right;">25.08406</td>
<td style="text-align: right;">12295970</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1965</td>
<td style="text-align: right;">3136258897</td>
<td style="text-align: right;">6.2068982</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">25.83308</td>
<td style="text-align: right;">22.60394</td>
<td style="text-align: right;">12626952</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1966</td>
<td style="text-align: right;">3039834559</td>
<td style="text-align: right;">-4.8049709</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">24.65357</td>
<td style="text-align: right;">25.98620</td>
<td style="text-align: right;">12980267</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1967</td>
<td style="text-align: right;">3370843066</td>
<td style="text-align: right;">9.4529626</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">21.63177</td>
<td style="text-align: right;">23.43442</td>
<td style="text-align: right;">13354197</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1968</td>
<td style="text-align: right;">3852115817</td>
<td style="text-align: right;">10.7962386</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">24.18725</td>
<td style="text-align: right;">23.13563</td>
<td style="text-align: right;">13744387</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">4257218772</td>
<td style="text-align: right;">8.4332803</td>
<td style="text-align: right;">2.569024</td>
<td style="text-align: right;">28.07076</td>
<td style="text-align: right;">23.78878</td>
<td style="text-align: right;">14144438</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1970</td>
<td style="text-align: right;">4863487493</td>
<td style="text-align: right;">8.8626571</td>
<td style="text-align: right;">2.738580</td>
<td style="text-align: right;">29.15267</td>
<td style="text-align: right;">22.07273</td>
<td style="text-align: right;">14550034</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1971</td>
<td style="text-align: right;">5077222367</td>
<td style="text-align: right;">-11.3317192</td>
<td style="text-align: right;">2.810513</td>
<td style="text-align: right;">27.66378</td>
<td style="text-align: right;">18.44252</td>
<td style="text-align: right;">14960109</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1972</td>
<td style="text-align: right;">6761786387</td>
<td style="text-align: right;">27.4239695</td>
<td style="text-align: right;">2.913274</td>
<td style="text-align: right;">25.72687</td>
<td style="text-align: right;">20.44956</td>
<td style="text-align: right;">15377093</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1973</td>
<td style="text-align: right;">8715105930</td>
<td style="text-align: right;">3.8131763</td>
<td style="text-align: right;">3.093106</td>
<td style="text-align: right;">31.58976</td>
<td style="text-align: right;">25.50366</td>
<td style="text-align: right;">15804428</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1974</td>
<td style="text-align: right;">13209713643</td>
<td style="text-align: right;">7.4949177</td>
<td style="text-align: right;">3.238469</td>
<td style="text-align: right;">35.48978</td>
<td style="text-align: right;">38.74904</td>
<td style="text-align: right;">16247113</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1975</td>
<td style="text-align: right;">15557934268</td>
<td style="text-align: right;">5.0453416</td>
<td style="text-align: right;">3.505006</td>
<td style="text-align: right;">42.96560</td>
<td style="text-align: right;">33.68894</td>
<td style="text-align: right;">16709099</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1976</td>
<td style="text-align: right;">17728347375</td>
<td style="text-align: right;">8.3867565</td>
<td style="text-align: right;">3.835554</td>
<td style="text-align: right;">37.11867</td>
<td style="text-align: right;">33.05458</td>
<td style="text-align: right;">17190239</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">20971901273</td>
<td style="text-align: right;">5.2585860</td>
<td style="text-align: right;">4.295409</td>
<td style="text-align: right;">41.74032</td>
<td style="text-align: right;">30.58657</td>
<td style="text-align: right;">17690184</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1978</td>
<td style="text-align: right;">26364491313</td>
<td style="text-align: right;">9.2148357</td>
<td style="text-align: right;">5.048133</td>
<td style="text-align: right;">40.16873</td>
<td style="text-align: right;">25.53584</td>
<td style="text-align: right;">18212326</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">33243422158</td>
<td style="text-align: right;">7.4778266</td>
<td style="text-align: right;">5.621026</td>
<td style="text-align: right;">32.86575</td>
<td style="text-align: right;">31.14830</td>
<td style="text-align: right;">18760761</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">42345277342</td>
<td style="text-align: right;">0.7906070</td>
<td style="text-align: right;">6.156025</td>
<td style="text-align: right;">30.33846</td>
<td style="text-align: right;">34.33846</td>
<td style="text-align: right;">19337715</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">44348672668</td>
<td style="text-align: right;">2.9999961</td>
<td style="text-align: right;">7.058181</td>
<td style="text-align: right;">30.87774</td>
<td style="text-align: right;">34.58725</td>
<td style="text-align: right;">19943664</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1982</td>
<td style="text-align: right;">45207088716</td>
<td style="text-align: right;">6.4000041</td>
<td style="text-align: right;">7.519963</td>
<td style="text-align: right;">28.99807</td>
<td style="text-align: right;">30.92486</td>
<td style="text-align: right;">20575701</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1983</td>
<td style="text-align: right;">48801369800</td>
<td style="text-align: right;">5.4000030</td>
<td style="text-align: right;">7.968692</td>
<td style="text-align: right;">25.80231</td>
<td style="text-align: right;">27.94181</td>
<td style="text-align: right;">21228289</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">53698278906</td>
<td style="text-align: right;">5.5999965</td>
<td style="text-align: right;">8.615462</td>
<td style="text-align: right;">27.46637</td>
<td style="text-align: right;">25.71002</td>
<td style="text-align: right;">21893853</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">57937868670</td>
<td style="text-align: right;">3.6999973</td>
<td style="text-align: right;">9.518560</td>
<td style="text-align: right;">26.74219</td>
<td style="text-align: right;">23.58393</td>
<td style="text-align: right;">22565905</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1986</td>
<td style="text-align: right;">63696301893</td>
<td style="text-align: right;">0.4000010</td>
<td style="text-align: right;">10.696159</td>
<td style="text-align: right;">23.17195</td>
<td style="text-align: right;">12.85476</td>
<td style="text-align: right;">23241272</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1987</td>
<td style="text-align: right;">66742267773</td>
<td style="text-align: right;">-0.6999975</td>
<td style="text-align: right;">11.492088</td>
<td style="text-align: right;">18.41211</td>
<td style="text-align: right;">14.27247</td>
<td style="text-align: right;">23917897</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">59089067187</td>
<td style="text-align: right;">-1.0000055</td>
<td style="text-align: right;">12.171448</td>
<td style="text-align: right;">22.60372</td>
<td style="text-align: right;">15.50787</td>
<td style="text-align: right;">24591492</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">55631489802</td>
<td style="text-align: right;">4.4000022</td>
<td style="text-align: right;">13.303923</td>
<td style="text-align: right;">28.51406</td>
<td style="text-align: right;">18.63926</td>
<td style="text-align: right;">25257672</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">62045099643</td>
<td style="text-align: right;">0.8000006</td>
<td style="text-align: right;">15.519364</td>
<td style="text-align: right;">24.93703</td>
<td style="text-align: right;">23.44369</td>
<td style="text-align: right;">25912367</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">45715367087</td>
<td style="text-align: right;">-1.2000006</td>
<td style="text-align: right;">19.536766</td>
<td style="text-align: right;">23.59976</td>
<td style="text-align: right;">29.11782</td>
<td style="text-align: right;">26554329</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">48003298223</td>
<td style="text-align: right;">1.8000023</td>
<td style="text-align: right;">25.723994</td>
<td style="text-align: right;">23.86949</td>
<td style="text-align: right;">25.31959</td>
<td style="text-align: right;">27181094</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">49946455211</td>
<td style="text-align: right;">-2.1000008</td>
<td style="text-align: right;">31.007786</td>
<td style="text-align: right;">23.13894</td>
<td style="text-align: right;">21.78388</td>
<td style="text-align: right;">27786259</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">42542571306</td>
<td style="text-align: right;">-0.8999965</td>
<td style="text-align: right;">40.014821</td>
<td style="text-align: right;">26.05371</td>
<td style="text-align: right;">22.53073</td>
<td style="text-align: right;">28362253</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">41764052458</td>
<td style="text-align: right;">3.7999948</td>
<td style="text-align: right;">51.931085</td>
<td style="text-align: right;">28.99623</td>
<td style="text-align: right;">26.19478</td>
<td style="text-align: right;">28904298</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">46941496780</td>
<td style="text-align: right;">4.0999985</td>
<td style="text-align: right;">61.631332</td>
<td style="text-align: right;">23.94470</td>
<td style="text-align: right;">29.76045</td>
<td style="text-align: right;">29411415</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">48177862502</td>
<td style="text-align: right;">1.0999999</td>
<td style="text-align: right;">65.164979</td>
<td style="text-align: right;">21.33760</td>
<td style="text-align: right;">30.90631</td>
<td style="text-align: right;">29886839</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">48187747529</td>
<td style="text-align: right;">5.1000036</td>
<td style="text-align: right;">68.390750</td>
<td style="text-align: right;">22.51610</td>
<td style="text-align: right;">22.57835</td>
<td style="text-align: right;">30335732</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">48640574567</td>
<td style="text-align: right;">3.2000016</td>
<td style="text-align: right;">70.200035</td>
<td style="text-align: right;">22.77900</td>
<td style="text-align: right;">28.15012</td>
<td style="text-align: right;">30765613</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">54790245601</td>
<td style="text-align: right;">3.8196785</td>
<td style="text-align: right;">70.438128</td>
<td style="text-align: right;">20.78863</td>
<td style="text-align: right;">42.06972</td>
<td style="text-align: right;">31183660</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">54744714396</td>
<td style="text-align: right;">3.0083955</td>
<td style="text-align: right;">73.414835</td>
<td style="text-align: right;">22.01686</td>
<td style="text-align: right;">36.68930</td>
<td style="text-align: right;">31592153</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">56760288974</td>
<td style="text-align: right;">5.6093232</td>
<td style="text-align: right;">74.456079</td>
<td style="text-align: right;">25.62963</td>
<td style="text-align: right;">35.50453</td>
<td style="text-align: right;">31995046</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">67863829880</td>
<td style="text-align: right;">7.2018722</td>
<td style="text-align: right;">77.634575</td>
<td style="text-align: right;">23.87594</td>
<td style="text-align: right;">38.24883</td>
<td style="text-align: right;">32403514</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">85324998814</td>
<td style="text-align: right;">4.3016243</td>
<td style="text-align: right;">80.710302</td>
<td style="text-align: right;">25.64820</td>
<td style="text-align: right;">40.05323</td>
<td style="text-align: right;">32831096</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">103198228459</td>
<td style="text-align: right;">5.9077913</td>
<td style="text-align: right;">81.826078</td>
<td style="text-align: right;">24.07340</td>
<td style="text-align: right;">47.20519</td>
<td style="text-align: right;">33288437</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">117027304747</td>
<td style="text-align: right;">1.6844883</td>
<td style="text-align: right;">83.717488</td>
<td style="text-align: right;">21.91933</td>
<td style="text-align: right;">48.81069</td>
<td style="text-align: right;">33777915</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">134977087734</td>
<td style="text-align: right;">3.3728752</td>
<td style="text-align: right;">86.797450</td>
<td style="text-align: right;">24.86996</td>
<td style="text-align: right;">47.06816</td>
<td style="text-align: right;">34300076</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">171000691878</td>
<td style="text-align: right;">2.3601349</td>
<td style="text-align: right;">91.014583</td>
<td style="text-align: right;">28.71118</td>
<td style="text-align: right;">47.97335</td>
<td style="text-align: right;">34860715</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">137211039898</td>
<td style="text-align: right;">1.6322438</td>
<td style="text-align: right;">96.236145</td>
<td style="text-align: right;">35.95268</td>
<td style="text-align: right;">35.37165</td>
<td style="text-align: right;">35465760</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">161207268655</td>
<td style="text-align: right;">3.6341454</td>
<td style="text-align: right;">100.000000</td>
<td style="text-align: right;">31.42211</td>
<td style="text-align: right;">38.44455</td>
<td style="text-align: right;">36117637</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">200019057308</td>
<td style="text-align: right;">2.8918660</td>
<td style="text-align: right;">104.524212</td>
<td style="text-align: right;">28.68532</td>
<td style="text-align: right;">38.78695</td>
<td style="text-align: right;">36819558</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">209058991952</td>
<td style="text-align: right;">3.3747687</td>
<td style="text-align: right;">113.817931</td>
<td style="text-align: right;">28.51443</td>
<td style="text-align: right;">36.89055</td>
<td style="text-align: right;">37565847</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">209755003251</td>
<td style="text-align: right;">2.7676389</td>
<td style="text-align: right;">117.521838</td>
<td style="text-align: right;">30.40093</td>
<td style="text-align: right;">33.20990</td>
<td style="text-align: right;">38338562</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">213810022462</td>
<td style="text-align: right;">3.7891212</td>
<td style="text-align: right;">120.949864</td>
<td style="text-align: right;">31.92666</td>
<td style="text-align: right;">30.21912</td>
<td style="text-align: right;">39113313</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">165979277277</td>
<td style="text-align: right;">3.7634670</td>
<td style="text-align: right;">126.736646</td>
<td style="text-align: right;">36.52335</td>
<td style="text-align: right;">23.17178</td>
<td style="text-align: right;">39871528</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">160129866570</td>
<td style="text-align: right;">3.3000000</td>
<td style="text-align: right;">134.844870</td>
<td style="text-align: right;">35.03223</td>
<td style="text-align: right;">20.86001</td>
<td style="text-align: right;">40606052</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">DZA</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">167555280113</td>
<td style="text-align: right;">1.6000000</td>
<td style="text-align: right;">142.384203</td>
<td style="text-align: right;">33.50147</td>
<td style="text-align: right;">22.63889</td>
<td style="text-align: right;">41318142</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>optim</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (par, fn, gr = NULL, ..., method = c("Nelder-Mead", 
    "BFGS", "CG", "L-BFGS-B", "SANN", "Brent"), lower = -Inf, 
    upper = Inf, control = list(), hessian = FALSE) 
{
    fn1 &lt;- function(par) fn(par, ...)
    gr1 &lt;- if (!is.null(gr)) 
        function(par) gr(par, ...)
    method &lt;- match.arg(method)
    if ((any(lower &gt; -Inf) || any(upper &lt; Inf)) &amp;&amp; !any(method == 
        c("L-BFGS-B", "Brent"))) {
        warning("bounds can only be used with method L-BFGS-B (or Brent)")
        method &lt;- "L-BFGS-B"
    }
    npar &lt;- length(par)
    con &lt;- list(trace = 0, fnscale = 1, parscale = rep.int(1, 
        npar), ndeps = rep.int(0.001, npar), maxit = 100L, abstol = -Inf, 
        reltol = sqrt(.Machine$double.eps), alpha = 1, beta = 0.5, 
        gamma = 2, REPORT = 10, warn.1d.NelderMead = TRUE, type = 1, 
        lmm = 5, factr = 1e+07, pgtol = 0, tmax = 10, temp = 10)
    nmsC &lt;- names(con)
    if (method == "Nelder-Mead") 
        con$maxit &lt;- 500
    if (method == "SANN") {
        con$maxit &lt;- 10000
        con$REPORT &lt;- 100
    }
    con[(namc &lt;- names(control))] &lt;- control
    if (length(noNms &lt;- namc[!namc %in% nmsC])) 
        warning("unknown names in control: ", paste(noNms, collapse = ", "))
    if (con$trace &lt; 0) 
        warning("read the documentation for 'trace' more carefully")
    else if (method == "SANN" &amp;&amp; con$trace &amp;&amp; as.integer(con$REPORT) == 
        0) 
        stop("'trace != 0' needs 'REPORT &gt;= 1'")
    if (method == "L-BFGS-B" &amp;&amp; any(!is.na(match(c("reltol", 
        "abstol"), namc)))) 
        warning("method L-BFGS-B uses 'factr' (and 'pgtol') instead of 'reltol' and 'abstol'")
    if (npar == 1 &amp;&amp; method == "Nelder-Mead" &amp;&amp; isTRUE(con$warn.1d.NelderMead)) 
        warning("one-dimensional optimization by Nelder-Mead is unreliable:\nuse \"Brent\" or optimize() directly")
    if (npar &gt; 1 &amp;&amp; method == "Brent") 
        stop("method = \"Brent\" is only available for one-dimensional optimization")
    lower &lt;- as.double(rep_len(lower, npar))
    upper &lt;- as.double(rep_len(upper, npar))
    res &lt;- if (method == "Brent") {
        if (any(!is.finite(c(upper, lower)))) 
            stop("'lower' and 'upper' must be finite values")
        res &lt;- optimize(function(par) fn(par, ...)/con$fnscale, 
            lower = lower, upper = upper, tol = con$reltol)
        names(res)[names(res) == c("minimum", "objective")] &lt;- c("par", 
            "value")
        res$value &lt;- res$value * con$fnscale
        c(res, list(counts = c(`function` = NA, gradient = NA), 
            convergence = 0L, message = NULL))
    }
    else .External2(C_optim, par, fn1, gr1, method, con, lower, 
        upper)
    if (hessian) 
        res$hessian &lt;- .External2(C_optimhess, res$par, fn1, 
            gr1, con)
    res
}
&lt;bytecode: 0x0000025146aad168&gt;
&lt;environment: namespace:stats&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="ot">&lt;-</span> gafa_stock <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>, <span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2018</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Close)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">ACF</span>(Close) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(<span class="fu">difference</span>(Close))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">ACF</span>(<span class="fu">difference</span>(Close)) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-hyndman_forecasting_2021" class="csl-entry" role="listitem">
Hyndman, Rob J., and George Athanasopoulos. 2021. <em>Forecasting: <span>Principles</span> and <span>Practice</span></em>. 3rd ed. edition. Melbourne, Australia: Otexts.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/peter-amerkhanian\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Basic Concepts in Forecasting"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../blog.bib"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Peter Amerkhanian"</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-3-17"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ['R', 'Statistics']</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-dpi: 300</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>Let's say we are analyzing the data in the BART time series that I've been using a various blog posts.</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>parquet_directory <span class="ot">&lt;-</span> <span class="st">"../dask-data-io/data/parquet_data"</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(parquet_directory)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>df_daily <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date) <span class="sc">%&gt;%</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">daily_riders=</span><span class="fu">sum</span>(Riders)) <span class="sc">%&gt;%</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(date, daily_riders)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>df_daily <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>I'll create a <span class="in">`tstibble`</span> of monthly BART riders, 2011 through the end of 2018 and run through some exercises where I try to forecast how many monthly riders there will be in 2019.  </span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>Here's the groundtruth dataset for $<span class="co">[</span><span class="ot">2011, 2019</span><span class="co">]</span>$:</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>df_daily_ts <span class="ot">&lt;-</span> df_daily <span class="sc">%&gt;%</span> </span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"2011-01-01"</span> <span class="sc">~</span> <span class="st">"2018-12-31"</span>)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="ot">&lt;-</span> df_daily_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_key</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">year_month =</span> <span class="sc">~</span> <span class="fu">yearmonth</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_riders =</span> <span class="fu">sum</span>(daily_riders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the date dynamically</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>earliest_date <span class="ot">&lt;-</span> <span class="fu">min</span>(df_monthly_ts<span class="sc">$</span>year_month)</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>latest_date <span class="ot">&lt;-</span> <span class="fu">max</span>(df_monthly_ts<span class="sc">$</span>year_month)</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>formatted_string <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%s through %s"</span>,</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">format</span>(earliest_date, <span class="st">"%b %Y"</span>),</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">format</span>(latest_date, <span class="st">"%b %Y"</span>))</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>plot_bart_series <span class="ot">&lt;-</span> <span class="cf">function</span>(title, subtitle) {</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>  df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> monthly_riders)) <span class="sc">+</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> .<span class="dv">9</span>,</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#619CFF"</span>)   <span class="sc">+</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="cf">if</span> (<span class="fu">missing</span>(subtitle)) {</span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>        subtitle</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Riders"</span>,</span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Month"</span></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Monthly Bart Rides"</span>, formatted_string)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>When analyzing a time series, we often want to produce a forecast, $\hat{y}_{T+h|T}$. I found this to be a weird looking term when I first saw it in <span class="co">[</span><span class="ot">@hyndman_forecasting_2021</span><span class="co">]</span>, so I'll break down what it's referring to here:  </span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>$\hat{y}$: The "hat" symbol (^) over the ($y$) indicates that</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>    this is an estimated value.</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$T$: This represents the most recent observation from the time series.</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>$h$: This is the "forecast horizon", indicating how many time</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a>    steps ahead from (T) we are forecasting.</span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>$|T$: The vertical bar ($|$) followed by ($T$) signifies that</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>    the forecast is conditional on the information available up to time</span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>    (T).  </span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>Thus,$\hat{y}_{T+h|T}$ is a forecast of the time series, $y$ at time $T+h$, given the</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>information available up to and including time $T$.</span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Benchmark Forecasts</span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predicting the mean</span></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>One of the most straightforward prediction models in the mean, a single scalar that minimizes mean-squared error across the data.</span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>\hat{y}_{T+h|T} = \frac{1}{T} \sum_{i=1}^T y_{i}</span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>We can calculate that on our BART data:</span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_monthly_ts<span class="sc">$</span>monthly_riders)</span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a>pred</span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a>So if we are forecasting with the mean, we'll simply predict always predict $\hat{y}=$<span class="in">`{r} scales::comma(pred)`</span> as the monthly rider total for all months going forward.  </span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Mean =</span> <span class="fu">MEAN</span>(monthly_riders))</span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"dotted"</span>,</span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model Evaluation</span></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a>If we want to evaluate that prediction, we would look at its residuals, $\hat{y}-y$, across the observed data. Here we'll take a look at the distribution of these residuals, which will be important for both model evaluation and model inference.</span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> df_monthly_ts<span class="sc">$</span>monthly_riders <span class="sc">-</span> pred</span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>residuals <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a>The most important checks on these are that their mean is 0 and that the residuals are not auto-correlated -- if those two conditions don't hold, that means that **the model can be improved**. In addition to those essential properties, it is also preferable that the residuals exhibit constant variance (homoscedasticity) and are normally distributed, but a model that fails on those last two conditions cannot necessarily be improved  <span class="co">[</span><span class="ot">@hyndman_forecasting_2021, chap 5.4</span><span class="co">]</span>.  </span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`gg_tsresiduals()`</span> from the <span class="in">`feast`</span> package to get some simple visuals that let us evaluate these diagnostics:</span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>df_monthly_ts <span class="sc">|&gt;</span></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">|&gt;</span></span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>()</span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a>From these visuals, I'll informally conclude that:  </span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The mean is 0</span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>There is significant autocorrelation </span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The residuals *look* kind of normally distributed</span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>The variance of the residuals is not constant -- we start out systematically overestimating ridership</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>Given that we failed on autocorrelation, we conclude that this model can be improved, and this is unsurprising given that we were just predicting the mean. However, we'll keep working with this model as we establish how to do inference on this forecast and produce prediction intervals, rather than just a point estimate forecast.</span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model Inference</span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>If we **assume that the distribution of future observations is normal**, a 95% prediction interval would be computed as follows:  </span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>\hat{y}_{T+h|T} \pm 1.96 \hat\sigma_h</span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>This follows from the fact that 95% of the area under a Gaussian curve lies within ~1.96 standard deviations, or, $1.96 \hat\sigma_h$, of the mean (<span class="co">[</span><span class="ot">see proof</span><span class="co">](https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule#Proof)</span>). 1.96 can be switched out with a different multiplier depending on the desired interval (<span class="co">[</span><span class="ot">see table</span><span class="co">](https://otexts.com/fpp3/prediction-intervals.html#prediction-intervals-1)</span>). When we are forecasting, the standard deviation of the forecast distribution is estimated using the <span class="co">[</span><span class="ot">corrected sample standard deviation</span><span class="co">](https://en.wikipedia.org/wiki/Standard_deviation#Corrected_sample_standard_deviation)</span> of the residuals.</span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>  \hat{\sigma} = \sqrt{\frac{1}{T-K-M}\sum_{t=1}^T e_t^2}</span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a>sample_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( (<span class="dv">1</span> <span class="sc">/</span> (T <span class="sc">-</span> K <span class="sc">-</span> M)) <span class="sc">*</span> <span class="fu">sum</span>(residuals<span class="sc">^</span><span class="dv">2</span>) )</span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>interval_95 <span class="ot">&lt;-</span> <span class="fl">1.96</span> <span class="sc">*</span> sample_sd</span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a>interval_95</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>So for our mean forecast, the prediction interval would be <span class="in">`{r} pred %&gt;% scales::comma()`</span> $\pm$ <span class="in">`{r} interval_95 %&gt;% scales::comma()`</span> </span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">12</span>)</span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fc_mean)</span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a>We can also relax some of the assumptions necessary for theoretical inference by using bootstrapping, where we only have to assume that the residuals are uncorrelated and have constant variance. To be fair, both of these conditions are violated in this example model, but we'll still bootstrap this as an example.  </span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a>When we bootstrap a time series forecast, we use the following equation:  </span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a>y^*_{T+1} &amp;= y_{T} + e^*_{T+1} <span class="sc">\\</span></span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a>y^*_{T+2} &amp;= y_{T+1}^* + e^*_{T+2} <span class="sc">\\</span></span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>y^*_{T+h} &amp;= y_{T+h-1}^* + e^*_{T+h}</span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>$$   </span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>Where each $e^*_{T+h}$ is a random sample with replacement from the residuals distribution.  </span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: </span></span>
<span id="cb25-243"><a href="#cb25-243" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Bootstrap Simulations, b=1"</span></span>
<span id="cb25-244"><a href="#cb25-244" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Bootstrapped Prediction Interval, b=5000"</span></span>
<span id="cb25-245"><a href="#cb25-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb25-246"><a href="#cb25-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-247"><a href="#cb25-247" aria-hidden="true" tabindex="-1"></a>bootstrapped_fs <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-248"><a href="#cb25-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb25-249"><a href="#cb25-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">h =</span> <span class="dv">12</span>, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-250"><a href="#cb25-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-251"><a href="#cb25-251" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb25-252"><a href="#cb25-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> bootstrapped_fs, <span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">linewidth=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">y =</span> .sim, <span class="at">colour =</span> <span class="fu">as.factor</span>(.rep) )) <span class="sc">+</span></span>
<span id="cb25-253"><a href="#cb25-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>)</span>
<span id="cb25-254"><a href="#cb25-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-255"><a href="#cb25-255" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-256"><a href="#cb25-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(monthly_riders)) <span class="sc">%&gt;%</span></span>
<span id="cb25-257"><a href="#cb25-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">12</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>, <span class="at">times =</span> <span class="dv">5000</span>)</span>
<span id="cb25-258"><a href="#cb25-258" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fc_mean) <span class="sc">+</span></span>
<span id="cb25-259"><a href="#cb25-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-260"><a href="#cb25-260" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-261"><a href="#cb25-261" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb25-262"><a href="#cb25-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-263"><a href="#cb25-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-264"><a href="#cb25-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-265"><a href="#cb25-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-266"><a href="#cb25-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-267"><a href="#cb25-267" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Walk</span></span>
<span id="cb25-268"><a href="#cb25-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-269"><a href="#cb25-269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-270"><a href="#cb25-270" aria-hidden="true" tabindex="-1"></a>\hat{y}_{T+h|T} = y_T</span>
<span id="cb25-271"><a href="#cb25-271" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-274"><a href="#cb25-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-275"><a href="#cb25-275" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-276"><a href="#cb25-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Naive =</span> <span class="fu">NAIVE</span>(monthly_riders))</span>
<span id="cb25-277"><a href="#cb25-277" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb25-278"><a href="#cb25-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-279"><a href="#cb25-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb25-280"><a href="#cb25-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-281"><a href="#cb25-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"solid"</span>,</span>
<span id="cb25-282"><a href="#cb25-282" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb25-283"><a href="#cb25-283" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-284"><a href="#cb25-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-285"><a href="#cb25-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb25-286"><a href="#cb25-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-287"><a href="#cb25-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb25-288"><a href="#cb25-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb25-289"><a href="#cb25-289" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb25-290"><a href="#cb25-290" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-291"><a href="#cb25-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span>
<span id="cb25-292"><a href="#cb25-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-293"><a href="#cb25-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-296"><a href="#cb25-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-297"><a href="#cb25-297" aria-hidden="true" tabindex="-1"></a>fc_mean <span class="ot">&lt;-</span> df_monthly_ts <span class="sc">%&gt;%</span></span>
<span id="cb25-298"><a href="#cb25-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(monthly_riders))</span>
<span id="cb25-299"><a href="#cb25-299" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bart_series</span>(<span class="st">"Mean Forecast"</span>) <span class="sc">+</span></span>
<span id="cb25-300"><a href="#cb25-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-301"><a href="#cb25-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>),</span>
<span id="cb25-302"><a href="#cb25-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-303"><a href="#cb25-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype=</span><span class="st">"solid"</span>,</span>
<span id="cb25-304"><a href="#cb25-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb25-305"><a href="#cb25-305" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-306"><a href="#cb25-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb25-307"><a href="#cb25-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fc_mean <span class="sc">%&gt;%</span> <span class="fu">augment</span>(),</span>
<span id="cb25-308"><a href="#cb25-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb25-309"><a href="#cb25-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb25-310"><a href="#cb25-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span>.<span class="dv">5</span>,</span>
<span id="cb25-311"><a href="#cb25-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)</span>
<span id="cb25-312"><a href="#cb25-312" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-313"><a href="#cb25-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>)</span>
<span id="cb25-314"><a href="#cb25-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-315"><a href="#cb25-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-316"><a href="#cb25-316" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exponential Smoothing</span></span>
<span id="cb25-317"><a href="#cb25-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-318"><a href="#cb25-318" aria-hidden="true" tabindex="-1"></a>Exponential Smoothing is a popular forecasting method where the forecast</span>
<span id="cb25-319"><a href="#cb25-319" aria-hidden="true" tabindex="-1"></a>is simply a weighted average of past observations, with weights</span>
<span id="cb25-320"><a href="#cb25-320" aria-hidden="true" tabindex="-1"></a>decreasing exponentially as observations get older</span>
<span id="cb25-321"><a href="#cb25-321" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@hyndman_forecasting_2021, chapter 8</span><span class="co">]</span>.</span>
<span id="cb25-322"><a href="#cb25-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-323"><a href="#cb25-323" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@hyndman_forecasting_2021, chapter 9</span><span class="co">]</span></span>
<span id="cb25-324"><a href="#cb25-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-327"><a href="#cb25-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-328"><a href="#cb25-328" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb25-329"><a href="#cb25-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-330"><a href="#cb25-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-333"><a href="#cb25-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-334"><a href="#cb25-334" aria-hidden="true" tabindex="-1"></a>algeria_economy <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span></span>
<span id="cb25-335"><a href="#cb25-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Algeria"</span>)</span>
<span id="cb25-336"><a href="#cb25-336" aria-hidden="true" tabindex="-1"></a>algeria_economy </span>
<span id="cb25-337"><a href="#cb25-337" aria-hidden="true" tabindex="-1"></a>optim</span>
<span id="cb25-338"><a href="#cb25-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-339"><a href="#cb25-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-342"><a href="#cb25-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-343"><a href="#cb25-343" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="ot">&lt;-</span> gafa_stock <span class="sc">%&gt;%</span> </span>
<span id="cb25-344"><a href="#cb25-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>, <span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2018</span>)</span>
<span id="cb25-345"><a href="#cb25-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-346"><a href="#cb25-346" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Close)</span>
<span id="cb25-347"><a href="#cb25-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-348"><a href="#cb25-348" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">ACF</span>(Close) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span>
<span id="cb25-349"><a href="#cb25-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-350"><a href="#cb25-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-351"><a href="#cb25-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-354"><a href="#cb25-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-355"><a href="#cb25-355" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(<span class="fu">difference</span>(Close))</span>
<span id="cb25-356"><a href="#cb25-356" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">%&gt;%</span> <span class="fu">ACF</span>(<span class="fu">difference</span>(Close)) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span>
<span id="cb25-357"><a href="#cb25-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Peter Amerkhanian</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>