<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2025-04-20">
<meta name="description" content="Replace VBA with Python. Interacting with Excel using xlwings/pywin32 to produce formatted tables.">

<title>Using The Excel Object Model in Python – Peter Amerkhanian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile_backup.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V95HGLKTEB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V95HGLKTEB', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile_backup.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Professional</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Using The Excel Object Model in Python</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
                  <div>
        <div class="description">
          Replace VBA with Python. Interacting with Excel using <code>xlwings</code>/<code>pywin32</code> to produce formatted tables.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Data Management</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Amerkhanian </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title"><a href="#" class="nav-link">Using The Excel Object Model in Python</a></h2>
     
    <ul>
    <li><a href="#problem-setup" id="toc-problem-setup" class="nav-link active" data-scroll-target="#problem-setup">Problem Setup</a></li>
    <li><a href="#getting-connected-to-excel" id="toc-getting-connected-to-excel" class="nav-link" data-scroll-target="#getting-connected-to-excel">Getting connected to Excel</a></li>
    <li><a href="#interacting-with-the-excel-object-model" id="toc-interacting-with-the-excel-object-model" class="nav-link" data-scroll-target="#interacting-with-the-excel-object-model">Interacting with the Excel Object Model</a>
    <ul class="collapse">
    <li><a href="#autofit" id="toc-autofit" class="nav-link" data-scroll-target="#autofit">AutoFit</a></li>
    <li><a href="#number-formatting" id="toc-number-formatting" class="nav-link" data-scroll-target="#number-formatting">Number Formatting</a></li>
    <li><a href="#text-formatting" id="toc-text-formatting" class="nav-link" data-scroll-target="#text-formatting">Text Formatting</a></li>
    <li><a href="#shading-and-borders" id="toc-shading-and-borders" class="nav-link" data-scroll-target="#shading-and-borders">Shading and Borders</a></li>
    </ul></li>
    <li><a href="#a-package-approach" id="toc-a-package-approach" class="nav-link" data-scroll-target="#a-package-approach">A Package approach</a></li>
    <li><a href="#complex-tables" id="toc-complex-tables" class="nav-link" data-scroll-target="#complex-tables">Complex Tables</a></li>
    </ul>
    <div class="quarto-alternate-formats">
    <ul><li>
    <a id="github" href="#" target="_blank"><i class="bi bi-github"></i>Source Code</a>
  </li></ul>
</div>

  </nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<script>
  var githubLink = document.getElementById("github");
  var currentPath = window.location.pathname;
  githubLink.href = "https://github.com/peter-amerkhanian/peter-amerkhanian.github.io/blob/master" + currentPath;
  document.getElementById('toc-title').addEventListener('click', function(event) {
  event.preventDefault(); // Prevent default behavior of anchor tag
  const firstHeader = document.querySelector('body'); // Select the first h2 element
  if (firstHeader) {
    firstHeader.scrollIntoView({ behavior: 'smooth', block: "start", inline: "nearest"}); // Scroll to the first header smoothly
  }
});
</script>
<div id="cell-1" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xlwings <span class="im">as</span> xw</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code></pre></div>
</div>
<p>In this post, I’m going to overview how to use Python’s <code>xlwings</code> and <code>pywin32</code> libraries to produce formatted, human-readable tables in Excel. Beyond basic uses of <code>xlwings</code>, I’ll overview how to leverage <code>pywin32</code> and the <code>.api</code> attribute to interact directly with the Excel object model using VBA-like Python code. The approach allows one to produce highly customizable Excel tables that should satisfy any audience that prefers formatted spreadsheet output rather than, say, a quarto doc.</p>
<p>Alongside this blog post, I’ve been developing an <code>excel</code> submodule in <a href="https://github.com/peter-amerkhanian/swiss-code">my <code>swiss-code</code> package</a>, with various wrapper functions for <code>xlwings</code> and <code>pywin32</code>. I’ll also use this post to showcase that submodule, and specifically the <code>ExcelDataFrame</code> class that I’ve developed to integrate a given <code>pandas</code> dataframe with a corresponding table range in Excel.</p>
<section id="problem-setup" class="level2">
<h2 class="anchored" data-anchor-id="problem-setup">Problem Setup</h2>
<div id="cell-4" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code for dataset generation</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_df(num_transactions<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    customer_ids <span class="op">=</span> np.random.randint(<span class="dv">1000</span>, <span class="dv">5000</span>, num_transactions)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    transaction_amounts <span class="op">=</span> np.<span class="bu">round</span>(np.random.uniform(<span class="dv">5</span>, <span class="dv">500</span>, num_transactions), <span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    payment_methods <span class="op">=</span> np.random.choice([<span class="st">"Credit Card"</span>, <span class="st">"Debit Card"</span>, <span class="st">"PayPal"</span>, <span class="st">"Cash"</span>], num_transactions)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> np.random.choice([<span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Groceries"</span>, <span class="st">"Entertainment"</span>], num_transactions)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    transaction_dates <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">"2024-01-01"</span>, periods<span class="op">=</span>num_transactions, freq<span class="op">=</span><span class="st">"D"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transaction_id"</span>: <span class="bu">range</span>(<span class="dv">1</span>, num_transactions <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"customer_id"</span>: customer_ids,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amount"</span>: transaction_amounts,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"payment_method"</span>: payment_methods,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"category"</span>: categories,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: transaction_dates</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.year.astype(<span class="bu">str</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"class"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].<span class="bu">map</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Clothing"</span>: <span class="st">"Necessity"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Groceries"</span>: <span class="st">"Necessity"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Electronics"</span>: <span class="st">"Discretionary"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Entertainment"</span>: <span class="st">"Discretionary"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div>
</details>
</div>
<p>Say we have a dataset of customer transactions at a super store. I simulated this data arbitrarily.</p>
<div id="cell-6" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> simulate_df()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">transaction_id</th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">amount</th>
<th data-quarto-table-cell-role="th">payment_method</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2061</td>
<td>177.75</td>
<td>Debit Card</td>
<td>Electronics</td>
<td>2024-01-01</td>
<td>2024</td>
<td>Discretionary</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1235</td>
<td>33.20</td>
<td>Credit Card</td>
<td>Clothing</td>
<td>2024-01-02</td>
<td>2024</td>
<td>Necessity</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>4980</td>
<td>118.26</td>
<td>Credit Card</td>
<td>Groceries</td>
<td>2024-01-03</td>
<td>2024</td>
<td>Necessity</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>2096</td>
<td>333.73</td>
<td>Debit Card</td>
<td>Entertainment</td>
<td>2024-01-04</td>
<td>2024</td>
<td>Discretionary</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>4839</td>
<td>251.14</td>
<td>Credit Card</td>
<td>Electronics</td>
<td>2024-01-05</td>
<td>2024</td>
<td>Discretionary</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s imagine the case where a stakeholder asks for a report on the following:</p>
<ul>
<li>Total dollars transacted, broken down by key categories and payment method.</li>
</ul>
<p>It’s fairly straightforward to use <code>pandas</code> to make a pivot table report, complete with human-readable, title-cased indices and columns. In this case, I’ve aggregated the total dollars spent, dissagregated by payment method and category of good. Some users prefer that the pivot table also include subtotals, and we flexibly add those with <code>margins=True</code>.</p>
<div id="cell-8" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dollars_by_method <span class="op">=</span> df.pivot_table(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"payment_method"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"category"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">"amount"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">"sum"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    margins_name<span class="op">=</span><span class="st">"Total"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>dollars_by_method.index.name <span class="op">=</span> <span class="st">"Payment Method"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>dollars_by_method.columns.name <span class="op">=</span> <span class="st">"Category"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>dollars_by_method</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Clothing</th>
<th data-quarto-table-cell-role="th">Electronics</th>
<th data-quarto-table-cell-role="th">Entertainment</th>
<th data-quarto-table-cell-role="th">Groceries</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Payment Method</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cash</td>
<td>15016.00</td>
<td>17026.47</td>
<td>18208.16</td>
<td>18242.88</td>
<td>68493.51</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>16074.92</td>
<td>10960.64</td>
<td>16052.85</td>
<td>20187.25</td>
<td>63275.66</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>14032.23</td>
<td>17325.96</td>
<td>14363.99</td>
<td>17188.67</td>
<td>62910.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>14143.84</td>
<td>15108.84</td>
<td>16852.17</td>
<td>12065.14</td>
<td>58169.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>59266.99</td>
<td>60421.91</td>
<td>65477.17</td>
<td>67683.94</td>
<td>252850.01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>That’s a fine-enough <code>pandas</code> dataframe, but now the question arises of how to best serve this data to the end-user.</p>
<p>There are several options – lately I’ve been using Quarto reports or else Tableau dashboards for these sorts of analytics projects. However, those formats are very “finalized” and can be a little unsatisfying for end-users who want to further filter or modify table output. If that audience doesn’t use R/Python, access to underlying <code>.ipynb</code> or <code>.qmd</code> files will not be helpful. This is the case where I think that spreadsheet output, and specifically reproducible, formatted Excel worksheets, can be very potent.</p>
</section>
<section id="getting-connected-to-excel" class="level2">
<h2 class="anchored" data-anchor-id="getting-connected-to-excel">Getting connected to Excel</h2>
<p>To write a <code>pandas</code> dataframe out to Excel, we’ll work through the Excel/<code>xlwings</code> <a href="https://docs.xlwings.org/en/stable/syntax_overview.html#object-hierarchy">object hierarchy</a>:</p>
<ul>
<li>Application<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="math inline">\(\rightarrow\)</span> Work Book <span class="math inline">\(\rightarrow\)</span> Sheet <span class="math inline">\(\rightarrow\)</span> Range.</li>
</ul>
<p>In <code>xlwings</code> we’ll establish a <code>xw.Book</code> object, which either creates or opens an existing excel work book, in this case <code>test.xlsx</code>.</p>
<div id="cell-13" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"test.xlsx"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(filename):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        wb <span class="op">=</span> xw.Book(filename)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    wb <span class="op">=</span> xw.Book()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    wb.save(filename)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>wb</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>&lt;Book [test.xlsx]&gt;</code></pre>
</div>
</div>
<p>Next, we establish an <code>xw.Sheet</code> within that <code>xw.Book</code> object, in this case I’ll call the sheet <code>first_test</code>.</p>
<div id="cell-15" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sheet_name <span class="op">=</span> <span class="st">'first_test'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    sheet_new <span class="op">=</span> wb.sheets.add(sheet_name) </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    sheet_new <span class="op">=</span> wb.sheets[sheet_name]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sheet_new</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;Sheet [test.xlsx]first_test&gt;</code></pre>
</div>
</div>
<p>At this point, we can select the sheet, <code>sheet_new</code>, select a start range, “A1”, then set it’s value with our dataframe object from the previous section, <code>dollars_by_method</code>. This will export the full dataframe into the spreadsheet.</p>
<div id="cell-17" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sheet_new.<span class="bu">range</span>(<span class="st">"A1"</span>).options(index<span class="op">=</span><span class="va">True</span>, header<span class="op">=</span><span class="va">True</span>).value <span class="op">=</span> dollars_by_method</span></code></pre></div>
</div>
<p>Then, when we save the book, we can inspect the output by opening <code>text.xlsx</code>. Note that the data were entered into cell <code>A1</code> and expanded as needed.</p>
<div id="cell-19" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="1.png" class="img-fluid"></p>
<p>This is an unattractive table, with no formatting and with poorly fitted columns. This is also equivalent to what we could get if we simply used the <code>df.to_excel()</code> method within <code>pandas</code>. We’ll proceed to format this table, that that is where we get the real value out of <code>xlwings</code>.</p>
</section>
<section id="interacting-with-the-excel-object-model" class="level2">
<h2 class="anchored" data-anchor-id="interacting-with-the-excel-object-model">Interacting with the Excel Object Model</h2>
<p>The most powerful aspect of <code>xlwings</code> is that it allows for interacting with the Excel object model – an API for programmatically editing Excel spreadsheets. One would typically interact with Excel’s object model via VBA code, but <code>xlwings</code> and <code>pywin32</code> together allow for us to use Python for a conceptually similar workflow.</p>
<p>Note that Microsoft provides a few key pieces of documentation that augment <a href="https://docs.xlwings.org/en/stable/api/index.html"><code>xlwings</code>’ own API reference</a>.</p>
<ol type="1">
<li>An overview of the object model concept and typical VBA workflows in <a href="https://learn.microsoft.com/en-us/office/vba/library-reference/concepts/getting-started-with-vba-in-office#vba-programming-101">in the “VBA Programming 101”</a> section of the Official VBA Reference, and,</li>
<li>A complete reference for the <a href="https://learn.microsoft.com/en-us/office/vba/api/overview/excel/object-model">Excel object model</a> in the Official VBA Reference.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Excel Object Model for VBA Reference</figcaption>
<p><img src="object_model.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>We can access the object model API from an <code>xw.Sheet</code> object by calling the <code>.api</code> attribute:</p>
<div id="cell-26" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sheet_new.api</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>&lt;win32com.gen_py.Microsoft Excel 16.0 Object Library._Worksheet instance at 0x2714414253696&gt;</code></pre>
</div>
</div>
<p>This is an instance of VBA’s Worksheet object, which has <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.worksheet">a documentation page in the VBA reference</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>The Worksheet Object</figcaption>
<p><img src="worksheet.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<section id="autofit" class="level3">
<h3 class="anchored" data-anchor-id="autofit">AutoFit</h3>
<p>Python objects have attributes and methods, whereas the VBA Worksheet object has properties and methods. One particularly useful property is <code>UsedRange</code>, which stores the range of cells that have data. We often access that property when we want to format a table.</p>
<div id="cell-30" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sheet_new.api.UsedRange</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;win32com.gen_py.Microsoft Excel 16.0 Object Library.Range instance at 0x2712378707792&gt;</code></pre>
</div>
</div>
<p>For very popular properties and methods from the Excel object model, such as <code>UsedRange</code>, the <code>xlwings</code> api has simplified python attributes and methods that allow one to avoid explicity accessing the object model api. E.g. we can call <code>xw.Sheet.used_range</code> for similar functionality to <code>xw.Sheet.UsedRange</code>.</p>
<div id="cell-32" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sheet_new.used_range</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>&lt;Range [test.xlsx]first_test!$A$1:$F$6&gt;</code></pre>
</div>
</div>
<p>I’ll stick with the former approach for now.</p>
<p>From the <code>UsedRange</code> attribute, which is a <code>Range</code> object, we can access the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.range.entirecolumn">EntireColumn</a> property, which selects the entire columns for a given range.</p>
<div id="cell-35" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sheet_new.api.UsedRange.EntireColumn</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>&lt;win32com.gen_py.Microsoft Excel 16.0 Object Library.Range instance at 0x2712379336816&gt;</code></pre>
</div>
</div>
<p>This is equivalent to the following selection:</p>
<p><img src="1.5.png" class="img-fluid"></p>
<p>For that <code>Range</code> object, we will now call the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.range.autofit">Autofit() method</a>.</p>
<div id="cell-39" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sheet_new.api.UsedRange.EntireColumn.AutoFit()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>True</code></pre>
</div>
</div>
<p>We get the following in Excel:</p>
<p><img src="2.png" class="img-fluid"></p>
<p>Let’s autofit the rows and the columns where there is currently data.</p>
<div id="cell-43" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sheet_new.api.UsedRange.EntireColumn.AutoFit()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sheet_new.api.UsedRange.EntireRow.AutoFit()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
</section>
<section id="number-formatting" class="level3">
<h3 class="anchored" data-anchor-id="number-formatting">Number Formatting</h3>
<p>Now we’ll move onto formatting the data, which represent dollar totals, as follows:</p>
<ul>
<li><code>11020</code> <span class="math inline">\(\rightarrow\)</span> <code>$11,020</code></li>
</ul>
<p>I’ll be using a mix of <code>xlwings</code> wrapper methods/attributes, and explicit calls to the Excel object model via <code>.api</code>, with no real commitment as to when to use which. Given that we get equivalent results, I’m of the mind that it doesn’t particularly matter.</p>
<p>We can apply dollar formatting to any range in Excel via the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.range.numberformat">NumberFormat</a> property – <a href="https://docs.xlwings.org/en/stable/api/range.html#xlwings.Range.number_format"><code>number_format</code></a> in <code>xlwings</code>. But to do that, we’ll first need to define a range that captures exactly where there is numerical data.</p>
<p>I’ll first select the top row of the sheet and retrieve its values, which are the column headers:</p>
<div id="cell-46" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> sheet_new.<span class="bu">range</span>(<span class="st">"A1"</span>).expand(<span class="st">"right"</span>).value</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>headers</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>['Payment Method',
 'Clothing',
 'Electronics',
 'Entertainment',
 'Groceries',
 'Total']</code></pre>
</div>
</div>
<p>We now want to access those columns that actually contain data (Payment Method is the index title and doesn’t contain data). We’ll do this by taking the index of Clothing, the first column with data, adding one,<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div id="cell-48" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>col_index <span class="op">=</span> headers.index(<span class="st">'Clothing'</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>col_index</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>2</code></pre>
</div>
</div>
<p>then retrieving the letter that corresponds to that index:</p>
<div id="cell-50" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>col_letter <span class="op">=</span> xw.utils.col_name(col_index) </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>col_letter</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>'B'</code></pre>
</div>
</div>
<p>Given the column letter, we can now select all of the data in that column:</p>
<div id="cell-52" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>col_letter<span class="sc">}</span><span class="ss">2:</span><span class="sc">{</span>col_letter<span class="sc">}</span><span class="ss">1000000"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>selection</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'B2:B1000000'</code></pre>
</div>
</div>
<p>Then we can set the number format (see <a href="https://support.microsoft.com/en-us/office/number-format-codes-in-excel-for-mac-5026bbd6-04bc-48cd-bf33-80f18b4eae68">supported Number format codes</a>):</p>
<div id="cell-54" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sheet_new.<span class="bu">range</span>(selection).number_format <span class="op">=</span> <span class="st">"$#,###.##"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="3.png" class="img-fluid"></p>
<p>To format all of the data, we’ll just iterate through the columns and execute that same chunk of code:</p>
<div id="cell-57" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> dollars_by_method.columns:</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    col_index <span class="op">=</span> headers.index(col) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    col_letter <span class="op">=</span> xw.utils.col_name(col_index)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>col_letter<span class="sc">}</span><span class="ss">2:</span><span class="sc">{</span>col_letter<span class="sc">}</span><span class="ss">1048576"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    sheet_new.<span class="bu">range</span>(selection).number_format <span class="op">=</span> <span class="st">"$#,###.##"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="4.png" class="img-fluid"></p>
</section>
<section id="text-formatting" class="level3">
<h3 class="anchored" data-anchor-id="text-formatting">Text Formatting</h3>
<p>Now I’d like to bold-format the index to differentiate it from the data.</p>
<p>We’ll use a similar process to make the column and index headers bold. I’ll translate the dataframe’s headers into an Excel range as follows – I retrieve the numerical index of the last column (indexed from 1)</p>
<div id="cell-61" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>last_column_index <span class="op">=</span> dollars_by_method.reset_index().shape[<span class="dv">1</span>]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>last_column_index</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>6</code></pre>
</div>
</div>
<p>I translate that into its column letter:</p>
<div id="cell-63" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>end_col <span class="op">=</span> xw.utils.col_name(last_column_index)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>end_col</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>'F'</code></pre>
</div>
</div>
<p>Then I use that to define the range of the columns, which are all in row 1:</p>
<div id="cell-65" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> <span class="ss">f"A1:</span><span class="sc">{</span>end_col<span class="sc">}</span><span class="ss">1"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>selection</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'A1:F1'</code></pre>
</div>
</div>
<p>With that range selection, we can access the <a href="https://docs.xlwings.org/en/stable/api/font.html"><code>.font</code> attribute in <code>xlwings</code></a>, which corresponds to the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.font(object)">Font object</a> in the Excel object model, and set <code>bold = True</code>.</p>
<div id="cell-67" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>header_range <span class="op">=</span> sheet_new.<span class="bu">range</span>(selection)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>header_range.font.bold <span class="op">=</span> <span class="va">True</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="5.png" class="img-fluid"></p>
<p>I’ll do the same with the index, capturing its range then setting <code>bold = True</code></p>
<div id="cell-70" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>end_row <span class="op">=</span> dollars_by_method.reset_index().shape[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> <span class="ss">f"A1:A</span><span class="sc">{</span>end_row<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>selection</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'A1:A6'</code></pre>
</div>
</div>
<div id="cell-71" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>header_range <span class="op">=</span> sheet_new.<span class="bu">range</span>(selection)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>header_range.font.bold <span class="op">=</span> <span class="va">True</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="6.png" class="img-fluid"></p>
</section>
<section id="shading-and-borders" class="level3">
<h3 class="anchored" data-anchor-id="shading-and-borders">Shading and Borders</h3>
<p>To finish the formatting, I’d also like to shade in the grand total column/row so as to differentiate it from unaggregated data, and add basic black borders on all cells.</p>
<p>We’ll be doing much the same as before when it comes to shading in rows/columns – we define a range that captures an entire target row/column, then access the appropriate object to format that range. I’ll reuse the <code>end_col</code> and <code>end_row</code> values defined above to get the range of the last column</p>
<div id="cell-75" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>total_col <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>end_col<span class="sc">}</span><span class="ss">1:</span><span class="sc">{</span>end_col<span class="sc">}{</span>end_row<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>total_col</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>'F1:F6'</code></pre>
</div>
</div>
<p>In excel, we set colors using RGB codes, which I like to get from <a href="https://htmlcolorcodes.com/">https://htmlcolorcodes.com/</a>, though any color-swatch site should suffice.</p>
<div id="cell-77" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>total_col <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>end_col<span class="sc">}</span><span class="ss">1:</span><span class="sc">{</span>end_col<span class="sc">}{</span>end_row<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>sheet_new.<span class="bu">range</span>(total_col).color <span class="op">=</span> (<span class="dv">242</span>, <span class="dv">242</span>, <span class="dv">242</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>total_row <span class="op">=</span> <span class="ss">f"A</span><span class="sc">{</span>end_row<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>end_col<span class="sc">}{</span>end_row<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>sheet_new.<span class="bu">range</span>(total_row).color <span class="op">=</span> (<span class="dv">242</span>, <span class="dv">242</span>, <span class="dv">242</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total Column:"</span>, total_col, <span class="st">"</span><span class="ch">\n</span><span class="st">Total Row:"</span>, total_row)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total Column: F1:F6 
Total Row: A6:F6</code></pre>
</div>
</div>
<p><img src="7.png" class="img-fluid"></p>
<p>For defining borders, we’ll just access the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.borders">Borders object</a> from the UsedRange, so that we apply the borders only where there is currently data. We set two properties for the Border:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/office/vba/api/excel.xllinestyle">LineStyle</a>, e.g.&nbsp;solid versus dashed.</li>
<li><a href="https://learn.microsoft.com/en-us/office/vba/api/excel.xlborderweight">Weight</a>, e.g.&nbsp;hairline versus thick.</li>
<li>There are several other properties we can change as needed in the <a href="https://learn.microsoft.com/en-us/office/vba/api/excel.borders#properties">Border object’s properties</a>, but I typically just focus on style and weight.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
<div id="cell-80" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sheet_new.used_range.api.Borders.LineStyle <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>sheet_new.used_range.api.Borders.Weight <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>wb.save()</span></code></pre></div>
</div>
<p><img src="8.png" class="img-fluid"></p>
</section>
</section>
<section id="a-package-approach" class="level2">
<h2 class="anchored" data-anchor-id="a-package-approach">A Package approach</h2>
<p><code>xlwings</code> is great, but sometimes bridging the gap between working on a <code>pandas</code> dataframe and an Excel object can be a little involved. For example, formatting a column requires finding that column within Excel then programatically defining its range, being mindful of the different numerical indexing systems in Python vs.&nbsp;Excel, potential issues with <code>pd.MultiIndex</code> objects, etc.</p>
<p>This can require a lot of code, so I defined a set of wrapper functions, and eventually an entire class, <code>ExcelDataFrame</code>, to facilitate moving between <code>pandas</code> and Excel. This class is part of the submodule, <code>swiss_code.excel</code>, which is a part of my <a href="https://github.com/peter-amerkhanian/swiss-code">larger <code>swiss_code</code> package</a>.</p>
<p>You can download as follows:</p>
<pre><code>pip install git+https://github.com/peter-amerkhanian/swiss-code.git@main</code></pre>
<div id="cell-85" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>My environment specific setup</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'../../../swiss-code/src'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code></pre></div>
</details>
</div>
<p>Once you have the package installed, you can import the <code>excel</code> submodule.</p>
<div id="cell-87" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> swiss_code.excel <span class="im">import</span> excel</span></code></pre></div>
</div>
<p>Given a <code>pandas</code> dataframe and an Excel sheet, we can establish an <code>ExcelDataFrame</code> object via the <code>excel.write_df_to_excel</code> function. This will write the <code>pandas</code> dataframe into the Excel sheet, and establish an object that can be further manipulated.</p>
<div id="cell-89" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> excel.get_or_create_workbook(<span class="st">"test.xlsx"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>function_sheet <span class="op">=</span> excel.select_sheet(<span class="st">'function_sheet'</span>, wb)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>edf <span class="op">=</span> excel.write_df_to_excel(df<span class="op">=</span>dollars_by_method,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                              sheet<span class="op">=</span>function_sheet,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                              cell_start<span class="op">=</span><span class="st">"A1"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>edf</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>ACTIVE ExcelDataFrame(sheet=function_sheet, range=$A$1:$F$6, df_shape=(5, 5))</code></pre>
</div>
</div>
<p>We’ll now complete all the same formatting tasks as before via method calls:</p>
<div id="cell-91" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> edf.df.columns:</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    edf.format_column_data(col, <span class="bu">format</span><span class="op">=</span><span class="st">"$#,###.##"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>edf.make_borders()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>edf.format_indices(bold<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>edf.format_row(<span class="st">'Total'</span>, bold<span class="op">=</span><span class="st">"ignore"</span>, color<span class="op">=</span><span class="st">"light_grey"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>edf.format_column(<span class="st">'Total'</span>, bold<span class="op">=</span><span class="st">"ignore"</span>, color<span class="op">=</span><span class="st">"light_grey"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>excel.close_out_book(wb)</span></code></pre></div>
</div>
<p>Once <code>excel.close_out_book(wb)</code> has been called, the <code>edf</code> no longer has an active connection to any workbook.</p>
<div id="cell-93" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>edf</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code> DISCONNECTED ExcelDataFrame(sheet=NA, range=NA, df_shape=(5, 5))</code></pre>
</div>
</div>
</section>
<section id="complex-tables" class="level2">
<h2 class="anchored" data-anchor-id="complex-tables">Complex Tables</h2>
<p>I’ll show some further functionality of the <code>ExcelDataFrame</code> class in the case of a much more complicated pivot table. Let’s say that a stakeholder wants something like the previous report, but with more disaggregation:</p>
<ul>
<li>Total dollars transacted, broken down by discretionary vs.&nbsp;essential, and broken down by key categories and payment method, for each year available. Include subtotals for each year.</li>
</ul>
<p>This is a fairly complex pivot table, and requires a little bit for code beyond just <code>pd.pivot_table</code>. I’ll iterate over years and generate pivot tables with subtotals for each, then I’ll concatenate them together:</p>
<div id="cell-96" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year Pivots w/ subtotals</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr <span class="op">=</span> pd.concat(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    [df[df[<span class="st">'year'</span>] <span class="op">==</span> year]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>     .pivot_table(index<span class="op">=</span>[<span class="st">"payment_method"</span>], </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                  columns<span class="op">=</span>[<span class="st">"class"</span>, <span class="st">"category"</span>],</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                  values<span class="op">=</span><span class="st">"amount"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                  aggfunc<span class="op">=</span><span class="st">"sum"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                  margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                  margins_name<span class="op">=</span><span class="st">"Total"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                  .reset_index()</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                  .assign(Year<span class="op">=</span>year)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                  .set_index([<span class="st">'Year'</span>, <span class="st">'payment_method'</span>])</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> year <span class="kw">in</span> [<span class="st">'2024'</span>, <span class="st">'2025'</span>, <span class="st">'2026'</span>]],</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>                  axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr <span class="op">=</span> dollars_by_method_yr.fillna(<span class="dv">0</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">class</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Discretionary</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Necessity</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">Electronics</th>
<th data-quarto-table-cell-role="th">Entertainment</th>
<th data-quarto-table-cell-role="th">Clothing</th>
<th data-quarto-table-cell-role="th">Groceries</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">payment_method</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2024</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>5182.41</td>
<td>8661.28</td>
<td>5709.71</td>
<td>6552.53</td>
<td>26105.93</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>2976.99</td>
<td>5334.29</td>
<td>5846.53</td>
<td>7983.28</td>
<td>22141.09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>6997.97</td>
<td>4998.41</td>
<td>4887.89</td>
<td>5603.41</td>
<td>22487.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>5649.27</td>
<td>7034.34</td>
<td>5225.22</td>
<td>3945.90</td>
<td>21854.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>20806.64</td>
<td>26028.32</td>
<td>21669.35</td>
<td>24085.12</td>
<td>92589.43</td>
</tr>
<tr class="even">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2025</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>6148.02</td>
<td>5110.80</td>
<td>4651.67</td>
<td>7717.81</td>
<td>23628.30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>4618.44</td>
<td>5946.31</td>
<td>6843.13</td>
<td>5828.80</td>
<td>23236.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>6606.99</td>
<td>7087.51</td>
<td>5801.20</td>
<td>4554.53</td>
<td>24050.23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>5220.53</td>
<td>5592.94</td>
<td>6203.22</td>
<td>3442.25</td>
<td>20458.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>22593.98</td>
<td>23737.56</td>
<td>23499.22</td>
<td>21543.39</td>
<td>91374.15</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2026</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>5696.04</td>
<td>4436.08</td>
<td>4654.62</td>
<td>3972.54</td>
<td>18759.28</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>3365.21</td>
<td>4772.25</td>
<td>3385.26</td>
<td>6375.17</td>
<td>17897.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>3721.00</td>
<td>2278.07</td>
<td>3343.14</td>
<td>7030.73</td>
<td>16372.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>4239.04</td>
<td>4224.89</td>
<td>2715.40</td>
<td>4676.99</td>
<td>15856.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>17021.29</td>
<td>15711.29</td>
<td>14098.42</td>
<td>22055.43</td>
<td>68886.43</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Then I’ll attach a grand total at the bottom:</p>
<div id="cell-98" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grand Total</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr.loc[(<span class="st">"Grand Total"</span>, <span class="st">""</span>), :] <span class="op">=</span> (</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    df.pivot_table(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"class"</span>, <span class="st">"category"</span>],</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">"amount"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span><span class="st">"sum"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        margins_name<span class="op">=</span><span class="st">"Total"</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        )[<span class="st">"amount"</span>]</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Table Formatting</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr.index.names <span class="op">=</span> [<span class="st">"Year"</span>, <span class="st">"Payment Method"</span>]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr.columns.names <span class="op">=</span> [<span class="st">'Class'</span>, <span class="st">'Category'</span>]</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>dollars_by_method_yr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Discretionary</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Necessity</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Electronics</th>
<th data-quarto-table-cell-role="th">Entertainment</th>
<th data-quarto-table-cell-role="th">Clothing</th>
<th data-quarto-table-cell-role="th">Groceries</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Payment Method</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2024</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>5182.41</td>
<td>8661.28</td>
<td>5709.71</td>
<td>6552.53</td>
<td>26105.93</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>2976.99</td>
<td>5334.29</td>
<td>5846.53</td>
<td>7983.28</td>
<td>22141.09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>6997.97</td>
<td>4998.41</td>
<td>4887.89</td>
<td>5603.41</td>
<td>22487.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>5649.27</td>
<td>7034.34</td>
<td>5225.22</td>
<td>3945.90</td>
<td>21854.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>20806.64</td>
<td>26028.32</td>
<td>21669.35</td>
<td>24085.12</td>
<td>92589.43</td>
</tr>
<tr class="even">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2025</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>6148.02</td>
<td>5110.80</td>
<td>4651.67</td>
<td>7717.81</td>
<td>23628.30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>4618.44</td>
<td>5946.31</td>
<td>6843.13</td>
<td>5828.80</td>
<td>23236.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>6606.99</td>
<td>7087.51</td>
<td>5801.20</td>
<td>4554.53</td>
<td>24050.23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>5220.53</td>
<td>5592.94</td>
<td>6203.22</td>
<td>3442.25</td>
<td>20458.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>22593.98</td>
<td>23737.56</td>
<td>23499.22</td>
<td>21543.39</td>
<td>91374.15</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2026</td>
<td data-quarto-table-cell-role="th">Cash</td>
<td>5696.04</td>
<td>4436.08</td>
<td>4654.62</td>
<td>3972.54</td>
<td>18759.28</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Card</td>
<td>3365.21</td>
<td>4772.25</td>
<td>3385.26</td>
<td>6375.17</td>
<td>17897.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debit Card</td>
<td>3721.00</td>
<td>2278.07</td>
<td>3343.14</td>
<td>7030.73</td>
<td>16372.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PayPal</td>
<td>4239.04</td>
<td>4224.89</td>
<td>2715.40</td>
<td>4676.99</td>
<td>15856.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>17021.29</td>
<td>15711.29</td>
<td>14098.42</td>
<td>22055.43</td>
<td>68886.43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Grand Total</td>
<td data-quarto-table-cell-role="th"></td>
<td>60421.91</td>
<td>65477.17</td>
<td>59266.99</td>
<td>67683.94</td>
<td>252850.01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Getting that complex table into a formatted Excel table presents a couple complications:</p>
<ul>
<li>There is a multi-index, which <code>pandas</code> presents as merged. In Excel, these merged multi-indexes will just render with the value repeated over the merged range.</li>
<li>We will want to shade and bold all subtotals to match the previous table’s formatting. This will be a little more difficult given that they exist for each year.</li>
</ul>
<div id="cell-100" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> excel.get_or_create_workbook(<span class="st">"test.xlsx"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>complex_sheet <span class="op">=</span> excel.select_sheet(<span class="st">'complex_sheet'</span>, wb)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>edf <span class="op">=</span> excel.write_df_to_excel(dollars_by_method_yr,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                              complex_sheet,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                              cell_start<span class="op">=</span><span class="st">"A1"</span>)</span></code></pre></div>
</div>
<p><img src="9.png" class="img-fluid"></p>
<p>I’ve defined a suit of methods to deal with this – notably <code>edf.merge_axis</code> for dealing with any cell merging problems, and I can use simple for loops to format the “total” rows. I also added in some vertical and horizontal alignment options when formatting.</p>
<div id="cell-103" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>edf.merge_axis(index<span class="op">=</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>edf.merge_axis(index<span class="op">=</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>edf.format_indices(bold<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"light_grey"</span>, v_align<span class="op">=</span><span class="st">'Center'</span>, h_align<span class="op">=</span><span class="st">'Center'</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> edf.df.columns:</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    edf.format_column_data(col, <span class="bu">format</span><span class="op">=</span><span class="st">"$#,###.##"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> df[<span class="st">'year'</span>].unique():</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    edf.format_row((year, <span class="st">'Total'</span>), bold<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"light_grey"</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>edf.format_row((<span class="st">'Grand Total'</span>, <span class="st">''</span>), bold<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"light_grey"</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>edf.format_column((<span class="st">'Total'</span>, <span class="st">''</span>), bold<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"light_grey"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>edf.make_borders()</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>excel.close_out_book(wb)</span></code></pre></div>
</div>
<p><img src="complex.png" class="img-fluid"></p>
<p>This package is a work in progress, so feel free to let me know if you have any ideas of how the design could be improved!</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Dealing with the Application object in <code>xlwings</code> is optional, and the workflow outlined in this blog just ignores it.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Excel indexes from 1 whereas python indexes from 0, so adding 1 will be common in a lot of these workflows<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I found out about these pages through this <a href="https://stackoverflow.com/questions/73014614/win32com-linestyle-excel/73015199#73015199">excellent stackoverflow answer</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{amerkhanian2025,
  author = {Amerkhanian, Peter},
  title = {Using {The} {Excel} {Object} {Model} in {Python}},
  date = {2025-04-20},
  url = {https://peter-amerkhanian.com/posts/excel-wings/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-amerkhanian2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Amerkhanian, Peter. 2025. <span>“Using The Excel Object Model in
Python.”</span> April 20, 2025. <a href="https://peter-amerkhanian.com/posts/excel-wings/">https://peter-amerkhanian.com/posts/excel-wings/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/peter-amerkhanian\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Peter Amerkhanian</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>