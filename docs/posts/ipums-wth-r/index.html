<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2024-12-29">
<meta name="description" content="A general overview of retrieving and working with IPUMS data in R.">

<title>Working with ACS microdata in R – Peter Amerkhanian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V95HGLKTEB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V95HGLKTEB', { 'anonymize_ip': true});
</script>
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../memos.html"> 
<span class="menu-text">Memos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Professional</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Working with ACS microdata in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          A general overview of retrieving and working with IPUMS data in R.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Data Management</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Amerkhanian </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 29, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title"><a href="#" class="nav-link">Working with ACS microdata in R</a></h2>
     
    <ul>
    <li><a href="#aggregate-data-with-tidycensus" id="toc-aggregate-data-with-tidycensus" class="nav-link active" data-scroll-target="#aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></a></li>
    <li><a href="#microdata-with-ipums" id="toc-microdata-with-ipums" class="nav-link" data-scroll-target="#microdata-with-ipums">Microdata with IPUMS</a>
    <ul class="collapse">
    <li><a href="#step-1-retrieving-data" id="toc-step-1-retrieving-data" class="nav-link" data-scroll-target="#step-1-retrieving-data">Step 1: Retrieving data</a></li>
    <li><a href="#step-2-using-geocorr-to-identify-geographies" id="toc-step-2-using-geocorr-to-identify-geographies" class="nav-link" data-scroll-target="#step-2-using-geocorr-to-identify-geographies">Step 2: Using Geocorr to Identify Geographies</a></li>
    <li><a href="#step-3-filtering-to-desired-granularity" id="toc-step-3-filtering-to-desired-granularity" class="nav-link" data-scroll-target="#step-3-filtering-to-desired-granularity">Step 3: Filtering to desired granularity</a></li>
    <li><a href="#step-4-applying-sample-weights" id="toc-step-4-applying-sample-weights" class="nav-link" data-scroll-target="#step-4-applying-sample-weights">Step 4: Applying sample weights</a></li>
    <li><a href="#step-5-applying-replicate-weights" id="toc-step-5-applying-replicate-weights" class="nav-link" data-scroll-target="#step-5-applying-replicate-weights">Step 5: Applying replicate weights</a></li>
    </ul></li>
    <li><a href="#analyzing-acs-microdata" id="toc-analyzing-acs-microdata" class="nav-link" data-scroll-target="#analyzing-acs-microdata">Analyzing ACS microdata</a></li>
    </ul>
  </nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<script>
  document.getElementById('toc-title').addEventListener('click', function(event) {
  event.preventDefault(); // Prevent default behavior of anchor tag
  const firstHeader = document.querySelector('body'); // Select the first h2 element
  if (firstHeader) {
    firstHeader.scrollIntoView({ behavior: 'smooth', block: "start", inline: "nearest"}); // Scroll to the first header smoothly
  }
});
</script>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Statistics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               modelsummary,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               srvyr,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               survey,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Webscraping</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               httr,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               rvest,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               readr,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               glue,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Census</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>               tidycensus,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>               ipumsr)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> raw, <span class="sc">~</span> clean, <span class="sc">~</span> fmt,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
</div>
<p>In this post, I’m going to cover how to use American Community Survey (ACS) microdata, leveraging the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> I’ll cover:</p>
<ol type="1">
<li><strong>Retrieval</strong>: how to choose which ACS product is relevant, how to submit a request to IPUMS, and how to filter down to relevant levels of geography/granularity.</li>
<li><strong>Analysis</strong>: how to properly weight ACS data using sample and replication weights for accurate data visualizations and statistical models.</li>
</ol>
<p>I’ll start with a question: <strong>What was the median household income in Oakland, California in 2022?</strong></p>
<section id="aggregate-data-with-tidycensus" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></h2>
<p>Answering that question is straightforward using <em>aggregate</em> data from the U.S. Census, which provides various descriptive statistics for aggregate geographies. I might use a web-based tool like <a href="https://censusreporter.org/">Census Reporter</a> to quickly look it up, but for an analysis, I would like the data retrieval to be carried out transparently via an API.</p>
<p>In R, the <code>tidycensus</code> package provides an easy-to-use wrapper for the Census API. Note that I set up an API key for the U.S. Census and I’m storing it in my <code>.Renviron</code> file as <code>census_api_key</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span></code></pre></div>
</div>
<p>I query <code>B19013_001</code>, the median household income variable, using the 2022 1-year American Community Survey sample<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and I filter down to Oakland’s GEOID, <code>0653000</code>, which is a combination of the state code for California, <code>06</code>, and the place code for Oakland, <code>53000</code>. I’ll throw in the total population variable for good measure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Done! Aggregate census data like this is very useful, and <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span> offers a comprehensive treatment of working with aggregate census data.</p>
</section>
<section id="microdata-with-ipums" class="level2">
<h2 class="anchored" data-anchor-id="microdata-with-ipums">Microdata with IPUMS</h2>
<p>What if instead of the median, I wanted some other arbitrary percentile of household income, e.g.&nbsp;the 75th? That statistic likely isn’t available as an aggregate measure in the Census API. Indeed, if I want it, I need to calculate that myself using <em>household level</em> census data, as-in, data where each row is a household. This is a common need and entails accessing census <em>microdata</em>, which enables us to work with household level and/or individual level census data.</p>
<p>One of the most popular sources for downloading census microdata is the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS). The IPUMS team provides a centralized API for downloading census microdata, comprehensive documentation for working with census microdata, and harmonized variables across time <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 9</a>)</span>.</p>
<p>The easiest way to access IPUMS data in R is with the <a href="https://tech.popdata.org/ipumsr/"><code>ipumsr</code></a> package, which the IPUMS team maintains <span class="citation" data-cites="greg_freedman_ellis_ipumsr_2024">(<a href="#ref-greg_freedman_ellis_ipumsr_2024" role="doc-biblioref">Greg Freedman Ellis, Derek Burk, and Finn Roberts 2024</a>)</span>. Here I’ll set an API key in my <code>.Renviron</code> file to use for submitting requests via <code>ipumsr</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span></code></pre></div>
</div>
<p>The <code>ipumsr</code> website <a href="https://tech.popdata.org/ipumsr/articles/ipums.html#obtaining-data-via-the-ipums-api">provides details</a> on what survey products the project currently supports, as does the <code>ipums_data_collections()</code> function. The following are the survey products that currently have API support:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">collection_name</th>
<th style="text-align: left;">collection_type</th>
<th style="text-align: left;">code_for_api</th>
<th style="text-align: left;">api_support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IPUMS USA</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">usa</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS CPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">cps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS International</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ipumsi</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS ATUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">atus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS AHTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ahtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">mtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHIS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">nhis</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MEPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">meps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHGIS</td>
<td style="text-align: left;">aggregate data</td>
<td style="text-align: left;">nhgis</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>For any analysis of populations in the U.S., the IPUMS USA and IPUMS CPS collections are of particular interest. I’ll look at IPUMS USA since my motivating question involves median household income for a year (2022), and IPUMS USA offers annual data from decennial censuses 1790-2010 and American Community Surveys (ACS) 2000-present <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. We can check out the newest products they have in the USA collection as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">us2023b</td>
<td style="text-align: left;">2023 PRCS</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2023a</td>
<td style="text-align: left;">2023 ACS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022d</td>
<td style="text-align: left;">2018-2022, PRCS 5-year</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2022c</td>
<td style="text-align: left;">2018-2022, ACS 5-year</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022b</td>
<td style="text-align: left;">2022 PRCS</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that PRCS refers to the Puerto Rico Community Survey (an ACS equivalent specifically tailored to Puerto Rico). We are principally interested in the ACS, which comes in either one-year (e.g.&nbsp;2023 ACS) or five-year (e.g.&nbsp;2018-2022, ACS 5-year) estimates. The differences between these two estimates are described in detail in the <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-data-an-overview">Census Data: An Overview</a> in <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span>. Broadly speaking, one-year estimates come from a smaller, but more contemporary sample. In our case we’ll use the one-year to get the best sense of the 2022 income dynamics.</p>
<section id="step-1-retrieving-data" class="level3">
<h3 class="anchored" data-anchor-id="step-1-retrieving-data">Step 1: Retrieving data</h3>
<p>Let’s return to the motivating question for this post: <strong>What was the median household income in Oakland, California in 2022?</strong></p>
<p>We’ll need to get income data from the 2022 1-year ACS, and we will need to filter our data down to just the city of Oakland. For the first task, I’ll define a general function, <code>retrieve_sample()</code> that retrieves a list of variables from a given ACS sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(<span class="at">description =</span> <span class="st">"Incomes by PUMA"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">variables =</span> variables)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<p>I’ll also define a list of variables that I want, including <code>HHINCOME</code> (household income) and <code>INCTOT</code> (individual income). Some of these variables refer to census-specific language – i.e.&nbsp;<code>PUMA</code> , <code>REPWT</code> , <code>REPWTP</code>. I’ll cover exactly what each of these represent later in the post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>Note the variable, <code>var_spec("STATEFIP", case_selections = "06")</code>. This selects the variable <code>STATEFIP</code>, while also specifying that we want to restrict our request to data where <code>STATEFIP=='06'</code> (California). Generally, <a href="https://tech.popdata.org/ipumsr/reference/var_spec.html"><code>var_spec()</code></a> is used to provide specifications for individual variables when defining an IPUMS microdata extract request <span class="citation" data-cites="greg_freedman_ellis_ipumsr_2024">(<a href="#ref-greg_freedman_ellis_ipumsr_2024" role="doc-biblioref">Greg Freedman Ellis, Derek Burk, and Finn Roberts 2024</a>)</span>.</p>
<p>Now I can request these variables from the 2022 1-year ACS via the function call, <code>retrieve_sample("us2022a", variables)</code>. However, I’ll first write code that checks if I’ve already downloaded the data before running the query to avoid repeatedly downloading it.</p>
<p>full.names = TRUE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(<span class="st">"us2022a"</span>, variables)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Here’s the resulting data, the 2022 1-year ACS for California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74692</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6509</td>
<td style="text-align: right;">650906</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">14500</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74693</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6501</td>
<td style="text-align: right;">650106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74694</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8101</td>
<td style="text-align: right;">810106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74695</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8303</td>
<td style="text-align: right;">830306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">9000</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74696</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6712</td>
<td style="text-align: right;">671206</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">48000</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74697</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7301</td>
<td style="text-align: right;">730106</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">24000</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="step-2-using-geocorr-to-identify-geographies" class="level3">
<h3 class="anchored" data-anchor-id="step-2-using-geocorr-to-identify-geographies">Step 2: Using Geocorr to Identify Geographies</h3>
<p>We now have microdata for all of California, but we need to filter down to just Oakland. Unfortunately, this isn’t as simple as just running <code>filter(CITY == 'Oakland')</code> – ACS microdata does not include a field for explicitly identifying cities (note that a city is typically referred to as a “place” in census data).</p>
<p>The smallest geographic area explicitly identified in the microdata is something called a public use microdata area (PUMA) <span class="citation" data-cites="pastoor_how_2024">(<a href="#ref-pastoor_how_2024" role="doc-biblioref">Pastoor 2024</a>)</span>. PUMAS are unique geographies that always aggregate to the state-level (e.g.&nbsp;California can be constructed with a collection of PUMAs), but only sometimes aggregate to other small geographic areas, such as city, metro area, and county <span class="citation" data-cites="walker_analyzing_2023">(See <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies" role="doc-biblioref">Census Hierarchies</a> in <a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 1</a>)</span>.</p>
<p>To find out if a city corresponds to a collection of PUMAs and which PUMAs those are, we’ll use <a href="https://mcdc.missouri.edu/applications/geocorr2022.html">Geocorr</a> (geographic correspondence engine), an application that generates correlation lists showing relationships between two or more geographic coverages in the United States <span class="citation" data-cites="mihalik_missouri_2022">(<a href="#ref-mihalik_missouri_2022" role="doc-biblioref">Mihalik, Rice, and Hesser 2022</a>)</span>. Geocorr is a sponsored program of the Missouri State library and published by the University of Missouri Center for Health Policy.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Geocorr 2022: Geographic Correspondence Engine</figcaption>
<p><img src="geocorr.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>To use Geocorr, I’ll define a function, <code>geocorr_2022()</code> that queries Geocorr 2022 and retrieves a .csv file establishing the relationships between two sets of geographies within a given state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>We’ll use that function to establish the relationships between California’s 2022 PUMAs and its “places,” using individual population as measured in the 2020 Decenial Census to weight the relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span></code></pre></div>
</div>
<p>With that, we can see which PUMAs correspond to the City of Oakland.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">puma22</th>
<th style="text-align: left;">PlaceName</th>
<th style="text-align: left;">pop20</th>
<th style="text-align: left;">afact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">00111</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">106433</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00112</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">106896</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00113</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">125840</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00114</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00123</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">101468</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>AFACT</code> (allocation factor) column shows the proportion of the source area contained in the target area – in this case the proportion of the PUMA population that belongs to Oakland. In this case, 100% of the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of PUMA 114. GEOCORR does believe that 9 individuals from 114 live in Oakland, but based on the AFACT of 0, I’ll feel comfortable dropping that PUMA.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the City of Oakland (note the use of <code>haven::zap_labels()</code> is just to remove some unnecessary formatting that comes with the data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74718</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74737</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74738</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1200</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75005</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">41300</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75119</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5800</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75131</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">12306</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="step-3-filtering-to-desired-granularity" class="level3">
<h3 class="anchored" data-anchor-id="step-3-filtering-to-desired-granularity">Step 3: Filtering to desired granularity</h3>
<p>Each row in the ACS microdata is an individual, identified by a unique combination of <code>SAMPLE</code>, which defines the year when the individual was surveyed, <code>SERIAL</code>, a unique identifier for that individual’s household, and <code>PERNUM</code>, a unique identifier for the individual within their household <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. Thus, we can identify units as follows:</p>
<ul>
<li><strong>Households</strong>: The combination of <code>SAMPLE</code> and <code>SERIAL</code> provides a unique identifier for every household in the IPUMS</li>
<li><strong>Individuals</strong>: The combination of <code>SAMPLE</code>, <code>SERIAL</code>, and <code>PERNUM</code> provides a unique identifier for every person in the IPUMS</li>
</ul>
<p>We can group by these variable combinations and see how many individuals and households were surveyed across PUMAs in Oakland for the 2022 1-year ACS. We can see that each row in the data represents an individual (<code>n_rows</code> equals <code>n_individuals</code>) and, as we would expect, the number of households is much lower than the number of individuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="tbl-granularity" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Oakland Dataset Granularity by PUMA
</figcaption>
<div aria-describedby="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">n_rows</th>
<th style="text-align: right;">n_individuals</th>
<th style="text-align: right;">n_households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">111</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">578</td>
</tr>
<tr class="even">
<td style="text-align: right;">112</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">547</td>
</tr>
<tr class="odd">
<td style="text-align: right;">113</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">385</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">389</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>I’ll also randomly select a household in the data to see what such a unit looks like in practice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, PERNUM, AGE, SEX, HHINCOME, INCTOT))</span></code></pre></div>
</details>
<div id="tbl-example-hh" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: An example household
</figcaption>
<div aria-describedby="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9300</td>
</tr>
<tr class="even">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="even">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">18000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Here we can see that this household, with <code>SERIAL</code> 211975 has 4 members, each with a unique <code>PERNUM</code>.</p>
<p>Let’s return to the motivating question – <strong>what was the median household income in Oakland, California in 2022?</strong> Note the income variables we observe for this family:</p>
<ol type="1">
<li><p><code>INCTOT</code> reports each respondent’s total pre-tax personal income or losses from all sources for the previous year. <code>9999999</code> is code to denote that the value is missing, which makes sense given that the missing values above correspond to children in the household <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/INCTOT" role="doc-biblioref">INCTOT</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p></li>
<li><p><code>HHINCOME</code> reports the total money income of all household members age 15+ during the previous year. The amount should equal the sum of all household members’ individual incomes, as recorded in the person-record variable INCTOT <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/HHINCOME" role="doc-biblioref">HHINCOME</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span></p></li>
</ol>
<p>Given what we know about the unique identifier for households, and the <code>HHINCOME</code> variable, we can construct the appropriate dataset for answering our motivating question – every household in Oakland that had household income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
<p>It seems we can proceed to simply calculate the median of the <code>HHINCOME</code> column? Not so fast… Data in the ACS microdata are not what they seem. Before we do any analysis, we have to account for <strong>sample weights</strong>.</p>
</section>
<section id="step-4-applying-sample-weights" class="level3">
<h3 class="anchored" data-anchor-id="step-4-applying-sample-weights">Step 4: Applying sample weights</h3>
<p>Let’s return to our sample family from above, but also examine the variables <code>PERWT</code> and <code>HHWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">HHWT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9300</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">18000</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">62</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These are the two primary sample weights in ACS microdata, and they can be interpreted fairly directly. <code>PERWT</code> gives the population represented by each individual in the sample, thus in the first row of the sample household, the 31 year old woman with an individual income of $9,300 represents 62 individuals in the PUMA. <code>HHWT</code> gives the number of households in the general population represented by each household in the sample, thus this household is representative of 62 households in that PUMA.</p>
<p>Any person-level analysis of ACS microdata should be weighted by <code>PERWT</code>, and household-level analysis should be weighted by <code>HHWT</code> <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa/intro.shtml#weights" role="doc-biblioref">Sample Weights</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. We’ll use the <a href="http://gdfe.co/srvyr/reference/index.html"><code>srvyr</code></a> package for easily defining the survey weights and using them to calculate summary statistics.</p>
<p>Here we’ll finally address the motivating question. <strong>The median household income in Oakland in 2022</strong> as measured in the IPUMS microdata was as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_median</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">89000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let’s do a quick comparison of our IPUMS results to the aggregate census data we retrieved in the first section. Here are our full IPUMS results for both median household income and population:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"median_hh_income"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"total_pop"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>aggregate_data <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ACS_aggregate_estimate =</span> estimate)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table) <span class="sc">%&gt;%</span> </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate)) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(aggregate_data, <span class="at">by=</span><span class="st">'variable'</span>)</span></code></pre></div>
</details>
<div id="tbl-ipums-res" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ipums-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: IPUMS versus ACS aggregate results
</figcaption>
<div aria-describedby="tbl-ipums-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">ipums_estimate</th>
<th style="text-align: right;">ACS_aggregate_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">430052</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">89000</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>These are.. Clearly different. What gives? Unfortunately, <strong>summary statistics calculated using IPUMS data typically cannot match aggregate ACS figures!</strong></p>
<p>One major reason for the gap is additional sampling error. Recall that the American Community Survey is a sample. A given one-year ACS is typically a 1% sample of the U.S. population, with associated sampling error. When the census makes microdata available, they create a sample of that sample – we do not get the full 1%. This second sampling process introduces further sampling error in the microdata that is not reflected in figures sourced from aggregate ACS data, which are calculated using the full ACS sample <span class="citation" data-cites="ruggles_ipums_2024">(<a href="https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS" role="doc-biblioref">See ACS</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. This introduces its own, additional sampling error.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
</section>
<section id="step-5-applying-replicate-weights" class="level3">
<h3 class="anchored" data-anchor-id="step-5-applying-replicate-weights">Step 5: Applying replicate weights</h3>
<p>If we stopped at this point, we would be able to use census microdata to accurately calculate all sorts of interesting quantities. However, there is one more subtlety to ACS microdata that becomes important when we are calculating the standard errors of those quantities: <strong>replicate weights</strong>.</p>
<p>For the sake of this example, let’s shift from our motivating question to a new one – <strong>what was the average earned income for women in Oakland in 2022</strong>? I’ll create a dataset of individuals with income and labeled gender here:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
</div>
<p>When we calculate the average income for women in Oakland using the production individual weights, we get the standard error (se) below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">71669.67</td>
<td style="text-align: right;">2599.97</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>That is the weighted sample mean and its accompanying sample standard error.</p>
<p>In theory, the standard error of an estimate measures the variation of a statistic across multiple samples of a given population. Our sample standard error above, calculated using just the one sample, is just an estimate of that theoretical standard error. We can get a better estimate of that theoretical standard error using replicate weights.</p>
<p>Replicate weights allow a single sample to simulate multiple samples, thus generating more informed standard error estimates that more closely mimic the theoretical basis of standard errors. https://usa.ipums.org/usa/repwt.shtml#q70</p>
<p>Here we can see what replicate weights (in this case, individual replicate weights) look like in our data. Each of <code>REPWTP</code>, 1 through 80, is a set of alternative individual weights, slightly different from the “production weight,” <code>PERWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(INCTOT, PERWT, REPWTP1, REPWTP2, <span class="st">`</span><span class="at"> </span><span class="st">`</span>, REPWTP79, REPWTP80)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: left;"></th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">480</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="even">
<td style="text-align: right;">1200</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41300</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="even">
<td style="text-align: right;">5800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="odd">
<td style="text-align: right;">480</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: right;">480</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can use replicate weights in a variety of alternative variance estimates in the calculation of “successive difference replication (SDR) variance,” an alternative to the standard variance of an estimate. We obtain SDR variance by calculating a statistic of interest with the production weights (e.g.&nbsp;<code>HHWT</code>), then sum the squared deviations between that production weighted estimate and the weighted estimates we obtain with each replicate weight (e.g.&nbsp;<code>REPWT1</code>). Specifically: <span class="math display">\[
\begin{align*}
\bar{x}_w &amp;= \frac{\sum_{i=1}^{n}w_ix_i}{\sum_{i=1}^{n}w_i} \\
\bar{x}_r &amp;= \frac{\sum_{i=1}^{n}r_ix_i}{\sum_{i=1}^{n}r_i} \\
SE(\bar{x}_w) &amp;= \sqrt{\frac{4}{80} \sum_{r=1}^{80} (\bar{x}_r - \bar{x}_w)^2}
\end{align*}
\]</span></p>
<p>Where <span class="math inline">\(w\)</span> represents the production weights, <span class="math inline">\(r\)</span> represents each replicate weight. There are a few ways you can rationalize this equation to yourself.</p>
<ol type="1">
<li>It’s equivalent to using <a href="https://documentation.sas.com/doc/en/statug/15.2/statug_surveyphreg_details29.htm#:~:text=the%20following%20section.-,Fay%E2%80%99s%20BRR%20Method,-The%20traditional%20BRR">Fay’s Balanced Repeated Replication method</a> with the Faye coefficient set to <span class="math inline">\(\epsilon=.5\)</span>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWTP"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2481.816</code></pre>
</div>
</div>
<p>To be clear, we don’t have to ever do that manually – <code>survey</code> supports specifying survey designs with replicate weights. Here we can</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_female_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">mean_female_income</th>
<th style="text-align: right;">mean_female_income_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">71669.67</td>
<td style="text-align: right;">2481.345</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In IPUMS testing of ACS/PRCS data, replicate weights usually increase standard errors. This increase is generally not large enough to alter the significance level of coefficients, though marginally significant coefficients may become clearly non-significant. The more obvious effect of using replicate weights is on the width of confidence intervals, which can change substantially.</p>
<p>IPUMS’ documentation recommends the following specification for the replicate weights, where the standard errors are calculated via a <a href="https://en.wikipedia.org/wiki/Jackknife_resampling">jacknife</a> (see <code>type = 'JK1'</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="analyzing-acs-microdata" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-acs-microdata">Analyzing ACS microdata</h2>
<p>Here we can see the un-adjusted gender earnings gap in Oakland, where men on earn about $20k more than women on average:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEX) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">SEX</th>
<th style="text-align: right;">mean_income</th>
<th style="text-align: right;">mean_income_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">71669.67</td>
<td style="text-align: right;">2481.816</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">90114.19</td>
<td style="text-align: right;">2742.858</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Lets explore a couple other dynamics related to earnings in Oakland and practice making visualizations and estimating regressions with the data. Here’s the income distribution across different levels of highest education earned. Note here that I’m not using the replicate weights (I’m just using the <code>individuals_w_income</code> object), since I’m not estimating anything. <code>ggplot</code> does take a weight argument, for which I’ve supplied the <code>PERWT</code> sample weights.</p>
<p><a href="https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html" class="uri">https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> INCTOT,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.2</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">9</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">outliers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">8</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>, <span class="at">y =</span> <span class="st">"Income"</span>, <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows that individuals with bachelor’s and graduate degrees generally have higher incomes in Oakland. Let’s seen how bachelor and graduate degree attainment differs across sex. Again, I’m using the <code>individuals_w_income</code> object as I have no need to replicate weights.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level =</span> order),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> PERWT</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (..count..) <span class="sc">/</span> <span class="fu">sum</span>(..count..))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Sex"</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So bachelor and graduate degree holders generally earn more, and women are more likely than men to have bachelor and graduate degrees in Oakland. This should imply that if we adjust for education when estimating the gender-earnings gap in Oakland, thus only comparing men and women in the same education levels, we should see the gap increase.</p>
<p>We again use <code>svyglm</code> to estimate the regression, and <code>oak_indiv_svy</code> as the data/survey design so as to use the replicate weights for our standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    AGE <span class="sc">+</span> <span class="fu">I</span>(AGE <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">relevel</span>(educ_attain, <span class="at">ref =</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  oak_indiv_svy</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, no covariates"</span> <span class="ot">=</span> model_ols2,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, adjusted for age and education"</span> <span class="ot">=</span> model_ols3</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_385vecy7vcg48ezgfka8(i, j, css_id) {
          var table = document.getElementById("tinytable_385vecy7vcg48ezgfka8");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_385vecy7vcg48ezgfka8');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_385vecy7vcg48ezgfka8(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_385vecy7vcg48ezgfka8");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_n5oulf5ntayq56h7mz0z',}, 
          { positions: [ { i: 22, j: 0 },  ], css_id: 'tinytable_css_fdb2hvyh1dxktbqaylod',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_edboomrj03lnsmr6ijkc',}, 
          { positions: [ { i: 20, j: 2 }, { i: 20, j: 1 },  ], css_id: 'tinytable_css_bp3kl56jkm9yddf2dmko',}, 
          { positions: [ { i: 1, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 2, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 6, j: 1 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 10, j: 2 }, { i: 21, j: 1 }, { i: 12, j: 2 }, { i: 10, j: 1 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 14, j: 2 }, { i: 11, j: 2 }, { i: 16, j: 2 }, { i: 13, j: 2 }, { i: 18, j: 2 }, { i: 15, j: 2 }, { i: 17, j: 2 }, { i: 19, j: 2 }, { i: 21, j: 2 },  ], css_id: 'tinytable_css_92dgcpa2j7cv97hbjts2',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 10, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 14, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 18, j: 0 }, { i: 19, j: 0 }, { i: 21, j: 0 },  ], css_id: 'tinytable_css_84pyqvwdoa4y201vgm47',}, 
          { positions: [ { i: 20, j: 0 },  ], css_id: 'tinytable_css_3tx7cgzsn7pwqsjhjbtl',}, 
          { positions: [ { i: 22, j: 1 }, { i: 22, j: 2 },  ], css_id: 'tinytable_css_0bipq2oc1isjvn6p8uit',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_385vecy7vcg48ezgfka8(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_n5oulf5ntayq56h7mz0z, .table th.tinytable_css_n5oulf5ntayq56h7mz0z { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_fdb2hvyh1dxktbqaylod, .table th.tinytable_css_fdb2hvyh1dxktbqaylod { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_edboomrj03lnsmr6ijkc, .table th.tinytable_css_edboomrj03lnsmr6ijkc { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_bp3kl56jkm9yddf2dmko, .table th.tinytable_css_bp3kl56jkm9yddf2dmko { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_92dgcpa2j7cv97hbjts2, .table th.tinytable_css_92dgcpa2j7cv97hbjts2 { text-align: center; }
      .table td.tinytable_css_84pyqvwdoa4y201vgm47, .table th.tinytable_css_84pyqvwdoa4y201vgm47 { text-align: left; }
      .table td.tinytable_css_3tx7cgzsn7pwqsjhjbtl, .table th.tinytable_css_3tx7cgzsn7pwqsjhjbtl { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_0bipq2oc1isjvn6p8uit, .table th.tinytable_css_0bipq2oc1isjvn6p8uit { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_385vecy7vcg48ezgfka8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Earnings gap, no covariates</th>
                <th scope="col">Earnings gap, adjusted for age and education</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                                                       </td>
                  <td>37064.571 </td>
                  <td>3805.220 </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(1610.829)</td>
                  <td>(726.915)</td>
                </tr>
                <tr>
                  <td>factor(SEX)Male                                                   </td>
                  <td>1.251     </td>
                  <td>1.378    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(0.064)   </td>
                  <td>(0.067)  </td>
                </tr>
                <tr>
                  <td>AGE                                                               </td>
                  <td>          </td>
                  <td>1.074    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.009)  </td>
                </tr>
                <tr>
                  <td>I(AGE^2)                                                          </td>
                  <td>          </td>
                  <td>0.999    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.000)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Associate's degree</td>
                  <td>          </td>
                  <td>1.466    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.176)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Bachelor's degree </td>
                  <td>          </td>
                  <td>2.880    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.198)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Graduate degree   </td>
                  <td>          </td>
                  <td>4.377    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.291)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")No schooling      </td>
                  <td>          </td>
                  <td>0.743    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.087)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some college      </td>
                  <td>          </td>
                  <td>1.171    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.132)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some school       </td>
                  <td>          </td>
                  <td>0.774    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.074)  </td>
                </tr>
                <tr>
                  <td>N                                                                 </td>
                  <td>3131      </td>
                  <td>3131     </td>
                </tr>
                <tr>
                  <td>R²                                                                </td>
                  <td>0.007     </td>
                  <td>0.308    </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Fun!</p>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-greg_freedman_ellis_ipumsr_2024" class="csl-entry" role="listitem">
Greg Freedman Ellis, Derek Burk, and Finn Roberts. 2024. <span>“Ipumsr: <span>An</span> <span>R</span> <span>Interface</span> for <span>Downloading</span>, <span>Reading</span>, and <span>Handling</span> <span>IPUMS</span> <span>Data</span>.”</span> <a href="https://tech.popdata.org/ipumsr/">https://tech.popdata.org/ipumsr/</a>.
</div>
<div id="ref-mihalik_missouri_2022" class="csl-entry" role="listitem">
Mihalik, Cory, Glenn Rice, and Matt Hesser. 2022. <span>“The <span>Missouri</span> <span>Census</span> <span>Data</span> <span>Center</span> (<span>MCDC</span>) 2022 <span>Geographic</span> <span>Correspondence</span> <span>Engine</span> (<span>GEOCORR</span>).”</span> <a href="https://mcdc.missouri.edu/applications/geocorr.html">https://mcdc.missouri.edu/applications/geocorr.html</a>.
</div>
<div id="ref-pastoor_how_2024" class="csl-entry" role="listitem">
Pastoor, Isabel. 2024. <span>“How Can <span>I</span> Pull Data at the Zip Code or City Level?”</span> <em>IPUMS Forum</em>. <a href="https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2">https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2</a>.
</div>
<div id="ref-ruggles_ipums_2024" class="csl-entry" role="listitem">
Ruggles, Steven, Sarah Flood, Matthew Sobek, Daniel Backman, Annie Chen, Grace Cooper, Stephanie Richards, Renae Rogers, and Megan Schouweiler. 2024. <span>“<span>IPUMS</span> <span>USA</span>: <span>Version</span> 15.0.”</span> Minneapolis, MN: IPUMS. <a href="https://doi.org/10.18128/D010.V15.0">https://doi.org/10.18128/D010.V15.0</a>.
</div>
<div id="ref-walker_analyzing_2023" class="csl-entry" role="listitem">
Walker, Kyle. 2023. <em>Analyzing <span>US</span> <span>Census</span> <span>Data</span></em>. 1st edition. Boca Raton: Chapman; Hall/CRC.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I want to note that several of the points I cover here are things I learned from some coworkers– <a href="https://www.bwilden.com/">Bert Wilden</a> and Stephanie Peng.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See the <a href="https://api.census.gov/data/2022/acs/acs1/variables.html">full variable list for the 2022 1-year ACS</a> for the available variables, and see the <a href="https://www.census.gov/library/reference/code-lists/ansi.html#place">Census Place table</a> for looking up GEOIDs<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I’ll to note that the combination of IPUMS and Geocorr is a fantastic public good, and it’s extremely generous of the public Universities of Minnesota and Missouri to publish these.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Were the AFACT higher, e.g.&nbsp;1%, I would randomly sample 1% of the individuals from that PUMA and include them in my Oakland sample.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Beyond that sampling error, the census applies various other additional data processing steps to microdata that aren’t applied to aggregate figures <span class="citation" data-cites="ruggles_ipums_2024">(<a href="https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS" role="doc-biblioref">See ACS</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{amerkhanian2024,
  author = {Amerkhanian, Peter},
  title = {Working with {ACS} Microdata in {R}},
  date = {2024-12-29},
  url = {https://peter-amerkhanian.com/posts/ipums-wth-r/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-amerkhanian2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Amerkhanian, Peter. 2024. <span>“Working with ACS Microdata in
R.”</span> December 29, 2024. <a href="https://peter-amerkhanian.com/posts/ipums-wth-r/">https://peter-amerkhanian.com/posts/ipums-wth-r/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/peter-amerkhanian\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb32" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Working with ACS microdata in R"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../blog.bib"</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Peter Amerkhanian"</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-12-29"</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "A general overview of retrieving and working with IPUMS data in R."</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> thumbnail.png</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ['R', 'Data Management']</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Statistics</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>               modelsummary,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>               srvyr,</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>               survey,</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Webscraping</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>               httr,</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>               rvest,</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>               readr,</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>               glue,</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Census</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>               tidycensus,</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>               ipumsr)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> raw, <span class="sc">~</span> clean, <span class="sc">~</span> fmt,</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>In this post, I'm going to cover how to use American Community Survey</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>(ACS) microdata, leveraging the University of Minnesota's Integrated</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>Public Use Microdata Series (IPUMS).<span class="ot">[^1]</span> I'll cover:</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>I want to note that several of the points I cover here are things</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>    I learned from some coworkers-- [Bert</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    Wilden](https://www.bwilden.com/) and Stephanie Peng.</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Retrieval**: how to choose which ACS product is relevant, how to</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>    submit a request to IPUMS, and how to filter down to relevant levels</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    of geography/granularity.</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Analysis**: how to properly weight ACS data using sample and</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>    replication weights for accurate data visualizations and statistical</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>    models.</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>I'll start with a question: **What was the median household income in</span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>Oakland, California in 2022?**</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregate data with `tidycensus`</span></span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>Answering that question is straightforward using *aggregate* data from</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>the U.S. Census, which provides various descriptive statistics for</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>aggregate geographies. I might use a web-based tool like [Census</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>Reporter](https://censusreporter.org/) to quickly look it up, but for an</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>analysis, I would like the data retrieval to be carried out</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>transparently via an API.</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>In R, the <span class="in">`tidycensus`</span> package provides an easy-to-use wrapper for the</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>Census API. Note that I set up an API key for the U.S. Census and I'm</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>storing it in my <span class="in">`.Renviron`</span> file as <span class="in">`census_api_key`</span>.</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>I query <span class="in">`B19013_001`</span>, the median household income variable, using the</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>2022 1-year American Community Survey sample<span class="ot">[^2]</span> and I filter down to</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>Oakland's GEOID, <span class="in">`0653000`</span>, which is a combination of the state code for</span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>California, <span class="in">`06`</span>, and the place code for Oakland, <span class="in">`53000`</span>. I'll throw in</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>the total population variable for good measure:</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>See the [full variable list for the 2022 1-year</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>    ACS](https://api.census.gov/data/2022/acs/acs1/variables.html) for</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>    the available variables, and see the [Census Place</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>    table](https://www.census.gov/library/reference/code-lists/ansi.html#place)</span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>    for looking up GEOIDs</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>Done! Aggregate census data like this is very useful, and</span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span> offers a comprehensive treatment of working</span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>with aggregate census data.</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Microdata with IPUMS</span></span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>What if instead of the median, I wanted some other arbitrary percentile</span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>of household income, e.g. the 75th? That statistic likely isn't</span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>available as an aggregate measure in the Census API. Indeed, if I want</span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>it, I need to calculate that myself using *household level* census data,</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>as-in, data where each row is a household. This is a common</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>need and entails accessing census *microdata*, which enables us to work</span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>with household level and/or individual level census data.</span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a>One of the most popular sources for downloading census microdata is the</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a>University of Minnesota's Integrated Public Use Microdata Series</span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>(IPUMS). The IPUMS team provides a centralized API for downloading</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>census microdata, comprehensive documentation for working with census</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a>microdata, and harmonized variables across time [@walker_analyzing_2023,</span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a>chapter 9].</span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a>The easiest way to access IPUMS data in R is with the <span class="co">[</span><span class="ot">`ipumsr`</span><span class="co">](https://tech.popdata.org/ipumsr/)</span> package,</span>
<span id="cb32-143"><a href="#cb32-143" aria-hidden="true" tabindex="-1"></a>which the IPUMS team maintains <span class="co">[</span><span class="ot">@greg_freedman_ellis_ipumsr_2024</span><span class="co">]</span>. Here I'll set an API key in my <span class="in">`.Renviron`</span></span>
<span id="cb32-144"><a href="#cb32-144" aria-hidden="true" tabindex="-1"></a>file to use for submitting requests via <span class="in">`ipumsr`</span> .</span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ipumsr`</span> website [provides</span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a>details](https://tech.popdata.org/ipumsr/articles/ipums.html#obtaining-data-via-the-ipums-api) on what survey products the project currently supports, as does</span>
<span id="cb32-155"><a href="#cb32-155" aria-hidden="true" tabindex="-1"></a>the <span class="in">`ipums_data_collections()`</span> function. The following are the survey</span>
<span id="cb32-156"><a href="#cb32-156" aria-hidden="true" tabindex="-1"></a>products that currently have API support:</span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a>For any analysis of populations in the U.S., the IPUMS USA and IPUMS</span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a>CPS collections are of</span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a>particular interest. I'll look at IPUMS USA since my motivating question</span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>involves median household income for a year (2022), and IPUMS USA offers</span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a>annual data from decennial censuses 1790-2010 and American Community</span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a>Surveys (ACS) 2000-present <span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span>. We can check out the</span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>newest products they have in the USA collection as follows:</span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a>Note that PRCS refers to the Puerto Rico Community Survey (an ACS</span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a>equivalent specifically tailored to Puerto Rico). We are principally</span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a>interested in the ACS, which comes in either one-year (e.g. 2023 ACS) or five-year</span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a>(e.g. 2018-2022, ACS 5-year) estimates. The differences between these two estimates are described in detail in</span>
<span id="cb32-186"><a href="#cb32-186" aria-hidden="true" tabindex="-1"></a>the [Census Data: An</span>
<span id="cb32-187"><a href="#cb32-187" aria-hidden="true" tabindex="-1"></a>Overview](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-data-an-overview)</span>
<span id="cb32-188"><a href="#cb32-188" aria-hidden="true" tabindex="-1"></a>in <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span>. Broadly speaking, one-year estimates come</span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a>from a smaller, but more contemporary sample. In our case we'll use the</span>
<span id="cb32-190"><a href="#cb32-190" aria-hidden="true" tabindex="-1"></a>one-year to get the best sense of the 2022 income dynamics.</span>
<span id="cb32-191"><a href="#cb32-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-192"><a href="#cb32-192" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Retrieving data</span></span>
<span id="cb32-193"><a href="#cb32-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-194"><a href="#cb32-194" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question for this post: **What was the</span>
<span id="cb32-195"><a href="#cb32-195" aria-hidden="true" tabindex="-1"></a>median household income in Oakland, California in 2022?**</span>
<span id="cb32-196"><a href="#cb32-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-197"><a href="#cb32-197" aria-hidden="true" tabindex="-1"></a>We'll need to get income data from the 2022 1-year ACS, and we will need</span>
<span id="cb32-198"><a href="#cb32-198" aria-hidden="true" tabindex="-1"></a>to filter our data down to just the city of Oakland. For the first task,</span>
<span id="cb32-199"><a href="#cb32-199" aria-hidden="true" tabindex="-1"></a>I'll define a general function, <span class="in">`retrieve_sample()`</span> that retrieves a</span>
<span id="cb32-200"><a href="#cb32-200" aria-hidden="true" tabindex="-1"></a>list of variables from a given ACS sample.</span>
<span id="cb32-201"><a href="#cb32-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-204"><a href="#cb32-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-205"><a href="#cb32-205" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables){</span>
<span id="cb32-206"><a href="#cb32-206" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(<span class="at">description =</span> <span class="st">"Incomes by PUMA"</span>,</span>
<span id="cb32-207"><a href="#cb32-207" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb32-208"><a href="#cb32-208" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb32-209"><a href="#cb32-209" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">variables =</span> variables)</span>
<span id="cb32-210"><a href="#cb32-210" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb32-211"><a href="#cb32-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-212"><a href="#cb32-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-213"><a href="#cb32-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb32-214"><a href="#cb32-214" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-215"><a href="#cb32-215" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb32-216"><a href="#cb32-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb32-217"><a href="#cb32-217" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-218"><a href="#cb32-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-219"><a href="#cb32-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-220"><a href="#cb32-220" aria-hidden="true" tabindex="-1"></a>I'll also define a list of variables that I want, including <span class="in">`HHINCOME`</span></span>
<span id="cb32-221"><a href="#cb32-221" aria-hidden="true" tabindex="-1"></a>(household income) and <span class="in">`INCTOT`</span> (individual income). Some of these</span>
<span id="cb32-222"><a href="#cb32-222" aria-hidden="true" tabindex="-1"></a>variables refer to census-specific language – i.e. <span class="in">`PUMA`</span> , <span class="in">`REPWT`</span> ,</span>
<span id="cb32-223"><a href="#cb32-223" aria-hidden="true" tabindex="-1"></a><span class="in">`REPWTP`</span>. I'll cover exactly what each of these represent later in the</span>
<span id="cb32-224"><a href="#cb32-224" aria-hidden="true" tabindex="-1"></a>post.</span>
<span id="cb32-225"><a href="#cb32-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-228"><a href="#cb32-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-229"><a href="#cb32-229" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-230"><a href="#cb32-230" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb32-231"><a href="#cb32-231" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb32-232"><a href="#cb32-232" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb32-233"><a href="#cb32-233" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb32-234"><a href="#cb32-234" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb32-235"><a href="#cb32-235" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb32-236"><a href="#cb32-236" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb32-237"><a href="#cb32-237" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb32-238"><a href="#cb32-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb32-239"><a href="#cb32-239" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb32-240"><a href="#cb32-240" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-241"><a href="#cb32-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-242"><a href="#cb32-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-243"><a href="#cb32-243" aria-hidden="true" tabindex="-1"></a>Note the variable, <span class="in">`var_spec("STATEFIP", case_selections = "06")`</span>. This</span>
<span id="cb32-244"><a href="#cb32-244" aria-hidden="true" tabindex="-1"></a>selects the variable <span class="in">`STATEFIP`</span>, while also specifying that we want to</span>
<span id="cb32-245"><a href="#cb32-245" aria-hidden="true" tabindex="-1"></a>restrict our request to data where <span class="in">`STATEFIP=='06'`</span> (California).</span>
<span id="cb32-246"><a href="#cb32-246" aria-hidden="true" tabindex="-1"></a>Generally,</span>
<span id="cb32-247"><a href="#cb32-247" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`var_spec()`</span><span class="co">](https://tech.popdata.org/ipumsr/reference/var_spec.html)</span></span>
<span id="cb32-248"><a href="#cb32-248" aria-hidden="true" tabindex="-1"></a>is used to provide specifications for individual variables when defining</span>
<span id="cb32-249"><a href="#cb32-249" aria-hidden="true" tabindex="-1"></a>an IPUMS microdata extract request <span class="co">[</span><span class="ot">@greg_freedman_ellis_ipumsr_2024</span><span class="co">]</span>.</span>
<span id="cb32-250"><a href="#cb32-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-251"><a href="#cb32-251" aria-hidden="true" tabindex="-1"></a>Now I can request these variables from the 2022 1-year ACS via the</span>
<span id="cb32-252"><a href="#cb32-252" aria-hidden="true" tabindex="-1"></a>function call, <span class="in">`retrieve_sample("us2022a", variables)`</span>. However, I'll</span>
<span id="cb32-253"><a href="#cb32-253" aria-hidden="true" tabindex="-1"></a>first write code that checks if I've already downloaded the data before</span>
<span id="cb32-254"><a href="#cb32-254" aria-hidden="true" tabindex="-1"></a>running the query to avoid repeatedly downloading it.</span>
<span id="cb32-255"><a href="#cb32-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-256"><a href="#cb32-256" aria-hidden="true" tabindex="-1"></a>full.names = TRUE</span>
<span id="cb32-257"><a href="#cb32-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-260"><a href="#cb32-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-261"><a href="#cb32-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-262"><a href="#cb32-262" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb32-263"><a href="#cb32-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb32-264"><a href="#cb32-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb32-265"><a href="#cb32-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-266"><a href="#cb32-266" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-267"><a href="#cb32-267" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb32-268"><a href="#cb32-268" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb32-269"><a href="#cb32-269" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb32-270"><a href="#cb32-270" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(<span class="st">"us2022a"</span>, variables)</span>
<span id="cb32-271"><a href="#cb32-271" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-272"><a href="#cb32-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-273"><a href="#cb32-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-274"><a href="#cb32-274" aria-hidden="true" tabindex="-1"></a>Here's the resulting data, the 2022 1-year ACS for California.</span>
<span id="cb32-275"><a href="#cb32-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-278"><a href="#cb32-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-279"><a href="#cb32-279" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb32-280"><a href="#cb32-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-281"><a href="#cb32-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-282"><a href="#cb32-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Using Geocorr to Identify Geographies</span></span>
<span id="cb32-283"><a href="#cb32-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-284"><a href="#cb32-284" aria-hidden="true" tabindex="-1"></a>We now have microdata for all of California, but we need to filter down</span>
<span id="cb32-285"><a href="#cb32-285" aria-hidden="true" tabindex="-1"></a>to just Oakland. Unfortunately, this isn't as simple as just running</span>
<span id="cb32-286"><a href="#cb32-286" aria-hidden="true" tabindex="-1"></a><span class="in">`filter(CITY == 'Oakland')`</span> -- ACS microdata does not include a field</span>
<span id="cb32-287"><a href="#cb32-287" aria-hidden="true" tabindex="-1"></a>for explicitly identifying cities (note that a city is typically</span>
<span id="cb32-288"><a href="#cb32-288" aria-hidden="true" tabindex="-1"></a>referred to as a "place" in census data).</span>
<span id="cb32-289"><a href="#cb32-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-290"><a href="#cb32-290" aria-hidden="true" tabindex="-1"></a>The smallest geographic area explicitly identified in the microdata is</span>
<span id="cb32-291"><a href="#cb32-291" aria-hidden="true" tabindex="-1"></a>something called a public use microdata area (PUMA) <span class="co">[</span><span class="ot">@pastoor_how_2024</span><span class="co">]</span>.</span>
<span id="cb32-292"><a href="#cb32-292" aria-hidden="true" tabindex="-1"></a>PUMAS are unique geographies that always aggregate to the state-level</span>
<span id="cb32-293"><a href="#cb32-293" aria-hidden="true" tabindex="-1"></a>(e.g. California can be constructed with a collection of PUMAs), but</span>
<span id="cb32-294"><a href="#cb32-294" aria-hidden="true" tabindex="-1"></a>only sometimes aggregate to other small geographic areas, such as city,</span>
<span id="cb32-295"><a href="#cb32-295" aria-hidden="true" tabindex="-1"></a>metro area, and county [See [Census</span>
<span id="cb32-296"><a href="#cb32-296" aria-hidden="true" tabindex="-1"></a>Hierarchies](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies)</span>
<span id="cb32-297"><a href="#cb32-297" aria-hidden="true" tabindex="-1"></a>in @walker_analyzing_2023, chapter 1].</span>
<span id="cb32-298"><a href="#cb32-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-299"><a href="#cb32-299" aria-hidden="true" tabindex="-1"></a>To find out if a city corresponds to a collection of PUMAs and which</span>
<span id="cb32-300"><a href="#cb32-300" aria-hidden="true" tabindex="-1"></a>PUMAs those are, we'll use</span>
<span id="cb32-301"><a href="#cb32-301" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Geocorr</span><span class="co">](https://mcdc.missouri.edu/applications/geocorr2022.html)</span></span>
<span id="cb32-302"><a href="#cb32-302" aria-hidden="true" tabindex="-1"></a>(geographic correspondence engine), an application that generates</span>
<span id="cb32-303"><a href="#cb32-303" aria-hidden="true" tabindex="-1"></a>correlation lists showing relationships between two or more geographic</span>
<span id="cb32-304"><a href="#cb32-304" aria-hidden="true" tabindex="-1"></a>coverages in the United States <span class="co">[</span><span class="ot">@mihalik_missouri_2022</span><span class="co">]</span>. Geocorr is a</span>
<span id="cb32-305"><a href="#cb32-305" aria-hidden="true" tabindex="-1"></a>sponsored program of the Missouri State library and published by the</span>
<span id="cb32-306"><a href="#cb32-306" aria-hidden="true" tabindex="-1"></a>University of Missouri Center for Health Policy.<span class="ot">[^3]</span></span>
<span id="cb32-307"><a href="#cb32-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-308"><a href="#cb32-308" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span>I'll to note that the combination of IPUMS and Geocorr</span>
<span id="cb32-309"><a href="#cb32-309" aria-hidden="true" tabindex="-1"></a>    is a fantastic public good, and it's extremely generous of the</span>
<span id="cb32-310"><a href="#cb32-310" aria-hidden="true" tabindex="-1"></a>    public Universities of Minnesota and Missouri to publish these.</span>
<span id="cb32-311"><a href="#cb32-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-312"><a href="#cb32-312" aria-hidden="true" tabindex="-1"></a>![Geocorr 2022: Geographic Correspondence</span>
<span id="cb32-313"><a href="#cb32-313" aria-hidden="true" tabindex="-1"></a>Engine](geocorr.png){width="80%"}</span>
<span id="cb32-314"><a href="#cb32-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-315"><a href="#cb32-315" aria-hidden="true" tabindex="-1"></a>To use Geocorr, I'll define a function, <span class="in">`geocorr_2022()`</span> that queries</span>
<span id="cb32-316"><a href="#cb32-316" aria-hidden="true" tabindex="-1"></a>Geocorr 2022 and retrieves a .csv file establishing the relationships</span>
<span id="cb32-317"><a href="#cb32-317" aria-hidden="true" tabindex="-1"></a>between two sets of geographies within a given state.</span>
<span id="cb32-318"><a href="#cb32-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-321"><a href="#cb32-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-322"><a href="#cb32-322" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb32-323"><a href="#cb32-323" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb32-324"><a href="#cb32-324" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb32-325"><a href="#cb32-325" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb32-326"><a href="#cb32-326" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb32-327"><a href="#cb32-327" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb32-328"><a href="#cb32-328" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb32-329"><a href="#cb32-329" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb32-330"><a href="#cb32-330" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span>)</span>
<span id="cb32-331"><a href="#cb32-331" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb32-332"><a href="#cb32-332" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb32-333"><a href="#cb32-333" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb32-334"><a href="#cb32-334" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb32-335"><a href="#cb32-335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb32-336"><a href="#cb32-336" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb32-337"><a href="#cb32-337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-338"><a href="#cb32-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-339"><a href="#cb32-339" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-340"><a href="#cb32-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb32-341"><a href="#cb32-341" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb32-342"><a href="#cb32-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb32-343"><a href="#cb32-343" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-344"><a href="#cb32-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-345"><a href="#cb32-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-346"><a href="#cb32-346" aria-hidden="true" tabindex="-1"></a>We'll use that function to establish the relationships between</span>
<span id="cb32-347"><a href="#cb32-347" aria-hidden="true" tabindex="-1"></a>California's 2022 PUMAs and its "places," using individual population as</span>
<span id="cb32-348"><a href="#cb32-348" aria-hidden="true" tabindex="-1"></a>measured in the 2020 Decenial Census to weight the relationships.</span>
<span id="cb32-349"><a href="#cb32-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-352"><a href="#cb32-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-353"><a href="#cb32-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-354"><a href="#cb32-354" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb32-355"><a href="#cb32-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-356"><a href="#cb32-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-357"><a href="#cb32-357" aria-hidden="true" tabindex="-1"></a>With that, we can see which PUMAs correspond to the City of Oakland.</span>
<span id="cb32-358"><a href="#cb32-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-361"><a href="#cb32-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-362"><a href="#cb32-362" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb32-363"><a href="#cb32-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb32-364"><a href="#cb32-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span>
<span id="cb32-365"><a href="#cb32-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-366"><a href="#cb32-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-367"><a href="#cb32-367" aria-hidden="true" tabindex="-1"></a>The <span class="in">`AFACT`</span> (allocation factor) column shows the proportion of the</span>
<span id="cb32-368"><a href="#cb32-368" aria-hidden="true" tabindex="-1"></a>source area contained in the target area -- in this case the proportion</span>
<span id="cb32-369"><a href="#cb32-369" aria-hidden="true" tabindex="-1"></a>of the PUMA population that belongs to Oakland. In this case, 100% of</span>
<span id="cb32-370"><a href="#cb32-370" aria-hidden="true" tabindex="-1"></a>the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and</span>
<span id="cb32-371"><a href="#cb32-371" aria-hidden="true" tabindex="-1"></a>0% of PUMA 114. GEOCORR does believe that 9 individuals from 114 live in</span>
<span id="cb32-372"><a href="#cb32-372" aria-hidden="true" tabindex="-1"></a>Oakland, but based on the AFACT of 0, I'll feel comfortable dropping</span>
<span id="cb32-373"><a href="#cb32-373" aria-hidden="true" tabindex="-1"></a>that PUMA.<span class="ot">[^4]</span></span>
<span id="cb32-374"><a href="#cb32-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-375"><a href="#cb32-375" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>Were the AFACT higher, e.g. 1%, I would randomly sample 1% of the</span>
<span id="cb32-376"><a href="#cb32-376" aria-hidden="true" tabindex="-1"></a>    individuals from that PUMA and include them in my Oakland sample.</span>
<span id="cb32-377"><a href="#cb32-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-378"><a href="#cb32-378" aria-hidden="true" tabindex="-1"></a>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the</span>
<span id="cb32-379"><a href="#cb32-379" aria-hidden="true" tabindex="-1"></a>City of Oakland (note the use of <span class="in">`haven::zap_labels()`</span> is just to remove</span>
<span id="cb32-380"><a href="#cb32-380" aria-hidden="true" tabindex="-1"></a>some unnecessary formatting that comes with the data).</span>
<span id="cb32-381"><a href="#cb32-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-384"><a href="#cb32-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-385"><a href="#cb32-385" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb32-386"><a href="#cb32-386" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb32-387"><a href="#cb32-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb32-388"><a href="#cb32-388" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb32-389"><a href="#cb32-389" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb32-390"><a href="#cb32-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-391"><a href="#cb32-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-392"><a href="#cb32-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Filtering to desired granularity</span></span>
<span id="cb32-393"><a href="#cb32-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-394"><a href="#cb32-394" aria-hidden="true" tabindex="-1"></a>Each row in the ACS microdata is an individual, identified by a unique</span>
<span id="cb32-395"><a href="#cb32-395" aria-hidden="true" tabindex="-1"></a>combination of <span class="in">`SAMPLE`</span>, which defines the year when the individual was</span>
<span id="cb32-396"><a href="#cb32-396" aria-hidden="true" tabindex="-1"></a>surveyed, <span class="in">`SERIAL`</span>, a unique identifier for that individual's household,</span>
<span id="cb32-397"><a href="#cb32-397" aria-hidden="true" tabindex="-1"></a>and <span class="in">`PERNUM`</span>, a unique identifier for the individual within their</span>
<span id="cb32-398"><a href="#cb32-398" aria-hidden="true" tabindex="-1"></a>household <span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span>. Thus, we can identify units as follows:</span>
<span id="cb32-399"><a href="#cb32-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-400"><a href="#cb32-400" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Households**: The combination of <span class="in">`SAMPLE`</span> and <span class="in">`SERIAL`</span> provides a</span>
<span id="cb32-401"><a href="#cb32-401" aria-hidden="true" tabindex="-1"></a>    unique identifier for every household in the IPUMS</span>
<span id="cb32-402"><a href="#cb32-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Individuals**: The combination of <span class="in">`SAMPLE`</span>, <span class="in">`SERIAL`</span>, and <span class="in">`PERNUM`</span></span>
<span id="cb32-403"><a href="#cb32-403" aria-hidden="true" tabindex="-1"></a>    provides a unique identifier for every person in the IPUMS</span>
<span id="cb32-404"><a href="#cb32-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-405"><a href="#cb32-405" aria-hidden="true" tabindex="-1"></a>We can group by these variable combinations and see how many individuals</span>
<span id="cb32-406"><a href="#cb32-406" aria-hidden="true" tabindex="-1"></a>and households were surveyed across PUMAs in Oakland for the 2022 1-year</span>
<span id="cb32-407"><a href="#cb32-407" aria-hidden="true" tabindex="-1"></a>ACS. We can see that each row in the data represents an individual</span>
<span id="cb32-408"><a href="#cb32-408" aria-hidden="true" tabindex="-1"></a>(<span class="in">`n_rows`</span> equals <span class="in">`n_individuals`</span>) and, as we would expect, the number of</span>
<span id="cb32-409"><a href="#cb32-409" aria-hidden="true" tabindex="-1"></a>households is much lower than the number of individuals.</span>
<span id="cb32-410"><a href="#cb32-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-413"><a href="#cb32-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-414"><a href="#cb32-414" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-granularity</span></span>
<span id="cb32-415"><a href="#cb32-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Oakland Dataset Granularity by PUMA"</span></span>
<span id="cb32-416"><a href="#cb32-416" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb32-417"><a href="#cb32-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb32-418"><a href="#cb32-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb32-419"><a href="#cb32-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb32-420"><a href="#cb32-420" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-421"><a href="#cb32-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-422"><a href="#cb32-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-423"><a href="#cb32-423" aria-hidden="true" tabindex="-1"></a>I'll also randomly select a household in the data to see what such a</span>
<span id="cb32-424"><a href="#cb32-424" aria-hidden="true" tabindex="-1"></a>unit looks like in practice.</span>
<span id="cb32-425"><a href="#cb32-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-428"><a href="#cb32-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-429"><a href="#cb32-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-hh</span></span>
<span id="cb32-430"><a href="#cb32-430" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example household"</span></span>
<span id="cb32-431"><a href="#cb32-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-432"><a href="#cb32-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-433"><a href="#cb32-433" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb32-434"><a href="#cb32-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb32-435"><a href="#cb32-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-436"><a href="#cb32-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-437"><a href="#cb32-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb32-438"><a href="#cb32-438" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb32-439"><a href="#cb32-439" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb32-440"><a href="#cb32-440" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb32-441"><a href="#cb32-441" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb32-442"><a href="#cb32-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, PERNUM, AGE, SEX, HHINCOME, INCTOT))</span>
<span id="cb32-443"><a href="#cb32-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-444"><a href="#cb32-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-445"><a href="#cb32-445" aria-hidden="true" tabindex="-1"></a>Here we can see that this household, with <span class="in">`SERIAL`</span></span>
<span id="cb32-446"><a href="#cb32-446" aria-hidden="true" tabindex="-1"></a><span class="in">`{r} format(sample_household, scientific=FALSE)`</span> has <span class="in">`{r} n`</span> members,</span>
<span id="cb32-447"><a href="#cb32-447" aria-hidden="true" tabindex="-1"></a>each with a unique <span class="in">`PERNUM`</span>.</span>
<span id="cb32-448"><a href="#cb32-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-449"><a href="#cb32-449" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question – **what was the median</span>
<span id="cb32-450"><a href="#cb32-450" aria-hidden="true" tabindex="-1"></a>household income in Oakland, California in 2022?** Note the income</span>
<span id="cb32-451"><a href="#cb32-451" aria-hidden="true" tabindex="-1"></a>variables we observe for this family:</span>
<span id="cb32-452"><a href="#cb32-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-453"><a href="#cb32-453" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`INCTOT`</span> reports each respondent's total pre-tax personal income or</span>
<span id="cb32-454"><a href="#cb32-454" aria-hidden="true" tabindex="-1"></a>    losses from all sources for the previous year. <span class="in">`9999999`</span> is code to</span>
<span id="cb32-455"><a href="#cb32-455" aria-hidden="true" tabindex="-1"></a>    denote that the value is missing, which makes sense given that the</span>
<span id="cb32-456"><a href="#cb32-456" aria-hidden="true" tabindex="-1"></a>    missing values above correspond to children in the household [See</span>
<span id="cb32-457"><a href="#cb32-457" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">INCTOT</span><span class="co">](https://usa.ipums.org/usa-action/variables/INCTOT)</span> in</span>
<span id="cb32-458"><a href="#cb32-458" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024].</span>
<span id="cb32-459"><a href="#cb32-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-460"><a href="#cb32-460" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`HHINCOME`</span> reports the total money income of all household members</span>
<span id="cb32-461"><a href="#cb32-461" aria-hidden="true" tabindex="-1"></a>    age 15+ during the previous year. The amount should equal the sum of</span>
<span id="cb32-462"><a href="#cb32-462" aria-hidden="true" tabindex="-1"></a>    all household members' individual incomes, as recorded in the</span>
<span id="cb32-463"><a href="#cb32-463" aria-hidden="true" tabindex="-1"></a>    person-record variable INCTOT [See</span>
<span id="cb32-464"><a href="#cb32-464" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">HHINCOME</span><span class="co">](https://usa.ipums.org/usa-action/variables/HHINCOME)</span> in</span>
<span id="cb32-465"><a href="#cb32-465" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024]</span>
<span id="cb32-466"><a href="#cb32-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-467"><a href="#cb32-467" aria-hidden="true" tabindex="-1"></a>Given what we know about the unique identifier for households, and the</span>
<span id="cb32-468"><a href="#cb32-468" aria-hidden="true" tabindex="-1"></a><span class="in">`HHINCOME`</span> variable, we can construct the appropriate dataset for</span>
<span id="cb32-469"><a href="#cb32-469" aria-hidden="true" tabindex="-1"></a>answering our motivating question – every household in Oakland that had</span>
<span id="cb32-470"><a href="#cb32-470" aria-hidden="true" tabindex="-1"></a>household income.</span>
<span id="cb32-471"><a href="#cb32-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-474"><a href="#cb32-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-475"><a href="#cb32-475" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb32-476"><a href="#cb32-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-477"><a href="#cb32-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-478"><a href="#cb32-478" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb32-479"><a href="#cb32-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb32-480"><a href="#cb32-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-481"><a href="#cb32-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-482"><a href="#cb32-482" aria-hidden="true" tabindex="-1"></a>It seems we can proceed to simply calculate the median of the <span class="in">`HHINCOME`</span></span>
<span id="cb32-483"><a href="#cb32-483" aria-hidden="true" tabindex="-1"></a>column? Not so fast... Data in the ACS microdata are not what they seem.</span>
<span id="cb32-484"><a href="#cb32-484" aria-hidden="true" tabindex="-1"></a>Before we do any analysis, we have to account for **sample weights**.</span>
<span id="cb32-485"><a href="#cb32-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-486"><a href="#cb32-486" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Applying sample weights</span></span>
<span id="cb32-487"><a href="#cb32-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-488"><a href="#cb32-488" aria-hidden="true" tabindex="-1"></a>Let's return to our sample family from above, but also examine the</span>
<span id="cb32-489"><a href="#cb32-489" aria-hidden="true" tabindex="-1"></a>variables <span class="in">`PERWT`</span> and <span class="in">`HHWT`</span>.</span>
<span id="cb32-490"><a href="#cb32-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-493"><a href="#cb32-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-494"><a href="#cb32-494" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb32-495"><a href="#cb32-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span>
<span id="cb32-496"><a href="#cb32-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-497"><a href="#cb32-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-498"><a href="#cb32-498" aria-hidden="true" tabindex="-1"></a>These are the two primary sample weights in ACS microdata, and they can</span>
<span id="cb32-499"><a href="#cb32-499" aria-hidden="true" tabindex="-1"></a>be interpreted fairly directly. <span class="in">`PERWT`</span> gives the population represented</span>
<span id="cb32-500"><a href="#cb32-500" aria-hidden="true" tabindex="-1"></a>by each individual in the sample, thus in the first row of the sample</span>
<span id="cb32-501"><a href="#cb32-501" aria-hidden="true" tabindex="-1"></a>household, the 31 year old woman with an individual income of \$9,300</span>
<span id="cb32-502"><a href="#cb32-502" aria-hidden="true" tabindex="-1"></a>represents 62 individuals in the PUMA. <span class="in">`HHWT`</span> gives the number of</span>
<span id="cb32-503"><a href="#cb32-503" aria-hidden="true" tabindex="-1"></a>households in the general population represented by each household in</span>
<span id="cb32-504"><a href="#cb32-504" aria-hidden="true" tabindex="-1"></a>the sample, thus this household is representative of 62 households in</span>
<span id="cb32-505"><a href="#cb32-505" aria-hidden="true" tabindex="-1"></a>that PUMA.</span>
<span id="cb32-506"><a href="#cb32-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-507"><a href="#cb32-507" aria-hidden="true" tabindex="-1"></a>Any person-level analysis of ACS microdata should be weighted by</span>
<span id="cb32-508"><a href="#cb32-508" aria-hidden="true" tabindex="-1"></a><span class="in">`PERWT`</span>, and household-level analysis should be weighted by <span class="in">`HHWT`</span> [See</span>
<span id="cb32-509"><a href="#cb32-509" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Sample Weights</span><span class="co">](https://usa.ipums.org/usa/intro.shtml#weights)</span> in</span>
<span id="cb32-510"><a href="#cb32-510" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024]. We'll use the</span>
<span id="cb32-511"><a href="#cb32-511" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`srvyr`</span><span class="co">](http://gdfe.co/srvyr/reference/index.html)</span> package for easily</span>
<span id="cb32-512"><a href="#cb32-512" aria-hidden="true" tabindex="-1"></a>defining the survey weights and using them to calculate summary</span>
<span id="cb32-513"><a href="#cb32-513" aria-hidden="true" tabindex="-1"></a>statistics.</span>
<span id="cb32-514"><a href="#cb32-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-515"><a href="#cb32-515" aria-hidden="true" tabindex="-1"></a>Here we'll finally address the motivating question. **The median</span>
<span id="cb32-516"><a href="#cb32-516" aria-hidden="true" tabindex="-1"></a>household income in Oakland in 2022** as measured in the IPUMS microdata</span>
<span id="cb32-517"><a href="#cb32-517" aria-hidden="true" tabindex="-1"></a>was as follows:</span>
<span id="cb32-518"><a href="#cb32-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-521"><a href="#cb32-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-522"><a href="#cb32-522" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-523"><a href="#cb32-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb32-524"><a href="#cb32-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-525"><a href="#cb32-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span>
<span id="cb32-526"><a href="#cb32-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-527"><a href="#cb32-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-528"><a href="#cb32-528" aria-hidden="true" tabindex="-1"></a>Let's do a quick comparison of our IPUMS results to the aggregate census</span>
<span id="cb32-529"><a href="#cb32-529" aria-hidden="true" tabindex="-1"></a>data we retrieved in the first section. Here are our full IPUMS results</span>
<span id="cb32-530"><a href="#cb32-530" aria-hidden="true" tabindex="-1"></a>for both median household income and population:</span>
<span id="cb32-531"><a href="#cb32-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-534"><a href="#cb32-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-535"><a href="#cb32-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-536"><a href="#cb32-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-ipums-res</span></span>
<span id="cb32-537"><a href="#cb32-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "IPUMS versus ACS aggregate results"</span></span>
<span id="cb32-538"><a href="#cb32-538" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-539"><a href="#cb32-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb32-540"><a href="#cb32-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-541"><a href="#cb32-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"median_hh_income"</span>,</span>
<span id="cb32-542"><a href="#cb32-542" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb32-543"><a href="#cb32-543" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb32-544"><a href="#cb32-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-545"><a href="#cb32-545" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb32-546"><a href="#cb32-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb32-547"><a href="#cb32-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-548"><a href="#cb32-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"total_pop"</span>,</span>
<span id="cb32-549"><a href="#cb32-549" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb32-550"><a href="#cb32-550" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb32-551"><a href="#cb32-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-552"><a href="#cb32-552" aria-hidden="true" tabindex="-1"></a>aggregate_data <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb32-553"><a href="#cb32-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb32-554"><a href="#cb32-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ACS_aggregate_estimate =</span> estimate)</span>
<span id="cb32-555"><a href="#cb32-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-556"><a href="#cb32-556" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table) <span class="sc">%&gt;%</span> </span>
<span id="cb32-557"><a href="#cb32-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate)) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(aggregate_data, <span class="at">by=</span><span class="st">'variable'</span>)</span>
<span id="cb32-558"><a href="#cb32-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-559"><a href="#cb32-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-560"><a href="#cb32-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-561"><a href="#cb32-561" aria-hidden="true" tabindex="-1"></a>These are.. Clearly different. What gives? Unfortunately, **summary</span>
<span id="cb32-562"><a href="#cb32-562" aria-hidden="true" tabindex="-1"></a>statistics calculated using IPUMS data typically cannot match aggregate</span>
<span id="cb32-563"><a href="#cb32-563" aria-hidden="true" tabindex="-1"></a>ACS figures!**</span>
<span id="cb32-564"><a href="#cb32-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-565"><a href="#cb32-565" aria-hidden="true" tabindex="-1"></a>One major reason for the gap is additional sampling error. Recall that</span>
<span id="cb32-566"><a href="#cb32-566" aria-hidden="true" tabindex="-1"></a>the American Community Survey is a sample. A given one-year ACS is</span>
<span id="cb32-567"><a href="#cb32-567" aria-hidden="true" tabindex="-1"></a>typically a 1% sample of the U.S. population, with associated sampling</span>
<span id="cb32-568"><a href="#cb32-568" aria-hidden="true" tabindex="-1"></a>error. When the census makes microdata available, they create a sample</span>
<span id="cb32-569"><a href="#cb32-569" aria-hidden="true" tabindex="-1"></a>of that sample -- we do not get the full 1%. This second sampling</span>
<span id="cb32-570"><a href="#cb32-570" aria-hidden="true" tabindex="-1"></a>process introduces further sampling error in the microdata that is not</span>
<span id="cb32-571"><a href="#cb32-571" aria-hidden="true" tabindex="-1"></a>reflected in figures sourced from aggregate ACS data, which are</span>
<span id="cb32-572"><a href="#cb32-572" aria-hidden="true" tabindex="-1"></a>calculated using the full ACS sample [[See</span>
<span id="cb32-573"><a href="#cb32-573" aria-hidden="true" tabindex="-1"></a>ACS](https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS) in</span>
<span id="cb32-574"><a href="#cb32-574" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024]. This introduces its own, additional sampling</span>
<span id="cb32-575"><a href="#cb32-575" aria-hidden="true" tabindex="-1"></a>error.<span class="ot">[^5]</span></span>
<span id="cb32-576"><a href="#cb32-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-577"><a href="#cb32-577" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>Beyond that sampling error, the census applies various other</span>
<span id="cb32-578"><a href="#cb32-578" aria-hidden="true" tabindex="-1"></a>    additional data processing steps to microdata that aren't applied to</span>
<span id="cb32-579"><a href="#cb32-579" aria-hidden="true" tabindex="-1"></a>    aggregate figures [[See</span>
<span id="cb32-580"><a href="#cb32-580" aria-hidden="true" tabindex="-1"></a>    ACS](https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS) in</span>
<span id="cb32-581"><a href="#cb32-581" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024]</span>
<span id="cb32-582"><a href="#cb32-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-583"><a href="#cb32-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Applying replicate weights</span></span>
<span id="cb32-584"><a href="#cb32-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-585"><a href="#cb32-585" aria-hidden="true" tabindex="-1"></a>If we stopped at this point, we would be able to use census microdata to</span>
<span id="cb32-586"><a href="#cb32-586" aria-hidden="true" tabindex="-1"></a>accurately calculate all sorts of interesting quantities. However, there</span>
<span id="cb32-587"><a href="#cb32-587" aria-hidden="true" tabindex="-1"></a>is one more subtlety to ACS microdata that becomes important when we are</span>
<span id="cb32-588"><a href="#cb32-588" aria-hidden="true" tabindex="-1"></a>calculating the standard errors of those quantities: **replicate</span>
<span id="cb32-589"><a href="#cb32-589" aria-hidden="true" tabindex="-1"></a>weights**.</span>
<span id="cb32-590"><a href="#cb32-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-591"><a href="#cb32-591" aria-hidden="true" tabindex="-1"></a>For the sake of this example, let's shift from our motivating question to a new one -- **what was the average earned income for women in Oakland in 2022**? I'll create a dataset of individuals with income and labeled gender here:  </span>
<span id="cb32-592"><a href="#cb32-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-595"><a href="#cb32-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-596"><a href="#cb32-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-597"><a href="#cb32-597" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb32-598"><a href="#cb32-598" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb32-599"><a href="#cb32-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-600"><a href="#cb32-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-601"><a href="#cb32-601" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb32-602"><a href="#cb32-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb32-603"><a href="#cb32-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb32-604"><a href="#cb32-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-605"><a href="#cb32-605" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb32-606"><a href="#cb32-606" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb32-607"><a href="#cb32-607" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb32-608"><a href="#cb32-608" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb32-609"><a href="#cb32-609" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb32-610"><a href="#cb32-610" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb32-611"><a href="#cb32-611" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb32-612"><a href="#cb32-612" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb32-613"><a href="#cb32-613" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb32-614"><a href="#cb32-614" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-615"><a href="#cb32-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-616"><a href="#cb32-616" aria-hidden="true" tabindex="-1"></a>When we calculate the average income for women in Oakland using the</span>
<span id="cb32-617"><a href="#cb32-617" aria-hidden="true" tabindex="-1"></a>production individual weights, we get the standard error (se) below:</span>
<span id="cb32-618"><a href="#cb32-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-621"><a href="#cb32-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-622"><a href="#cb32-622" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-623"><a href="#cb32-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-624"><a href="#cb32-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb32-625"><a href="#cb32-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT))</span>
<span id="cb32-626"><a href="#cb32-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-627"><a href="#cb32-627" aria-hidden="true" tabindex="-1"></a>That is the weighted sample mean and its accompanying sample standard</span>
<span id="cb32-628"><a href="#cb32-628" aria-hidden="true" tabindex="-1"></a>error.</span>
<span id="cb32-629"><a href="#cb32-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-630"><a href="#cb32-630" aria-hidden="true" tabindex="-1"></a>In theory, the standard error of an estimate measures the variation of a</span>
<span id="cb32-631"><a href="#cb32-631" aria-hidden="true" tabindex="-1"></a>statistic across multiple samples of a given population. Our sample</span>
<span id="cb32-632"><a href="#cb32-632" aria-hidden="true" tabindex="-1"></a>standard error above, calculated using just the one sample, is just an</span>
<span id="cb32-633"><a href="#cb32-633" aria-hidden="true" tabindex="-1"></a>estimate of that theoretical standard error. We can get a better estimate of that theoretical standard error using replicate weights.</span>
<span id="cb32-634"><a href="#cb32-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-635"><a href="#cb32-635" aria-hidden="true" tabindex="-1"></a>Replicate weights allow a single sample to simulate multiple samples, thus generating more</span>
<span id="cb32-636"><a href="#cb32-636" aria-hidden="true" tabindex="-1"></a>informed standard error estimates that more closely mimic the</span>
<span id="cb32-637"><a href="#cb32-637" aria-hidden="true" tabindex="-1"></a>theoretical basis of standard errors.</span>
<span id="cb32-638"><a href="#cb32-638" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa/repwt.shtml#q70</span>
<span id="cb32-639"><a href="#cb32-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-640"><a href="#cb32-640" aria-hidden="true" tabindex="-1"></a>Here we can see what replicate weights (in this case, individual</span>
<span id="cb32-641"><a href="#cb32-641" aria-hidden="true" tabindex="-1"></a>replicate weights) look like in our data. Each of <span class="in">`REPWTP`</span>, 1 through 80,</span>
<span id="cb32-642"><a href="#cb32-642" aria-hidden="true" tabindex="-1"></a>is a set of alternative individual weights, slightly different from the</span>
<span id="cb32-643"><a href="#cb32-643" aria-hidden="true" tabindex="-1"></a>"production weight," <span class="in">`PERWT`</span>.</span>
<span id="cb32-644"><a href="#cb32-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-647"><a href="#cb32-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-648"><a href="#cb32-648" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-649"><a href="#cb32-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-650"><a href="#cb32-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(INCTOT, PERWT, REPWTP1, REPWTP2, <span class="st">`</span><span class="at"> </span><span class="st">`</span>, REPWTP79, REPWTP80)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-651"><a href="#cb32-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb32-652"><a href="#cb32-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-653"><a href="#cb32-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-654"><a href="#cb32-654" aria-hidden="true" tabindex="-1"></a>We can use replicate weights in a variety of alternative variance</span>
<span id="cb32-655"><a href="#cb32-655" aria-hidden="true" tabindex="-1"></a>estimates in the calculation of "successive difference replication (SDR)</span>
<span id="cb32-656"><a href="#cb32-656" aria-hidden="true" tabindex="-1"></a>variance," an alternative to the standard variance of an estimate. We</span>
<span id="cb32-657"><a href="#cb32-657" aria-hidden="true" tabindex="-1"></a>obtain SDR variance by calculating a statistic of interest with the</span>
<span id="cb32-658"><a href="#cb32-658" aria-hidden="true" tabindex="-1"></a>production weights (e.g. <span class="in">`HHWT`</span>), then sum the squared deviations</span>
<span id="cb32-659"><a href="#cb32-659" aria-hidden="true" tabindex="-1"></a>between that production weighted estimate and the weighted estimates we</span>
<span id="cb32-660"><a href="#cb32-660" aria-hidden="true" tabindex="-1"></a>obtain with each replicate weight (e.g. <span class="in">`REPWT1`</span>). Specifically:</span>
<span id="cb32-661"><a href="#cb32-661" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb32-662"><a href="#cb32-662" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb32-663"><a href="#cb32-663" aria-hidden="true" tabindex="-1"></a>\bar{x}_w &amp;= \frac{\sum_{i=1}^{n}w_ix_i}{\sum_{i=1}^{n}w_i} <span class="sc">\\</span> </span>
<span id="cb32-664"><a href="#cb32-664" aria-hidden="true" tabindex="-1"></a>\bar{x}_r &amp;= \frac{\sum_{i=1}^{n}r_ix_i}{\sum_{i=1}^{n}r_i} <span class="sc">\\</span> </span>
<span id="cb32-665"><a href="#cb32-665" aria-hidden="true" tabindex="-1"></a>SE(\bar{x}_w) &amp;= \sqrt{\frac{4}{80} \sum_{r=1}^{80} (\bar{x}_r - \bar{x}_w)^2}</span>
<span id="cb32-666"><a href="#cb32-666" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb32-667"><a href="#cb32-667" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb32-668"><a href="#cb32-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-669"><a href="#cb32-669" aria-hidden="true" tabindex="-1"></a>Where $w$ represents the production weights, $r$ represents each</span>
<span id="cb32-670"><a href="#cb32-670" aria-hidden="true" tabindex="-1"></a>replicate weight. There are a few ways you can rationalize this equation to yourself.</span>
<span id="cb32-671"><a href="#cb32-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-672"><a href="#cb32-672" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>It's equivalent to using <span class="co">[</span><span class="ot">Fay's Balanced Repeated Replication method</span><span class="co">](https://documentation.sas.com/doc/en/statug/15.2/statug_surveyphreg_details29.htm#:~:text=the%20following%20section.-,Fay%E2%80%99s%20BRR%20Method,-The%20traditional%20BRR)</span> with the Faye coefficient set to $\epsilon=.5$.</span>
<span id="cb32-673"><a href="#cb32-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-676"><a href="#cb32-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-677"><a href="#cb32-677" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb32-678"><a href="#cb32-678" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb32-679"><a href="#cb32-679" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb32-680"><a href="#cb32-680" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-681"><a href="#cb32-681" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-682"><a href="#cb32-682" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWTP"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb32-683"><a href="#cb32-683" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-684"><a href="#cb32-684" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb32-685"><a href="#cb32-685" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-686"><a href="#cb32-686" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb32-687"><a href="#cb32-687" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-688"><a href="#cb32-688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-689"><a href="#cb32-689" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb32-690"><a href="#cb32-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(INCTOT)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-691"><a href="#cb32-691" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb32-692"><a href="#cb32-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb32-693"><a href="#cb32-693" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span>
<span id="cb32-694"><a href="#cb32-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-695"><a href="#cb32-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-696"><a href="#cb32-696" aria-hidden="true" tabindex="-1"></a>To be clear, we don't have to ever do that manually -- <span class="in">`survey`</span> supports</span>
<span id="cb32-697"><a href="#cb32-697" aria-hidden="true" tabindex="-1"></a>specifying survey designs with replicate weights. Here we can</span>
<span id="cb32-698"><a href="#cb32-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-701"><a href="#cb32-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-702"><a href="#cb32-702" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb32-703"><a href="#cb32-703" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb32-704"><a href="#cb32-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb32-705"><a href="#cb32-705" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb32-706"><a href="#cb32-706" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span></span>
<span id="cb32-707"><a href="#cb32-707" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb32-708"><a href="#cb32-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SEX <span class="sc">==</span> <span class="st">'Female'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-709"><a href="#cb32-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_female_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span>
<span id="cb32-710"><a href="#cb32-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-711"><a href="#cb32-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-712"><a href="#cb32-712" aria-hidden="true" tabindex="-1"></a>In IPUMS testing of ACS/PRCS data, replicate weights usually increase</span>
<span id="cb32-713"><a href="#cb32-713" aria-hidden="true" tabindex="-1"></a>standard errors. This increase is generally not large enough to alter</span>
<span id="cb32-714"><a href="#cb32-714" aria-hidden="true" tabindex="-1"></a>the significance level of coefficients, though marginally significant</span>
<span id="cb32-715"><a href="#cb32-715" aria-hidden="true" tabindex="-1"></a>coefficients may become clearly non-significant. The more obvious effect</span>
<span id="cb32-716"><a href="#cb32-716" aria-hidden="true" tabindex="-1"></a>of using replicate weights is on the width of confidence intervals,</span>
<span id="cb32-717"><a href="#cb32-717" aria-hidden="true" tabindex="-1"></a>which can change substantially.</span>
<span id="cb32-718"><a href="#cb32-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-719"><a href="#cb32-719" aria-hidden="true" tabindex="-1"></a>IPUMS' documentation recommends the following specification for the</span>
<span id="cb32-720"><a href="#cb32-720" aria-hidden="true" tabindex="-1"></a>replicate weights, where the standard errors are calculated via a</span>
<span id="cb32-721"><a href="#cb32-721" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">jacknife</span><span class="co">](https://en.wikipedia.org/wiki/Jackknife_resampling)</span> (see</span>
<span id="cb32-722"><a href="#cb32-722" aria-hidden="true" tabindex="-1"></a><span class="in">`type = 'JK1'`</span>).</span>
<span id="cb32-723"><a href="#cb32-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-726"><a href="#cb32-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-727"><a href="#cb32-727" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb32-728"><a href="#cb32-728" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb32-729"><a href="#cb32-729" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb32-730"><a href="#cb32-730" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb32-731"><a href="#cb32-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb32-732"><a href="#cb32-732" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb32-733"><a href="#cb32-733" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb32-734"><a href="#cb32-734" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-735"><a href="#cb32-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-736"><a href="#cb32-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-737"><a href="#cb32-737" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyzing ACS microdata</span></span>
<span id="cb32-738"><a href="#cb32-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-739"><a href="#cb32-739" aria-hidden="true" tabindex="-1"></a>Here we can see the un-adjusted gender earnings gap in Oakland, where</span>
<span id="cb32-740"><a href="#cb32-740" aria-hidden="true" tabindex="-1"></a>men on earn about \$20k more than women on average:</span>
<span id="cb32-741"><a href="#cb32-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-744"><a href="#cb32-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-745"><a href="#cb32-745" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="sc">%&gt;%</span></span>
<span id="cb32-746"><a href="#cb32-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEX) <span class="sc">%&gt;%</span></span>
<span id="cb32-747"><a href="#cb32-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span>
<span id="cb32-748"><a href="#cb32-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-749"><a href="#cb32-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-750"><a href="#cb32-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-753"><a href="#cb32-753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-754"><a href="#cb32-754" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-755"><a href="#cb32-755" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-756"><a href="#cb32-756" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb32-757"><a href="#cb32-757" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb32-758"><a href="#cb32-758" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="st">'base'</span>)</span>
<span id="cb32-759"><a href="#cb32-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-760"><a href="#cb32-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-763"><a href="#cb32-763" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb32-764"><a href="#cb32-764" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb32-765"><a href="#cb32-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb32-766"><a href="#cb32-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb32-767"><a href="#cb32-767" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-768"><a href="#cb32-768" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb32-769"><a href="#cb32-769" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb32-770"><a href="#cb32-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-771"><a href="#cb32-771" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(r[<span class="st">'individuals_w_income'</span>])</span>
<span id="cb32-772"><a href="#cb32-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-773"><a href="#cb32-773" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb32-774"><a href="#cb32-774" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'INCTOT'</span>, y<span class="op">=</span><span class="st">"AGE"</span>, weights<span class="op">=</span><span class="st">"PERWT"</span>, ax<span class="op">=</span>ax, fill<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">.5</span>, log_scale<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-775"><a href="#cb32-775" aria-hidden="true" tabindex="-1"></a><span class="co"># df['INCTOT'].plot.kde(ax=ax, alpha=.9)</span></span>
<span id="cb32-776"><a href="#cb32-776" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb32-777"><a href="#cb32-777" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb32-778"><a href="#cb32-778" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"thumbnail.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb32-779"><a href="#cb32-779" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span>
<span id="cb32-780"><a href="#cb32-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-781"><a href="#cb32-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-782"><a href="#cb32-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-783"><a href="#cb32-783" aria-hidden="true" tabindex="-1"></a>Lets explore a couple other dynamics related to earnings in Oakland and</span>
<span id="cb32-784"><a href="#cb32-784" aria-hidden="true" tabindex="-1"></a>practice making visualizations and estimating regressions with the data.</span>
<span id="cb32-785"><a href="#cb32-785" aria-hidden="true" tabindex="-1"></a>Here's the income distribution across different levels of highest</span>
<span id="cb32-786"><a href="#cb32-786" aria-hidden="true" tabindex="-1"></a>education earned. Note here that I'm not using the replicate weights</span>
<span id="cb32-787"><a href="#cb32-787" aria-hidden="true" tabindex="-1"></a>(I'm just using the <span class="in">`individuals_w_income`</span> object), since I'm not</span>
<span id="cb32-788"><a href="#cb32-788" aria-hidden="true" tabindex="-1"></a>estimating anything. <span class="in">`ggplot`</span> does take a weight argument, for which</span>
<span id="cb32-789"><a href="#cb32-789" aria-hidden="true" tabindex="-1"></a>I've supplied the <span class="in">`PERWT`</span> sample weights.</span>
<span id="cb32-790"><a href="#cb32-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-791"><a href="#cb32-791" aria-hidden="true" tabindex="-1"></a><span class="ot">&lt;https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html&gt;</span></span>
<span id="cb32-792"><a href="#cb32-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-795"><a href="#cb32-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-796"><a href="#cb32-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-797"><a href="#cb32-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-798"><a href="#cb32-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-799"><a href="#cb32-799" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-800"><a href="#cb32-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb32-801"><a href="#cb32-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb32-802"><a href="#cb32-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb32-803"><a href="#cb32-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb32-804"><a href="#cb32-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-805"><a href="#cb32-805" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(</span>
<span id="cb32-806"><a href="#cb32-806" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order),</span>
<span id="cb32-807"><a href="#cb32-807" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> INCTOT,</span>
<span id="cb32-808"><a href="#cb32-808" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT</span>
<span id="cb32-809"><a href="#cb32-809" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb32-810"><a href="#cb32-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb32-811"><a href="#cb32-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb32-812"><a href="#cb32-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb32-813"><a href="#cb32-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb32-814"><a href="#cb32-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.2</span></span>
<span id="cb32-815"><a href="#cb32-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-816"><a href="#cb32-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb32-817"><a href="#cb32-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb32-818"><a href="#cb32-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb32-819"><a href="#cb32-819" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">9</span>,</span>
<span id="cb32-820"><a href="#cb32-820" aria-hidden="true" tabindex="-1"></a>    <span class="at">outliers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-821"><a href="#cb32-821" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">8</span></span>
<span id="cb32-822"><a href="#cb32-822" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-823"><a href="#cb32-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb32-824"><a href="#cb32-824" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb32-825"><a href="#cb32-825" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb32-826"><a href="#cb32-826" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)</span>
<span id="cb32-827"><a href="#cb32-827" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-828"><a href="#cb32-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb32-829"><a href="#cb32-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>, <span class="at">y =</span> <span class="st">"Income"</span>, <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb32-830"><a href="#cb32-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-831"><a href="#cb32-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-832"><a href="#cb32-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb32-833"><a href="#cb32-833" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb32-834"><a href="#cb32-834" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb32-835"><a href="#cb32-835" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb32-836"><a href="#cb32-836" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb32-837"><a href="#cb32-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb32-838"><a href="#cb32-838" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-839"><a href="#cb32-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-840"><a href="#cb32-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-841"><a href="#cb32-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-842"><a href="#cb32-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-843"><a href="#cb32-843" aria-hidden="true" tabindex="-1"></a>The plot shows that individuals with bachelor's and graduate degrees</span>
<span id="cb32-844"><a href="#cb32-844" aria-hidden="true" tabindex="-1"></a>generally have higher incomes in Oakland. Let's seen how bachelor and</span>
<span id="cb32-845"><a href="#cb32-845" aria-hidden="true" tabindex="-1"></a>graduate degree attainment differs across sex. Again, I'm using the</span>
<span id="cb32-846"><a href="#cb32-846" aria-hidden="true" tabindex="-1"></a><span class="in">`individuals_w_income`</span> object as I have no need to replicate weights.</span>
<span id="cb32-847"><a href="#cb32-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-850"><a href="#cb32-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-851"><a href="#cb32-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-852"><a href="#cb32-852" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-853"><a href="#cb32-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-854"><a href="#cb32-854" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb32-855"><a href="#cb32-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-856"><a href="#cb32-856" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb32-857"><a href="#cb32-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-858"><a href="#cb32-858" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income,</span>
<span id="cb32-859"><a href="#cb32-859" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb32-860"><a href="#cb32-860" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level =</span> order),</span>
<span id="cb32-861"><a href="#cb32-861" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb32-862"><a href="#cb32-862" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb32-863"><a href="#cb32-863" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> PERWT</span>
<span id="cb32-864"><a href="#cb32-864" aria-hidden="true" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb32-865"><a href="#cb32-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb32-866"><a href="#cb32-866" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb32-867"><a href="#cb32-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb32-868"><a href="#cb32-868" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb32-869"><a href="#cb32-869" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (..count..) <span class="sc">/</span> <span class="fu">sum</span>(..count..))</span>
<span id="cb32-870"><a href="#cb32-870" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-871"><a href="#cb32-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb32-872"><a href="#cb32-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb32-873"><a href="#cb32-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb32-874"><a href="#cb32-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-875"><a href="#cb32-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb32-876"><a href="#cb32-876" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb32-877"><a href="#cb32-877" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb32-878"><a href="#cb32-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb32-879"><a href="#cb32-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Sex"</span></span>
<span id="cb32-880"><a href="#cb32-880" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-881"><a href="#cb32-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-882"><a href="#cb32-882" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-883"><a href="#cb32-883" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb32-884"><a href="#cb32-884" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb32-885"><a href="#cb32-885" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb32-886"><a href="#cb32-886" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb32-887"><a href="#cb32-887" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb32-888"><a href="#cb32-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb32-889"><a href="#cb32-889" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-890"><a href="#cb32-890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-891"><a href="#cb32-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-892"><a href="#cb32-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-893"><a href="#cb32-893" aria-hidden="true" tabindex="-1"></a>So bachelor and graduate degree holders generally earn more, and women</span>
<span id="cb32-894"><a href="#cb32-894" aria-hidden="true" tabindex="-1"></a>are more likely than men to have bachelor and graduate degrees in</span>
<span id="cb32-895"><a href="#cb32-895" aria-hidden="true" tabindex="-1"></a>Oakland. This should imply that if we adjust for education when</span>
<span id="cb32-896"><a href="#cb32-896" aria-hidden="true" tabindex="-1"></a>estimating the gender-earnings gap in Oakland, thus only comparing men</span>
<span id="cb32-897"><a href="#cb32-897" aria-hidden="true" tabindex="-1"></a>and women in the same education levels, we should see the gap increase.</span>
<span id="cb32-898"><a href="#cb32-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-899"><a href="#cb32-899" aria-hidden="true" tabindex="-1"></a>We again use <span class="in">`svyglm`</span> to estimate the regression, and <span class="in">`oak_indiv_svy`</span> as</span>
<span id="cb32-900"><a href="#cb32-900" aria-hidden="true" tabindex="-1"></a>the data/survey design so as to use the replicate weights for our</span>
<span id="cb32-901"><a href="#cb32-901" aria-hidden="true" tabindex="-1"></a>standard errors.</span>
<span id="cb32-902"><a href="#cb32-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-905"><a href="#cb32-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-906"><a href="#cb32-906" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb32-907"><a href="#cb32-907" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb32-908"><a href="#cb32-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span></span>
<span id="cb32-909"><a href="#cb32-909" aria-hidden="true" tabindex="-1"></a>    AGE <span class="sc">+</span> <span class="fu">I</span>(AGE <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-910"><a href="#cb32-910" aria-hidden="true" tabindex="-1"></a>    <span class="fu">relevel</span>(educ_attain, <span class="at">ref =</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb32-911"><a href="#cb32-911" aria-hidden="true" tabindex="-1"></a>  oak_indiv_svy</span>
<span id="cb32-912"><a href="#cb32-912" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-913"><a href="#cb32-913" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb32-914"><a href="#cb32-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb32-915"><a href="#cb32-915" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, no covariates"</span> <span class="ot">=</span> model_ols2,</span>
<span id="cb32-916"><a href="#cb32-916" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, adjusted for age and education"</span> <span class="ot">=</span> model_ols3</span>
<span id="cb32-917"><a href="#cb32-917" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-918"><a href="#cb32-918" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb32-919"><a href="#cb32-919" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb32-920"><a href="#cb32-920" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-921"><a href="#cb32-921" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-922"><a href="#cb32-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-923"><a href="#cb32-923" aria-hidden="true" tabindex="-1"></a>Fun!</span>
</code></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Peter Amerkhanian</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>