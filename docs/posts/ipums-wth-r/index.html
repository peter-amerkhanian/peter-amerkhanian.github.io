<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2024-09-01">

<title>Working with IPUMS microdata – Peter Amerkhanian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V95HGLKTEB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V95HGLKTEB', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../memos.html"> 
<span class="menu-text">Memos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Professional</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Working with IPUMS microdata</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Data Management</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Amerkhanian </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title"><a href="#" class="nav-link">Working with IPUMS microdata</a></h2>
     
    <ul>
    <li><a href="#aggregate-data-with-tidycensus" id="toc-aggregate-data-with-tidycensus" class="nav-link active" data-scroll-target="#aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></a>
    <ul class="collapse">
    <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
    </ul></li>
    <li><a href="#ipums-microdata-overview" id="toc-ipums-microdata-overview" class="nav-link" data-scroll-target="#ipums-microdata-overview">IPUMS microdata overview</a></li>
    <li><a href="#retrieving-data-from-ipums-usa" id="toc-retrieving-data-from-ipums-usa" class="nav-link" data-scroll-target="#retrieving-data-from-ipums-usa">Retrieving data from IPUMS USA</a></li>
    <li><a href="#using-geocorr-to-identify-geographies" id="toc-using-geocorr-to-identify-geographies" class="nav-link" data-scroll-target="#using-geocorr-to-identify-geographies">Using Geocorr to Identify Geographies</a></li>
    <li><a href="#granularity-in-acs-microdata" id="toc-granularity-in-acs-microdata" class="nav-link" data-scroll-target="#granularity-in-acs-microdata">Granularity in ACS microdata</a></li>
    <li><a href="#applying-sample-weights-in-the-acs" id="toc-applying-sample-weights-in-the-acs" class="nav-link" data-scroll-target="#applying-sample-weights-in-the-acs">Applying sample weights in the ACS</a></li>
    <li><a href="#comparing-microdata-with-aggregate-results" id="toc-comparing-microdata-with-aggregate-results" class="nav-link" data-scroll-target="#comparing-microdata-with-aggregate-results">Comparing microdata with aggregate results</a></li>
    <li><a href="#accurate-standard-errors-with-replicate-weights" id="toc-accurate-standard-errors-with-replicate-weights" class="nav-link" data-scroll-target="#accurate-standard-errors-with-replicate-weights">Accurate Standard Errors with Replicate Weights</a></li>
    <li><a href="#analyzing-acs-microdata" id="toc-analyzing-acs-microdata" class="nav-link" data-scroll-target="#analyzing-acs-microdata">Analyzing ACS microdata</a></li>
    </ul>
  </nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<script>
  document.getElementById('toc-title').addEventListener('click', function(event) {
  event.preventDefault(); // Prevent default behavior of anchor tag
  const firstHeader = document.querySelector('body'); // Select the first h2 element
  if (firstHeader) {
    firstHeader.scrollIntoView({ behavior: 'smooth', block: "start", inline: "nearest"}); // Scroll to the first header smoothly
  }
});
</script>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  dplyr,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  ggplot2,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Statistics</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  modelsummary,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  srvyr,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  survey,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Webscraping</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  httr,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  rvest,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  readr,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  glue,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Census</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  tidycensus,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  ipumsr</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>In this post, I’m going to write up how to use American Community Survey (ACS) microdata, leveraging the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> I’ll cover:</p>
<ol type="1">
<li>Data Retrieval and Processing: how to choose which ACS product is relevant, how to submit a request to IPUMS, and how to filter down to relevant levels of geography/granularity.</li>
<li>Analysis: how to properly weight ACS data using sample and replication weights for accurate data visualizations and statistical models.</li>
</ol>
<p>I’ll start with a question: <strong>What was the median household income in Oakland, California in 2022?</strong></p>
<section id="aggregate-data-with-tidycensus" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></h2>
<p>Answering that question is pretty straightforward using <em>aggregate</em> data from the U.S. Census, which provides various descriptive statistics describing aggregate geographies. If I needed to get the number quickly and wasn’t using it for analysis, I might use a web-based tool like <a href="https://censusreporter.org/">Census Reporter</a> to quickly look it up. However, for an analysis, I would like the data retrieval to be replicable and carried out transparently via an API.</p>
<p>In R, the <code>tidycensus</code> package provides an easy-to-use wrapper for requesting data from the Census API. Note that I set up an API key for the U.S. Census and am storing it in my <code>.Renviron</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span></code></pre></div>
</div>
<p>I can query <code>B19013_001</code>, the median household income variable, using the 2022 1-year American Community Survey sample<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and filter down to Oakland’s GEOID, <code>0653000</code>, which is a combination of the state code for California, <code>06</code>, and the place code for Oakland, <code>53000</code>. I’ll throw in the total population variable for good measure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Done! This is an example of retrieving aggregate census data – in this case a statistic describing the population of Oakland. Aggregate census data is very useful, and <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span> offers a comprehensive treatment of use cases of aggregate census data.</p>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<p>What if instead of the median, I wanted a different quantile of household income? What if I wanted to run a regression and find the association between sex and individual income while adjusting for education? These statistics are not obviously available as aggregate measures in the Census API. Indeed, if I want them, I need to calculate them myself using either <em>individual or household level</em> census data, as-in, data where each row is an individual person or an individual household (depending on your population of interest). This is a common need and entails accessing census <em>microdata</em>, a complicated process that I’ll cover now.</p>
</section>
</section>
<section id="ipums-microdata-overview" class="level2">
<h2 class="anchored" data-anchor-id="ipums-microdata-overview">IPUMS microdata overview</h2>
<p>One of the most popular sources for downloading census microdata is the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS). The IPUMS team provides a centralized API for downloading census microdata, comprehensive documentation for working with census microdata, and harmonized variables across time <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 9</a>)</span>. The easiest way to access IPUMS data in R is with the <code>ipumsr</code> package, which the IPUMS team manages. Here I’ll set an API key in my <code>.Renviron</code> file to use for submitting requests via <code>ipumsr</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span></code></pre></div>
</div>
<p>The <a href="https://tech.popdata.org/ipumsr/"><code>ipumsr</code> website</a> provides details on what degree of support the package has for various IPUMS products, though it’s also possible to check for support using the <code>ipums_data_collections()</code> function. I prefer the function so that I can see exactly what code I’ll need to plug into the API (see <code>code_for_api</code>). The following are the survey products that currently have API support:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">collection_name</th>
<th style="text-align: left;">collection_type</th>
<th style="text-align: left;">code_for_api</th>
<th style="text-align: left;">api_support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IPUMS USA</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">usa</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS CPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">cps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS International</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ipumsi</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS ATUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">atus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS AHTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ahtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">mtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHIS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">nhis</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MEPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">meps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHGIS</td>
<td style="text-align: left;">aggregate data</td>
<td style="text-align: left;">nhgis</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>For any analysis of populations in the U.S., the IPUMS USA (annual survey products) and IPUMS CPS (a <a href="https://www.census.gov/programs-surveys/acs">monthly survey</a> product) collections are of particular interest. I’ll look at IPUMS USA since my motivating question involves median household income for a year – 2022.</p>
<p>The IPUMS USA project collects, preserves and harmonizes U.S. census microdata and provides easy access to this data with enhanced documentation. Data includes decennial censuses from 1790 to 2010 and American Community Surveys (ACS) from 2000 to the present <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. We can check out the newest products they have in the USA collection as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">us2023b</td>
<td style="text-align: left;">2023 PRCS</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2023a</td>
<td style="text-align: left;">2023 ACS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022d</td>
<td style="text-align: left;">2018-2022, PRCS 5-year</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2022c</td>
<td style="text-align: left;">2018-2022, ACS 5-year</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022b</td>
<td style="text-align: left;">2022 PRCS</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Some things to note about these collections:</p>
<ul>
<li><p><strong>ACS vs.&nbsp;PRCS</strong>: The ACS (American Community Survey) collects detailed population and housing information for the 50 U.S. states and The District of Columbia, whereas the PRCS (Puerto Rico Community Survey) functions as an ACS equivalent specifically tailored to collect data in Puerto Rico.</p></li>
<li><p><strong>One-Year vs.&nbsp;Five-Year Estimates</strong>:</p>
<ul>
<li><p>One-Year Estimates (e.g.&nbsp;“2022 ACS”) are based on data collected over a single year; they provide timely information for areas with populations of 65,000 or more (this excludes some small geographies)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> but may have higher margins of error for smaller areas.</p></li>
<li><p>Five-Year Estimates represent a moving average of data collected over a 5-year period and covers geographies down to the Census block group. The 5-year window creates a larger sample size and offers more reliable and detailed information for all population sizes, including small areas, but is less timely than one-year estimates <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span>.</p></li>
</ul></li>
</ul>
</section>
<section id="retrieving-data-from-ipums-usa" class="level2">
<h2 class="anchored" data-anchor-id="retrieving-data-from-ipums-usa">Retrieving data from IPUMS USA</h2>
<p>Let’s return to the motivating question for this post: <strong>What was the median household income in Oakland, California in 2022?</strong></p>
<p>We’ll need to get income data from the 2022 1-year ACS, and we will need to filter our data down to just the city of Oakland. For the first task, I’ll define a general function, <code>retrieve_sample()</code> that retrieves a list of variables from a given ACS sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="st">"Incomes by PUMA"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> variables</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<p>I’ll also define a list of variables that I want, including <code>HHINCOME</code> (household income) and <code>INCTOT</code> (individual income). Some of these variables refer to census-specific language – i.e.&nbsp;<code>PUMA</code> , <code>REPWT</code> , <code>REPWTP</code>. I’ll cover exactly what each of these represent later in the post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>Note the variable, <code>var_spec("STATEFIP", case_selections = "06")</code>. This selects the variable <code>STATEFIP</code>, while also specifying that we want to restrict our request to data where <code>STATEFIP=='06'</code> (California). Generally, <a href="https://tech.popdata.org/ipumsr/reference/var_spec.html"><code>var_spec()</code></a> is used to provide specifications for individual variables when defining an IPUMS microdata extract request <span class="citation" data-cites="greg_freedman_ellis_ipumsr_2024">(<a href="#ref-greg_freedman_ellis_ipumsr_2024" role="doc-biblioref">Greg Freedman Ellis, Derek Burk, and Finn Roberts 2024</a>)</span>.</p>
<p>Now we can request these variables from the 2022 1-year ACS via the following function call:</p>
<p><code>retrieve_sample("us2022a", variables)</code></p>
<p>However, I’ll first write code that checks if I’ve already downloaded the data before running the query to avoid running it unnecessarily (the query can take some time).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(<span class="st">"us2022a"</span>, variables)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Here’s the resulting data, the 2022 1-year ACS for California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74692</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6509</td>
<td style="text-align: right;">650906</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">14500</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74693</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6501</td>
<td style="text-align: right;">650106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74694</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8101</td>
<td style="text-align: right;">810106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74695</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8303</td>
<td style="text-align: right;">830306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">9000</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74696</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6712</td>
<td style="text-align: right;">671206</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">48000</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74697</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7301</td>
<td style="text-align: right;">730106</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">24000</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="using-geocorr-to-identify-geographies" class="level2">
<h2 class="anchored" data-anchor-id="using-geocorr-to-identify-geographies">Using Geocorr to Identify Geographies</h2>
<p>We now have microdata for all of California, but how do we filter down to just Oakland? Unfortunately, this isn’t as simple as just running <code>filter(CITY == 'Oakland')</code> – ACS microdata does not include a field for explicitly identifying cities (note that a city is typically referred to as a “place” in census data). Indeed, the smallest geographic area explicitly identified in the microdata is something called a public use microdata area (PUMA), a geographic area defined based on population <span class="citation" data-cites="pastoor_how_2024">(<a href="#ref-pastoor_how_2024" role="doc-biblioref">Pastoor 2024</a>)</span>. PUMAS are unique geographies – they always correspond to states, but only sometimes correspond to other small geographic areas, such as city, metro area, and county <span class="citation" data-cites="walker_analyzing_2023">(See <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies" role="doc-biblioref">Census Hierarchies</a> in <a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 1</a>)</span>.</p>
<p>To find out if a city corresponds to a collection of PUMAs and which PUMAs those are, we’ll use a tool called Geocorr (geographic correspondence engine), an application that generates files and/or reports — called correlation lists — showing relationships between two or more geographic coverages in the United States <span class="citation" data-cites="mihalik_missouri_2022">(<a href="#ref-mihalik_missouri_2022" role="doc-biblioref">Mihalik, Rice, and Hesser 2022</a>)</span>. Geocorr is a sponsored program of the Missouri State library and published by the University of Missouri Center for Health Policy.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Geocorr 2022: Geographic Correspondence Engine</figcaption>
<p><img src="geocorr.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>For example, suppose you have county-level data for California and would like to convert that data to the ZIP code level. Geocorr can show how each county relates to the ZIP code(s) that intersect it. It can tell you, for each of those ZIP/county intersections, what the size of that intersection is and what portion of the ZIP’s total population is in that intersection <span class="citation" data-cites="mihalik_missouri_2022">(<a href="#ref-mihalik_missouri_2022" role="doc-biblioref">Mihalik, Rice, and Hesser 2022</a>)</span>.</p>
<p>Here I’ll define a function, <code>geocorr_2022()</code> that queries Geocorr 2022 and retrieves a .csv file establishing the relationships between two sets of geographies in a given state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>We’ll use that function to establish the relationships between California’s 2022 PUMAs and its “places,” using individual population as measured in the 2020 Decenial Census to weight the relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span></code></pre></div>
</div>
<p>With that, we can whether Oakland can be represented as a collection of PUMAs, and, if so, which PUMAs make up the city.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 68%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">puma22</th>
<th style="text-align: left;">PlaceName</th>
<th style="text-align: left;">PUMA22name</th>
<th style="text-align: left;">pop20</th>
<th style="text-align: left;">afact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">00111</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (Downtown/West Oakland/North Oakland)</td>
<td style="text-align: left;">106433</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00112</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (Oakland Hills)</td>
<td style="text-align: left;">106896</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00113</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (West)–Oakland City (Elmhurst/Central/East Oakland)</td>
<td style="text-align: left;">125840</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00114</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (West)–San Leandro, Alameda, Emeryville &amp; Piedmont Cities</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00123</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">Alameda County (Northwest)–Oakland City (San Antonio/Fruitvale)</td>
<td style="text-align: left;">101468</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>AFACT</code> (allocation factor) column shows the proportion of the source area contained in the target area – this case the proportion of the PUMA population that belongs to Oakland. In this case, 100% of the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of PUMA 114. To be clear, GEOCORR believes that 9 individuals from 114 do live in Oakland, but based on the AFACT I’ll feel comfortable dropping that PUMA.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the City of Oakland.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74718</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74737</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74738</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1200</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75005</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">41300</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75119</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5800</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75131</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">12306</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But what do these data actually represent?</p>
</section>
<section id="granularity-in-acs-microdata" class="level2">
<h2 class="anchored" data-anchor-id="granularity-in-acs-microdata">Granularity in ACS microdata</h2>
<p>Each row in the ACS microdata is an individual, identified by a unique combination of <code>SERIAL</code>, the unique identifier for their household, and <code>PERNUM</code>, their unique identifier within their household. Thus, we can identify units as follows:</p>
<ul>
<li>Households: The combination of <code>SAMPLE</code> and <code>SERIAL</code> provides a unique identifier for every household in the IPUMS<br>
</li>
<li>Individuals: The combination of <code>SAMPLE</code>, <code>SERIAL</code>, and <code>PERNUM</code> provides a unique identifier for every person in the IPUMS</li>
</ul>
<p>Where <code>SAMPLE</code> defines when the individual was surveyed (in the 1-year ACS it’s the same for all rows) <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/SERIAL" role="doc-biblioref">SERIAL</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p>
<p>We can group by these variable combinations and see how many individuals and households were surveyed across PUMAs in Oakland for the 2022 1-year ACS:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="tbl-granularity" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Oakland Dataset Granularity by PUMA
</figcaption>
<div aria-describedby="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">n_rows</th>
<th style="text-align: right;">n_individuals</th>
<th style="text-align: right;">n_households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">111</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">578</td>
</tr>
<tr class="even">
<td style="text-align: right;">112</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">547</td>
</tr>
<tr class="odd">
<td style="text-align: right;">113</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">385</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">389</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s randomly select a household in the data and see what such a unit looks like in practice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, PERNUM, AGE, SEX, HHINCOME, INCTOT))</span></code></pre></div>
<div id="tbl-example-hh" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: An example household
</figcaption>
<div aria-describedby="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9300</td>
</tr>
<tr class="even">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="even">
<td style="text-align: right;">211975</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">18000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>So here we can see that this household, with <code>SERIAL</code> 211975 has 4 members, each with a unique <code>PERNUM</code>.</p>
<p>Let’s return to the motivating question – <strong>what was the median household income in Oakland, California in 2022?</strong> Here we have a household in Oakland and we can see their individual and household incomes:</p>
<ul>
<li><p><code>INCTOT</code> reports each respondent’s total pre-tax personal income or losses from all sources for the previous year. <code>9999999</code> is code to denote that the value is missing, which makes sense given that the missing values above correspond to children in the household <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/INCTOT" role="doc-biblioref">INCTOT</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p></li>
<li><p><code>HHINCOME</code> reports the total money income of all household members age 15+ during the previous year. The amount should equal the sum of all household members’ individual incomes, as recorded in the person-record variable INCTOT <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/HHINCOME" role="doc-biblioref">HHINCOME</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span></p></li>
</ul>
<p>Given what we know about the unique identifier for households, and the <code>HHINCOME</code> variable, we can construct the appropriate dataset for answering our motivating question:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
<p>It seems we can proceed to simply calculate the median of the <code>HHINCOME</code> column? Not so fast… Data in the ACS microdata are not what they seem. Before we do any analysis, we have to account for <strong>sample weights</strong>.</p>
</section>
<section id="applying-sample-weights-in-the-acs" class="level2">
<h2 class="anchored" data-anchor-id="applying-sample-weights-in-the-acs">Applying sample weights in the ACS</h2>
<p>Let’s return to our sample family from above, but also examine the variables <code>PERWT</code> and <code>HHWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">HHWT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9300</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27300</td>
<td style="text-align: right;">18000</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">62</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These are the two primary sample weights in ACS microdata, and they can be interpreted fairly directly. <code>PERWT</code> gives the population represented by each individual in the sample, thus in the first row of the sample household, the 31 year old woman with an individual income of $9,300 represents 62 individuals in the PUMA. <code>HHWT</code> gives the number of households in the general population represented by each household in the sample, thus this household is representative of 62 households in that PUMA.</p>
<p>Any person-level analysis of ACS microdata should be weighted by <code>PERWT</code>, and household-level analysis should be weighted by <code>HHWT</code> <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa/intro.shtml#weights" role="doc-biblioref">Sample Weights</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. We’ll use the <a href="http://gdfe.co/srvyr/reference/index.html">srvyr</a> package for easily defining the survey weights and using them in calculating summary statistics. Here we’ll finally address the motivating question. The median household income in Oakland in 2022 as measured in the IPUMS microdata was as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_median</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">89000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="comparing-microdata-with-aggregate-results" class="level2">
<h2 class="anchored" data-anchor-id="comparing-microdata-with-aggregate-results">Comparing microdata with aggregate results</h2>
<p>Let’s do a quick comparison of our IPUMS results to the aggregate census data we retrieved in the first section. Here are our full IPUMS results for median household income and population:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Median HH Income"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Population"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table)<span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">ipums_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Population</td>
<td style="text-align: right;">430052</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median HH Income</td>
<td style="text-align: right;">89000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here are our results from the aggregate data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">aggregate_estimate =</span> estimate)</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">aggregate_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These are… Clearly different. What gives? Unfortunately, summary statistics calculated using IPUMS data typically cannot match aggregate ACS figures! One major reason for this is <strong>added sampling error</strong>. Recall that the American Community Survey is a sample. A given one-year ACS is typically a 1% sample of the U.S. population, with associated sampling error. When the census makes microdata available, such as the data we have from IPUMS, they create a sample of that sample – we do not get the full 1%. This second sampling process introduces further sampling error that is not reflected in figures sourced from aggregate ACS data, which are calculated using the full ACS sample <span class="citation" data-cites="ruggles_ipums_2024">(<a href="https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS" role="doc-biblioref">See ACS</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. This introduces its own, additional sampling error, that’s not present in the aggregate ACS figures.</p>
<p>Beyond that sampling error, microdata estimates will also be different because the census applies various other additional data processing steps to microdata to ensure privacy and accuracy. For example, in microdata income variables are “top-coded,” meaning that particularly extreme or specific income values are clipped to ensure privacy <span class="citation" data-cites="ruggles_ipums_2024">(<a href="https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS" role="doc-biblioref">See ACS</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p>
<p>So at the end of the day, due to the way that the census processes ACS microdata before releasing it to the public, this is as close as we are going to get.</p>
</section>
<section id="accurate-standard-errors-with-replicate-weights" class="level2">
<h2 class="anchored" data-anchor-id="accurate-standard-errors-with-replicate-weights">Accurate Standard Errors with Replicate Weights</h2>
<p>If we stopped at this point, we would be able to use census microdata to accurately calculate all sorts of interesting quantities. However, there is one more subtlety to the microdata that becomes important specifically when we are calculating the standard errors of those quantities: <strong>replicate weights</strong>.</p>
<p>When we calculate the median household income in Oakland using the household weights, we get the standard error (se) below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">141001.2</td>
<td style="text-align: right;">4142.847</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>That is a “sample standard error” – it’s an estimate of the population standard error, based on this one sample we have.</p>
<p>In theory, the standard error of an estimate measures the variation of a statistic across multiple samples of a given population. Thus the true standard error of any characteristic calculated from a single sample can never be known with certainty; sample standard errors are simply estimated.</p>
<p>Replicate weights allow a single sample to simulate multiple samples, thus generating more informed standard error estimates that mimic the theoretical basis of standard errors while retaining all information about the complex sample design. These standard errors can then be used to obtain more precise confidence intervals and significance tests. https://usa.ipums.org/usa/repwt.shtml#q70</p>
<p>Here we can see what replicate weights (in this case, household replicate weights) look like in our data. Each of <code>REPWT</code>, 1 through 80, is a set of alternative household weights, slightly different from the “production weight,” <code>HHWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(HHINCOME, HHWT, REPWT1, REPWT2, REPWT3, REPWT80)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">129200</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: right;">107000</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: right;">138000</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="even">
<td style="text-align: right;">44800</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: right;">380000</td>
<td style="text-align: right;">311</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="even">
<td style="text-align: right;">189150</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">122</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>If we calculate a statistic of interest with the production weights, then measure the deviations between that production weighted estimate and the weighted estimates we would produce with each replicate weight, we can calculate the following: <span class="math display">\[
SE(X) = \sqrt{\frac{4}{80} \sum_{r=1}^{80} (X_r - X)^2}
\]</span> This is a standard error that leverages the replicate weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWT"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3436.261</code></pre>
</div>
</div>
<p>To be clear, we don’t have to ever do that manually – <code>survey</code> supports specifying survey designs with replicate weights. Here is a more-or-less exact</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  households_w_income,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_hh_income =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">mean_hh_income</th>
<th style="text-align: right;">mean_hh_income_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">141001.2</td>
<td style="text-align: right;">3435.34</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In IPUMS testing of ACS/PRCS data, replicate weights usually increase standard errors. This increase is generally not large enough to alter the significance level of coefficients, though marginally significant coefficients may become clearly nonsignificant. The more obvious effect of using replicate weights is on the width of confidence intervals, which can change substantially.</p>
<p>IPUMS’ documentation reccomends the following specification for the replicate weights, where the standard errors are calculated via the <a href="https://en.wikipedia.org/wiki/Jackknife_resampling">jacknife procedure</a>.</p>
<p>Households:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  households_w_income,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</section>
<section id="analyzing-acs-microdata" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-acs-microdata">Analyzing ACS microdata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>Individuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<p>Here we can see the un-adjusted gender earnings gap in Oakland, where men on earn about $20k more than women on average:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEX) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">SEX</th>
<th style="text-align: right;">mean_income</th>
<th style="text-align: right;">mean_income_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">71669.67</td>
<td style="text-align: right;">2481.816</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">90114.19</td>
<td style="text-align: right;">2742.858</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that we are using <code>oak_indiv_svy</code> and by extension the replicate weights to produce those standard errors. If we instead used <code>individuals_w_income</code>, we would get the same estimates, but likely smaller standard errors. Indeed, lets explicitly look at the equivalent regressions specification (though with log income as the outcome to more accurately model the income distribution), once using only the sample weights, and once using the replicate weights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>model_ols1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> raw, <span class="sc">~</span> clean, <span class="sc">~</span> fmt,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sample weights, no covariates"</span> <span class="ot">=</span> model_ols1,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Replicate weights, no covariates"</span> <span class="ot">=</span> model_ols2</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_jr385vecy7vcg48ezgfk(i, j, css_id) {
          var table = document.getElementById("tinytable_jr385vecy7vcg48ezgfk");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_jr385vecy7vcg48ezgfk');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_jr385vecy7vcg48ezgfk(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_jr385vecy7vcg48ezgfk");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 6, j: 0 },  ], css_id: 'tinytable_css_tlfdb2hvyh1dxktbqayl',}, 
          { positions: [ { i: 4, j: 2 }, { i: 4, j: 1 },  ], css_id: 'tinytable_css_s2bp3kl56jkm9yddf2dm',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_odn5oulf5ntayq56h7mz',}, 
          { positions: [ { i: 6, j: 1 }, { i: 6, j: 2 },  ], css_id: 'tinytable_css_ko0bipq2oc1isjvn6p8u',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 5, j: 0 },  ], css_id: 'tinytable_css_kc84pyqvwdoa4y201vgm',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_a8edboomrj03lnsmr6ij',}, 
          { positions: [ { i: 4, j: 0 },  ], css_id: 'tinytable_css_473tx7cgzsn7pwqsjhjb',}, 
          { positions: [ { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 1, j: 2 }, { i: 5, j: 1 }, { i: 3, j: 2 }, { i: 3, j: 1 }, { i: 5, j: 2 }, { i: 2, j: 2 },  ], css_id: 'tinytable_css_0z92dgcpa2j7cv97hbjt',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_jr385vecy7vcg48ezgfk(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_tlfdb2hvyh1dxktbqayl, .table th.tinytable_css_tlfdb2hvyh1dxktbqayl { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_s2bp3kl56jkm9yddf2dm, .table th.tinytable_css_s2bp3kl56jkm9yddf2dm { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_odn5oulf5ntayq56h7mz, .table th.tinytable_css_odn5oulf5ntayq56h7mz { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_ko0bipq2oc1isjvn6p8u, .table th.tinytable_css_ko0bipq2oc1isjvn6p8u { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_kc84pyqvwdoa4y201vgm, .table th.tinytable_css_kc84pyqvwdoa4y201vgm { text-align: left; }
      .table td.tinytable_css_a8edboomrj03lnsmr6ij, .table th.tinytable_css_a8edboomrj03lnsmr6ij { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_473tx7cgzsn7pwqsjhjb, .table th.tinytable_css_473tx7cgzsn7pwqsjhjb { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_0z92dgcpa2j7cv97hbjt, .table th.tinytable_css_0z92dgcpa2j7cv97hbjt { text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_jr385vecy7vcg48ezgfk" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Sample weights, no covariates</th>
                <th scope="col">Replicate weights, no covariates</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)    </td>
                  <td>37064.571 </td>
                  <td>37064.571 </td>
                </tr>
                <tr>
                  <td>               </td>
                  <td>(1229.397)</td>
                  <td>(1610.829)</td>
                </tr>
                <tr>
                  <td>factor(SEX)Male</td>
                  <td>1.251     </td>
                  <td>1.251     </td>
                </tr>
                <tr>
                  <td>               </td>
                  <td>(0.058)   </td>
                  <td>(0.064)   </td>
                </tr>
                <tr>
                  <td>N              </td>
                  <td>3131      </td>
                  <td>3131      </td>
                </tr>
                <tr>
                  <td>R²             </td>
                  <td>0.007     </td>
                  <td>0.007     </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Note that using replicate weights slightly enlarged our standard errors, as described in the IPUMS documentation.</p>
<p>Lets explore a couple other dynamics related to earnings in Oakland and practice making visualizations and estimating regressions with the data. Here’s the income distribution across different levels of highest education earned. Note here that I’m not using the replicate weights (I’m just using the <code>individuals_w_income</code> object), since I’m not estimating anything. <code>ggplot</code> does take a weight argument, for which I’ve supplied the <code>PERWT</code> sample weights.</p>
<p><a href="https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html" class="uri">https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> INCTOT,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.2</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">9</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">outliers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">8</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>, <span class="at">y =</span> <span class="st">"Income"</span>, <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows that individuals with bachelor’s and graduate degrees generally have higher incomes in Oakland. Let’s seen how bachelor and graduate degree attainment differs across sex. Again, I’m using the <code>individuals_w_income</code> object as I have no need to replicate weights.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level =</span> order),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> PERWT</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (..count..) <span class="sc">/</span> <span class="fu">sum</span>(..count..))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Sex"</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So bachelor and graduate degree holders generally earn more, and women are more likely than men to have bachelor and graduate degrees in Oakland. This should imply that if we adjust for education when estimating the gender-earnings gap in Oakland, thus only comparing men and women in the same education levels, we should see the gap increase.</p>
<p>We again use <code>svyglm</code> to estimate the regression, and <code>oak_indiv_svy</code> as the data/survey design so as to use the replicate weights for our standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    AGE <span class="sc">+</span> <span class="fu">I</span>(AGE <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">relevel</span>(educ_attain, <span class="at">ref =</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  oak_indiv_svy</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, no covariates"</span> <span class="ot">=</span> model_ols2,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, adjusted for age and education"</span> <span class="ot">=</span> model_ols3</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_zp8b8t1vnhnwsdfnp8oq(i, j, css_id) {
          var table = document.getElementById("tinytable_zp8b8t1vnhnwsdfnp8oq");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_zp8b8t1vnhnwsdfnp8oq');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_zp8b8t1vnhnwsdfnp8oq(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_zp8b8t1vnhnwsdfnp8oq");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 20, j: 0 },  ], css_id: 'tinytable_css_yodlykkaqkcedepep1f6',}, 
          { positions: [ { i: 20, j: 2 }, { i: 20, j: 1 },  ], css_id: 'tinytable_css_yfrdq8xgrhb8p14z2c9j',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 10, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 14, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 18, j: 0 }, { i: 19, j: 0 }, { i: 21, j: 0 },  ], css_id: 'tinytable_css_wsauvv4cs1di7r0ax54u',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_r9580mdyr03x4bu0bl7c',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_mgdsnka4bkuemhuujtf6',}, 
          { positions: [ { i: 22, j: 0 },  ], css_id: 'tinytable_css_f7d59vclmo77zt630ty3',}, 
          { positions: [ { i: 1, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 2, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 6, j: 1 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 10, j: 2 }, { i: 21, j: 1 }, { i: 12, j: 2 }, { i: 10, j: 1 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 14, j: 2 }, { i: 11, j: 2 }, { i: 16, j: 2 }, { i: 13, j: 2 }, { i: 18, j: 2 }, { i: 15, j: 2 }, { i: 17, j: 2 }, { i: 19, j: 2 }, { i: 21, j: 2 },  ], css_id: 'tinytable_css_78l5smpgl9wouequddsv',}, 
          { positions: [ { i: 22, j: 1 }, { i: 22, j: 2 },  ], css_id: 'tinytable_css_45dykzysz9uypg6l6jbv',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_zp8b8t1vnhnwsdfnp8oq(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_yodlykkaqkcedepep1f6, .table th.tinytable_css_yodlykkaqkcedepep1f6 { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_yfrdq8xgrhb8p14z2c9j, .table th.tinytable_css_yfrdq8xgrhb8p14z2c9j { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_wsauvv4cs1di7r0ax54u, .table th.tinytable_css_wsauvv4cs1di7r0ax54u { text-align: left; }
      .table td.tinytable_css_r9580mdyr03x4bu0bl7c, .table th.tinytable_css_r9580mdyr03x4bu0bl7c { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_mgdsnka4bkuemhuujtf6, .table th.tinytable_css_mgdsnka4bkuemhuujtf6 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_f7d59vclmo77zt630ty3, .table th.tinytable_css_f7d59vclmo77zt630ty3 { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_78l5smpgl9wouequddsv, .table th.tinytable_css_78l5smpgl9wouequddsv { text-align: center; }
      .table td.tinytable_css_45dykzysz9uypg6l6jbv, .table th.tinytable_css_45dykzysz9uypg6l6jbv { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_zp8b8t1vnhnwsdfnp8oq" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Earnings gap, no covariates</th>
                <th scope="col">Earnings gap, adjusted for age and education</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                                                       </td>
                  <td>37064.571 </td>
                  <td>3805.220 </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(1610.829)</td>
                  <td>(726.915)</td>
                </tr>
                <tr>
                  <td>factor(SEX)Male                                                   </td>
                  <td>1.251     </td>
                  <td>1.378    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>(0.064)   </td>
                  <td>(0.067)  </td>
                </tr>
                <tr>
                  <td>AGE                                                               </td>
                  <td>          </td>
                  <td>1.074    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.009)  </td>
                </tr>
                <tr>
                  <td>I(AGE^2)                                                          </td>
                  <td>          </td>
                  <td>0.999    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.000)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Associate's degree</td>
                  <td>          </td>
                  <td>1.466    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.176)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Bachelor's degree </td>
                  <td>          </td>
                  <td>2.880    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.198)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Graduate degree   </td>
                  <td>          </td>
                  <td>4.377    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.291)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")No schooling      </td>
                  <td>          </td>
                  <td>0.743    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.087)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some college      </td>
                  <td>          </td>
                  <td>1.171    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.132)  </td>
                </tr>
                <tr>
                  <td>relevel(educ_attain, ref = "Highschool diploma")Some school       </td>
                  <td>          </td>
                  <td>0.774    </td>
                </tr>
                <tr>
                  <td>                                                                  </td>
                  <td>          </td>
                  <td>(0.074)  </td>
                </tr>
                <tr>
                  <td>N                                                                 </td>
                  <td>3131      </td>
                  <td>3131     </td>
                </tr>
                <tr>
                  <td>R²                                                                </td>
                  <td>0.007     </td>
                  <td>0.308    </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Fun!</p>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-greg_freedman_ellis_ipumsr_2024" class="csl-entry" role="listitem">
Greg Freedman Ellis, Derek Burk, and Finn Roberts. 2024. <span>“Ipumsr: <span>An</span> <span>R</span> <span>Interface</span> for <span>Downloading</span>, <span>Reading</span>, and <span>Handling</span> <span>IPUMS</span> <span>Data</span>.”</span> <a href="https://tech.popdata.org/ipumsr/">https://tech.popdata.org/ipumsr/</a>.
</div>
<div id="ref-mihalik_missouri_2022" class="csl-entry" role="listitem">
Mihalik, Cory, Glenn Rice, and Matt Hesser. 2022. <span>“The <span>Missouri</span> <span>Census</span> <span>Data</span> <span>Center</span> (<span>MCDC</span>) 2022 <span>Geographic</span> <span>Correspondence</span> <span>Engine</span> (<span>GEOCORR</span>).”</span> <a href="https://mcdc.missouri.edu/applications/geocorr.html">https://mcdc.missouri.edu/applications/geocorr.html</a>.
</div>
<div id="ref-pastoor_how_2024" class="csl-entry" role="listitem">
Pastoor, Isabel. 2024. <span>“How Can <span>I</span> Pull Data at the Zip Code or City Level?”</span> <em>IPUMS Forum</em>. <a href="https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2">https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2</a>.
</div>
<div id="ref-ruggles_ipums_2024" class="csl-entry" role="listitem">
Ruggles, Steven, Sarah Flood, Matthew Sobek, Daniel Backman, Annie Chen, Grace Cooper, Stephanie Richards, Renae Rogers, and Megan Schouweiler. 2024. <span>“<span>IPUMS</span> <span>USA</span>: <span>Version</span> 15.0.”</span> Minneapolis, MN: IPUMS. <a href="https://doi.org/10.18128/D010.V15.0">https://doi.org/10.18128/D010.V15.0</a>.
</div>
<div id="ref-walker_analyzing_2023" class="csl-entry" role="listitem">
Walker, Kyle. 2023. <em>Analyzing <span>US</span> <span>Census</span> <span>Data</span></em>. 1st edition. Boca Raton: Chapman; Hall/CRC.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I want to note that several of the points I cover here are things I learned from some coworkers– <a href="https://www.bwilden.com/">Bert Wilden</a> and Stephanie Peng.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See the <a href="https://api.census.gov/data/2022/acs/acs1/variables.html">full variable list for the 2022 1-year ACS</a> for the full universe of variables.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies">census hierarchies</a> in <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span> for explanation of distinct geographical units in Census products.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I should pause to note that the combination of IPUMS and Geocorr is an unbelievable public good, and it’s extremely generous of the public Universities of Minnesota and Missouri to publish these.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Were the AFACT higher, e.g.&nbsp;1%, I would randomly sample 1% of the individuals from that PUMA and include them in my Oakland sample.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{amerkhanian2024,
  author = {Amerkhanian, Peter},
  title = {Working with {IPUMS} Microdata},
  date = {2024-09-01},
  url = {https://peter-amerkhanian.com/posts/ipums-wth-r/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-amerkhanian2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Amerkhanian, Peter. 2024. <span>“Working with IPUMS Microdata.”</span>
September 1, 2024. <a href="https://peter-amerkhanian.com/posts/ipums-wth-r/">https://peter-amerkhanian.com/posts/ipums-wth-r/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/peter-amerkhanian\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Working with IPUMS microdata"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../blog.bib"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Peter Amerkhanian"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-9-1"</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> thumbnail.png</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ['R', 'Data Management']</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  dplyr,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  ggplot2,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Statistics</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  modelsummary,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  srvyr,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  survey,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Webscraping</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  httr,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  rvest,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  readr,</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  glue,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Census</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  tidycensus,</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  ipumsr</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>In this post, I'm going to write up how to use American Community Survey</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>(ACS) microdata, leveraging the University of Minnesota's Integrated</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>Public Use Microdata Series (IPUMS).<span class="ot">[^1]</span> I'll cover:</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>I want to note that several of the points I cover here are things</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    I learned from some coworkers-- [Bert</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    Wilden](https://www.bwilden.com/) and Stephanie Peng.</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Data Retrieval and Processing: how to choose which ACS product is</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    relevant, how to submit a request to IPUMS, and how to filter down</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    to relevant levels of geography/granularity.</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Analysis: how to properly weight ACS data using sample and</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    replication weights for accurate data visualizations and statistical</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>    models.</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>I'll start with a question: **What was the median household income in</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>Oakland, California in 2022?**</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregate data with `tidycensus`</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>Answering that question is pretty straightforward using *aggregate* data</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>from the U.S. Census, which provides various descriptive statistics</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>describing aggregate geographies. If I needed to get the number quickly</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>and wasn't using it for analysis, I might use a web-based tool like</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Census Reporter</span><span class="co">](https://censusreporter.org/)</span> to quickly look it up.</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>However, for an analysis, I would like the data retrieval to be</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>replicable and carried out transparently via an API.</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>In R, the <span class="in">`tidycensus`</span> package provides an easy-to-use wrapper for</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>requesting data from the Census API. Note that I set up an API key for</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>the U.S. Census and am storing it in my <span class="in">`.Renviron`</span> file.</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>I can query <span class="in">`B19013_001`</span>, the median household income variable, using</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>the 2022 1-year American Community Survey sample<span class="ot">[^2]</span> and filter down to</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>Oakland's GEOID, <span class="in">`0653000`</span>, which is a combination of the state code for</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>California, <span class="in">`06`</span>, and the place code for Oakland, <span class="in">`53000`</span>. I'll throw in</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>the total population variable for good measure:</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>See the [full variable list for the 2022 1-year</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>    ACS](https://api.census.gov/data/2022/acs/acs1/variables.html) for</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    the full universe of variables.</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate))</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>Done! This is an example of retrieving aggregate census data -- in this</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>case a statistic describing the population of Oakland. Aggregate census</span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>data is very useful, and <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span> offers a comprehensive</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>treatment of use cases of aggregate census data.</span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a><span class="fu">### Limitations</span></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>What if instead of the median, I wanted a different quantile of</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>household income? What if I wanted to run a regression and find the</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>association between sex and individual income while adjusting for</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>education? These statistics are not obviously available as aggregate</span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>measures in the Census API. Indeed, if I want them, I need to calculate</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>them myself using either *individual or household level* census data,</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>as-in, data where each row is an individual person or an individual</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>household (depending on your population of interest). This is a common</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>need and entails accessing census *microdata*, a complicated process</span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>that I'll cover now.</span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## IPUMS microdata overview</span></span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>One of the most popular sources for downloading census microdata is the</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a>University of Minnesota's Integrated Public Use Microdata Series</span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>(IPUMS). The IPUMS team provides a centralized API for downloading</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>census microdata, comprehensive documentation for working with census</span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>microdata, and harmonized variables across time [@walker_analyzing_2023,</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>chapter 9]. The easiest way to access IPUMS data in R is with the</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a><span class="in">`ipumsr`</span> package, which the IPUMS team manages. Here I'll set an API key</span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>in my <span class="in">`.Renviron`</span> file to use for submitting requests via <span class="in">`ipumsr`</span> .</span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">`ipumsr` website</span><span class="co">](https://tech.popdata.org/ipumsr/)</span> provides</span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a>details on what degree of support the package has for various IPUMS</span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a>products, though it's also possible to check for support using the</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a><span class="in">`ipums_data_collections()`</span> function. I prefer the function so that I can</span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a>see exactly what code I'll need to plug into the API (see</span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a><span class="in">`code_for_api`</span>). The following are the survey products that currently</span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>have API support:</span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a>For any analysis of populations in the U.S., the IPUMS USA (annual survey products) and IPUMS CPS (a [monthly</span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a>survey](https://www.census.gov/programs-surveys/acs) product) collections are of</span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a>particular interest. I'll look at IPUMS USA since my motivating question</span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a>involves median household income for a year -- 2022.</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a>The IPUMS USA project collects, preserves and harmonizes U.S. census</span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a>microdata and provides easy access to this data with enhanced</span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a>documentation. Data includes decennial censuses from 1790 to 2010 and</span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a>American Community Surveys (ACS) from 2000 to the present</span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span>. We can check out the newest products they have in</span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a>the USA collection as follows:</span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a>Some things to note about these collections:</span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ACS vs. PRCS**: The ACS (American Community Survey) collects</span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a>    detailed population and housing information for the 50 U.S. states</span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a>    and The District of Columbia, whereas the PRCS (Puerto Rico</span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a>    Community Survey) functions as an ACS equivalent specifically</span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a>    tailored to collect data in Puerto Rico.</span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**One-Year vs. Five-Year Estimates**:</span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>One-Year Estimates (e.g. "2022 ACS") are based on data collected</span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a>        over a single year; they provide timely information for areas</span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a>        with populations of 65,000 or more (this excludes some small</span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a>        geographies)<span class="ot">[^3]</span> but may have higher margins of error for</span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a>        smaller areas.</span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Five-Year Estimates represent a moving average of data collected</span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a>        over a 5-year period and covers geographies down to the Census</span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a>        block group. The 5-year window creates a larger sample size and</span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a>        offers more reliable and detailed information for all population</span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a>        sizes, including small areas, but is less timely than one-year</span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a>        estimates <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span>.</span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span>See <span class="co">[</span><span class="ot">census hierarchies</span><span class="co">](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies)</span> in <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span> for explanation of distinct geographical units in Census products.</span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-211"><a href="#cb36-211" aria-hidden="true" tabindex="-1"></a><span class="fu">## Retrieving data from IPUMS USA</span></span>
<span id="cb36-212"><a href="#cb36-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question for this post: **What was the</span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a>median household income in Oakland, California in 2022?**</span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-216"><a href="#cb36-216" aria-hidden="true" tabindex="-1"></a>We'll need to get income data from the 2022 1-year ACS, and we will need</span>
<span id="cb36-217"><a href="#cb36-217" aria-hidden="true" tabindex="-1"></a>to filter our data down to just the city of Oakland. For the first task,</span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a>I'll define a general function, <span class="in">`retrieve_sample()`</span> that retrieves a</span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a>list of variables from a given ACS sample.</span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables){</span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="st">"Incomes by PUMA"</span>,</span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> variables</span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb36-232"><a href="#cb36-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-233"><a href="#cb36-233" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>I'll also define a list of variables that I want, including <span class="in">`HHINCOME`</span></span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>(household income) and <span class="in">`INCTOT`</span> (individual income). Some of these</span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a>variables refer to census-specific language – i.e. <span class="in">`PUMA`</span> , <span class="in">`REPWT`</span> ,</span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a><span class="in">`REPWTP`</span>. I'll cover exactly what each of these represent later in the</span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a>post.</span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a>Note the variable, <span class="in">`var_spec("STATEFIP", case_selections = "06")`</span>. This</span>
<span id="cb36-265"><a href="#cb36-265" aria-hidden="true" tabindex="-1"></a>selects the variable <span class="in">`STATEFIP`</span>, while also specifying that we want to</span>
<span id="cb36-266"><a href="#cb36-266" aria-hidden="true" tabindex="-1"></a>restrict our request to data where <span class="in">`STATEFIP=='06'`</span> (California).</span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a>Generally,</span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`var_spec()`</span><span class="co">](https://tech.popdata.org/ipumsr/reference/var_spec.html)</span></span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a>is used to provide specifications for individual variables when defining</span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a>an IPUMS microdata extract request <span class="co">[</span><span class="ot">@greg_freedman_ellis_ipumsr_2024</span><span class="co">]</span>.</span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a>Now we can request these variables from the 2022 1-year ACS via the</span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a>following function call:</span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a><span class="in">`retrieve_sample("us2022a", variables)`</span></span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a>However, I'll first write code that checks if I've already downloaded</span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a>the data before running the query to avoid running it unnecessarily (the</span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a>query can take some time).</span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a>local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb36-287"><a href="#cb36-287" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb36-288"><a href="#cb36-288" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(local_ipums_extracts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a>  existing_path <span class="ot">&lt;-</span> local_ipums_extracts[<span class="dv">1</span>]</span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(existing_path)</span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(<span class="st">"us2022a"</span>, variables)</span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a>Here's the resulting data, the 2022 1-year ACS for California.</span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using Geocorr to Identify Geographies</span></span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a>We now have microdata for all of California, but how do we filter down</span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a>to just Oakland? Unfortunately, this isn't as simple as just running</span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a><span class="in">`filter(CITY == 'Oakland')`</span> -- ACS microdata does not include a field</span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a>for explicitly identifying cities (note that a city is typically</span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a>referred to as a "place" in census data). Indeed, the smallest</span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a>geographic area explicitly identified in the microdata is something</span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a>called a public use microdata area (PUMA), a geographic area defined</span>
<span id="cb36-314"><a href="#cb36-314" aria-hidden="true" tabindex="-1"></a>based on population <span class="co">[</span><span class="ot">@pastoor_how_2024</span><span class="co">]</span>. PUMAS are unique geographies –</span>
<span id="cb36-315"><a href="#cb36-315" aria-hidden="true" tabindex="-1"></a>they always correspond to states, but only sometimes correspond to other</span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a>small geographic areas, such as city, metro area, and county [See</span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a>[Census</span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a>Hierarchies](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies)</span>
<span id="cb36-319"><a href="#cb36-319" aria-hidden="true" tabindex="-1"></a>in @walker_analyzing_2023, chapter 1].</span>
<span id="cb36-320"><a href="#cb36-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a>To find out if a city corresponds to a collection of PUMAs and which</span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a>PUMAs those are, we'll use a tool called Geocorr (geographic</span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a>correspondence engine), an application that generates files and/or</span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>reports — called correlation lists — showing relationships between two</span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a>or more geographic coverages in the United States</span>
<span id="cb36-326"><a href="#cb36-326" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@mihalik_missouri_2022</span><span class="co">]</span>. Geocorr is a sponsored program of the Missouri</span>
<span id="cb36-327"><a href="#cb36-327" aria-hidden="true" tabindex="-1"></a>State library and published by the University of Missouri Center for</span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a>Health Policy.<span class="ot">[^4]</span></span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>I should pause to note that the combination of IPUMS and Geocorr</span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a>    is an unbelievable public good, and it's extremely generous of the</span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a>    public Universities of Minnesota and Missouri to publish these.</span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a>![Geocorr 2022: Geographic Correspondence</span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a>Engine](geocorr.png){width="80%"}</span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a>For example, suppose you have county-level data for California and would</span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a>like to convert that data to the ZIP code level. Geocorr can show how</span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a>each county relates to the ZIP code(s) that intersect it. It can tell</span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a>you, for each of those ZIP/county intersections, what the size of that</span>
<span id="cb36-341"><a href="#cb36-341" aria-hidden="true" tabindex="-1"></a>intersection is and what portion of the ZIP's total population is in</span>
<span id="cb36-342"><a href="#cb36-342" aria-hidden="true" tabindex="-1"></a>that intersection <span class="co">[</span><span class="ot">@mihalik_missouri_2022</span><span class="co">]</span>.</span>
<span id="cb36-343"><a href="#cb36-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-344"><a href="#cb36-344" aria-hidden="true" tabindex="-1"></a>Here I'll define a function, <span class="in">`geocorr_2022()`</span> that queries Geocorr 2022</span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a>and retrieves a .csv file establishing the relationships between two</span>
<span id="cb36-346"><a href="#cb36-346" aria-hidden="true" tabindex="-1"></a>sets of geographies in a given state.</span>
<span id="cb36-347"><a href="#cb36-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-350"><a href="#cb36-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb36-353"><a href="#cb36-353" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb36-354"><a href="#cb36-354" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb36-357"><a href="#cb36-357" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb36-358"><a href="#cb36-358" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span></span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-368"><a href="#cb36-368" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-369"><a href="#cb36-369" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a>We'll use that function to establish the relationships between</span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a>California's 2022 PUMAs and its "places," using individual population as</span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a>measured in the 2020 Decenial Census to weight the relationships.</span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-382"><a href="#cb36-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-383"><a href="#cb36-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a>With that, we can whether Oakland can be represented as a collection of</span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a>PUMAs, and, if so, which PUMAs make up the city.</span>
<span id="cb36-389"><a href="#cb36-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-392"><a href="#cb36-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-393"><a href="#cb36-393" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place)) <span class="sc">%&gt;%</span></span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a>The <span class="in">`AFACT`</span> (allocation factor) column shows the proportion of the source</span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a>area contained in the target area -- this case the proportion of the</span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a>PUMA population that belongs to Oakland. In this case, 100% of the</span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a>populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of</span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a>PUMA 114. To be clear, GEOCORR believes that 9 individuals from 114 do</span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a>live in Oakland, but based on the AFACT I'll feel comfortable dropping</span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a>that PUMA.<span class="ot">[^5]</span></span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>Were the AFACT higher, e.g. 1%, I would randomly sample 1% of the</span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a>    individuals from that PUMA and include them in my Oakland sample.</span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-409"><a href="#cb36-409" aria-hidden="true" tabindex="-1"></a>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the</span>
<span id="cb36-410"><a href="#cb36-410" aria-hidden="true" tabindex="-1"></a>City of Oakland.</span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb36-416"><a href="#cb36-416" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb36-417"><a href="#cb36-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb36-418"><a href="#cb36-418" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb36-419"><a href="#cb36-419" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a>But what do these data actually represent?</span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a><span class="fu">## Granularity in ACS microdata</span></span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a>Each row in the ACS microdata is an individual, identified by a unique</span>
<span id="cb36-427"><a href="#cb36-427" aria-hidden="true" tabindex="-1"></a>combination of <span class="in">`SERIAL`</span>, the unique identifier for their household, and</span>
<span id="cb36-428"><a href="#cb36-428" aria-hidden="true" tabindex="-1"></a><span class="in">`PERNUM`</span>, their unique identifier within their household. Thus, we can</span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a>identify units as follows:</span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Households: The combination of <span class="in">`SAMPLE`</span> and <span class="in">`SERIAL`</span> provides a</span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a>    unique identifier for every household in the IPUMS\</span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Individuals: The combination of <span class="in">`SAMPLE`</span>, <span class="in">`SERIAL`</span>, and <span class="in">`PERNUM`</span></span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a>    provides a unique identifier for every person in the IPUMS</span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a>Where <span class="in">`SAMPLE`</span> defines when the individual was surveyed (in the 1-year</span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a>ACS it's the same for all rows) [See</span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">SERIAL</span><span class="co">](https://usa.ipums.org/usa-action/variables/SERIAL)</span> in</span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024].</span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a>We can group by these variable combinations and see how many individuals</span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a>and households were surveyed across PUMAs in Oakland for the 2022 1-year</span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a>ACS:</span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-granularity</span></span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Oakland Dataset Granularity by PUMA"</span></span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)</span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a>Let's randomly select a household in the data and see what such a unit</span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a>looks like in practice.</span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-468"><a href="#cb36-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb36-469"><a href="#cb36-469" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-477"><a href="#cb36-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-hh</span></span>
<span id="cb36-478"><a href="#cb36-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example household"</span></span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, PERNUM, AGE, SEX, HHINCOME, INCTOT))</span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a>So here we can see that this household, with <span class="in">`SERIAL`</span></span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a><span class="in">`{r} format(sample_household, scientific=FALSE)`</span> has <span class="in">`{r} n`</span> members,</span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>each with a unique <span class="in">`PERNUM`</span>.</span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question – **what was the median</span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a>household income in Oakland, California in 2022?** Here we have a</span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a>household in Oakland and we can see their individual and household</span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a>incomes:</span>
<span id="cb36-492"><a href="#cb36-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-493"><a href="#cb36-493" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`INCTOT`</span> reports each respondent's total pre-tax personal income or</span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a>    losses from all sources for the previous year. <span class="in">`9999999`</span> is code to</span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a>    denote that the value is missing, which makes sense given that the</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a>    missing values above correspond to children in the household [See</span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">INCTOT</span><span class="co">](https://usa.ipums.org/usa-action/variables/INCTOT)</span> in</span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024].</span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`HHINCOME`</span> reports the total money income of all household members</span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>    age 15+ during the previous year. The amount should equal the sum of</span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>    all household members' individual incomes, as recorded in the</span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>    person-record variable INCTOT [See</span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">HHINCOME</span><span class="co">](https://usa.ipums.org/usa-action/variables/HHINCOME)</span> in</span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024]</span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a>Given what we know about the unique identifier for households, and the</span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a><span class="in">`HHINCOME`</span> variable, we can construct the appropriate dataset for</span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a>answering our motivating question:</span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a>oak_households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> oak_households <span class="sc">%&gt;%</span> </span>
<span id="cb36-518"><a href="#cb36-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb36-519"><a href="#cb36-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a>It seems we can proceed to simply calculate the median of the <span class="in">`HHINCOME`</span></span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a>column? Not so fast... Data in the ACS microdata are not what they seem.</span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a>Before we do any analysis, we have to account for **sample weights**.</span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-525"><a href="#cb36-525" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applying sample weights in the ACS</span></span>
<span id="cb36-526"><a href="#cb36-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a>Let's return to our sample family from above, but also examine the</span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a>variables <span class="in">`PERWT`</span> and <span class="in">`HHWT`</span>.</span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-536"><a href="#cb36-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-537"><a href="#cb36-537" aria-hidden="true" tabindex="-1"></a>These are the two primary sample weights in ACS microdata, and they can</span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a>be interpreted fairly directly. <span class="in">`PERWT`</span> gives the population represented</span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a>by each individual in the sample, thus in the first row of the sample</span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a>household, the 31 year old woman with an individual income of \$9,300</span>
<span id="cb36-541"><a href="#cb36-541" aria-hidden="true" tabindex="-1"></a>represents 62 individuals in the PUMA. <span class="in">`HHWT`</span> gives the number</span>
<span id="cb36-542"><a href="#cb36-542" aria-hidden="true" tabindex="-1"></a>of households in the general population represented by each household in</span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a>the sample, thus this household is representative of 62 households in</span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a>that PUMA.</span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-546"><a href="#cb36-546" aria-hidden="true" tabindex="-1"></a>Any person-level analysis of ACS microdata should be weighted by</span>
<span id="cb36-547"><a href="#cb36-547" aria-hidden="true" tabindex="-1"></a><span class="in">`PERWT`</span>, and household-level analysis should be weighted by <span class="in">`HHWT`</span> [See</span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Sample Weights</span><span class="co">](https://usa.ipums.org/usa/intro.shtml#weights)</span> in</span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024]. We'll use the</span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">srvyr</span><span class="co">](http://gdfe.co/srvyr/reference/index.html)</span> package for easily</span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a>defining the survey weights and using them in calculating summary</span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a>statistics. Here we'll finally address the motivating question. The</span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a>median household income in Oakland in 2022 as measured in the IPUMS</span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a>microdata was as follows:</span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-564"><a href="#cb36-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-565"><a href="#cb36-565" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing microdata with aggregate results  </span></span>
<span id="cb36-566"><a href="#cb36-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a>Let's do a quick comparison of our IPUMS results to the aggregate census</span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a>data we retrieved in the first section. Here are our full IPUMS results</span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a>for median household income and population:</span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-576"><a href="#cb36-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb36-577"><a href="#cb36-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Median HH Income"</span>,</span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Population"</span>,</span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb36-587"><a href="#cb36-587" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb36-588"><a href="#cb36-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-589"><a href="#cb36-589" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table)<span class="sc">%&gt;%</span> </span>
<span id="cb36-590"><a href="#cb36-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate))</span>
<span id="cb36-591"><a href="#cb36-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-592"><a href="#cb36-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-593"><a href="#cb36-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-594"><a href="#cb36-594" aria-hidden="true" tabindex="-1"></a>Here are our results from the aggregate data:</span>
<span id="cb36-595"><a href="#cb36-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-598"><a href="#cb36-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-599"><a href="#cb36-599" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb36-600"><a href="#cb36-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb36-601"><a href="#cb36-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">aggregate_estimate =</span> estimate)</span>
<span id="cb36-602"><a href="#cb36-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-603"><a href="#cb36-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-604"><a href="#cb36-604" aria-hidden="true" tabindex="-1"></a>These are... Clearly different. What gives? Unfortunately, summary statistics calculated using IPUMS data typically cannot match aggregate ACS figures! One major reason for this is **added sampling error**. Recall that the American Community Survey is a sample. A given one-year ACS is typically a 1% sample of the U.S. population, with associated sampling error. When the census makes microdata available, such as the data we have from IPUMS, they create a sample of that sample -- we do not get the full 1%. This second sampling process introduces further sampling error that is not reflected in figures sourced from aggregate ACS data, which are calculated using the full ACS sample [<span class="co">[</span><span class="ot">See ACS</span><span class="co">](https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS)</span> in @ruggles_ipums_2024]. This introduces its own, additional sampling error, that's not present in the aggregate ACS figures.</span>
<span id="cb36-605"><a href="#cb36-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-606"><a href="#cb36-606" aria-hidden="true" tabindex="-1"></a>Beyond that sampling error, microdata estimates will also be different because the census applies various other additional data processing steps to microdata to ensure privacy and accuracy. For example, in microdata income variables are "top-coded," meaning that particularly extreme or specific income values are clipped to ensure privacy [<span class="co">[</span><span class="ot">See ACS</span><span class="co">](https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS)</span> in @ruggles_ipums_2024].</span>
<span id="cb36-607"><a href="#cb36-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-608"><a href="#cb36-608" aria-hidden="true" tabindex="-1"></a>So at the end of the day, due to the way that the census processes ACS</span>
<span id="cb36-609"><a href="#cb36-609" aria-hidden="true" tabindex="-1"></a>microdata before releasing it to the public, this is as close as we are</span>
<span id="cb36-610"><a href="#cb36-610" aria-hidden="true" tabindex="-1"></a>going to get.</span>
<span id="cb36-611"><a href="#cb36-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-612"><a href="#cb36-612" aria-hidden="true" tabindex="-1"></a><span class="fu">## Accurate Standard Errors with Replicate Weights</span></span>
<span id="cb36-613"><a href="#cb36-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-614"><a href="#cb36-614" aria-hidden="true" tabindex="-1"></a>If we stopped at this point, we would be able to use census microdata to accurately calculate all sorts of interesting quantities. However, there is one more subtlety to the microdata that becomes important specifically when we are calculating the standard errors of those quantities: **replicate weights**.</span>
<span id="cb36-615"><a href="#cb36-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-616"><a href="#cb36-616" aria-hidden="true" tabindex="-1"></a>When we calculate the median household income in Oakland using the household weights, we get the standard error (se) below:</span>
<span id="cb36-617"><a href="#cb36-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-620"><a href="#cb36-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-621"><a href="#cb36-621" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-622"><a href="#cb36-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb36-623"><a href="#cb36-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb36-624"><a href="#cb36-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-625"><a href="#cb36-625" aria-hidden="true" tabindex="-1"></a>That is a "sample standard error" -- it's an estimate of the population standard error, based on this one sample we have.</span>
<span id="cb36-626"><a href="#cb36-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-627"><a href="#cb36-627" aria-hidden="true" tabindex="-1"></a>In theory, the standard error of an estimate measures the variation of a</span>
<span id="cb36-628"><a href="#cb36-628" aria-hidden="true" tabindex="-1"></a>statistic across multiple samples of a given population. Thus the true</span>
<span id="cb36-629"><a href="#cb36-629" aria-hidden="true" tabindex="-1"></a>standard error of any characteristic calculated from a single sample can</span>
<span id="cb36-630"><a href="#cb36-630" aria-hidden="true" tabindex="-1"></a>never be known with certainty; sample standard errors are simply</span>
<span id="cb36-631"><a href="#cb36-631" aria-hidden="true" tabindex="-1"></a>estimated.</span>
<span id="cb36-632"><a href="#cb36-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-633"><a href="#cb36-633" aria-hidden="true" tabindex="-1"></a>Replicate weights allow a single sample to simulate multiple</span>
<span id="cb36-634"><a href="#cb36-634" aria-hidden="true" tabindex="-1"></a>samples, thus generating more informed standard error estimates that</span>
<span id="cb36-635"><a href="#cb36-635" aria-hidden="true" tabindex="-1"></a>mimic the theoretical basis of standard errors while retaining all</span>
<span id="cb36-636"><a href="#cb36-636" aria-hidden="true" tabindex="-1"></a>information about the complex sample design. These standard errors can</span>
<span id="cb36-637"><a href="#cb36-637" aria-hidden="true" tabindex="-1"></a>then be used to obtain more precise confidence intervals and</span>
<span id="cb36-638"><a href="#cb36-638" aria-hidden="true" tabindex="-1"></a>significance tests.</span>
<span id="cb36-639"><a href="#cb36-639" aria-hidden="true" tabindex="-1"></a>https://usa.ipums.org/usa/repwt.shtml#q70</span>
<span id="cb36-640"><a href="#cb36-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-641"><a href="#cb36-641" aria-hidden="true" tabindex="-1"></a>Here we can see what replicate weights (in this case, household replicate weights) look like in our data. Each of <span class="in">`REPWT`</span>, 1 through 80, is a set of alternative household weights, slightly different from the "production weight," <span class="in">`HHWT`</span>.</span>
<span id="cb36-642"><a href="#cb36-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-645"><a href="#cb36-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-646"><a href="#cb36-646" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-647"><a href="#cb36-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(HHINCOME, HHWT, REPWT1, REPWT2, REPWT3, REPWT80)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-648"><a href="#cb36-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb36-649"><a href="#cb36-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-650"><a href="#cb36-650" aria-hidden="true" tabindex="-1"></a>If we calculate a statistic of interest with the production weights, then measure the deviations between that production weighted estimate and the weighted estimates we would produce with each replicate weight, we can calculate the following:</span>
<span id="cb36-651"><a href="#cb36-651" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb36-652"><a href="#cb36-652" aria-hidden="true" tabindex="-1"></a>SE(X) = \sqrt{\frac{4}{80} \sum_{r=1}^{80} (X_r - X)^2}</span>
<span id="cb36-653"><a href="#cb36-653" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb36-654"><a href="#cb36-654" aria-hidden="true" tabindex="-1"></a>This is a standard error that leverages the replicate weights</span>
<span id="cb36-655"><a href="#cb36-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-658"><a href="#cb36-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-659"><a href="#cb36-659" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb36-660"><a href="#cb36-660" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb36-661"><a href="#cb36-661" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb36-662"><a href="#cb36-662" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-663"><a href="#cb36-663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWT"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb36-664"><a href="#cb36-664" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-665"><a href="#cb36-665" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb36-666"><a href="#cb36-666" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-667"><a href="#cb36-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb36-668"><a href="#cb36-668" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-669"><a href="#cb36-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb36-670"><a href="#cb36-670" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-671"><a href="#cb36-671" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb36-672"><a href="#cb36-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb36-673"><a href="#cb36-673" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span>
<span id="cb36-674"><a href="#cb36-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-675"><a href="#cb36-675" aria-hidden="true" tabindex="-1"></a>To be clear, we don't have to ever do that manually -- <span class="in">`survey`</span> supports specifying survey designs with replicate weights. Here is a more-or-less exact </span>
<span id="cb36-676"><a href="#cb36-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-679"><a href="#cb36-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-680"><a href="#cb36-680" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb36-681"><a href="#cb36-681" aria-hidden="true" tabindex="-1"></a>  households_w_income,</span>
<span id="cb36-682"><a href="#cb36-682" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb36-683"><a href="#cb36-683" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb36-684"><a href="#cb36-684" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span>)</span>
<span id="cb36-685"><a href="#cb36-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-686"><a href="#cb36-686" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_hh_income =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb36-687"><a href="#cb36-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-688"><a href="#cb36-688" aria-hidden="true" tabindex="-1"></a>In IPUMS testing of ACS/PRCS data, replicate weights usually increase</span>
<span id="cb36-689"><a href="#cb36-689" aria-hidden="true" tabindex="-1"></a>standard errors. This increase is generally not large enough to alter</span>
<span id="cb36-690"><a href="#cb36-690" aria-hidden="true" tabindex="-1"></a>the significance level of coefficients, though marginally significant</span>
<span id="cb36-691"><a href="#cb36-691" aria-hidden="true" tabindex="-1"></a>coefficients may become clearly nonsignificant. The more obvious effect</span>
<span id="cb36-692"><a href="#cb36-692" aria-hidden="true" tabindex="-1"></a>of using replicate weights is on the width of confidence intervals,</span>
<span id="cb36-693"><a href="#cb36-693" aria-hidden="true" tabindex="-1"></a>which can change substantially.</span>
<span id="cb36-694"><a href="#cb36-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-695"><a href="#cb36-695" aria-hidden="true" tabindex="-1"></a>IPUMS' documentation reccomends the following specification for the replicate weights, where the standard errors are calculated via the <span class="co">[</span><span class="ot">jacknife procedure</span><span class="co">](https://en.wikipedia.org/wiki/Jackknife_resampling)</span>.</span>
<span id="cb36-696"><a href="#cb36-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-697"><a href="#cb36-697" aria-hidden="true" tabindex="-1"></a>Households:</span>
<span id="cb36-698"><a href="#cb36-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-701"><a href="#cb36-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-702"><a href="#cb36-702" aria-hidden="true" tabindex="-1"></a>oak_hh_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb36-703"><a href="#cb36-703" aria-hidden="true" tabindex="-1"></a>  households_w_income,</span>
<span id="cb36-704"><a href="#cb36-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb36-705"><a href="#cb36-705" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb36-706"><a href="#cb36-706" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb36-707"><a href="#cb36-707" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb36-708"><a href="#cb36-708" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb36-709"><a href="#cb36-709" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-710"><a href="#cb36-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-711"><a href="#cb36-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-712"><a href="#cb36-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-713"><a href="#cb36-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-714"><a href="#cb36-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-715"><a href="#cb36-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-716"><a href="#cb36-716" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyzing ACS microdata</span></span>
<span id="cb36-717"><a href="#cb36-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-720"><a href="#cb36-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-721"><a href="#cb36-721" aria-hidden="true" tabindex="-1"></a>individuals_w_income <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb36-722"><a href="#cb36-722" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find adult earners</span></span>
<span id="cb36-723"><a href="#cb36-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCTOT <span class="sc">!=</span> <span class="dv">9999999</span>, INCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, AGE <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-724"><a href="#cb36-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-725"><a href="#cb36-725" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label sex</span></span>
<span id="cb36-726"><a href="#cb36-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">case_when</span>(SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'Male'</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Female'</span>),</span>
<span id="cb36-727"><a href="#cb36-727" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label education</span></span>
<span id="cb36-728"><a href="#cb36-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ_attain =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-729"><a href="#cb36-729" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb36-730"><a href="#cb36-730" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb36-731"><a href="#cb36-731" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">65</span>, <span class="dv">64</span>) <span class="sc">~</span> <span class="st">"Highschool diploma"</span>,</span>
<span id="cb36-732"><a href="#cb36-732" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">71</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb36-733"><a href="#cb36-733" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Associate's degree"</span>,</span>
<span id="cb36-734"><a href="#cb36-734" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No schooling"</span>,</span>
<span id="cb36-735"><a href="#cb36-735" aria-hidden="true" tabindex="-1"></a>      EDUCD <span class="sc">==</span> <span class="dv">61</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb36-736"><a href="#cb36-736" aria-hidden="true" tabindex="-1"></a>      EDUC <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Some school"</span>,</span>
<span id="cb36-737"><a href="#cb36-737" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb36-738"><a href="#cb36-738" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-739"><a href="#cb36-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-740"><a href="#cb36-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-741"><a href="#cb36-741" aria-hidden="true" tabindex="-1"></a>Individuals:</span>
<span id="cb36-742"><a href="#cb36-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-745"><a href="#cb36-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-746"><a href="#cb36-746" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="ot">&lt;-</span> <span class="fu">as_survey_rep</span>(</span>
<span id="cb36-747"><a href="#cb36-747" aria-hidden="true" tabindex="-1"></a>  individuals_w_income,</span>
<span id="cb36-748"><a href="#cb36-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT ,</span>
<span id="cb36-749"><a href="#cb36-749" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWTP[0-9]+"</span>),</span>
<span id="cb36-750"><a href="#cb36-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb36-751"><a href="#cb36-751" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span> <span class="dv">80</span> ,</span>
<span id="cb36-752"><a href="#cb36-752" aria-hidden="true" tabindex="-1"></a>  <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb36-753"><a href="#cb36-753" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-754"><a href="#cb36-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-755"><a href="#cb36-755" aria-hidden="true" tabindex="-1"></a>Here we can see the un-adjusted gender earnings gap in Oakland, where</span>
<span id="cb36-756"><a href="#cb36-756" aria-hidden="true" tabindex="-1"></a>men on earn about \$20k more than women on average:</span>
<span id="cb36-757"><a href="#cb36-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-760"><a href="#cb36-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-761"><a href="#cb36-761" aria-hidden="true" tabindex="-1"></a>oak_indiv_svy <span class="sc">%&gt;%</span></span>
<span id="cb36-762"><a href="#cb36-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEX) <span class="sc">%&gt;%</span></span>
<span id="cb36-763"><a href="#cb36-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_income =</span> <span class="fu">survey_mean</span>(INCTOT))</span>
<span id="cb36-764"><a href="#cb36-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-765"><a href="#cb36-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-766"><a href="#cb36-766" aria-hidden="true" tabindex="-1"></a>Note that we are using <span class="in">`oak_indiv_svy`</span> and by extension the replicate</span>
<span id="cb36-767"><a href="#cb36-767" aria-hidden="true" tabindex="-1"></a>weights to produce those standard errors. If we instead used</span>
<span id="cb36-768"><a href="#cb36-768" aria-hidden="true" tabindex="-1"></a><span class="in">`individuals_w_income`</span>, we would get the same estimates, but likely</span>
<span id="cb36-769"><a href="#cb36-769" aria-hidden="true" tabindex="-1"></a>smaller standard errors. Indeed, lets explicitly look at the equivalent</span>
<span id="cb36-770"><a href="#cb36-770" aria-hidden="true" tabindex="-1"></a>regressions specification (though with log income as the outcome to more</span>
<span id="cb36-771"><a href="#cb36-771" aria-hidden="true" tabindex="-1"></a>accurately model the income distribution), once using only the sample</span>
<span id="cb36-772"><a href="#cb36-772" aria-hidden="true" tabindex="-1"></a>weights, and once using the replicate weights:</span>
<span id="cb36-773"><a href="#cb36-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-776"><a href="#cb36-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-777"><a href="#cb36-777" aria-hidden="true" tabindex="-1"></a>model_ols1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb36-778"><a href="#cb36-778" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> individuals_w_income,</span>
<span id="cb36-779"><a href="#cb36-779" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> individuals_w_income<span class="sc">$</span>PERWT)</span>
<span id="cb36-780"><a href="#cb36-780" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb36-781"><a href="#cb36-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-782"><a href="#cb36-782" aria-hidden="true" tabindex="-1"></a>gof_stuff <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb36-783"><a href="#cb36-783" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> raw, <span class="sc">~</span> clean, <span class="sc">~</span> fmt,</span>
<span id="cb36-784"><a href="#cb36-784" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="dv">0</span>,</span>
<span id="cb36-785"><a href="#cb36-785" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="dv">3</span></span>
<span id="cb36-786"><a href="#cb36-786" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-787"><a href="#cb36-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-788"><a href="#cb36-788" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb36-789"><a href="#cb36-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb36-790"><a href="#cb36-790" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sample weights, no covariates"</span> <span class="ot">=</span> model_ols1,</span>
<span id="cb36-791"><a href="#cb36-791" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Replicate weights, no covariates"</span> <span class="ot">=</span> model_ols2</span>
<span id="cb36-792"><a href="#cb36-792" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-793"><a href="#cb36-793" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb36-794"><a href="#cb36-794" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb36-795"><a href="#cb36-795" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-796"><a href="#cb36-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-797"><a href="#cb36-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-798"><a href="#cb36-798" aria-hidden="true" tabindex="-1"></a>Note that using replicate weights slightly enlarged our standard errors,</span>
<span id="cb36-799"><a href="#cb36-799" aria-hidden="true" tabindex="-1"></a>as described in the IPUMS documentation.</span>
<span id="cb36-800"><a href="#cb36-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-801"><a href="#cb36-801" aria-hidden="true" tabindex="-1"></a>Lets explore a couple other dynamics related to earnings in Oakland and</span>
<span id="cb36-802"><a href="#cb36-802" aria-hidden="true" tabindex="-1"></a>practice making visualizations and estimating regressions with the data.</span>
<span id="cb36-803"><a href="#cb36-803" aria-hidden="true" tabindex="-1"></a>Here's the income distribution across different levels of highest</span>
<span id="cb36-804"><a href="#cb36-804" aria-hidden="true" tabindex="-1"></a>education earned. Note here that I'm not using the replicate weights</span>
<span id="cb36-805"><a href="#cb36-805" aria-hidden="true" tabindex="-1"></a>(I'm just using the <span class="in">`individuals_w_income`</span> object), since I'm not</span>
<span id="cb36-806"><a href="#cb36-806" aria-hidden="true" tabindex="-1"></a>estimating anything. <span class="in">`ggplot`</span> does take a weight argument, for which</span>
<span id="cb36-807"><a href="#cb36-807" aria-hidden="true" tabindex="-1"></a>I've supplied the <span class="in">`PERWT`</span> sample weights.</span>
<span id="cb36-808"><a href="#cb36-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-809"><a href="#cb36-809" aria-hidden="true" tabindex="-1"></a><span class="ot">&lt;https://www.andrewheiss.com/blog/2022/06/23/long-labels-ggplot/index.html&gt;</span></span>
<span id="cb36-810"><a href="#cb36-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-813"><a href="#cb36-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-814"><a href="#cb36-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb36-815"><a href="#cb36-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-816"><a href="#cb36-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-817"><a href="#cb36-817" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span></span>
<span id="cb36-818"><a href="#cb36-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb36-819"><a href="#cb36-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EDUC) <span class="sc">%&gt;%</span></span>
<span id="cb36-820"><a href="#cb36-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span></span>
<span id="cb36-821"><a href="#cb36-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb36-822"><a href="#cb36-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-823"><a href="#cb36-823" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income, <span class="fu">aes</span>(</span>
<span id="cb36-824"><a href="#cb36-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">factor</span>(educ_attain, <span class="at">levels =</span> order),</span>
<span id="cb36-825"><a href="#cb36-825" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> INCTOT,</span>
<span id="cb36-826"><a href="#cb36-826" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> PERWT</span>
<span id="cb36-827"><a href="#cb36-827" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb36-828"><a href="#cb36-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb36-829"><a href="#cb36-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb36-830"><a href="#cb36-830" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb36-831"><a href="#cb36-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb36-832"><a href="#cb36-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.2</span></span>
<span id="cb36-833"><a href="#cb36-833" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-834"><a href="#cb36-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb36-835"><a href="#cb36-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb36-836"><a href="#cb36-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb36-837"><a href="#cb36-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">9</span>,</span>
<span id="cb36-838"><a href="#cb36-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">outliers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-839"><a href="#cb36-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">8</span></span>
<span id="cb36-840"><a href="#cb36-840" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-841"><a href="#cb36-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb36-842"><a href="#cb36-842" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb36-843"><a href="#cb36-843" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500000</span>),</span>
<span id="cb36-844"><a href="#cb36-844" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500000</span>, <span class="dv">100000</span>)</span>
<span id="cb36-845"><a href="#cb36-845" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-846"><a href="#cb36-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb36-847"><a href="#cb36-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Income by Education Level"</span>, <span class="at">y =</span> <span class="st">"Income"</span>, <span class="at">x =</span> <span class="st">"Education Level"</span>) <span class="sc">+</span></span>
<span id="cb36-848"><a href="#cb36-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-849"><a href="#cb36-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-850"><a href="#cb36-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb36-851"><a href="#cb36-851" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb36-852"><a href="#cb36-852" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb36-853"><a href="#cb36-853" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb36-854"><a href="#cb36-854" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-855"><a href="#cb36-855" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb36-856"><a href="#cb36-856" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-857"><a href="#cb36-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-858"><a href="#cb36-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-859"><a href="#cb36-859" aria-hidden="true" tabindex="-1"></a>The plot shows that individuals with bachelor's and graduate degrees</span>
<span id="cb36-860"><a href="#cb36-860" aria-hidden="true" tabindex="-1"></a>generally have higher incomes in Oakland. Let's seen how bachelor and</span>
<span id="cb36-861"><a href="#cb36-861" aria-hidden="true" tabindex="-1"></a>graduate degree attainment differs across sex. Again, I'm using the</span>
<span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a><span class="in">`individuals_w_income`</span> object as I have no need to replicate weights.</span>
<span id="cb36-863"><a href="#cb36-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="st">"Set1"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)]</span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> individuals_w_income <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(EDUC, educ_attain) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(EDUC)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(educ_attain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(individuals_w_income,</span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(educ_attain, <span class="at">level =</span> order),</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="fu">factor</span>(SEX),</span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> PERWT</span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb36-881"><a href="#cb36-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb36-882"><a href="#cb36-882" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb36-883"><a href="#cb36-883" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb36-884"><a href="#cb36-884" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb36-885"><a href="#cb36-885" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (..count..) <span class="sc">/</span> <span class="fu">sum</span>(..count..))</span>
<span id="cb36-886"><a href="#cb36-886" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-887"><a href="#cb36-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb36-888"><a href="#cb36-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb36-889"><a href="#cb36-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), ) <span class="sc">+</span></span>
<span id="cb36-890"><a href="#cb36-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-891"><a href="#cb36-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Highest Education Level by Sex"</span>,</span>
<span id="cb36-892"><a href="#cb36-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percent of earners"</span>,</span>
<span id="cb36-893"><a href="#cb36-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Education"</span>,</span>
<span id="cb36-894"><a href="#cb36-894" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sex"</span>,</span>
<span id="cb36-895"><a href="#cb36-895" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Sex"</span></span>
<span id="cb36-896"><a href="#cb36-896" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-897"><a href="#cb36-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-898"><a href="#cb36-898" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-899"><a href="#cb36-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(</span>
<span id="cb36-900"><a href="#cb36-900" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb36-901"><a href="#cb36-901" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb36-902"><a href="#cb36-902" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="dv">1</span></span>
<span id="cb36-903"><a href="#cb36-903" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-904"><a href="#cb36-904" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"white"</span>)</span>
<span id="cb36-905"><a href="#cb36-905" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-906"><a href="#cb36-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-907"><a href="#cb36-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-908"><a href="#cb36-908" aria-hidden="true" tabindex="-1"></a>So bachelor and graduate degree holders generally earn more, and women</span>
<span id="cb36-909"><a href="#cb36-909" aria-hidden="true" tabindex="-1"></a>are more likely than men to have bachelor and graduate degrees in</span>
<span id="cb36-910"><a href="#cb36-910" aria-hidden="true" tabindex="-1"></a>Oakland. This should imply that if we adjust for education when</span>
<span id="cb36-911"><a href="#cb36-911" aria-hidden="true" tabindex="-1"></a>estimating the gender-earnings gap in Oakland, thus only comparing men</span>
<span id="cb36-912"><a href="#cb36-912" aria-hidden="true" tabindex="-1"></a>and women in the same education levels, we should see the gap increase.</span>
<span id="cb36-913"><a href="#cb36-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-914"><a href="#cb36-914" aria-hidden="true" tabindex="-1"></a>We again use <span class="in">`svyglm`</span> to estimate the regression, and <span class="in">`oak_indiv_svy`</span> as</span>
<span id="cb36-915"><a href="#cb36-915" aria-hidden="true" tabindex="-1"></a>the data/survey design so as to use the replicate weights for our</span>
<span id="cb36-916"><a href="#cb36-916" aria-hidden="true" tabindex="-1"></a>standard errors.</span>
<span id="cb36-917"><a href="#cb36-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-920"><a href="#cb36-920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-921"><a href="#cb36-921" aria-hidden="true" tabindex="-1"></a>model_ols2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX), oak_indiv_svy)</span>
<span id="cb36-922"><a href="#cb36-922" aria-hidden="true" tabindex="-1"></a>model_ols3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb36-923"><a href="#cb36-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(INCTOT) <span class="sc">~</span> <span class="fu">factor</span>(SEX) <span class="sc">+</span></span>
<span id="cb36-924"><a href="#cb36-924" aria-hidden="true" tabindex="-1"></a>    AGE <span class="sc">+</span> <span class="fu">I</span>(AGE <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-925"><a href="#cb36-925" aria-hidden="true" tabindex="-1"></a>    <span class="fu">relevel</span>(educ_attain, <span class="at">ref =</span><span class="st">"Highschool diploma"</span>),</span>
<span id="cb36-926"><a href="#cb36-926" aria-hidden="true" tabindex="-1"></a>  oak_indiv_svy</span>
<span id="cb36-927"><a href="#cb36-927" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-928"><a href="#cb36-928" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb36-929"><a href="#cb36-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb36-930"><a href="#cb36-930" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, no covariates"</span> <span class="ot">=</span> model_ols2,</span>
<span id="cb36-931"><a href="#cb36-931" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Earnings gap, adjusted for age and education"</span> <span class="ot">=</span> model_ols3</span>
<span id="cb36-932"><a href="#cb36-932" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-933"><a href="#cb36-933" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_stuff,</span>
<span id="cb36-934"><a href="#cb36-934" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb36-935"><a href="#cb36-935" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-936"><a href="#cb36-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-937"><a href="#cb36-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-938"><a href="#cb36-938" aria-hidden="true" tabindex="-1"></a>Fun!</span>
</code></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Peter Amerkhanian</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>