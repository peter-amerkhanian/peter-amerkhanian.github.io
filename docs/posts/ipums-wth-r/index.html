<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Amerkhanian">
<meta name="dcterms.date" content="2025-02-20">
<meta name="description" content="Using ipumsr, geocorr, and survey to analyze a small-geography in IPUMS data.">

<title>Working with ACS microdata in R – Peter Amerkhanian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile_backup.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V95HGLKTEB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V95HGLKTEB', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile_backup.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Professional</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Working with ACS microdata in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Using <code>ipumsr</code>, geocorr, and <code>survey</code> to analyze a small-geography in IPUMS data.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Data Management</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Amerkhanian </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title"><a href="#" class="nav-link">Working with ACS microdata in R</a></h2>
     
    <ul>
    <li><a href="#aggregate-data-with-tidycensus" id="toc-aggregate-data-with-tidycensus" class="nav-link active" data-scroll-target="#aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></a></li>
    <li><a href="#microdata-with-ipumsipumsr" id="toc-microdata-with-ipumsipumsr" class="nav-link" data-scroll-target="#microdata-with-ipumsipumsr">Microdata with IPUMS/<code>ipumsr</code></a></li>
    <li><a href="#sec-step-1" id="toc-sec-step-1" class="nav-link" data-scroll-target="#sec-step-1">Step 1: Retrieving data</a></li>
    <li><a href="#sec-step-2" id="toc-sec-step-2" class="nav-link" data-scroll-target="#sec-step-2">Step 2: Using Geocorr to identify small geographies</a></li>
    <li><a href="#sec-step-3" id="toc-sec-step-3" class="nav-link" data-scroll-target="#sec-step-3">Step 3: Specify the unit of analysis</a>
    <ul class="collapse">
    <li><a href="#households-group-quarters-and-institutions" id="toc-households-group-quarters-and-institutions" class="nav-link" data-scroll-target="#households-group-quarters-and-institutions">Households, group quarters, and institutions</a></li>
    <li><a href="#household-income-in-the-acs" id="toc-household-income-in-the-acs" class="nav-link" data-scroll-target="#household-income-in-the-acs">Household Income in the ACS</a></li>
    </ul></li>
    <li><a href="#sec-step-4" id="toc-sec-step-4" class="nav-link" data-scroll-target="#sec-step-4">Step 4: Applying sample weights</a></li>
    <li><a href="#sec-step-5" id="toc-sec-step-5" class="nav-link" data-scroll-target="#sec-step-5">Step 5: Calculating standard errors</a>
    <ul class="collapse">
    <li><a href="#the-taylor-series-method" id="toc-the-taylor-series-method" class="nav-link" data-scroll-target="#the-taylor-series-method">The Taylor series method</a></li>
    <li><a href="#replication-weights" id="toc-replication-weights" class="nav-link" data-scroll-target="#replication-weights">Replication weights</a></li>
    </ul></li>
    <li><a href="#a-production-workflow" id="toc-a-production-workflow" class="nav-link" data-scroll-target="#a-production-workflow">A Production Workflow</a></li>
    </ul>
    <div class="quarto-alternate-formats">
    <ul><li>
    <a id="github" href="#" target="_blank"><i class="bi bi-github"></i>Source Code</a>
  </li></ul>
</div>

  </nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<script>
  var githubLink = document.getElementById("github");
  var currentPath = window.location.pathname;
  githubLink.href = "https://github.com/peter-amerkhanian/peter-amerkhanian.github.io/blob/master" + currentPath;
  document.getElementById('toc-title').addEventListener('click', function(event) {
  event.preventDefault(); // Prevent default behavior of anchor tag
  const firstHeader = document.querySelector('body'); // Select the first h2 element
  if (firstHeader) {
    firstHeader.scrollIntoView({ behavior: 'smooth', block: "start", inline: "nearest"}); // Scroll to the first header smoothly
  }
});
</script>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Statistics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               modelsummary,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               srvyr,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               survey,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Webscraping</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               httr,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               rvest,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               readr,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               glue,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Census</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>               tidycensus,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>               ipumsr,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>               <span class="co"># XML Parsing</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>               xml2,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>               purrr,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>               stringr)</span></code></pre></div>
</details>
</div>
<p>The following are my notes on how to use American Community Survey (ACS) microdata, leveraging the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> I cover:</p>
<ol type="1">
<li><strong>Retrieval</strong>: how to choose which ACS product is relevant, how to submit a request to IPUMS, and how to filter down to relevant levels of geography/granularity.</li>
<li><strong>Analysis</strong>: how to properly weight ACS data using sample and replication weights for accurate analysis and uncertainty estimation.</li>
</ol>
<p>I’ll start with a motivating question:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Motivating Question
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What was the median household income in Oakland, California in 2022?</strong></p>
</div>
</div>
<section id="aggregate-data-with-tidycensus" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-data-with-tidycensus">Aggregate data with <code>tidycensus</code></h2>
<p>Answering that question is straightforward using the Census’ <em>aggregate</em> data – pre-calculated descriptive statistics for aggregate geographies. I typically retrieve aggregate data via the <a href="https://www.census.gov/programs-surveys/acs/data/data-via-api.html">Census API</a>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> In R, the <code>tidycensus</code> package provides an easy-to-use wrapper for that API. Note that I set up an API key for the U.S. Census and I’m storing it in my <code>.Renviron</code> file as <code>census_api_key="yourkeyhere"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span></code></pre></div>
</div>
<p>I query <code>B19013_001</code>, the median household income variable, using the 2022 1-year American Community Survey sample and I filter down to Oakland’s GEOID, <code>0653000</code>, which is a combination of the state code for California, <code>06</code>, and the place code for Oakland, <code>53000</code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> I’ll throw in the total population variable for good measure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate, moe))</span></code></pre></div>
<div id="tbl-agg-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-agg-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Total Population and Median Household Income in Oakand, CA via Aggregate Data
</figcaption>
<div aria-describedby="tbl-agg-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">moe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">426323</td>
<td style="text-align: right;">811</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">93146</td>
<td style="text-align: right;">6232</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Done! We now know the population and median household income for Oakland in 2022, along with a margin of error. See <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span> for a comprehensive treatment of working with aggregate census data.</p>
</section>
<section id="microdata-with-ipumsipumsr" class="level2">
<h2 class="anchored" data-anchor-id="microdata-with-ipumsipumsr">Microdata with IPUMS/<code>ipumsr</code></h2>
<p>What if I wanted to have access to the underlying data used to calculate the median? Maybe I want to try a different standard error specification for that statistic, or calculate other statistics, like the average household income. These tasks would all entail accessing census <em>microdata</em> – household and/or individual level census data.</p>
<p>One of the most popular sources for downloading census microdata is the University of Minnesota’s Integrated Public Use Microdata Series (IPUMS). The IPUMS team provides a centralized API for downloading census microdata, comprehensive documentation for working with the data, and harmonized variables across time <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 9</a>)</span>.</p>
<p>The easiest way to access IPUMS data in R is with the <a href="https://tech.popdata.org/ipumsr/"><code>ipumsr</code></a> package, which the IPUMS team maintains and which allows users to submit API requests to IPUMS directly from R <span class="citation" data-cites="greg_freedman_ellis_ipumsr_2024">(<a href="#ref-greg_freedman_ellis_ipumsr_2024" role="doc-biblioref">Greg Freedman Ellis, Derek Burk, and Finn Roberts 2024</a>)</span> . To get set up, I <a href="https://developer.ipums.org/docs/v2/get-started/">registered for an IPUMS API key</a>, stored the key in my <code>.Renviron</code> file, and will configure the key in <code>ipumsr</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span></code></pre></div>
</div>
<p>The <code>ipumsr</code> website <a href="https://tech.popdata.org/ipumsr/articles/ipums.html#obtaining-data-via-the-ipums-api">provides details</a> on what survey products the project currently supports, as does the <code>ipums_data_collections()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span></code></pre></div>
<div id="tbl-ipums-available" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ipums-available-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: IPUMS API Collections
</figcaption>
<div aria-describedby="tbl-ipums-available-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">collection_name</th>
<th style="text-align: left;">collection_type</th>
<th style="text-align: left;">code_for_api</th>
<th style="text-align: left;">api_support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IPUMS USA</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">usa</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS CPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">cps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS International</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ipumsi</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS ATUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">atus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS AHTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">ahtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MTUS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">mtus</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHIS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">nhis</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPUMS MEPS</td>
<td style="text-align: left;">microdata</td>
<td style="text-align: left;">meps</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IPUMS NHGIS</td>
<td style="text-align: left;">aggregate data</td>
<td style="text-align: left;">nhgis</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>I’ll look at IPUMS USA since my motivating question involves median household income for a year (2022), and IPUMS USA offers annual data from decennial censuses 1790-2010 and American Community Surveys (ACS) 2000-present <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. We can check out the newest products they have in the USA collection as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<div id="tbl-acs-datasets" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-acs-datasets-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: IPUMS USA Products
</figcaption>
<div aria-describedby="tbl-acs-datasets-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">us2023d</td>
<td style="text-align: left;">2019-2023, PRCS 5-year</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2023c</td>
<td style="text-align: left;">2019-2023, ACS 5-year</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2023b</td>
<td style="text-align: left;">2023 PRCS</td>
</tr>
<tr class="even">
<td style="text-align: left;">us2023a</td>
<td style="text-align: left;">2023 ACS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us2022d</td>
<td style="text-align: left;">2018-2022, PRCS 5-year</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Note that “PRCS” refers to the Puerto Rico Community Survey (an ACS equivalent specifically tailored to Puerto Rico). We are principally interested in the ACS, which comes in either one-year (e.g.&nbsp;2023 ACS) or five-year (e.g.&nbsp;2018-2022, ACS 5-year) estimates. The differences between these two estimates are described in detail in <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-data-an-overview">Census Data: An Overview</a> in <span class="citation" data-cites="walker_analyzing_2023">(<a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023</a>)</span>. One differentiating point is that one-year estimates come from a smaller, but more contemporary sample. In our case we’ll use the one-year to get the best sense of the 2022 income dynamics.</p>
<p>Let’s return to the motivating question for this post:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Motivating Question
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What was the median household income in Oakland, California in 2022?</strong></p>
</div>
</div>
<p>To answer that we will:</p>
<ol type="1">
<li>Get income data from the 2022 1-year ACS (<a href="#sec-step-1" class="quarto-xref">Section&nbsp;3</a>).</li>
<li>Filter our data down to households in the city of Oakland (<a href="#sec-step-2" class="quarto-xref">Section&nbsp;4</a> and <a href="#sec-step-3" class="quarto-xref">Section&nbsp;5</a>).</li>
<li>Calculate the median (<a href="#sec-step-4" class="quarto-xref">Section&nbsp;6</a> and <a href="#sec-step-5" class="quarto-xref">Section&nbsp;7</a>).</li>
</ol>
</section>
<section id="sec-step-1" class="level2">
<h2 class="anchored" data-anchor-id="sec-step-1">Step 1: Retrieving data</h2>
<p>For the first task, I’ll define several helper functions:</p>
<ul>
<li><code>retrieve_sample()</code> retrieves a list of variables from a given ACS sample from the IPUMS API. This is the only truly necessary code.</li>
<li><code>check_description()</code> and <code>ipums_data()</code> are functions for checking if the target extract already exists locally. Retrieving an extract can take some time, and I’d like to avoid doing it repeatedly when I’ve already downloaded the extract in the past.</li>
</ul>
<p>Each of these are defined in the following folded code block.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables, description) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> description,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> variables</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>check_description <span class="ot">&lt;-</span> <span class="cf">function</span>(file, description) {</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  xml_text <span class="ot">&lt;-</span> <span class="fu">readLines</span>(file, <span class="at">warn =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  user_description <span class="ot">&lt;-</span> <span class="fu">str_match</span>(xml_text, <span class="st">"User-provided description:</span><span class="sc">\\</span><span class="st">s*(.*)]]"</span>)[, <span class="dv">2</span>]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if it matches the target</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(user_description, <span class="fu">fixed</span>(description, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) {</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(file)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>ipums_data <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables, description) {</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  matching_files <span class="ot">&lt;-</span> <span class="fu">compact</span>(<span class="fu">map</span>(local_ipums_extracts, \(x) <span class="fu">check_description</span>(x, description)))</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there is a match, open the first matching file</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(matching_files) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    matched_file <span class="ot">&lt;-</span> matching_files[[<span class="dv">1</span>]]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Opening: "</span>, matched_file)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(matched_file)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No matching dataset found."</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(sample, variables, description)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<p>I’ll proceed to define a list of variables that I want, including <code>HHINCOME</code> (household income) and <code>INCTOT</code> (individual income). Some of these variables refer to census-specific language – i.e.&nbsp;<code>PUMA</code> , <code>REPWT</code> , <code>REPWTP</code>. I’ll cover exactly what each of these represent later in the post, but in the meantime I’ll also note that the IPUMS website has <a href="https://usa.ipums.org/usa-action/variables/group">full reference materials</a> for all available variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>Note the line, <code>var_spec("STATEFIP", case_selections = "06")</code>. This selects the variable <code>STATEFIP</code>, while also specifying that we want to restrict our request to data where <code>STATEFIP=='06'</code> (California). Using <a href="https://tech.popdata.org/ipumsr/reference/var_spec.html"><code>var_spec()</code></a> is important, as accidentally/unnecessarily downloading an unfiltered, full sample of the entire U.S. is time-consuming.</p>
<p>Anyways, I can request these variables from the 2022 1-year ACS via my<code>ipums_data()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">ipums_data</span>(<span class="st">"us2022a"</span>, variables, <span class="st">"Incomes by PUMA"</span>)</span></code></pre></div>
</div>
<p>Here are the resulting data, the 2022 1-year ACS for California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div id="tbl-raw" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Unfiltered 2022 1-year ACS data for California
</figcaption>
<div aria-describedby="tbl-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74692</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6509</td>
<td style="text-align: right;">650906</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">14500</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74693</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6501</td>
<td style="text-align: right;">650106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74694</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8101</td>
<td style="text-align: right;">810106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74695</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8303</td>
<td style="text-align: right;">830306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">9000</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74696</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6712</td>
<td style="text-align: right;">671206</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">48000</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74697</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7301</td>
<td style="text-align: right;">730106</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">24000</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">90</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="sec-step-2" class="level2">
<h2 class="anchored" data-anchor-id="sec-step-2">Step 2: Using Geocorr to identify small geographies</h2>
<p>We now have microdata for all of California, but we need to filter down to just Oakland. Unfortunately, this isn’t as simple as just running <code>filter(CITY == 'Oakland')</code> – ACS microdata does not include a field for explicitly identifying cities (note that a city is typically referred to as a “place” in census data).</p>
<p>The smallest geographic area explicitly identified in the microdata is something called a public use microdata area (PUMA) <span class="citation" data-cites="pastoor_how_2024">(<a href="#ref-pastoor_how_2024" role="doc-biblioref">Pastoor 2024</a>)</span>. PUMAS are unique geographies that always aggregate to the state-level (e.g.&nbsp;California can be constructed with a collection of PUMAs), but only sometimes aggregate to other small geographic areas, such as city, metro area, and county <span class="citation" data-cites="walker_analyzing_2023">(See <a href="https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies" role="doc-biblioref">Census Hierarchies</a> in <a href="#ref-walker_analyzing_2023" role="doc-biblioref">Walker 2023, chap. 1</a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_use_cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>bay_area_counties <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alameda"</span>, <span class="st">"Contra Costa"</span>, <span class="st">"Marin"</span>, <span class="st">"Napa"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"San Francisco"</span>, <span class="st">"San Mateo"</span>, <span class="st">"Santa Clara"</span>, <span class="st">"Solano"</span>, <span class="st">"Sonoma"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>bay_area <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"CA"</span>, <span class="at">class =</span> <span class="st">"sf"</span>, <span class="at">year=</span><span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> bay_area_counties) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>()  <span class="co"># Merge counties into a single boundary</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all California Places &amp; PUMAs</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>places <span class="ot">&lt;-</span> <span class="fu">places</span>(<span class="at">state =</span> <span class="st">"CA"</span>, <span class="at">class =</span> <span class="st">"sf"</span>, <span class="at">year=</span><span class="dv">2022</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>pumas <span class="ot">&lt;-</span> <span class="fu">pumas</span>(<span class="at">state =</span> <span class="st">"CA"</span>, <span class="at">class =</span> <span class="st">"sf"</span>,  <span class="at">year=</span><span class="dv">2022</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter only those in the Bay Area</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>places_bay <span class="ot">&lt;-</span> places[<span class="fu">st_intersects</span>(places, bay_area, <span class="at">sparse =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>pumas_bay <span class="ot">&lt;-</span> pumas[<span class="fu">st_intersects</span>(pumas, bay_area, <span class="at">sparse =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>pumas_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(bay_area)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>crop_theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),      </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"cm"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>map_places <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> places_bay, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bay_area, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">ylim =</span> <span class="fu">c</span>(pumas_bbox[<span class="st">"ymin"</span>], pumas_bbox[<span class="st">"ymax"</span>]), <span class="at">xlim =</span> <span class="fu">c</span>(pumas_bbox[<span class="st">"xmin"</span>], pumas_bbox[<span class="st">"xmax"</span>]), <span class="at">expand=</span><span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Apply PUMAs y-limits</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  crop_theme <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Places"</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>map_pumas <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pumas_bay, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bay_area, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">ylim =</span> <span class="fu">c</span>(pumas_bbox[<span class="st">"ymin"</span>], pumas_bbox[<span class="st">"ymax"</span>]), <span class="at">xlim =</span> <span class="fu">c</span>(pumas_bbox[<span class="st">"xmin"</span>], pumas_bbox[<span class="st">"xmax"</span>]), <span class="at">expand=</span><span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Ensure y-axis is the same</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  crop_theme <span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PUMAs"</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(map_places, map_pumas, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">"h"</span>, <span class="at">axis=</span><span class="st">"t"</span>, <span class="at">vjust =</span> <span class="dv">0</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Places and PUMAS in the Bay Area (region border in red)</figcaption>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To find out if a city corresponds to a collection of PUMAs and which PUMAs those are, we’ll use <a href="https://mcdc.missouri.edu/applications/geocorr2022.html">Geocorr</a> (geographic correspondence engine), an application that generates correlation lists showing relationships between two or more geographic coverages in the United States <span class="citation" data-cites="mihalik_missouri_2022">(<a href="#ref-mihalik_missouri_2022" role="doc-biblioref">Mihalik, Rice, and Hesser 2022</a>)</span>. Geocorr is a sponsored program of the Missouri State library and published by the University of Missouri Center for Health Policy.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Geocorr 2022: Geographic Correspondence Engine</figcaption>
<p><img src="geocorr.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>To use Geocorr, I’ll define a function, <code>geocorr_2022()</code> that queries Geocorr 2022 and retrieves a .csv file establishing the relationships between two sets of geographies within a given state. See the following folded code chunk for the specifics:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<p>We’ll use that function to establish the relationships between California’s 2022 PUMAs and its “places,” using individual population as measured in the 2020 Decenial Census to weight the relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span></code></pre></div>
</div>
<p>With that, we can see which PUMAs correspond to the City of Oakland.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span></code></pre></div>
<div id="tbl-correspondence" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-correspondence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: PUMA to Place correspondence for Oakand, CA
</figcaption>
<div aria-describedby="tbl-correspondence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">puma22</th>
<th style="text-align: left;">PlaceName</th>
<th style="text-align: left;">pop20</th>
<th style="text-align: left;">afact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">00111</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">106433</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00112</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">106896</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00113</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">125840</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">00114</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">00123</td>
<td style="text-align: left;">Oakland city, CA</td>
<td style="text-align: left;">101468</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>The <code>AFACT</code> (allocation factor) column shows the proportion of the source area contained in the target area – in this case the proportion of the PUMA population that belongs to Oakland. In this case, 100% of the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and 0% of PUMA 114. GEOCORR does believe that 9 individuals from 114 live in Oakland, but based on the AFACT of 0 and the fact that I know the PUMA overlays the neighboring city of Piedmont, I’ll feel comfortable dropping that PUMA.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Note that when you plot place to PUMA equivalence, you may find slight differences due to the fact that places can include un-populated areas, such as bodies of water <a href="https://www.google.com/maps/place/Oakland,+CA/@37.7831602,-122.3045548,11z/data=!4m6!3m5!1s0x80857d8b28aaed03:0x71b415d535759367!8m2!3d37.8043514!4d-122.2711639!16zL20vMGRjOTU?entry=ttu&amp;g_ep=EgoyMDI1MDIxMi4wIKXMDSoJLDEwMjExNDU1SAFQAw%3D%3D">in the case of Oakland</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter PUMAs for Oakland</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> pumas_bay <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PUMACE20 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'00111'</span>, <span class="st">'00112'</span>, <span class="st">'00113'</span>, <span class="st">'00123'</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>oakland_place <span class="ot">&lt;-</span> places_bay <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">'Oakland'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get bounding box for Oakland PUMAs</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>oakland_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(oakland_place)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>crop_theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),      </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"cm"</span>),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Oakland Places Map</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>map_places <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> oakland_place, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> oakland_place, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">ylim =</span> <span class="fu">c</span>(oakland_bbox[<span class="st">"ymin"</span>], oakland_bbox[<span class="st">"ymax"</span>]), </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim =</span> <span class="fu">c</span>(oakland_bbox[<span class="st">"xmin"</span>], oakland_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  crop_theme <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Oakland (Place)"</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Oakland PUMAs Map</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>map_pumas <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> oakland_pumas, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> oakland_pumas, <span class="fu">aes</span>(<span class="at">label =</span> PUMACE20)) <span class="sc">+</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> oakland_place, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_sf(data = oakland_pumas, fill = NA, color = "red", size = 4) +  </span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">ylim =</span> <span class="fu">c</span>(oakland_bbox[<span class="st">"ymin"</span>], oakland_bbox[<span class="st">"ymax"</span>]), </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim =</span> <span class="fu">c</span>(oakland_bbox[<span class="st">"xmin"</span>], oakland_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  crop_theme <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Oakland (PUMAs)"</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(map_places, map_pumas, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">"h"</span>, <span class="at">axis =</span> <span class="st">"t"</span>, <span class="at">vjust =</span> <span class="dv">0</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Place to PUMAs Correspondence in Oakland (place border in red)</figcaption>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the City of Oakland (I use <code>haven::zap_labels()</code> just to remove some unnecessary formatting that comes with the data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div id="tbl-oakland-raw" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-oakland-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: 2022 1-year ACS data for Oakland, CA
</figcaption>
<div aria-describedby="tbl-oakland-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">SAMPLE</th>
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">CBSERIAL</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT</th>
<th style="text-align: right;">CLUSTER</th>
<th style="text-align: right;">STATEFIP</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">STRATA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: right;">REPWT3</th>
<th style="text-align: right;">REPWT4</th>
<th style="text-align: right;">REPWT5</th>
<th style="text-align: right;">REPWT6</th>
<th style="text-align: right;">REPWT7</th>
<th style="text-align: right;">REPWT8</th>
<th style="text-align: right;">REPWT9</th>
<th style="text-align: right;">REPWT10</th>
<th style="text-align: right;">REPWT11</th>
<th style="text-align: right;">REPWT12</th>
<th style="text-align: right;">REPWT13</th>
<th style="text-align: right;">REPWT14</th>
<th style="text-align: right;">REPWT15</th>
<th style="text-align: right;">REPWT16</th>
<th style="text-align: right;">REPWT17</th>
<th style="text-align: right;">REPWT18</th>
<th style="text-align: right;">REPWT19</th>
<th style="text-align: right;">REPWT20</th>
<th style="text-align: right;">REPWT21</th>
<th style="text-align: right;">REPWT22</th>
<th style="text-align: right;">REPWT23</th>
<th style="text-align: right;">REPWT24</th>
<th style="text-align: right;">REPWT25</th>
<th style="text-align: right;">REPWT26</th>
<th style="text-align: right;">REPWT27</th>
<th style="text-align: right;">REPWT28</th>
<th style="text-align: right;">REPWT29</th>
<th style="text-align: right;">REPWT30</th>
<th style="text-align: right;">REPWT31</th>
<th style="text-align: right;">REPWT32</th>
<th style="text-align: right;">REPWT33</th>
<th style="text-align: right;">REPWT34</th>
<th style="text-align: right;">REPWT35</th>
<th style="text-align: right;">REPWT36</th>
<th style="text-align: right;">REPWT37</th>
<th style="text-align: right;">REPWT38</th>
<th style="text-align: right;">REPWT39</th>
<th style="text-align: right;">REPWT40</th>
<th style="text-align: right;">REPWT41</th>
<th style="text-align: right;">REPWT42</th>
<th style="text-align: right;">REPWT43</th>
<th style="text-align: right;">REPWT44</th>
<th style="text-align: right;">REPWT45</th>
<th style="text-align: right;">REPWT46</th>
<th style="text-align: right;">REPWT47</th>
<th style="text-align: right;">REPWT48</th>
<th style="text-align: right;">REPWT49</th>
<th style="text-align: right;">REPWT50</th>
<th style="text-align: right;">REPWT51</th>
<th style="text-align: right;">REPWT52</th>
<th style="text-align: right;">REPWT53</th>
<th style="text-align: right;">REPWT54</th>
<th style="text-align: right;">REPWT55</th>
<th style="text-align: right;">REPWT56</th>
<th style="text-align: right;">REPWT57</th>
<th style="text-align: right;">REPWT58</th>
<th style="text-align: right;">REPWT59</th>
<th style="text-align: right;">REPWT60</th>
<th style="text-align: right;">REPWT61</th>
<th style="text-align: right;">REPWT62</th>
<th style="text-align: right;">REPWT63</th>
<th style="text-align: right;">REPWT64</th>
<th style="text-align: right;">REPWT65</th>
<th style="text-align: right;">REPWT66</th>
<th style="text-align: right;">REPWT67</th>
<th style="text-align: right;">REPWT68</th>
<th style="text-align: right;">REPWT69</th>
<th style="text-align: right;">REPWT70</th>
<th style="text-align: right;">REPWT71</th>
<th style="text-align: right;">REPWT72</th>
<th style="text-align: right;">REPWT73</th>
<th style="text-align: right;">REPWT74</th>
<th style="text-align: right;">REPWT75</th>
<th style="text-align: right;">REPWT76</th>
<th style="text-align: right;">REPWT77</th>
<th style="text-align: right;">REPWT78</th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">REPWTP</th>
<th style="text-align: right;">FAMUNIT</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">RELATED</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">EDUCD</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">REPWTP1</th>
<th style="text-align: right;">REPWTP2</th>
<th style="text-align: right;">REPWTP3</th>
<th style="text-align: right;">REPWTP4</th>
<th style="text-align: right;">REPWTP5</th>
<th style="text-align: right;">REPWTP6</th>
<th style="text-align: right;">REPWTP7</th>
<th style="text-align: right;">REPWTP8</th>
<th style="text-align: right;">REPWTP9</th>
<th style="text-align: right;">REPWTP10</th>
<th style="text-align: right;">REPWTP11</th>
<th style="text-align: right;">REPWTP12</th>
<th style="text-align: right;">REPWTP13</th>
<th style="text-align: right;">REPWTP14</th>
<th style="text-align: right;">REPWTP15</th>
<th style="text-align: right;">REPWTP16</th>
<th style="text-align: right;">REPWTP17</th>
<th style="text-align: right;">REPWTP18</th>
<th style="text-align: right;">REPWTP19</th>
<th style="text-align: right;">REPWTP20</th>
<th style="text-align: right;">REPWTP21</th>
<th style="text-align: right;">REPWTP22</th>
<th style="text-align: right;">REPWTP23</th>
<th style="text-align: right;">REPWTP24</th>
<th style="text-align: right;">REPWTP25</th>
<th style="text-align: right;">REPWTP26</th>
<th style="text-align: right;">REPWTP27</th>
<th style="text-align: right;">REPWTP28</th>
<th style="text-align: right;">REPWTP29</th>
<th style="text-align: right;">REPWTP30</th>
<th style="text-align: right;">REPWTP31</th>
<th style="text-align: right;">REPWTP32</th>
<th style="text-align: right;">REPWTP33</th>
<th style="text-align: right;">REPWTP34</th>
<th style="text-align: right;">REPWTP35</th>
<th style="text-align: right;">REPWTP36</th>
<th style="text-align: right;">REPWTP37</th>
<th style="text-align: right;">REPWTP38</th>
<th style="text-align: right;">REPWTP39</th>
<th style="text-align: right;">REPWTP40</th>
<th style="text-align: right;">REPWTP41</th>
<th style="text-align: right;">REPWTP42</th>
<th style="text-align: right;">REPWTP43</th>
<th style="text-align: right;">REPWTP44</th>
<th style="text-align: right;">REPWTP45</th>
<th style="text-align: right;">REPWTP46</th>
<th style="text-align: right;">REPWTP47</th>
<th style="text-align: right;">REPWTP48</th>
<th style="text-align: right;">REPWTP49</th>
<th style="text-align: right;">REPWTP50</th>
<th style="text-align: right;">REPWTP51</th>
<th style="text-align: right;">REPWTP52</th>
<th style="text-align: right;">REPWTP53</th>
<th style="text-align: right;">REPWTP54</th>
<th style="text-align: right;">REPWTP55</th>
<th style="text-align: right;">REPWTP56</th>
<th style="text-align: right;">REPWTP57</th>
<th style="text-align: right;">REPWTP58</th>
<th style="text-align: right;">REPWTP59</th>
<th style="text-align: right;">REPWTP60</th>
<th style="text-align: right;">REPWTP61</th>
<th style="text-align: right;">REPWTP62</th>
<th style="text-align: right;">REPWTP63</th>
<th style="text-align: right;">REPWTP64</th>
<th style="text-align: right;">REPWTP65</th>
<th style="text-align: right;">REPWTP66</th>
<th style="text-align: right;">REPWTP67</th>
<th style="text-align: right;">REPWTP68</th>
<th style="text-align: right;">REPWTP69</th>
<th style="text-align: right;">REPWTP70</th>
<th style="text-align: right;">REPWTP71</th>
<th style="text-align: right;">REPWTP72</th>
<th style="text-align: right;">REPWTP73</th>
<th style="text-align: right;">REPWTP74</th>
<th style="text-align: right;">REPWTP75</th>
<th style="text-align: right;">REPWTP76</th>
<th style="text-align: right;">REPWTP77</th>
<th style="text-align: right;">REPWTP78</th>
<th style="text-align: right;">REPWTP79</th>
<th style="text-align: right;">REPWTP80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74718</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74737</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">74738</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1200</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75005</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">11306</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1270</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">41300</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75119</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">11106</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5800</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">202201</td>
<td style="text-align: right;">75131</td>
<td style="text-align: right;">2.02201e+12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.022001e+12</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">12306</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="sec-step-3" class="level2">
<h2 class="anchored" data-anchor-id="sec-step-3">Step 3: Specify the unit of analysis</h2>
<p>Each row in the ACS microdata represents an individual, identified by a unique combination of <code>SAMPLE</code>, which defines the year when the individual was surveyed, <code>SERIAL</code>, a unique identifier for that individual’s household, and <code>PERNUM</code>, a unique identifier for the individual within their household <span class="citation" data-cites="ruggles_ipums_2024">(<a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>. Given that, we can define a straightforward definition for unique individuals in the ACS:</p>
<ul>
<li><strong>Individuals</strong>: The combination of <code>SAMPLE</code>, <code>SERIAL</code>, and <code>PERNUM</code> provides a unique identifier for every person in the IPUMS. ACS microdata is typically individual-level, so this filtering should not be necessary.</li>
</ul>
<p>Defining a household is slightly more complex.</p>
<ul>
<li><strong>Housing Units</strong>: The combination of <code>SAMPLE</code> and <code>SERIAL</code> provides a unique identifier for every housing unit in the IPUMS. However, this includes both households and general group quarter housing, e.g.&nbsp;correctional facilities. Housing units are further categorized using the <a href="(https://usa.ipums.org/usa-action/variables/GQ#description_section)"><code>GQ</code></a> variable.
<ul>
<li><strong>Households</strong>: Non group quarter housing units, defined by filtering housing units to those where <code>GQ</code>, is 1 or 2 <span class="citation" data-cites="bloem_matching_2018">(<a href="#ref-bloem_matching_2018" role="doc-biblioref">Bloem 2018</a>)</span>. The <a href="https://usa.ipums.org/usa-action/variables/GQ#comparability_section">comparability section</a> of the <code>GQ</code> variable documentation explains this choice in greater detail, but in short it represents non-institutional housing-units where 9 or fewer people unrelated to the head-of-household reside.</li>
</ul></li>
</ul>
<p>We can group/filter by these variable combinations and see how many individuals, housing units, and households were surveyed across PUMAs in Oakland for the 2022 1-year ACS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_housing_units =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(oak <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(GQ <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarise</span>(<span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(PUMA))</span></code></pre></div>
<div id="tbl-granularity" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Oakland Dataset Granularity by PUMA
</figcaption>
<div aria-describedby="tbl-granularity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">n_rows</th>
<th style="text-align: right;">n_individuals</th>
<th style="text-align: right;">n_housing_units</th>
<th style="text-align: right;">n_households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">111</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">578</td>
<td style="text-align: right;">539</td>
</tr>
<tr class="even">
<td style="text-align: right;">112</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">1152</td>
<td style="text-align: right;">547</td>
<td style="text-align: right;">517</td>
</tr>
<tr class="odd">
<td style="text-align: right;">113</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">385</td>
<td style="text-align: right;">337</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">905</td>
<td style="text-align: right;">389</td>
<td style="text-align: right;">354</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>We see that each row in the data represents an individual (<code>n_rows</code> equals <code>n_individuals</code>) and, as we would expect, the number of housing units and households are successively lower than the number of individuals.</p>
<section id="households-group-quarters-and-institutions" class="level3">
<h3 class="anchored" data-anchor-id="households-group-quarters-and-institutions">Households, group quarters, and institutions</h3>
<p>So, given that our motivating question concerns household income, we can apply the following filtering, per <span class="citation" data-cites="bloem_matching_2018">(<a href="#ref-bloem_matching_2018" role="doc-biblioref">Bloem 2018</a>)</span>, and isolate just the heads of all the households in Oakland.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    PERNUM <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    GQ <span class="sc">&lt;=</span> <span class="dv">2</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<p>But to build a little intuition around that selection, let’s also look at what different housing units look like, and <em>why</em> the household definition is restrictive.</p>
<section id="a-household" class="level4">
<h4 class="anchored" data-anchor-id="a-household">A household</h4>
<p>I’ll randomly select a household in the data to see what such a unit looks like in practice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>sample_household_true <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT))</span></code></pre></div>
</details>
<div id="tbl-example-hh" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8: An example household with income data
</figcaption>
<div aria-describedby="tbl-example-hh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">196265</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">104500</td>
</tr>
<tr class="even">
<td style="text-align: right;">196265</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">60000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">196265</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="even">
<td style="text-align: right;">196265</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">9999999</td>
</tr>
<tr class="odd">
<td style="text-align: right;">196265</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">20000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>This household, with <code>SERIAL</code> 196265 has 5 members, each with a unique <code>PERNUM</code>. To identify household members’ relationship to the head-of-household, <a href="https://usa.ipums.org/usa-action/variables/RELATE#codes_section">we reference <code>RELATE</code></a>. The first row, where <code>RELATE==1</code> denotes a 41 year old female (<code>SEX==2</code>) head-of-household. The second, where <code>RELATE==2</code> denotes their spouse, in this case a 40 year old male. This couple has two children (<code>RELATE==3</code>) and the husband’s mother (<code>RELATE==6</code>), also living in the household.</p>
</section>
<section id="non-institutional-group-quarters" class="level4">
<h4 class="anchored" data-anchor-id="non-institutional-group-quarters">Non-institutional group-quarters</h4>
<p>We can contrast that fairly “nuclear family” household with a non-institutional group-quarters housing unit in Oakland:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">==</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>sampled_data <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SERIAL, PUMA, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>sampled_data</span></code></pre></div>
</details>
<div id="tbl-example-gq" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-gq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9: An example group quarters unit with income data
</figcaption>
<div aria-describedby="tbl-example-gq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">125000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">35000</td>
</tr>
<tr class="even">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">60000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">35000</td>
</tr>
<tr class="even">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">21000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">80000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">80800</td>
</tr>
<tr class="even">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">38000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165880</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">474800</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>We see that there is a head-of-household, a 26 year old male, but all 10 other housing unit members are “partners, friends, [or] visitors” (<code>RELATE==11</code>). These are largely adults with earnings, so this group quarters unit would have a very high “household income” and bias the estimated median income up were it included for that calculation.</p>
</section>
<section id="institutional-housing-units" class="level4">
<h4 class="anchored" data-anchor-id="institutional-housing-units">Institutional housing units</h4>
<p>Group quarters also include institutional housing units, such as correctional facilities.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sampled_data <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SERIAL, PUMA, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>sampled_data</span></code></pre></div>
</details>
<div id="tbl-example-ih" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-ih-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10: An example institutional housing unit with income data
</figcaption>
<div aria-describedby="tbl-example-ih-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">SERIAL</th>
<th style="text-align: right;">PUMA</th>
<th style="text-align: right;">GQ</th>
<th style="text-align: right;">PERNUM</th>
<th style="text-align: right;">RELATE</th>
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">75131</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>This housing unit only includes one member, an 86 year old woman who is an “institutional inmate” (<code>RELATE==13</code>) with no income. This unit would likely bias median household income down, were it included.</p>
</section>
</section>
<section id="household-income-in-the-acs" class="level3">
<h3 class="anchored" data-anchor-id="household-income-in-the-acs">Household Income in the ACS</h3>
<p>Let’s return to the motivating question:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Motivating Question
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What was the median household income in Oakland, California in 2022?</strong></p>
</div>
</div>
<p>Note the income variables we observe for this family:</p>
<ol type="1">
<li><p><code>INCTOT</code> reports each respondent’s total pre-tax personal income or losses from all sources for the previous year. <code>9999999</code> is code to denote that the value is missing, which makes sense given that the missing values above correspond to children in the household <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/INCTOT" role="doc-biblioref">INCTOT</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p></li>
<li><p><code>HHINCOME</code> reports the total money income of all household members age 15+ during the previous year. The amount should equal the sum of all household members’ individual incomes, as recorded in the person-record variable INCTOT <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa-action/variables/HHINCOME" role="doc-biblioref">HHINCOME</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span></p></li>
</ol>
<p>Given what we know about the unique identifier for households, and the <code>HHINCOME</code> variable, we can construct the appropriate dataset for answering our motivating question – every household in Oakland that had household income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> households <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<p>It seems we can proceed to simply calculate the median of the <code>HHINCOME</code> column? Not so fast… Data in the ACS microdata are not what they seem. Before we do any analysis, we have to account for <strong>sample weights</strong>.</p>
</section>
</section>
<section id="sec-step-4" class="level2">
<h2 class="anchored" data-anchor-id="sec-step-4">Step 4: Applying sample weights</h2>
<p>Let’s return to our sample family from above, but also examine the variables <code>PERWT</code> and <code>HHWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span></code></pre></div>
<div id="tbl-example-hh-weights" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-hh-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;11: An example household with weight data
</figcaption>
<div aria-describedby="tbl-example-hh-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">AGE</th>
<th style="text-align: right;">SEX</th>
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">INCTOT</th>
<th style="text-align: right;">PERWT</th>
<th style="text-align: right;">HHWT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">104500</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">60000</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">9999999</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="odd">
<td style="text-align: right;">65</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">184500</td>
<td style="text-align: right;">20000</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">51</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>These are the two primary sample weights in ACS microdata, and they can be interpreted fairly directly.</p>
<ul>
<li><code>PERWT</code> gives the population represented by each individual in the sample, thus in the first row of the sample household, the 41 year old woman with an individual income of $104,500 represents 51 individuals in the PUMA.</li>
<li><code>HHWT</code> gives the number of households in the general population represented by each household in the sample, thus this household is representative of 51 households in that PUMA.</li>
</ul>
<p>Any analysis or visualization of ACS microdata should be weighted by <code>PERWT</code> for work at the person-level, and <code>HHWT</code> for the household-level <span class="citation" data-cites="ruggles_ipums_2024">(See <a href="https://usa.ipums.org/usa/intro.shtml#weights" role="doc-biblioref">Sample Weights</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p>
<p>For visualizations, we pass the weights to the plotting API. For example, in <code>ggplot</code> many chart types support a <code>weight</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(households_w_income, <span class="fu">aes</span>(<span class="at">x =</span> HHINCOME, <span class="at">weight =</span> HHWT)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">50000</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_currency</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1600000</span>, <span class="dv">200000</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Household Income"</span>, <span class="at">y =</span> <span class="st">"Number of Households"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Household Income Distribution in Oakland (with household weights)</figcaption>
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For analysis, we use the <a href="http://gdfe.co/srvyr/reference/index.html"><code>srvyr</code></a> package to define the survey weights before using them to calculate statistics. For example, here we’ll finally address the motivating question.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Motivating Question
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What was the median household income in Oakland, California in 2022?</strong></p>
</div>
</div>
<p>The answer, as measured in the IPUMS microdata is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span></code></pre></div>
<div id="tbl-answer" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-answer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12: 2022 Median Household Income in Oakland, CA
</figcaption>
<div aria-describedby="tbl-answer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_median</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">89000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s do a quick comparison of our IPUMS results to the aggregate census data we retrieved in the first section. Here are our full IPUMS results for both median household income and population:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"median_hh_income"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"total_pop"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>aggregate_data <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ACS_aggregate_estimate =</span> estimate)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table) <span class="sc">%&gt;%</span> </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate)) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(aggregate_data, <span class="at">by=</span><span class="st">'variable'</span>)</span></code></pre></div>
</details>
<div id="tbl-ipums-res" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ipums-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13: IPUMS versus ACS aggregate results
</figcaption>
<div aria-describedby="tbl-ipums-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">ipums_estimate</th>
<th style="text-align: right;">ACS_aggregate_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">total_pop</td>
<td style="text-align: right;">430052</td>
<td style="text-align: right;">426323</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_hh_income</td>
<td style="text-align: right;">89000</td>
<td style="text-align: right;">93146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>These are clearly different. What gives? Unfortunately, <strong>summary statistics calculated using IPUMS data typically cannot match aggregate ACS figures!</strong></p>
<p>One major reason for this gap is additional sampling error. Recall that the American Community Survey is a sample. A given one-year ACS is typically a 1% sample of the U.S. population, with associated sampling error. When the census makes microdata available, they create a sample of that sample – we do not get the full 1%. This second sampling process introduces further sampling error in the microdata that is not reflected in figures sourced from aggregate ACS data, which are calculated using the full ACS sample <span class="citation" data-cites="ruggles_ipums_2024">(<a href="https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS" role="doc-biblioref">See ACS</a> in <a href="#ref-ruggles_ipums_2024" role="doc-biblioref">Ruggles et al. 2024</a>)</span>.</p>
</section>
<section id="sec-step-5" class="level2">
<h2 class="anchored" data-anchor-id="sec-step-5">Step 5: Calculating standard errors</h2>
<p>Now we have estimates derived from the ACS microdata, but how do we communicate uncertainty around those estimates? For the sake of this example, let’s explore the problem of standard errors via a slightly different motivating question – <strong>what was the average household income in Oakland in 2022</strong>?</p>
<p>I’m switching to the average because we are about to calculate some standard errors from-scratch, and that’s much more clear-cut for linear statistics like the average than for non-linear statistics like the median. We will return to the median at the end of this section, but rely on a package implementation and not do anything from-scratch.</p>
<p>Anyways, let’s calculate the average household income in Oakland using the sample household weights. The <a href="https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Mathematical_definition">formula for the weighted average</a> is: <span class="math display">\[
\bar{X}_w = \frac{\sum_{i=1}^{n}w_ix_i}{\sum_{i=1}^{n}w_i}
\]</span> We’ll put that into code and get the following estimate of the average household income in Oakland:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>weighted_mean <span class="ot">&lt;-</span> (</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHINCOME <span class="sc">*</span> households_w_income<span class="sc">$</span>HHWT)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">/</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>weighted_mean</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 140889.1</code></pre>
</div>
</div>
<p>Now, let’s get a standard error for that estimate. Correctly utilizing the sample weights in the variance calculation is <a href="https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Variance">a little tricky</a> and there are a few different approaches to the problem. I’ll cover two techniques for variance estimation: the Taylor series method (also referred to as “linearized variance” or Taylor series linearization) and replication weights. Each of these are implemented in the <code>survey</code> package <span class="citation" data-cites="lumley_analysis_2004">(<a href="#ref-lumley_analysis_2004" role="doc-biblioref">Lumley 2004</a>)</span>.</p>
<section id="the-taylor-series-method" class="level3">
<h3 class="anchored" data-anchor-id="the-taylor-series-method">The Taylor series method</h3>
<p>Most packages (e.g. <a href="https://documentation.sas.com/doc/en/statug/latest/statug_surveymeans_details06.htm#statug.surveymeans.variancedetails">SAS</a>, <a href="https://www.stata.com/manuals/svyvarianceestimation.pdf">Stata</a>, and R’s <a href="https://r-survey.r-forge.r-project.org/survey/#:~:text=Variances%20by%20Taylor%20linearization"><code>survey</code> package</a>) default to using the Taylor series method for variance estimation of weighted statistics. This is because weighted statistics, like the average above, are not linear with respect to the weights, making analytical calculation of the variance difficult or else undefined <span class="citation" data-cites="lohr_sampling_2021">(<a href="#ref-lohr_sampling_2021" role="doc-biblioref">Lohr 2021</a>)</span>. The Taylor series method entails calculating the first-order linear approximation of the statistic (e.g.&nbsp;the linear approximation of the weighted mean formula above), then finding the variance of that approximation. The details of those calculations are beyond the scope of this post, but <span class="citation" data-cites="lohr_sampling_2021">(<a href="#ref-lohr_sampling_2021" role="doc-biblioref">Lohr 2021</a>, chap 9.1)</span> covers the process in detail, and Wikipedia has a nice <a href="https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Variance_of_the_weighted_mean_(%CF%80-estimator_for_ratio-mean)">walkthrough</a> as well. We will just work with the formula for linearized variance that is arrived at in the Wikipedia post:</p>
<p><span class="math display">\[
\hat{\text{Var}}(\bar{X}_w) = \frac{\sum w_i^2 (x_i - \bar{X}_w)^2}{\left(\sum w_i\right)^2}
\]</span> The standard error is just the square root of that variance.<br>
<span class="math display">\[
\hat{\text{SE}}(\bar{X}_w) = \sqrt{\hat{\text{Var}}(\bar{X}_w)}
\]</span> We’ll code that up in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>numerator <span class="ot">&lt;-</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (households_w_income<span class="sc">$</span>HHINCOME <span class="sc">-</span> weighted_mean)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>denominator <span class="ot">&lt;-</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>variance <span class="ot">&lt;-</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(variance)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>se</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4141.197</code></pre>
</div>
</div>
<p>That result is a usable estimate for the standard error of the average household income in Oakland. Of course in practice we would always use a package, in this case <code>survey</code>, for calculating that. Here I’ll calculate the average household income in Oakland using <code>survey</code>, and it will default to returning a standard error via the Taylor series method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div id="tbl-wrong-se" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wrong-se-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14: Taylor Series Method Standard Error
</figcaption>
<div aria-describedby="tbl-wrong-se-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">140889.1</td>
<td style="text-align: right;">4142.384</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>This standard error is off from ours by about $1, which could be due to other corrections applied in the package’s variance calculation. We needn’t be too worried about this discrepancy, though. While the Taylor series method is popular in survey analysis, <a href="https://usa.ipums.org/usa/repwt.shtml">IPUMS recommends</a> that we use the replication weights method when working with ACS microdata.</p>
</section>
<section id="replication-weights" class="level3">
<h3 class="anchored" data-anchor-id="replication-weights">Replication weights</h3>
<p>In theory, the <a href="https://en.wikipedia.org/wiki/Standard_error">standard error</a> of an estimate measures the variation of a statistic across multiple samples from a given population. Our sample standard error above, calculated using just the one sample, is an estimate of that theoretical standard error.</p>
<p>Replicate methods operate under the assumption that one sample can be conceived of as a miniature version of the population. Instead of taking multiple samples from the population to construct a variance estimator, one may simply resample from the full, original sample to mimic the theoretical basis of standard errors <span class="citation" data-cites="lohr_sampling_2021">(<a href="#ref-lohr_sampling_2021" role="doc-biblioref">Lohr 2021</a>, chap 9.1)</span>.</p>
<p>In practice, we don’t explicitly do any resampling, instead relying on “replicate weights” that the census pre-computes. Here we can see what replicate weights (in this case, household replicate weights) look like in our data. Each of <code>REPWT</code>, 1 through 80, is a set of alternative household weights, slightly different from the “production weight,” <code>HHWT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(HHINCOME, HHWT, REPWT1, REPWT2, <span class="st">`</span><span class="at"> </span><span class="st">`</span>, REPWT79, REPWT80)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<div id="tbl-rep-weights" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rep-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;15: ACS Replicate Household Weights
</figcaption>
<div aria-describedby="tbl-rep-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">HHINCOME</th>
<th style="text-align: right;">HHWT</th>
<th style="text-align: right;">REPWT1</th>
<th style="text-align: right;">REPWT2</th>
<th style="text-align: left;"></th>
<th style="text-align: right;">REPWT79</th>
<th style="text-align: right;">REPWT80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">129200</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: right;">107000</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: right;">138000</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">85</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="even">
<td style="text-align: right;">44800</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">43</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: right;">380000</td>
<td style="text-align: right;">311</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">86</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">323</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="even">
<td style="text-align: right;">189150</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">…</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">122</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>We can use replicate weights in a variety of alternative variance estimates. In the IPUMS documentation on ACS replicate weights, they outline a <a href="https://usa.ipums.org/usa/repwt.shtml#:~:text=can%20change%20substantially.-,HOW%20DO%20I%20OBTAIN%20REPLICATE%20STANDARD%20ERRORS%20FROM%20IPUMS%2DUSA%20DATA%3F,-There%20are%203">variance estimation procedure</a> that matches the “successive difference replication (SDR) variance” method. We obtain SDR variance by calculating our statistic of interest with the production weights (e.g.&nbsp;<code>HHWT</code>) as follows:<br>
<span class="math display">\[
\bar{X}_w = \frac{\sum_{i=1}^{n}\text{HHWT}_ix_i}{\sum_{i=1}^{n}\text{HHWT}_i}
\]</span></p>
<p>Then, for each of the 80 household replicate weights (e.g.&nbsp;<code>REPWT1</code>), we calculate the weighted average income using the replicate weight<br>
<span class="math display">\[
\bar{X}_r = \frac{\sum_{i=1}^{n}\text{REPWT}_{ri}x_i}{\sum_{i=1}^{n}\text{REPWT}_{ri}}
\]</span> and sum the squared deviations between that “replicate-weighted” estimate, <span class="math inline">\(\bar{X}_r\)</span>, and the production weighted estimate. Specifically: <span class="math display">\[
\begin{align*}
\hat{\text{Var}}(\bar{X}_w) &amp;= \frac{4}{80} \sum_{r=1}^{80} (\bar{X}_r - \bar{X}_w)^2
\end{align*}
\]</span></p>
<p><span class="citation" data-cites="fay_aspects_1995">(<a href="#ref-fay_aspects_1995" role="doc-biblioref">Fay and Train 1995</a>)</span> initially proposed that variance estimator and <a href="https://www.census.gov/content/dam/Census/library/working-papers/1995/demo/faytrain95.pdf">their paper</a> gives the full derivation. The standard error is once again just the square root of that variance.</p>
<p><span class="math display">\[
\hat{\text{SE}}(\bar{X}_w) = \sqrt{\hat{\text{Var}}(\bar{X}_w)}
\]</span> In code, calculated via a for-loop, we’d get the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWT"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3432.032</code></pre>
</div>
</div>
<p>To be clear, we don’t do that manually in practice – <code>survey</code> supports specifying survey designs with replicate weights. The following is an implementation of the same standard error calculation procedure. Note the identical output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">140889.1</td>
<td style="text-align: right;">3432.032</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are a few different replicate methods for variance estimation, several of which are equivalent. For example, the successive-difference standard error above is equivalent to using <a href="https://documentation.sas.com/doc/en/statug/15.2/statug_surveyphreg_details29.htm">Fay’s Balanced Repeated Replication method</a> with the Faye coefficient set to <span class="math inline">\(\epsilon=.5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Fay"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho=</span>.<span class="dv">5</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">140889.1</td>
<td style="text-align: right;">3432.032</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>IPUMS’ documentation <a href="https://usa.ipums.org/usa/repwt.shtml">recommends</a> the following specification, where the replicate method is set to “ACS.” This has the same output as the previous two specifications, and is presumably implementing SDR variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">weighted_mean</th>
<th style="text-align: right;">weighted_mean_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">140889.1</td>
<td style="text-align: right;">3432.032</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now that we have the methods established, we’ll return to the median, rather than the mean, household income. Some of the above formulas would be different for the median, but the code and package implementations are the same. Here we will calculate the median household income in Oakland, and the standard error for that statistic using three methods:</p>
<ol type="1">
<li>ACS aggregate data retrieval</li>
<li>Estimation via IPUMS microdata with Taylor series variance/standard error</li>
<li>Estimation via IPUMS microdata with replicate weight variance/standard error</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> moe<span class="sc">/</span><span class="fl">1.645</span>, <span class="at">Method =</span> <span class="st">'Aggregate Data'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">'median_hh_income'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, estimate, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> estimate)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Weighted Median HH Income_se</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">'Microdata w/ Taylor Series Method'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, <span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span>, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Weighted Median HH Income_se</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">'Microdata w/ Replicate Weights'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, <span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span>, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>))</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>combined_df</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 45%">
<col style="width: 34%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">Weighted Median HH Income</th>
<th style="text-align: right;">Standard Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Aggregate Data</td>
<td style="text-align: right;">93146</td>
<td style="text-align: right;">3788.450</td>
</tr>
<tr class="even">
<td style="text-align: left;">Microdata w/ Taylor Series Method</td>
<td style="text-align: right;">89000</td>
<td style="text-align: right;">4354.199</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Microdata w/ Replicate Weights</td>
<td style="text-align: right;">89000</td>
<td style="text-align: right;">3793.112</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In IPUMS testing of ACS/PRCS data, replicate weights usually increase standard errors, though in our case the replicate weights produced a slightly smaller standard error than the Taylor series method.</p>
</section>
</section>
<section id="a-production-workflow" class="level2">
<h2 class="anchored" data-anchor-id="a-production-workflow">A Production Workflow</h2>
<p>Putting all of this post together, here is production code that I would use to build a dataset for analyzing household-level variables in Oakland, leaning on the IPUMS and geocorr helper functions I defined above, and specifying replicate weights and “ACS” variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the IPUMS data for California</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">ipums_data</span>(<span class="st">"us2022a"</span>, variables, <span class="st">"Incomes by PUMA"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the geographic correspondence for places -&gt; pumas</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># isolate pumas that correspond to oakland and have oak population</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>oak_pumas <span class="ot">&lt;-</span> csv_data <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>, afact <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(puma22) <span class="sc">%&gt;%</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the IPUMS data to those pumas</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>oak_hh_w_inc <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oak_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the IPUMS data to a survey dataset</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>oak_hh_inc_svy <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> HHWT,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">mse =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<p>And here is the median household income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>oak_hh_inc_svy <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_hh_inc =</span> <span class="fu">survey_median</span>(HHINCOME))</span></code></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">median_hh_inc</th>
<th style="text-align: right;">median_hh_inc_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">89000</td>
<td style="text-align: right;">3793.112</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'reticulate' was built under R version 4.3.3</code></pre>
</div>
</div>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bloem_matching_2018" class="csl-entry" role="listitem">
Bloem, Jeff. 2018. <span>“Matching <span>ACS</span> Median Household Income?”</span> <em>IPUMS Forum</em>. <a href="https://forum.ipums.org/t/matching-acs-median-household-income/2099">https://forum.ipums.org/t/matching-acs-median-household-income/2099</a>.
</div>
<div id="ref-fay_aspects_1995" class="csl-entry" role="listitem">
Fay, Robert E, and George F Train. 1995. <span>“Aspects of <span>Survey</span> and <span>Model</span>-<span>Based</span> <span>Postcensal</span> <span>Estimation</span> of <span>Income</span> and <span>Poverty</span> <span>Characteristics</span> for <span>States</span> and <span>Counties</span>.”</span> In, 154–59. Alexandria, VA.
</div>
<div id="ref-greg_freedman_ellis_ipumsr_2024" class="csl-entry" role="listitem">
Greg Freedman Ellis, Derek Burk, and Finn Roberts. 2024. <span>“Ipumsr: <span>An</span> <span>R</span> <span>Interface</span> for <span>Downloading</span>, <span>Reading</span>, and <span>Handling</span> <span>IPUMS</span> <span>Data</span>.”</span> <a href="https://tech.popdata.org/ipumsr/">https://tech.popdata.org/ipumsr/</a>.
</div>
<div id="ref-lohr_sampling_2021" class="csl-entry" role="listitem">
Lohr, Sharon L. 2021. <em>Sampling: <span>Design</span> and <span>Analysis</span></em>. 3rd edition. Boca Raton: Chapman; Hall/CRC.
</div>
<div id="ref-lumley_analysis_2004" class="csl-entry" role="listitem">
Lumley, Thomas. 2004. <span>“Analysis of <span>Complex</span> <span>Survey</span> <span>Samples</span>.”</span> <em>Journal of Statistical Software</em> 9 (April): 1–19. <a href="https://doi.org/10.18637/jss.v009.i08">https://doi.org/10.18637/jss.v009.i08</a>.
</div>
<div id="ref-mihalik_missouri_2022" class="csl-entry" role="listitem">
Mihalik, Cory, Glenn Rice, and Matt Hesser. 2022. <span>“The <span>Missouri</span> <span>Census</span> <span>Data</span> <span>Center</span> (<span>MCDC</span>) 2022 <span>Geographic</span> <span>Correspondence</span> <span>Engine</span> (<span>GEOCORR</span>).”</span> <a href="https://mcdc.missouri.edu/applications/geocorr.html">https://mcdc.missouri.edu/applications/geocorr.html</a>.
</div>
<div id="ref-pastoor_how_2024" class="csl-entry" role="listitem">
Pastoor, Isabel. 2024. <span>“How Can <span>I</span> Pull Data at the Zip Code or City Level?”</span> <em>IPUMS Forum</em>. <a href="https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2">https://forum.ipums.org/t/how-can-i-pull-data-at-the-zip-code-or-city-level/5650/2</a>.
</div>
<div id="ref-ruggles_ipums_2024" class="csl-entry" role="listitem">
Ruggles, Steven, Sarah Flood, Matthew Sobek, Daniel Backman, Annie Chen, Grace Cooper, Stephanie Richards, Renae Rogers, and Megan Schouweiler. 2024. <span>“<span>IPUMS</span> <span>USA</span>: <span>Version</span> 15.0.”</span> Minneapolis, MN: IPUMS. <a href="https://doi.org/10.18128/D010.V15.0">https://doi.org/10.18128/D010.V15.0</a>.
</div>
<div id="ref-walker_analyzing_2023" class="csl-entry" role="listitem">
Walker, Kyle. 2023. <em>Analyzing <span>US</span> <span>Census</span> <span>Data</span></em>. 1st edition. Boca Raton: Chapman; Hall/CRC.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I want to note that several of the points I cover here are things I learned from some coworkers– <a href="https://www.bwilden.com/">Bert Wilden</a> and Stephanie Peng.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For an informal analysis, I might just use a web-based tool like <a href="https://censusreporter.org/">Census Reporter</a> to quickly look something up.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See the <a href="https://api.census.gov/data/2022/acs/acs1/variables.html">full variable list for the 2022 1-year ACS</a> for the available variables, and see the <a href="https://www.census.gov/library/reference/code-lists/ansi.html#place">Census Place table</a> for looking up GEOIDs<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I’ll to note that the combination of IPUMS and Geocorr is a fantastic public good, and it’s extremely generous of the public Universities of Minnesota and Missouri to publish these.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Were the AFACT higher, e.g.&nbsp;1%, I could randomly sample 1% of the individuals from that PUMA and include them in my Oakland sample.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{amerkhanian2025,
  author = {Amerkhanian, Peter},
  title = {Working with {ACS} Microdata in {R}},
  date = {2025-02-20},
  url = {https://peter-amerkhanian.com/posts/ipums-wth-r/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-amerkhanian2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Amerkhanian, Peter. 2025. <span>“Working with ACS Microdata in
R.”</span> February 20, 2025. <a href="https://peter-amerkhanian.com/posts/ipums-wth-r/">https://peter-amerkhanian.com/posts/ipums-wth-r/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/peter-amerkhanian\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb42" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Working with ACS microdata in R"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../blog.bib"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Peter Amerkhanian"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-02-20"</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Using `ipumsr`, geocorr, and `survey` to analyze a small-geography in IPUMS data."</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> thumbnail.png</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ['R', 'Data Management']</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Statistics</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>               modelsummary,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>               srvyr,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>               survey,</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Webscraping</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>               httr,</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>               rvest,</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>               readr,</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>               glue,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Census</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>               tidycensus,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>               ipumsr,</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>               <span class="co"># XML Parsing</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>               xml2,</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>               purrr,</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>               stringr)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>The following are my notes on how to use American Community Survey (ACS)</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>microdata, leveraging the University of Minnesota's Integrated Public</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>Use Microdata Series (IPUMS).<span class="ot">[^1]</span> I cover:</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>I want to note that several of the points I cover here are things</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    I learned from some coworkers-- [Bert</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>    Wilden](https://www.bwilden.com/) and Stephanie Peng.</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Retrieval**: how to choose which ACS product is relevant, how to</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>    submit a request to IPUMS, and how to filter down to relevant levels</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>    of geography/granularity.</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Analysis**: how to properly weight ACS data using sample and</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>    replication weights for accurate analysis and uncertainty</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>    estimation.</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>I'll start with a motivating question:  </span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivating Question</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>**What was the median household</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>income in Oakland, California in 2022?**  </span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregate data with `tidycensus`</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>Answering that question is straightforward using the Census' *aggregate*</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>data -- pre-calculated descriptive statistics for aggregate geographies.</span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>I typically retrieve aggregate data via the [Census</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>API](https://www.census.gov/programs-surveys/acs/data/data-via-api.html).<span class="ot">[^2]</span></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>In R, the <span class="in">`tidycensus`</span> package provides an easy-to-use wrapper for that</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>API. Note that I set up an API key for the U.S. Census and I'm storing</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>it in my <span class="in">`.Renviron`</span> file as <span class="in">`census_api_key="yourkeyhere"`</span>.</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>For an informal analysis, I might just use a web-based tool like</span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">Census Reporter</span><span class="co">](https://censusreporter.org/)</span> to quickly look</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>    something up.</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>))</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>I query <span class="in">`B19013_001`</span>, the median household income variable, using the</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>2022 1-year American Community Survey sample and I filter down to</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>Oakland's GEOID, <span class="in">`0653000`</span>, which is a combination of the state code for</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>California, <span class="in">`06`</span>, and the place code for Oakland, <span class="in">`53000`</span>.<span class="ot">[^3]</span> I'll</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>throw in the total population variable for good measure:</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span>See the [full variable list for the 2022 1-year</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>    ACS](https://api.census.gov/data/2022/acs/acs1/variables.html) for</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>    the available variables, and see the [Census Place</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>    table](https://www.census.gov/library/reference/code-lists/ansi.html#place)</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>    for looking up GEOIDs</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-agg-data</span></span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Total Population and Median Household Income in Oakand, CA via Aggregate Data"</span></span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"place"</span>,</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_hh_income =</span> <span class="st">"B19013_001"</span>,</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="st">"B17001_001"</span></span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"CA"</span>,</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span></span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">'0653000'</span>)</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>oakland_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate, moe))</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>Done! We now know the population and median household income for Oakland</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>in 2022, along with a margin of error. See <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span> for</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>a comprehensive treatment of working with aggregate census data.</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Microdata with IPUMS/`ipumsr`</span></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>What if I wanted to have access to the underlying data used to calculate</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>the median? Maybe I want to try a different standard error specification</span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>for that statistic, or calculate other statistics, like the average</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>household income. These tasks would all entail accessing census</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>*microdata* -- household and/or individual level census data.</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>One of the most popular sources for downloading census microdata is the</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>University of Minnesota's Integrated Public Use Microdata Series</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>(IPUMS). The IPUMS team provides a centralized API for downloading</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>census microdata, comprehensive documentation for working with the data,</span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a>and harmonized variables across time [@walker_analyzing_2023, chapter</span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>9].</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>The easiest way to access IPUMS data in R is with the</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`ipumsr`</span><span class="co">](https://tech.popdata.org/ipumsr/)</span> package, which the IPUMS</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>team maintains and which allows users to submit API requests to IPUMS</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>directly from R <span class="co">[</span><span class="ot">@greg_freedman_ellis_ipumsr_2024</span><span class="co">]</span> . To get set up, I</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>[registered for an IPUMS API</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>key](https://developer.ipums.org/docs/v2/get-started/), stored the key</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>in my <span class="in">`.Renviron`</span> file, and will configure the key in <span class="in">`ipumsr`</span> as</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>follows:</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a><span class="fu">set_ipums_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">"ipums_api_key"</span>))</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ipumsr`</span> website [provides</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a>details](https://tech.popdata.org/ipumsr/articles/ipums.html#obtaining-data-via-the-ipums-api)</span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>on what survey products the project currently supports, as does the</span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a><span class="in">`ipums_data_collections()`</span> function:</span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-ipums-available</span></span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "IPUMS API Collections"</span></span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a><span class="fu">ipums_data_collections</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(api_support <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(collection_type))</span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>I'll look at IPUMS USA since my motivating question involves median</span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>household income for a year (2022), and IPUMS USA offers annual data</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>from decennial censuses 1790-2010 and American Community Surveys (ACS)</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>2000-present <span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span>. We can check out the newest products</span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>they have in the USA collection as follows:</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-acs-datasets</span></span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "IPUMS USA Products"</span></span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a><span class="fu">get_sample_info</span>(<span class="at">collection=</span><span class="st">"usa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>Note that "PRCS" refers to the Puerto Rico Community Survey (an ACS</span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>equivalent specifically tailored to Puerto Rico). We are principally</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>interested in the ACS, which comes in either one-year (e.g. 2023 ACS) or</span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a>five-year (e.g. 2018-2022, ACS 5-year) estimates. The differences</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>between these two estimates are described in detail in [Census Data: An</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>Overview](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-data-an-overview)</span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>in <span class="co">[</span><span class="ot">@walker_analyzing_2023</span><span class="co">]</span>. One differentiating point is that one-year</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>estimates come from a smaller, but more contemporary sample. In our case</span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a>we'll use the one-year to get the best sense of the 2022 income</span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a>dynamics.</span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question for this post:  </span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivating Question</span></span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>**What was the median household</span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>income in Oakland, California in 2022?**  </span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a>To answer that we will:</span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Get income data from the 2022 1-year ACS (@sec-step-1).</span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Filter our data down to households in the city of Oakland</span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a>    (@sec-step-2 and @sec-step-3).</span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Calculate the median (@sec-step-4 and @sec-step-5).</span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Retrieving data {#sec-step-1}</span></span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a>For the first task, I'll define several helper functions:</span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`retrieve_sample()`</span> retrieves a list of variables from a given ACS</span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a>    sample from the IPUMS API. This is the only truly necessary code.</span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`check_description()`</span> and <span class="in">`ipums_data()`</span> are functions for checking</span>
<span id="cb42-227"><a href="#cb42-227" aria-hidden="true" tabindex="-1"></a>    if the target extract already exists locally. Retrieving an extract</span>
<span id="cb42-228"><a href="#cb42-228" aria-hidden="true" tabindex="-1"></a>    can take some time, and I'd like to avoid doing it repeatedly when</span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a>    I've already downloaded the extract in the past.</span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a>Each of these are defined in the following folded code block.</span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-236"><a href="#cb42-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-237"><a href="#cb42-237" aria-hidden="true" tabindex="-1"></a>retrieve_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables, description) {</span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="fu">define_extract_micro</span>(</span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> description,</span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"usa"</span>,</span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">c</span>(sample),</span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> variables</span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> extract <span class="sc">%&gt;%</span></span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">submit_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wait_for_extract</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_extract</span>(<span class="at">download_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>),</span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(data_path)</span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a>check_description <span class="ot">&lt;-</span> <span class="cf">function</span>(file, description) {</span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a>  xml_text <span class="ot">&lt;-</span> <span class="fu">readLines</span>(file, <span class="at">warn =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a>  user_description <span class="ot">&lt;-</span> <span class="fu">str_match</span>(xml_text, <span class="st">"User-provided description:</span><span class="sc">\\</span><span class="st">s*(.*)]]"</span>)[, <span class="dv">2</span>]</span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if it matches the target</span></span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(user_description, <span class="fu">fixed</span>(description, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) {</span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(file)</span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a>ipums_data <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, variables, description) {</span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a>  local_ipums_extracts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb42-266"><a href="#cb42-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>),</span>
<span id="cb42-267"><a href="#cb42-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xml$"</span>,</span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a>  matching_files <span class="ot">&lt;-</span> <span class="fu">compact</span>(<span class="fu">map</span>(local_ipums_extracts, \(x) <span class="fu">check_description</span>(x, description)))</span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there is a match, open the first matching file</span></span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(matching_files) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a>    matched_file <span class="ot">&lt;-</span> matching_files[[<span class="dv">1</span>]]</span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Opening: "</span>, matched_file)</span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(matched_file)</span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No matching dataset found."</span>)</span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">retrieve_sample</span>(sample, variables, description)</span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-280"><a href="#cb42-280" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-281"><a href="#cb42-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a>I'll proceed to define a list of variables that I want, including</span>
<span id="cb42-284"><a href="#cb42-284" aria-hidden="true" tabindex="-1"></a><span class="in">`HHINCOME`</span> (household income) and <span class="in">`INCTOT`</span> (individual income). Some of</span>
<span id="cb42-285"><a href="#cb42-285" aria-hidden="true" tabindex="-1"></a>these variables refer to census-specific language – i.e. <span class="in">`PUMA`</span> ,</span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a><span class="in">`REPWT`</span> , <span class="in">`REPWTP`</span>. I'll cover exactly what each of these represent</span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a>later in the post, but in the meantime I'll also note that the IPUMS</span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a>website has [full reference</span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a>materials](https://usa.ipums.org/usa-action/variables/group) for all</span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a>available variables.</span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-294"><a href="#cb42-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-295"><a href="#cb42-295" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb42-296"><a href="#cb42-296" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUMA"</span>,</span>
<span id="cb42-297"><a href="#cb42-297" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,</span>
<span id="cb42-298"><a href="#cb42-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,</span>
<span id="cb42-299"><a href="#cb42-299" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUC"</span>,</span>
<span id="cb42-300"><a href="#cb42-300" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HHINCOME"</span>,</span>
<span id="cb42-301"><a href="#cb42-301" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INCTOT"</span>,</span>
<span id="cb42-302"><a href="#cb42-302" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWT"</span>,</span>
<span id="cb42-303"><a href="#cb42-303" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REPWTP"</span>,</span>
<span id="cb42-304"><a href="#cb42-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_spec</span>(<span class="st">"STATEFIP"</span>,</span>
<span id="cb42-305"><a href="#cb42-305" aria-hidden="true" tabindex="-1"></a>           <span class="at">case_selections =</span> <span class="st">"06"</span>)</span>
<span id="cb42-306"><a href="#cb42-306" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-307"><a href="#cb42-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-308"><a href="#cb42-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-309"><a href="#cb42-309" aria-hidden="true" tabindex="-1"></a>Note the line, <span class="in">`var_spec("STATEFIP", case_selections = "06")`</span>. This</span>
<span id="cb42-310"><a href="#cb42-310" aria-hidden="true" tabindex="-1"></a>selects the variable <span class="in">`STATEFIP`</span>, while also specifying that we want to</span>
<span id="cb42-311"><a href="#cb42-311" aria-hidden="true" tabindex="-1"></a>restrict our request to data where <span class="in">`STATEFIP=='06'`</span> (California). Using</span>
<span id="cb42-312"><a href="#cb42-312" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`var_spec()`</span><span class="co">](https://tech.popdata.org/ipumsr/reference/var_spec.html)</span></span>
<span id="cb42-313"><a href="#cb42-313" aria-hidden="true" tabindex="-1"></a>is important, as accidentally/unnecessarily downloading an unfiltered,</span>
<span id="cb42-314"><a href="#cb42-314" aria-hidden="true" tabindex="-1"></a>full sample of the entire U.S. is time-consuming.</span>
<span id="cb42-315"><a href="#cb42-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-316"><a href="#cb42-316" aria-hidden="true" tabindex="-1"></a>Anyways, I can request these variables from the 2022 1-year ACS via</span>
<span id="cb42-317"><a href="#cb42-317" aria-hidden="true" tabindex="-1"></a>my<span class="in">`ipums_data()`</span> function.</span>
<span id="cb42-318"><a href="#cb42-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-321"><a href="#cb42-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-322"><a href="#cb42-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-323"><a href="#cb42-323" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">ipums_data</span>(<span class="st">"us2022a"</span>, variables, <span class="st">"Incomes by PUMA"</span>)</span>
<span id="cb42-324"><a href="#cb42-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-325"><a href="#cb42-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-326"><a href="#cb42-326" aria-hidden="true" tabindex="-1"></a>Here are the resulting data, the 2022 1-year ACS for California.</span>
<span id="cb42-327"><a href="#cb42-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-330"><a href="#cb42-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-331"><a href="#cb42-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-raw</span></span>
<span id="cb42-332"><a href="#cb42-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Unfiltered 2022 1-year ACS data for California"</span></span>
<span id="cb42-333"><a href="#cb42-333" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb42-334"><a href="#cb42-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-335"><a href="#cb42-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-336"><a href="#cb42-336" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Using Geocorr to identify small geographies {#sec-step-2}</span></span>
<span id="cb42-337"><a href="#cb42-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-338"><a href="#cb42-338" aria-hidden="true" tabindex="-1"></a>We now have microdata for all of California, but we need to filter down</span>
<span id="cb42-339"><a href="#cb42-339" aria-hidden="true" tabindex="-1"></a>to just Oakland. Unfortunately, this isn't as simple as just running</span>
<span id="cb42-340"><a href="#cb42-340" aria-hidden="true" tabindex="-1"></a><span class="in">`filter(CITY == 'Oakland')`</span> -- ACS microdata does not include a field</span>
<span id="cb42-341"><a href="#cb42-341" aria-hidden="true" tabindex="-1"></a>for explicitly identifying cities (note that a city is typically</span>
<span id="cb42-342"><a href="#cb42-342" aria-hidden="true" tabindex="-1"></a>referred to as a "place" in census data).</span>
<span id="cb42-343"><a href="#cb42-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-344"><a href="#cb42-344" aria-hidden="true" tabindex="-1"></a>The smallest geographic area explicitly identified in the microdata is</span>
<span id="cb42-345"><a href="#cb42-345" aria-hidden="true" tabindex="-1"></a>something called a public use microdata area (PUMA) <span class="co">[</span><span class="ot">@pastoor_how_2024</span><span class="co">]</span>.</span>
<span id="cb42-346"><a href="#cb42-346" aria-hidden="true" tabindex="-1"></a>PUMAS are unique geographies that always aggregate to the state-level</span>
<span id="cb42-347"><a href="#cb42-347" aria-hidden="true" tabindex="-1"></a>(e.g. California can be constructed with a collection of PUMAs), but</span>
<span id="cb42-348"><a href="#cb42-348" aria-hidden="true" tabindex="-1"></a>only sometimes aggregate to other small geographic areas, such as city,</span>
<span id="cb42-349"><a href="#cb42-349" aria-hidden="true" tabindex="-1"></a>metro area, and county [See [Census</span>
<span id="cb42-350"><a href="#cb42-350" aria-hidden="true" tabindex="-1"></a>Hierarchies](https://walker-data.com/census-r/the-united-states-census-and-the-r-programming-language.html#census-hierarchies)</span>
<span id="cb42-351"><a href="#cb42-351" aria-hidden="true" tabindex="-1"></a>in @walker_analyzing_2023, chapter 1].</span>
<span id="cb42-352"><a href="#cb42-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-353"><a href="#cb42-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.asp = .6}</span></span>
<span id="cb42-354"><a href="#cb42-354" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb42-355"><a href="#cb42-355" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Places and PUMAS in the Bay Area (region border in red)"</span></span>
<span id="cb42-356"><a href="#cb42-356" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb42-357"><a href="#cb42-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-358"><a href="#cb42-358" aria-hidden="true" tabindex="-1"></a><span class="in">library(tigris)</span></span>
<span id="cb42-359"><a href="#cb42-359" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb42-360"><a href="#cb42-360" aria-hidden="true" tabindex="-1"></a><span class="in">library(cowplot)</span></span>
<span id="cb42-361"><a href="#cb42-361" aria-hidden="true" tabindex="-1"></a><span class="in">options(tigris_use_cache = TRUE)</span></span>
<span id="cb42-362"><a href="#cb42-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-363"><a href="#cb42-363" aria-hidden="true" tabindex="-1"></a><span class="in">bay_area_counties &lt;- c(</span></span>
<span id="cb42-364"><a href="#cb42-364" aria-hidden="true" tabindex="-1"></a><span class="in">  "Alameda", "Contra Costa", "Marin", "Napa",</span></span>
<span id="cb42-365"><a href="#cb42-365" aria-hidden="true" tabindex="-1"></a><span class="in">  "San Francisco", "San Mateo", "Santa Clara", "Solano", "Sonoma"</span></span>
<span id="cb42-366"><a href="#cb42-366" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb42-367"><a href="#cb42-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-368"><a href="#cb42-368" aria-hidden="true" tabindex="-1"></a><span class="in">bay_area &lt;- counties(state = "CA", class = "sf", year=2022) %&gt;%</span></span>
<span id="cb42-369"><a href="#cb42-369" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% bay_area_counties) %&gt;%</span></span>
<span id="cb42-370"><a href="#cb42-370" aria-hidden="true" tabindex="-1"></a><span class="in">  st_union()  # Merge counties into a single boundary</span></span>
<span id="cb42-371"><a href="#cb42-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-372"><a href="#cb42-372" aria-hidden="true" tabindex="-1"></a><span class="in"># Get all California Places &amp; PUMAs</span></span>
<span id="cb42-373"><a href="#cb42-373" aria-hidden="true" tabindex="-1"></a><span class="in">places &lt;- places(state = "CA", class = "sf", year=2022)</span></span>
<span id="cb42-374"><a href="#cb42-374" aria-hidden="true" tabindex="-1"></a><span class="in">pumas &lt;- pumas(state = "CA", class = "sf",  year=2022)</span></span>
<span id="cb42-375"><a href="#cb42-375" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter only those in the Bay Area</span></span>
<span id="cb42-376"><a href="#cb42-376" aria-hidden="true" tabindex="-1"></a><span class="in">places_bay &lt;- places[st_intersects(places, bay_area, sparse = FALSE), ]</span></span>
<span id="cb42-377"><a href="#cb42-377" aria-hidden="true" tabindex="-1"></a><span class="in">pumas_bay &lt;- pumas[st_intersects(pumas, bay_area, sparse = FALSE), ]</span></span>
<span id="cb42-378"><a href="#cb42-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-379"><a href="#cb42-379" aria-hidden="true" tabindex="-1"></a><span class="in">pumas_bbox &lt;- st_bbox(bay_area)</span></span>
<span id="cb42-380"><a href="#cb42-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-381"><a href="#cb42-381" aria-hidden="true" tabindex="-1"></a><span class="in">crop_theme &lt;- theme(</span></span>
<span id="cb42-382"><a href="#cb42-382" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.spacing = unit(0, "lines"),      </span></span>
<span id="cb42-383"><a href="#cb42-383" aria-hidden="true" tabindex="-1"></a><span class="in">    plot.margin = margin(0, 0, 0, 0, "cm")</span></span>
<span id="cb42-384"><a href="#cb42-384" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb42-385"><a href="#cb42-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-386"><a href="#cb42-386" aria-hidden="true" tabindex="-1"></a><span class="in">map_places &lt;- ggplot() +</span></span>
<span id="cb42-387"><a href="#cb42-387" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = places_bay, fill = "lightblue", color = "darkgrey", size = 0.1) +</span></span>
<span id="cb42-388"><a href="#cb42-388" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = bay_area, fill = NA, color = "red", size = 4) +  </span></span>
<span id="cb42-389"><a href="#cb42-389" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(ylim = c(pumas_bbox["ymin"], pumas_bbox["ymax"]), xlim = c(pumas_bbox["xmin"], pumas_bbox["xmax"]), expand=FALSE) +  # Apply PUMAs y-limits</span></span>
<span id="cb42-390"><a href="#cb42-390" aria-hidden="true" tabindex="-1"></a><span class="in">  crop_theme +</span></span>
<span id="cb42-391"><a href="#cb42-391" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-392"><a href="#cb42-392" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Places")</span></span>
<span id="cb42-393"><a href="#cb42-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-394"><a href="#cb42-394" aria-hidden="true" tabindex="-1"></a><span class="in">map_pumas &lt;- ggplot() +</span></span>
<span id="cb42-395"><a href="#cb42-395" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = pumas_bay, fill = "lightblue", color = "darkgrey", size = 0.1) +</span></span>
<span id="cb42-396"><a href="#cb42-396" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = bay_area, fill = NA, color = "red", size = 4) +  </span></span>
<span id="cb42-397"><a href="#cb42-397" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(ylim = c(pumas_bbox["ymin"], pumas_bbox["ymax"]), xlim = c(pumas_bbox["xmin"], pumas_bbox["xmax"]), expand=FALSE) +  # Ensure y-axis is the same</span></span>
<span id="cb42-398"><a href="#cb42-398" aria-hidden="true" tabindex="-1"></a><span class="in">  crop_theme +</span></span>
<span id="cb42-399"><a href="#cb42-399" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-400"><a href="#cb42-400" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("PUMAs")</span></span>
<span id="cb42-401"><a href="#cb42-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-402"><a href="#cb42-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-403"><a href="#cb42-403" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grid(map_places, map_pumas, nrow = 1, align = "h", axis="t", vjust = 0)</span></span>
<span id="cb42-404"><a href="#cb42-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-405"><a href="#cb42-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-406"><a href="#cb42-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-407"><a href="#cb42-407" aria-hidden="true" tabindex="-1"></a>To find out if a city corresponds to a collection of PUMAs and which</span>
<span id="cb42-408"><a href="#cb42-408" aria-hidden="true" tabindex="-1"></a>PUMAs those are, we'll use</span>
<span id="cb42-409"><a href="#cb42-409" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Geocorr</span><span class="co">](https://mcdc.missouri.edu/applications/geocorr2022.html)</span></span>
<span id="cb42-410"><a href="#cb42-410" aria-hidden="true" tabindex="-1"></a>(geographic correspondence engine), an application that generates</span>
<span id="cb42-411"><a href="#cb42-411" aria-hidden="true" tabindex="-1"></a>correlation lists showing relationships between two or more geographic</span>
<span id="cb42-412"><a href="#cb42-412" aria-hidden="true" tabindex="-1"></a>coverages in the United States <span class="co">[</span><span class="ot">@mihalik_missouri_2022</span><span class="co">]</span>. Geocorr is a</span>
<span id="cb42-413"><a href="#cb42-413" aria-hidden="true" tabindex="-1"></a>sponsored program of the Missouri State library and published by the</span>
<span id="cb42-414"><a href="#cb42-414" aria-hidden="true" tabindex="-1"></a>University of Missouri Center for Health Policy.<span class="ot">[^4]</span></span>
<span id="cb42-415"><a href="#cb42-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-416"><a href="#cb42-416" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>I'll to note that the combination of IPUMS and Geocorr is a</span>
<span id="cb42-417"><a href="#cb42-417" aria-hidden="true" tabindex="-1"></a>    fantastic public good, and it's extremely generous of the public</span>
<span id="cb42-418"><a href="#cb42-418" aria-hidden="true" tabindex="-1"></a>    Universities of Minnesota and Missouri to publish these.</span>
<span id="cb42-419"><a href="#cb42-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-420"><a href="#cb42-420" aria-hidden="true" tabindex="-1"></a>![Geocorr 2022: Geographic Correspondence</span>
<span id="cb42-421"><a href="#cb42-421" aria-hidden="true" tabindex="-1"></a>Engine](geocorr.png){width="80%"}</span>
<span id="cb42-422"><a href="#cb42-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-423"><a href="#cb42-423" aria-hidden="true" tabindex="-1"></a>To use Geocorr, I'll define a function, <span class="in">`geocorr_2022()`</span> that queries</span>
<span id="cb42-424"><a href="#cb42-424" aria-hidden="true" tabindex="-1"></a>Geocorr 2022 and retrieves a .csv file establishing the relationships</span>
<span id="cb42-425"><a href="#cb42-425" aria-hidden="true" tabindex="-1"></a>between two sets of geographies within a given state. See the following</span>
<span id="cb42-426"><a href="#cb42-426" aria-hidden="true" tabindex="-1"></a>folded code chunk for the specifics:</span>
<span id="cb42-427"><a href="#cb42-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-430"><a href="#cb42-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-431"><a href="#cb42-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-432"><a href="#cb42-432" aria-hidden="true" tabindex="-1"></a>geocorr_2022 <span class="ot">&lt;-</span> <span class="cf">function</span>(state, geo_1, geo_2, weight_var) {</span>
<span id="cb42-433"><a href="#cb42-433" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mcdc.missouri.edu"</span></span>
<span id="cb42-434"><a href="#cb42-434" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb42-435"><a href="#cb42-435" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cgi-bin/broker?_PROGRAM=apps.geocorr2022.sas&amp;"</span>,</span>
<span id="cb42-436"><a href="#cb42-436" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_SERVICE=MCDC_long&amp;_debug=0&amp;"</span>,</span>
<span id="cb42-437"><a href="#cb42-437" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state={state}&amp;g1_={geo_1}&amp;g2_={geo_2}&amp;wtvar={weight_var}&amp;"</span>,</span>
<span id="cb42-438"><a href="#cb42-438" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nozerob=1&amp;fileout=1&amp;filefmt=csv&amp;lstfmt=txt&amp;title=&amp;"</span>,</span>
<span id="cb42-439"><a href="#cb42-439" aria-hidden="true" tabindex="-1"></a>    <span class="st">"counties=&amp;metros=&amp;places=&amp;oropt=&amp;latitude=&amp;longitude=&amp;"</span>,</span>
<span id="cb42-440"><a href="#cb42-440" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distance=&amp;kiloms=0&amp;locname="</span>)</span>
<span id="cb42-441"><a href="#cb42-441" aria-hidden="true" tabindex="-1"></a>  initial_url <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb42-442"><a href="#cb42-442" aria-hidden="true" tabindex="-1"></a>  initial_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(initial_url)</span>
<span id="cb42-443"><a href="#cb42-443" aria-hidden="true" tabindex="-1"></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(initial_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb42-444"><a href="#cb42-444" aria-hidden="true" tabindex="-1"></a>  parsed_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb42-445"><a href="#cb42-445" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the one link</span></span>
<span id="cb42-446"><a href="#cb42-446" aria-hidden="true" tabindex="-1"></a>  csv_url <span class="ot">&lt;-</span> parsed_html <span class="sc">%&gt;%</span></span>
<span id="cb42-447"><a href="#cb42-447" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_node</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-448"><a href="#cb42-448" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-449"><a href="#cb42-449" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-450"><a href="#cb42-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url_absolute</span>(<span class="at">base =</span> base_url)</span>
<span id="cb42-451"><a href="#cb42-451" aria-hidden="true" tabindex="-1"></a>  csv_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_url)</span>
<span id="cb42-452"><a href="#cb42-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(csv_data)</span>
<span id="cb42-453"><a href="#cb42-453" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-454"><a href="#cb42-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-455"><a href="#cb42-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-456"><a href="#cb42-456" aria-hidden="true" tabindex="-1"></a>We'll use that function to establish the relationships between</span>
<span id="cb42-457"><a href="#cb42-457" aria-hidden="true" tabindex="-1"></a>California's 2022 PUMAs and its "places," using individual population as</span>
<span id="cb42-458"><a href="#cb42-458" aria-hidden="true" tabindex="-1"></a>measured in the 2020 Decenial Census to weight the relationships.</span>
<span id="cb42-459"><a href="#cb42-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-462"><a href="#cb42-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-463"><a href="#cb42-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-464"><a href="#cb42-464" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb42-465"><a href="#cb42-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-466"><a href="#cb42-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-467"><a href="#cb42-467" aria-hidden="true" tabindex="-1"></a>With that, we can see which PUMAs correspond to the City of Oakland.</span>
<span id="cb42-468"><a href="#cb42-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-471"><a href="#cb42-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-472"><a href="#cb42-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-correspondence</span></span>
<span id="cb42-473"><a href="#cb42-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "PUMA to Place correspondence for Oakand, CA"</span></span>
<span id="cb42-474"><a href="#cb42-474" aria-hidden="true" tabindex="-1"></a>csv_data <span class="sc">%&gt;%</span></span>
<span id="cb42-475"><a href="#cb42-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb42-476"><a href="#cb42-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>)</span>
<span id="cb42-477"><a href="#cb42-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-478"><a href="#cb42-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-479"><a href="#cb42-479" aria-hidden="true" tabindex="-1"></a>The <span class="in">`AFACT`</span> (allocation factor) column shows the proportion of the</span>
<span id="cb42-480"><a href="#cb42-480" aria-hidden="true" tabindex="-1"></a>source area contained in the target area -- in this case the proportion</span>
<span id="cb42-481"><a href="#cb42-481" aria-hidden="true" tabindex="-1"></a>of the PUMA population that belongs to Oakland. In this case, 100% of</span>
<span id="cb42-482"><a href="#cb42-482" aria-hidden="true" tabindex="-1"></a>the populations in PUMAs 111, 112, 113, and 123 belong to Oakland, and</span>
<span id="cb42-483"><a href="#cb42-483" aria-hidden="true" tabindex="-1"></a>0% of PUMA 114. GEOCORR does believe that 9 individuals from 114 live in</span>
<span id="cb42-484"><a href="#cb42-484" aria-hidden="true" tabindex="-1"></a>Oakland, but based on the AFACT of 0 and the fact that I know the PUMA</span>
<span id="cb42-485"><a href="#cb42-485" aria-hidden="true" tabindex="-1"></a>overlays the neighboring city of Piedmont, I'll feel comfortable</span>
<span id="cb42-486"><a href="#cb42-486" aria-hidden="true" tabindex="-1"></a>dropping that PUMA.<span class="ot">[^5]</span></span>
<span id="cb42-487"><a href="#cb42-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-488"><a href="#cb42-488" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>Were the AFACT higher, e.g. 1%, I could randomly sample 1% of the</span>
<span id="cb42-489"><a href="#cb42-489" aria-hidden="true" tabindex="-1"></a>    individuals from that PUMA and include them in my Oakland sample.</span>
<span id="cb42-490"><a href="#cb42-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-491"><a href="#cb42-491" aria-hidden="true" tabindex="-1"></a>Note that when you plot place to PUMA equivalence, you may find slight</span>
<span id="cb42-492"><a href="#cb42-492" aria-hidden="true" tabindex="-1"></a>differences due to the fact that places can include un-populated areas,</span>
<span id="cb42-493"><a href="#cb42-493" aria-hidden="true" tabindex="-1"></a>such as bodies of water [in the case of</span>
<span id="cb42-494"><a href="#cb42-494" aria-hidden="true" tabindex="-1"></a>Oakland](https://www.google.com/maps/place/Oakland,+CA/@37.7831602,-122.3045548,11z/data=!4m6!3m5!1s0x80857d8b28aaed03:0x71b415d535759367!8m2!3d37.8043514!4d-122.2711639!16zL20vMGRjOTU?entry=ttu&amp;g_ep=EgoyMDI1MDIxMi4wIKXMDSoJLDEwMjExNDU1SAFQAw%3D%3D).</span>
<span id="cb42-495"><a href="#cb42-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-496"><a href="#cb42-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.asp = .58}</span></span>
<span id="cb42-497"><a href="#cb42-497" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb42-498"><a href="#cb42-498" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb42-499"><a href="#cb42-499" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Place to PUMAs Correspondence in Oakland (place border in red)"</span></span>
<span id="cb42-500"><a href="#cb42-500" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter PUMAs for Oakland</span></span>
<span id="cb42-501"><a href="#cb42-501" aria-hidden="true" tabindex="-1"></a><span class="in">oakland_pumas &lt;- pumas_bay %&gt;% filter(PUMACE20 %in% c('00111', '00112', '00113', '00123'))</span></span>
<span id="cb42-502"><a href="#cb42-502" aria-hidden="true" tabindex="-1"></a><span class="in">oakland_place &lt;- places_bay %&gt;% filter(NAME == 'Oakland')</span></span>
<span id="cb42-503"><a href="#cb42-503" aria-hidden="true" tabindex="-1"></a><span class="in"># Get bounding box for Oakland PUMAs</span></span>
<span id="cb42-504"><a href="#cb42-504" aria-hidden="true" tabindex="-1"></a><span class="in">oakland_bbox &lt;- st_bbox(oakland_place)</span></span>
<span id="cb42-505"><a href="#cb42-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-506"><a href="#cb42-506" aria-hidden="true" tabindex="-1"></a><span class="in">crop_theme &lt;- theme(</span></span>
<span id="cb42-507"><a href="#cb42-507" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.spacing = unit(0, "lines"),      </span></span>
<span id="cb42-508"><a href="#cb42-508" aria-hidden="true" tabindex="-1"></a><span class="in">    plot.margin = margin(0, 0, 0, 0, "cm"),</span></span>
<span id="cb42-509"><a href="#cb42-509" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.title.y = element_blank(),</span></span>
<span id="cb42-510"><a href="#cb42-510" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.title.x = element_blank()</span></span>
<span id="cb42-511"><a href="#cb42-511" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb42-512"><a href="#cb42-512" aria-hidden="true" tabindex="-1"></a><span class="in"># Oakland Places Map</span></span>
<span id="cb42-513"><a href="#cb42-513" aria-hidden="true" tabindex="-1"></a><span class="in">map_places &lt;- ggplot() +</span></span>
<span id="cb42-514"><a href="#cb42-514" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = oakland_place, fill = "lightblue", color = "darkgrey", size = 0.1) +</span></span>
<span id="cb42-515"><a href="#cb42-515" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = oakland_place, fill = NA, color = "red", size = 4) +  </span></span>
<span id="cb42-516"><a href="#cb42-516" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(ylim = c(oakland_bbox["ymin"], oakland_bbox["ymax"]), </span></span>
<span id="cb42-517"><a href="#cb42-517" aria-hidden="true" tabindex="-1"></a><span class="in">           xlim = c(oakland_bbox["xmin"], oakland_bbox["xmax"]), </span></span>
<span id="cb42-518"><a href="#cb42-518" aria-hidden="true" tabindex="-1"></a><span class="in">           expand = FALSE) +</span></span>
<span id="cb42-519"><a href="#cb42-519" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-520"><a href="#cb42-520" aria-hidden="true" tabindex="-1"></a><span class="in">  crop_theme +</span></span>
<span id="cb42-521"><a href="#cb42-521" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Oakland (Place)")</span></span>
<span id="cb42-522"><a href="#cb42-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-523"><a href="#cb42-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-524"><a href="#cb42-524" aria-hidden="true" tabindex="-1"></a><span class="in"># Oakland PUMAs Map</span></span>
<span id="cb42-525"><a href="#cb42-525" aria-hidden="true" tabindex="-1"></a><span class="in">map_pumas &lt;- ggplot() +</span></span>
<span id="cb42-526"><a href="#cb42-526" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = oakland_pumas, fill = "lightblue", color = "darkgrey", size = 0.1) +</span></span>
<span id="cb42-527"><a href="#cb42-527" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = oakland_pumas, aes(label = PUMACE20)) +</span></span>
<span id="cb42-528"><a href="#cb42-528" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = oakland_place, fill = NA, color = "red", size = 4) +</span></span>
<span id="cb42-529"><a href="#cb42-529" aria-hidden="true" tabindex="-1"></a><span class="in">  #geom_sf(data = oakland_pumas, fill = NA, color = "red", size = 4) +  </span></span>
<span id="cb42-530"><a href="#cb42-530" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(ylim = c(oakland_bbox["ymin"], oakland_bbox["ymax"]), </span></span>
<span id="cb42-531"><a href="#cb42-531" aria-hidden="true" tabindex="-1"></a><span class="in">           xlim = c(oakland_bbox["xmin"], oakland_bbox["xmax"]), </span></span>
<span id="cb42-532"><a href="#cb42-532" aria-hidden="true" tabindex="-1"></a><span class="in">           expand = FALSE) +</span></span>
<span id="cb42-533"><a href="#cb42-533" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-534"><a href="#cb42-534" aria-hidden="true" tabindex="-1"></a><span class="in">  crop_theme +</span></span>
<span id="cb42-535"><a href="#cb42-535" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Oakland (PUMAs)")</span></span>
<span id="cb42-536"><a href="#cb42-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-537"><a href="#cb42-537" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grid(map_places, map_pumas, nrow = 1, align = "h", axis = "t", vjust = 0)</span></span>
<span id="cb42-538"><a href="#cb42-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-539"><a href="#cb42-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-540"><a href="#cb42-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-541"><a href="#cb42-541" aria-hidden="true" tabindex="-1"></a>Filtering to those PUMAs gets us the 2022 1-year ACS microdata for the</span>
<span id="cb42-542"><a href="#cb42-542" aria-hidden="true" tabindex="-1"></a>City of Oakland (I use <span class="in">`haven::zap_labels()`</span> just to remove some</span>
<span id="cb42-543"><a href="#cb42-543" aria-hidden="true" tabindex="-1"></a>unnecessary formatting that comes with the data).</span>
<span id="cb42-544"><a href="#cb42-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-547"><a href="#cb42-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-548"><a href="#cb42-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-oakland-raw</span></span>
<span id="cb42-549"><a href="#cb42-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "2022 1-year ACS data for Oakland, CA"</span></span>
<span id="cb42-550"><a href="#cb42-550" aria-hidden="true" tabindex="-1"></a>oakland_pumas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>, <span class="dv">113</span>, <span class="dv">123</span>)</span>
<span id="cb42-551"><a href="#cb42-551" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb42-552"><a href="#cb42-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oakland_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb42-553"><a href="#cb42-553" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb42-554"><a href="#cb42-554" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb42-555"><a href="#cb42-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-556"><a href="#cb42-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-557"><a href="#cb42-557" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Specify the unit of analysis {#sec-step-3}</span></span>
<span id="cb42-558"><a href="#cb42-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-559"><a href="#cb42-559" aria-hidden="true" tabindex="-1"></a>Each row in the ACS microdata represents an individual, identified by a</span>
<span id="cb42-560"><a href="#cb42-560" aria-hidden="true" tabindex="-1"></a>unique combination of <span class="in">`SAMPLE`</span>, which defines the year when the</span>
<span id="cb42-561"><a href="#cb42-561" aria-hidden="true" tabindex="-1"></a>individual was surveyed, <span class="in">`SERIAL`</span>, a unique identifier for that</span>
<span id="cb42-562"><a href="#cb42-562" aria-hidden="true" tabindex="-1"></a>individual's household, and <span class="in">`PERNUM`</span>, a unique identifier for the</span>
<span id="cb42-563"><a href="#cb42-563" aria-hidden="true" tabindex="-1"></a>individual within their household <span class="co">[</span><span class="ot">@ruggles_ipums_2024</span><span class="co">]</span>. Given that, we</span>
<span id="cb42-564"><a href="#cb42-564" aria-hidden="true" tabindex="-1"></a>can define a straightforward definition for unique individuals in the</span>
<span id="cb42-565"><a href="#cb42-565" aria-hidden="true" tabindex="-1"></a>ACS:</span>
<span id="cb42-566"><a href="#cb42-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-567"><a href="#cb42-567" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Individuals**: The combination of <span class="in">`SAMPLE`</span>, <span class="in">`SERIAL`</span>, and <span class="in">`PERNUM`</span></span>
<span id="cb42-568"><a href="#cb42-568" aria-hidden="true" tabindex="-1"></a>    provides a unique identifier for every person in the IPUMS. ACS</span>
<span id="cb42-569"><a href="#cb42-569" aria-hidden="true" tabindex="-1"></a>    microdata is typically individual-level, so this filtering should</span>
<span id="cb42-570"><a href="#cb42-570" aria-hidden="true" tabindex="-1"></a>    not be necessary.</span>
<span id="cb42-571"><a href="#cb42-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-572"><a href="#cb42-572" aria-hidden="true" tabindex="-1"></a>Defining a household is slightly more complex.</span>
<span id="cb42-573"><a href="#cb42-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-574"><a href="#cb42-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Housing Units**: The combination of <span class="in">`SAMPLE`</span> and <span class="in">`SERIAL`</span> provides</span>
<span id="cb42-575"><a href="#cb42-575" aria-hidden="true" tabindex="-1"></a>    a unique identifier for every housing unit in the IPUMS. However,</span>
<span id="cb42-576"><a href="#cb42-576" aria-hidden="true" tabindex="-1"></a>    this includes both households and general group quarter housing,</span>
<span id="cb42-577"><a href="#cb42-577" aria-hidden="true" tabindex="-1"></a>    e.g. correctional facilities. Housing units are further categorized</span>
<span id="cb42-578"><a href="#cb42-578" aria-hidden="true" tabindex="-1"></a>    using the</span>
<span id="cb42-579"><a href="#cb42-579" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">`GQ`</span><span class="co">]</span>((https://usa.ipums.org/usa-action/variables/GQ#description_section))</span>
<span id="cb42-580"><a href="#cb42-580" aria-hidden="true" tabindex="-1"></a>    variable.</span>
<span id="cb42-581"><a href="#cb42-581" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Households**: Non group quarter housing units, defined by</span>
<span id="cb42-582"><a href="#cb42-582" aria-hidden="true" tabindex="-1"></a>        filtering housing units to those where <span class="in">`GQ`</span>, is 1 or 2</span>
<span id="cb42-583"><a href="#cb42-583" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">@bloem_matching_2018</span><span class="co">]</span>. The [comparability</span>
<span id="cb42-584"><a href="#cb42-584" aria-hidden="true" tabindex="-1"></a>        section](https://usa.ipums.org/usa-action/variables/GQ#comparability_section)</span>
<span id="cb42-585"><a href="#cb42-585" aria-hidden="true" tabindex="-1"></a>        of the <span class="in">`GQ`</span> variable documentation explains this choice in</span>
<span id="cb42-586"><a href="#cb42-586" aria-hidden="true" tabindex="-1"></a>        greater detail, but in short it represents non-institutional</span>
<span id="cb42-587"><a href="#cb42-587" aria-hidden="true" tabindex="-1"></a>        housing-units where 9 or fewer people unrelated to the</span>
<span id="cb42-588"><a href="#cb42-588" aria-hidden="true" tabindex="-1"></a>        head-of-household reside.</span>
<span id="cb42-589"><a href="#cb42-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-590"><a href="#cb42-590" aria-hidden="true" tabindex="-1"></a>We can group/filter by these variable combinations and see how many</span>
<span id="cb42-591"><a href="#cb42-591" aria-hidden="true" tabindex="-1"></a>individuals, housing units, and households were surveyed across PUMAs in</span>
<span id="cb42-592"><a href="#cb42-592" aria-hidden="true" tabindex="-1"></a>Oakland for the 2022 1-year ACS.</span>
<span id="cb42-593"><a href="#cb42-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-596"><a href="#cb42-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-597"><a href="#cb42-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-granularity</span></span>
<span id="cb42-598"><a href="#cb42-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Oakland Dataset Granularity by PUMA"</span></span>
<span id="cb42-599"><a href="#cb42-599" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span></span>
<span id="cb42-600"><a href="#cb42-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span></span>
<span id="cb42-601"><a href="#cb42-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-602"><a href="#cb42-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="fu">n</span>(),</span>
<span id="cb42-603"><a href="#cb42-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_individuals =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL, PERNUM),</span>
<span id="cb42-604"><a href="#cb42-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_housing_units =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)) <span class="sc">%&gt;%</span></span>
<span id="cb42-605"><a href="#cb42-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(oak <span class="sc">%&gt;%</span></span>
<span id="cb42-606"><a href="#cb42-606" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(GQ <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-607"><a href="#cb42-607" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(PUMA) <span class="sc">%&gt;%</span></span>
<span id="cb42-608"><a href="#cb42-608" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarise</span>(<span class="at">n_households =</span> <span class="fu">n_distinct</span>(SAMPLE, SERIAL)),</span>
<span id="cb42-609"><a href="#cb42-609" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(PUMA))</span>
<span id="cb42-610"><a href="#cb42-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-611"><a href="#cb42-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-612"><a href="#cb42-612" aria-hidden="true" tabindex="-1"></a>We see that each row in the data represents an individual (<span class="in">`n_rows`</span></span>
<span id="cb42-613"><a href="#cb42-613" aria-hidden="true" tabindex="-1"></a>equals <span class="in">`n_individuals`</span>) and, as we would expect, the number of housing</span>
<span id="cb42-614"><a href="#cb42-614" aria-hidden="true" tabindex="-1"></a>units and households are successively lower than the number of</span>
<span id="cb42-615"><a href="#cb42-615" aria-hidden="true" tabindex="-1"></a>individuals.</span>
<span id="cb42-616"><a href="#cb42-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-617"><a href="#cb42-617" aria-hidden="true" tabindex="-1"></a><span class="fu">### Households, group quarters, and institutions</span></span>
<span id="cb42-618"><a href="#cb42-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-619"><a href="#cb42-619" aria-hidden="true" tabindex="-1"></a>So, given that our motivating question concerns household income, we can</span>
<span id="cb42-620"><a href="#cb42-620" aria-hidden="true" tabindex="-1"></a>apply the following filtering, per <span class="co">[</span><span class="ot">@bloem_matching_2018</span><span class="co">]</span>, and isolate just the heads of all the households in Oakland.</span>
<span id="cb42-621"><a href="#cb42-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-624"><a href="#cb42-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-625"><a href="#cb42-625" aria-hidden="true" tabindex="-1"></a>households <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb42-626"><a href="#cb42-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb42-627"><a href="#cb42-627" aria-hidden="true" tabindex="-1"></a>    PERNUM <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb42-628"><a href="#cb42-628" aria-hidden="true" tabindex="-1"></a>    GQ <span class="sc">&lt;=</span> <span class="dv">2</span></span>
<span id="cb42-629"><a href="#cb42-629" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-630"><a href="#cb42-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-631"><a href="#cb42-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-632"><a href="#cb42-632" aria-hidden="true" tabindex="-1"></a>But to build a little intuition around that selection, let's also look at what different housing units look like, and *why* the household definition is restrictive.  </span>
<span id="cb42-633"><a href="#cb42-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-634"><a href="#cb42-634" aria-hidden="true" tabindex="-1"></a><span class="fu">#### A household</span></span>
<span id="cb42-635"><a href="#cb42-635" aria-hidden="true" tabindex="-1"></a>I'll randomly select a household in the data to see what such a unit</span>
<span id="cb42-636"><a href="#cb42-636" aria-hidden="true" tabindex="-1"></a>looks like in practice.</span>
<span id="cb42-637"><a href="#cb42-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-640"><a href="#cb42-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-641"><a href="#cb42-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-hh</span></span>
<span id="cb42-642"><a href="#cb42-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example household with income data"</span></span>
<span id="cb42-643"><a href="#cb42-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-644"><a href="#cb42-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-645"><a href="#cb42-645" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb42-646"><a href="#cb42-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-647"><a href="#cb42-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SERIAL) <span class="sc">%&gt;%</span></span>
<span id="cb42-648"><a href="#cb42-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-649"><a href="#cb42-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-650"><a href="#cb42-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb42-651"><a href="#cb42-651" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb42-652"><a href="#cb42-652" aria-hidden="true" tabindex="-1"></a>sample_household_true <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb42-653"><a href="#cb42-653" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> <span class="fu">dim</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>]</span>
<span id="cb42-654"><a href="#cb42-654" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> </span>
<span id="cb42-655"><a href="#cb42-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(SERIAL, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT))</span>
<span id="cb42-656"><a href="#cb42-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-657"><a href="#cb42-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-658"><a href="#cb42-658" aria-hidden="true" tabindex="-1"></a>This household, with <span class="in">`SERIAL`</span></span>
<span id="cb42-659"><a href="#cb42-659" aria-hidden="true" tabindex="-1"></a><span class="in">`{r} format(sample_household_true, scientific=FALSE)`</span> has <span class="in">`{r} n`</span></span>
<span id="cb42-660"><a href="#cb42-660" aria-hidden="true" tabindex="-1"></a>members, each with a unique <span class="in">`PERNUM`</span>. To identify household members'</span>
<span id="cb42-661"><a href="#cb42-661" aria-hidden="true" tabindex="-1"></a>relationship to the head-of-household, [we reference</span>
<span id="cb42-662"><a href="#cb42-662" aria-hidden="true" tabindex="-1"></a><span class="in">`RELATE`</span>](https://usa.ipums.org/usa-action/variables/RELATE#codes_section).</span>
<span id="cb42-663"><a href="#cb42-663" aria-hidden="true" tabindex="-1"></a>The first row, where <span class="in">`RELATE==1`</span> denotes a 41 year old female (<span class="in">`SEX==2`</span>)</span>
<span id="cb42-664"><a href="#cb42-664" aria-hidden="true" tabindex="-1"></a>head-of-household. The second, where <span class="in">`RELATE==2`</span> denotes their spouse,</span>
<span id="cb42-665"><a href="#cb42-665" aria-hidden="true" tabindex="-1"></a>in this case a 40 year old male. This couple has two children</span>
<span id="cb42-666"><a href="#cb42-666" aria-hidden="true" tabindex="-1"></a>(<span class="in">`RELATE==3`</span>) and the husband's mother (<span class="in">`RELATE==6`</span>), also living in the</span>
<span id="cb42-667"><a href="#cb42-667" aria-hidden="true" tabindex="-1"></a>household.</span>
<span id="cb42-668"><a href="#cb42-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-669"><a href="#cb42-669" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Non-institutional group-quarters</span></span>
<span id="cb42-670"><a href="#cb42-670" aria-hidden="true" tabindex="-1"></a>We can contrast that fairly "nuclear family" household with a</span>
<span id="cb42-671"><a href="#cb42-671" aria-hidden="true" tabindex="-1"></a>non-institutional group-quarters housing unit in Oakland:</span>
<span id="cb42-672"><a href="#cb42-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-675"><a href="#cb42-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-676"><a href="#cb42-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example group quarters unit with income data"</span></span>
<span id="cb42-677"><a href="#cb42-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-678"><a href="#cb42-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-gq</span></span>
<span id="cb42-679"><a href="#cb42-679" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb42-680"><a href="#cb42-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">==</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-681"><a href="#cb42-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb42-682"><a href="#cb42-682" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb42-683"><a href="#cb42-683" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb42-684"><a href="#cb42-684" aria-hidden="true" tabindex="-1"></a>sampled_data <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> </span>
<span id="cb42-685"><a href="#cb42-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb42-686"><a href="#cb42-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SERIAL, PUMA, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT)</span>
<span id="cb42-687"><a href="#cb42-687" aria-hidden="true" tabindex="-1"></a>sampled_data</span>
<span id="cb42-688"><a href="#cb42-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-689"><a href="#cb42-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-690"><a href="#cb42-690" aria-hidden="true" tabindex="-1"></a>We see that there is a head-of-household, a 26 year old male, but all 10</span>
<span id="cb42-691"><a href="#cb42-691" aria-hidden="true" tabindex="-1"></a>other housing unit members are "partners, friends, <span class="sc">\[</span>or<span class="sc">\]</span> visitors"</span>
<span id="cb42-692"><a href="#cb42-692" aria-hidden="true" tabindex="-1"></a>(<span class="in">`RELATE==11`</span>). These are largely adults with earnings, so this group</span>
<span id="cb42-693"><a href="#cb42-693" aria-hidden="true" tabindex="-1"></a>quarters unit would have a very high "household income" and bias the estimated median income up were it included</span>
<span id="cb42-694"><a href="#cb42-694" aria-hidden="true" tabindex="-1"></a>for that calculation.</span>
<span id="cb42-695"><a href="#cb42-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-696"><a href="#cb42-696" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Institutional housing units</span></span>
<span id="cb42-697"><a href="#cb42-697" aria-hidden="true" tabindex="-1"></a>Group quarters also include institutional housing units, such as</span>
<span id="cb42-698"><a href="#cb42-698" aria-hidden="true" tabindex="-1"></a>correctional facilities.</span>
<span id="cb42-699"><a href="#cb42-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-702"><a href="#cb42-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-703"><a href="#cb42-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example institutional housing unit with income data"</span></span>
<span id="cb42-704"><a href="#cb42-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-705"><a href="#cb42-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-ih</span></span>
<span id="cb42-706"><a href="#cb42-706" aria-hidden="true" tabindex="-1"></a>household_serials <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb42-707"><a href="#cb42-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GQ <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-708"><a href="#cb42-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(SERIAL)</span>
<span id="cb42-709"><a href="#cb42-709" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb42-710"><a href="#cb42-710" aria-hidden="true" tabindex="-1"></a>sample_household <span class="ot">&lt;-</span> <span class="fu">sample</span>(household_serials, <span class="dv">1</span>)</span>
<span id="cb42-711"><a href="#cb42-711" aria-hidden="true" tabindex="-1"></a>sampled_data <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span> </span>
<span id="cb42-712"><a href="#cb42-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household) <span class="sc">%&gt;%</span> </span>
<span id="cb42-713"><a href="#cb42-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SERIAL, PUMA, GQ, PERNUM, RELATE, AGE, SEX, HHINCOME, INCTOT)</span>
<span id="cb42-714"><a href="#cb42-714" aria-hidden="true" tabindex="-1"></a>sampled_data</span>
<span id="cb42-715"><a href="#cb42-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-716"><a href="#cb42-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-717"><a href="#cb42-717" aria-hidden="true" tabindex="-1"></a>This housing unit only includes one member, an 86 year old woman who is</span>
<span id="cb42-718"><a href="#cb42-718" aria-hidden="true" tabindex="-1"></a>an "institutional inmate" (<span class="in">`RELATE==13`</span>) with no income. This unit would likely bias median household income down, were it included.</span>
<span id="cb42-719"><a href="#cb42-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-720"><a href="#cb42-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Household Income in the ACS</span></span>
<span id="cb42-721"><a href="#cb42-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-722"><a href="#cb42-722" aria-hidden="true" tabindex="-1"></a>Let's return to the motivating question:  </span>
<span id="cb42-723"><a href="#cb42-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-724"><a href="#cb42-724" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb42-725"><a href="#cb42-725" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivating Question</span></span>
<span id="cb42-726"><a href="#cb42-726" aria-hidden="true" tabindex="-1"></a>**What was the median household</span>
<span id="cb42-727"><a href="#cb42-727" aria-hidden="true" tabindex="-1"></a>income in Oakland, California in 2022?**  </span>
<span id="cb42-728"><a href="#cb42-728" aria-hidden="true" tabindex="-1"></a>:::  </span>
<span id="cb42-729"><a href="#cb42-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-730"><a href="#cb42-730" aria-hidden="true" tabindex="-1"></a>Note the income</span>
<span id="cb42-731"><a href="#cb42-731" aria-hidden="true" tabindex="-1"></a>variables we observe for this family:</span>
<span id="cb42-732"><a href="#cb42-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-733"><a href="#cb42-733" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`INCTOT`</span> reports each respondent's total pre-tax personal income or</span>
<span id="cb42-734"><a href="#cb42-734" aria-hidden="true" tabindex="-1"></a>    losses from all sources for the previous year. <span class="in">`9999999`</span> is code to</span>
<span id="cb42-735"><a href="#cb42-735" aria-hidden="true" tabindex="-1"></a>    denote that the value is missing, which makes sense given that the</span>
<span id="cb42-736"><a href="#cb42-736" aria-hidden="true" tabindex="-1"></a>    missing values above correspond to children in the household [See</span>
<span id="cb42-737"><a href="#cb42-737" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">INCTOT</span><span class="co">](https://usa.ipums.org/usa-action/variables/INCTOT)</span> in</span>
<span id="cb42-738"><a href="#cb42-738" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024].</span>
<span id="cb42-739"><a href="#cb42-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-740"><a href="#cb42-740" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`HHINCOME`</span> reports the total money income of all household members</span>
<span id="cb42-741"><a href="#cb42-741" aria-hidden="true" tabindex="-1"></a>    age 15+ during the previous year. The amount should equal the sum of</span>
<span id="cb42-742"><a href="#cb42-742" aria-hidden="true" tabindex="-1"></a>    all household members' individual incomes, as recorded in the</span>
<span id="cb42-743"><a href="#cb42-743" aria-hidden="true" tabindex="-1"></a>    person-record variable INCTOT [See</span>
<span id="cb42-744"><a href="#cb42-744" aria-hidden="true" tabindex="-1"></a>    <span class="co">[</span><span class="ot">HHINCOME</span><span class="co">](https://usa.ipums.org/usa-action/variables/HHINCOME)</span> in</span>
<span id="cb42-745"><a href="#cb42-745" aria-hidden="true" tabindex="-1"></a>    @ruggles_ipums_2024]</span>
<span id="cb42-746"><a href="#cb42-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-747"><a href="#cb42-747" aria-hidden="true" tabindex="-1"></a>Given what we know about the unique identifier for households, and the</span>
<span id="cb42-748"><a href="#cb42-748" aria-hidden="true" tabindex="-1"></a><span class="in">`HHINCOME`</span> variable, we can construct the appropriate dataset for</span>
<span id="cb42-749"><a href="#cb42-749" aria-hidden="true" tabindex="-1"></a>answering our motivating question – every household in Oakland that had</span>
<span id="cb42-750"><a href="#cb42-750" aria-hidden="true" tabindex="-1"></a>household income.</span>
<span id="cb42-751"><a href="#cb42-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-754"><a href="#cb42-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-755"><a href="#cb42-755" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="ot">&lt;-</span> households <span class="sc">%&gt;%</span></span>
<span id="cb42-756"><a href="#cb42-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb42-757"><a href="#cb42-757" aria-hidden="true" tabindex="-1"></a>    HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>,</span>
<span id="cb42-758"><a href="#cb42-758" aria-hidden="true" tabindex="-1"></a>    HHINCOME <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb42-759"><a href="#cb42-759" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-760"><a href="#cb42-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-761"><a href="#cb42-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-762"><a href="#cb42-762" aria-hidden="true" tabindex="-1"></a>It seems we can proceed to simply calculate the median of the <span class="in">`HHINCOME`</span></span>
<span id="cb42-763"><a href="#cb42-763" aria-hidden="true" tabindex="-1"></a>column? Not so fast... Data in the ACS microdata are not what they seem.</span>
<span id="cb42-764"><a href="#cb42-764" aria-hidden="true" tabindex="-1"></a>Before we do any analysis, we have to account for **sample weights**.</span>
<span id="cb42-765"><a href="#cb42-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-766"><a href="#cb42-766" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Applying sample weights {#sec-step-4}</span></span>
<span id="cb42-767"><a href="#cb42-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-768"><a href="#cb42-768" aria-hidden="true" tabindex="-1"></a>Let's return to our sample family from above, but also examine the</span>
<span id="cb42-769"><a href="#cb42-769" aria-hidden="true" tabindex="-1"></a>variables <span class="in">`PERWT`</span> and <span class="in">`HHWT`</span>.</span>
<span id="cb42-770"><a href="#cb42-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-773"><a href="#cb42-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-774"><a href="#cb42-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example-hh-weights</span></span>
<span id="cb42-775"><a href="#cb42-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "An example household with weight data"</span></span>
<span id="cb42-776"><a href="#cb42-776" aria-hidden="true" tabindex="-1"></a>oak <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SERIAL <span class="sc">==</span> sample_household_true) <span class="sc">%&gt;%</span> </span>
<span id="cb42-777"><a href="#cb42-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(AGE, SEX, HHINCOME, INCTOT, PERWT, HHWT))</span>
<span id="cb42-778"><a href="#cb42-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-779"><a href="#cb42-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-780"><a href="#cb42-780" aria-hidden="true" tabindex="-1"></a>These are the two primary sample weights in ACS microdata, and they can</span>
<span id="cb42-781"><a href="#cb42-781" aria-hidden="true" tabindex="-1"></a>be interpreted fairly directly.</span>
<span id="cb42-782"><a href="#cb42-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-783"><a href="#cb42-783" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`PERWT`</span> gives the population represented by each individual in the</span>
<span id="cb42-784"><a href="#cb42-784" aria-hidden="true" tabindex="-1"></a>    sample, thus in the first row of the sample household, the 41 year</span>
<span id="cb42-785"><a href="#cb42-785" aria-hidden="true" tabindex="-1"></a>    old woman with an individual income of \$104,500 represents 51</span>
<span id="cb42-786"><a href="#cb42-786" aria-hidden="true" tabindex="-1"></a>    individuals in the PUMA.</span>
<span id="cb42-787"><a href="#cb42-787" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`HHWT`</span> gives the number of households in the general population</span>
<span id="cb42-788"><a href="#cb42-788" aria-hidden="true" tabindex="-1"></a>    represented by each household in the sample, thus this household is</span>
<span id="cb42-789"><a href="#cb42-789" aria-hidden="true" tabindex="-1"></a>    representative of 51 households in that PUMA.</span>
<span id="cb42-790"><a href="#cb42-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-791"><a href="#cb42-791" aria-hidden="true" tabindex="-1"></a>Any analysis or visualization of ACS microdata should be weighted by</span>
<span id="cb42-792"><a href="#cb42-792" aria-hidden="true" tabindex="-1"></a><span class="in">`PERWT`</span> for work at the person-level, and <span class="in">`HHWT`</span> for the household-level</span>
<span id="cb42-793"><a href="#cb42-793" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">See [Sample Weights</span><span class="co">](https://usa.ipums.org/usa/intro.shtml#weights)</span> in</span>
<span id="cb42-794"><a href="#cb42-794" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024].</span>
<span id="cb42-795"><a href="#cb42-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-796"><a href="#cb42-796" aria-hidden="true" tabindex="-1"></a>For visualizations, we pass the weights to the plotting API. For</span>
<span id="cb42-797"><a href="#cb42-797" aria-hidden="true" tabindex="-1"></a>example, in <span class="in">`ggplot`</span> many chart types support a <span class="in">`weight`</span> argument.</span>
<span id="cb42-798"><a href="#cb42-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-799"><a href="#cb42-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.asp = .5}</span></span>
<span id="cb42-800"><a href="#cb42-800" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Household Income Distribution in Oakland (with household weights)"</span></span>
<span id="cb42-801"><a href="#cb42-801" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(households_w_income, aes(x = HHINCOME, weight = HHWT)) +</span></span>
<span id="cb42-802"><a href="#cb42-802" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(</span></span>
<span id="cb42-803"><a href="#cb42-803" aria-hidden="true" tabindex="-1"></a><span class="in">    binwidth = 50000,</span></span>
<span id="cb42-804"><a href="#cb42-804" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "lightblue",</span></span>
<span id="cb42-805"><a href="#cb42-805" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 1,</span></span>
<span id="cb42-806"><a href="#cb42-806" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "grey"</span></span>
<span id="cb42-807"><a href="#cb42-807" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb42-808"><a href="#cb42-808" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-809"><a href="#cb42-809" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb42-810"><a href="#cb42-810" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = scales::label_currency(scale_cut = scales::cut_short_scale()),</span></span>
<span id="cb42-811"><a href="#cb42-811" aria-hidden="true" tabindex="-1"></a><span class="in">    breaks = seq(0, 1600000, 200000)</span></span>
<span id="cb42-812"><a href="#cb42-812" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb42-813"><a href="#cb42-813" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels=scales::label_comma()) +</span></span>
<span id="cb42-814"><a href="#cb42-814" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Household Income", y = "Number of Households")</span></span>
<span id="cb42-815"><a href="#cb42-815" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-816"><a href="#cb42-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-817"><a href="#cb42-817" aria-hidden="true" tabindex="-1"></a>For analysis, we use the</span>
<span id="cb42-818"><a href="#cb42-818" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`srvyr`</span><span class="co">](http://gdfe.co/srvyr/reference/index.html)</span> package to define</span>
<span id="cb42-819"><a href="#cb42-819" aria-hidden="true" tabindex="-1"></a>the survey weights before using them to calculate statistics. For</span>
<span id="cb42-820"><a href="#cb42-820" aria-hidden="true" tabindex="-1"></a>example, here we'll finally address the motivating question.  </span>
<span id="cb42-821"><a href="#cb42-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-822"><a href="#cb42-822" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb42-823"><a href="#cb42-823" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivating Question</span></span>
<span id="cb42-824"><a href="#cb42-824" aria-hidden="true" tabindex="-1"></a>**What was the median household</span>
<span id="cb42-825"><a href="#cb42-825" aria-hidden="true" tabindex="-1"></a>income in Oakland, California in 2022?**  </span>
<span id="cb42-826"><a href="#cb42-826" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-827"><a href="#cb42-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-828"><a href="#cb42-828" aria-hidden="true" tabindex="-1"></a>The answer, as measured in the IPUMS</span>
<span id="cb42-829"><a href="#cb42-829" aria-hidden="true" tabindex="-1"></a>microdata is as follows:</span>
<span id="cb42-830"><a href="#cb42-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-833"><a href="#cb42-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-834"><a href="#cb42-834" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-answer</span></span>
<span id="cb42-835"><a href="#cb42-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "2022 Median Household Income in Oakland, CA"</span></span>
<span id="cb42-836"><a href="#cb42-836" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-837"><a href="#cb42-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb42-838"><a href="#cb42-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-839"><a href="#cb42-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weighted_median)</span>
<span id="cb42-840"><a href="#cb42-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-841"><a href="#cb42-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-842"><a href="#cb42-842" aria-hidden="true" tabindex="-1"></a>Let's do a quick comparison of our IPUMS results to the aggregate census</span>
<span id="cb42-843"><a href="#cb42-843" aria-hidden="true" tabindex="-1"></a>data we retrieved in the first section. Here are our full IPUMS results</span>
<span id="cb42-844"><a href="#cb42-844" aria-hidden="true" tabindex="-1"></a>for both median household income and population:</span>
<span id="cb42-845"><a href="#cb42-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-848"><a href="#cb42-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-849"><a href="#cb42-849" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-850"><a href="#cb42-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-ipums-res</span></span>
<span id="cb42-851"><a href="#cb42-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "IPUMS versus ACS aggregate results"</span></span>
<span id="cb42-852"><a href="#cb42-852" aria-hidden="true" tabindex="-1"></a>median_table <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-853"><a href="#cb42-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span> </span>
<span id="cb42-854"><a href="#cb42-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_median =</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-855"><a href="#cb42-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"median_hh_income"</span>,</span>
<span id="cb42-856"><a href="#cb42-856" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> weighted_median,</span>
<span id="cb42-857"><a href="#cb42-857" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> weighted_median_se)</span>
<span id="cb42-858"><a href="#cb42-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-859"><a href="#cb42-859" aria-hidden="true" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> oak <span class="sc">%&gt;%</span></span>
<span id="cb42-860"><a href="#cb42-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>PERWT) <span class="sc">%&gt;%</span> </span>
<span id="cb42-861"><a href="#cb42-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-862"><a href="#cb42-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"total_pop"</span>,</span>
<span id="cb42-863"><a href="#cb42-863" aria-hidden="true" tabindex="-1"></a>         <span class="at">ipums_estimate =</span> n,</span>
<span id="cb42-864"><a href="#cb42-864" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> n_se)</span>
<span id="cb42-865"><a href="#cb42-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-866"><a href="#cb42-866" aria-hidden="true" tabindex="-1"></a>aggregate_data <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span></span>
<span id="cb42-867"><a href="#cb42-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb42-868"><a href="#cb42-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ACS_aggregate_estimate =</span> estimate)</span>
<span id="cb42-869"><a href="#cb42-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-870"><a href="#cb42-870" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(count_table, median_table) <span class="sc">%&gt;%</span> </span>
<span id="cb42-871"><a href="#cb42-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(variable, ipums_estimate)) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(aggregate_data, <span class="at">by=</span><span class="st">'variable'</span>)</span>
<span id="cb42-872"><a href="#cb42-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-873"><a href="#cb42-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-874"><a href="#cb42-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-875"><a href="#cb42-875" aria-hidden="true" tabindex="-1"></a>These are clearly different. What gives? Unfortunately, **summary</span>
<span id="cb42-876"><a href="#cb42-876" aria-hidden="true" tabindex="-1"></a>statistics calculated using IPUMS data typically cannot match aggregate</span>
<span id="cb42-877"><a href="#cb42-877" aria-hidden="true" tabindex="-1"></a>ACS figures!**</span>
<span id="cb42-878"><a href="#cb42-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-879"><a href="#cb42-879" aria-hidden="true" tabindex="-1"></a>One major reason for this gap is additional sampling error. Recall that</span>
<span id="cb42-880"><a href="#cb42-880" aria-hidden="true" tabindex="-1"></a>the American Community Survey is a sample. A given one-year ACS is</span>
<span id="cb42-881"><a href="#cb42-881" aria-hidden="true" tabindex="-1"></a>typically a 1% sample of the U.S. population, with associated sampling</span>
<span id="cb42-882"><a href="#cb42-882" aria-hidden="true" tabindex="-1"></a>error. When the census makes microdata available, they create a sample</span>
<span id="cb42-883"><a href="#cb42-883" aria-hidden="true" tabindex="-1"></a>of that sample -- we do not get the full 1%. This second sampling</span>
<span id="cb42-884"><a href="#cb42-884" aria-hidden="true" tabindex="-1"></a>process introduces further sampling error in the microdata that is not</span>
<span id="cb42-885"><a href="#cb42-885" aria-hidden="true" tabindex="-1"></a>reflected in figures sourced from aggregate ACS data, which are</span>
<span id="cb42-886"><a href="#cb42-886" aria-hidden="true" tabindex="-1"></a>calculated using the full ACS sample [[See</span>
<span id="cb42-887"><a href="#cb42-887" aria-hidden="true" tabindex="-1"></a>ACS](https://usa.ipums.org/usa/chapter2/chapter2.shtml#ACS) in</span>
<span id="cb42-888"><a href="#cb42-888" aria-hidden="true" tabindex="-1"></a>@ruggles_ipums_2024].</span>
<span id="cb42-889"><a href="#cb42-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-890"><a href="#cb42-890" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5: Calculating standard errors {#sec-step-5}</span></span>
<span id="cb42-891"><a href="#cb42-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-892"><a href="#cb42-892" aria-hidden="true" tabindex="-1"></a>Now we have estimates derived from the ACS microdata, but how do we</span>
<span id="cb42-893"><a href="#cb42-893" aria-hidden="true" tabindex="-1"></a>communicate uncertainty around those estimates? For the sake of this</span>
<span id="cb42-894"><a href="#cb42-894" aria-hidden="true" tabindex="-1"></a>example, let's explore the problem of standard errors via a slightly</span>
<span id="cb42-895"><a href="#cb42-895" aria-hidden="true" tabindex="-1"></a>different motivating question -- **what was the average household income</span>
<span id="cb42-896"><a href="#cb42-896" aria-hidden="true" tabindex="-1"></a>in Oakland in 2022**?</span>
<span id="cb42-897"><a href="#cb42-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-898"><a href="#cb42-898" aria-hidden="true" tabindex="-1"></a>I'm switching to the average because we are about to calculate some</span>
<span id="cb42-899"><a href="#cb42-899" aria-hidden="true" tabindex="-1"></a>standard errors from-scratch, and that's much more clear-cut for linear</span>
<span id="cb42-900"><a href="#cb42-900" aria-hidden="true" tabindex="-1"></a>statistics like the average than for non-linear statistics like the</span>
<span id="cb42-901"><a href="#cb42-901" aria-hidden="true" tabindex="-1"></a>median. We will return to the median at the end of this section, but</span>
<span id="cb42-902"><a href="#cb42-902" aria-hidden="true" tabindex="-1"></a>rely on a package implementation and not do anything from-scratch.</span>
<span id="cb42-903"><a href="#cb42-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-904"><a href="#cb42-904" aria-hidden="true" tabindex="-1"></a>Anyways, let's calculate the average household income in Oakland using</span>
<span id="cb42-905"><a href="#cb42-905" aria-hidden="true" tabindex="-1"></a>the sample household weights. The [formula for the weighted</span>
<span id="cb42-906"><a href="#cb42-906" aria-hidden="true" tabindex="-1"></a>average](https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Mathematical_definition)</span>
<span id="cb42-907"><a href="#cb42-907" aria-hidden="true" tabindex="-1"></a>is: $$</span>
<span id="cb42-908"><a href="#cb42-908" aria-hidden="true" tabindex="-1"></a>\bar{X}_w = \frac{\sum_{i=1}^{n}w_ix_i}{\sum_{i=1}^{n}w_i}</span>
<span id="cb42-909"><a href="#cb42-909" aria-hidden="true" tabindex="-1"></a>$$ We'll put that into code and get the following estimate of the</span>
<span id="cb42-910"><a href="#cb42-910" aria-hidden="true" tabindex="-1"></a>average household income in Oakland:</span>
<span id="cb42-911"><a href="#cb42-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-914"><a href="#cb42-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-915"><a href="#cb42-915" aria-hidden="true" tabindex="-1"></a>weighted_mean <span class="ot">&lt;-</span> (</span>
<span id="cb42-916"><a href="#cb42-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHINCOME <span class="sc">*</span> households_w_income<span class="sc">$</span>HHWT)</span>
<span id="cb42-917"><a href="#cb42-917" aria-hidden="true" tabindex="-1"></a>  <span class="sc">/</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT)</span>
<span id="cb42-918"><a href="#cb42-918" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-919"><a href="#cb42-919" aria-hidden="true" tabindex="-1"></a>weighted_mean</span>
<span id="cb42-920"><a href="#cb42-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-921"><a href="#cb42-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-922"><a href="#cb42-922" aria-hidden="true" tabindex="-1"></a>Now, let's get a standard error for that estimate. Correctly utilizing</span>
<span id="cb42-923"><a href="#cb42-923" aria-hidden="true" tabindex="-1"></a>the sample weights in the variance calculation is [a little</span>
<span id="cb42-924"><a href="#cb42-924" aria-hidden="true" tabindex="-1"></a>tricky](https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Variance)</span>
<span id="cb42-925"><a href="#cb42-925" aria-hidden="true" tabindex="-1"></a>and there are a few different approaches to the problem. I'll cover two</span>
<span id="cb42-926"><a href="#cb42-926" aria-hidden="true" tabindex="-1"></a>techniques for variance estimation: the Taylor series method (also</span>
<span id="cb42-927"><a href="#cb42-927" aria-hidden="true" tabindex="-1"></a>referred to as "linearized variance" or Taylor series linearization) and</span>
<span id="cb42-928"><a href="#cb42-928" aria-hidden="true" tabindex="-1"></a>replication weights. Each of these are implemented in the <span class="in">`survey`</span></span>
<span id="cb42-929"><a href="#cb42-929" aria-hidden="true" tabindex="-1"></a>package <span class="co">[</span><span class="ot">@lumley_analysis_2004</span><span class="co">]</span>.</span>
<span id="cb42-930"><a href="#cb42-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-931"><a href="#cb42-931" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Taylor series method</span></span>
<span id="cb42-932"><a href="#cb42-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-933"><a href="#cb42-933" aria-hidden="true" tabindex="-1"></a>Most packages (e.g.</span>
<span id="cb42-934"><a href="#cb42-934" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">SAS</span><span class="co">](https://documentation.sas.com/doc/en/statug/latest/statug_surveymeans_details06.htm#statug.surveymeans.variancedetails)</span>,</span>
<span id="cb42-935"><a href="#cb42-935" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Stata</span><span class="co">](https://www.stata.com/manuals/svyvarianceestimation.pdf)</span>, and</span>
<span id="cb42-936"><a href="#cb42-936" aria-hidden="true" tabindex="-1"></a>R's [<span class="in">`survey`</span></span>
<span id="cb42-937"><a href="#cb42-937" aria-hidden="true" tabindex="-1"></a>package](https://r-survey.r-forge.r-project.org/survey/#:~:text=Variances%20by%20Taylor%20linearization))</span>
<span id="cb42-938"><a href="#cb42-938" aria-hidden="true" tabindex="-1"></a>default to using the Taylor series method for variance estimation of</span>
<span id="cb42-939"><a href="#cb42-939" aria-hidden="true" tabindex="-1"></a>weighted statistics. This is because weighted statistics, like the</span>
<span id="cb42-940"><a href="#cb42-940" aria-hidden="true" tabindex="-1"></a>average above, are not linear with respect to the weights, making</span>
<span id="cb42-941"><a href="#cb42-941" aria-hidden="true" tabindex="-1"></a>analytical calculation of the variance difficult or else undefined</span>
<span id="cb42-942"><a href="#cb42-942" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@lohr_sampling_2021</span><span class="co">]</span>. The Taylor series method entails calculating the</span>
<span id="cb42-943"><a href="#cb42-943" aria-hidden="true" tabindex="-1"></a>first-order linear approximation of the statistic (e.g. the linear</span>
<span id="cb42-944"><a href="#cb42-944" aria-hidden="true" tabindex="-1"></a>approximation of the weighted mean formula above), then finding the</span>
<span id="cb42-945"><a href="#cb42-945" aria-hidden="true" tabindex="-1"></a>variance of that approximation. The details of those calculations are</span>
<span id="cb42-946"><a href="#cb42-946" aria-hidden="true" tabindex="-1"></a>beyond the scope of this post, but <span class="co">[</span><span class="ot">@lohr_sampling_2021, chap 9.1</span><span class="co">]</span></span>
<span id="cb42-947"><a href="#cb42-947" aria-hidden="true" tabindex="-1"></a>covers the process in detail, and Wikipedia has a nice</span>
<span id="cb42-948"><a href="#cb42-948" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">walkthrough</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Variance_of_the_weighted_mean_(%CF%80-estimator_for_ratio-mean))</span>
<span id="cb42-949"><a href="#cb42-949" aria-hidden="true" tabindex="-1"></a>as well. We will just work with the formula for linearized variance that</span>
<span id="cb42-950"><a href="#cb42-950" aria-hidden="true" tabindex="-1"></a>is arrived at in the Wikipedia post:</span>
<span id="cb42-951"><a href="#cb42-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-952"><a href="#cb42-952" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-953"><a href="#cb42-953" aria-hidden="true" tabindex="-1"></a>\hat{\text{Var}}(\bar{X}_w) = \frac{\sum w_i^2 (x_i - \bar{X}_w)^2}{\left(\sum w_i\right)^2} </span>
<span id="cb42-954"><a href="#cb42-954" aria-hidden="true" tabindex="-1"></a>$$ The standard error is just the square root of that variance.\</span>
<span id="cb42-955"><a href="#cb42-955" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-956"><a href="#cb42-956" aria-hidden="true" tabindex="-1"></a>\hat{\text{SE}}(\bar{X}_w) = \sqrt{\hat{\text{Var}}(\bar{X}_w)}</span>
<span id="cb42-957"><a href="#cb42-957" aria-hidden="true" tabindex="-1"></a>$$ We'll code that up in R:</span>
<span id="cb42-958"><a href="#cb42-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-961"><a href="#cb42-961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-962"><a href="#cb42-962" aria-hidden="true" tabindex="-1"></a>numerator <span class="ot">&lt;-</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (households_w_income<span class="sc">$</span>HHINCOME <span class="sc">-</span> weighted_mean)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb42-963"><a href="#cb42-963" aria-hidden="true" tabindex="-1"></a>denominator <span class="ot">&lt;-</span> <span class="fu">sum</span>(households_w_income<span class="sc">$</span>HHWT)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb42-964"><a href="#cb42-964" aria-hidden="true" tabindex="-1"></a>variance <span class="ot">&lt;-</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb42-965"><a href="#cb42-965" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(variance)</span>
<span id="cb42-966"><a href="#cb42-966" aria-hidden="true" tabindex="-1"></a>se</span>
<span id="cb42-967"><a href="#cb42-967" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-968"><a href="#cb42-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-969"><a href="#cb42-969" aria-hidden="true" tabindex="-1"></a>That result is a usable estimate for the standard error of the average</span>
<span id="cb42-970"><a href="#cb42-970" aria-hidden="true" tabindex="-1"></a>household income in Oakland. Of course in practice we would always use a</span>
<span id="cb42-971"><a href="#cb42-971" aria-hidden="true" tabindex="-1"></a>package, in this case <span class="in">`survey`</span>, for calculating that. Here I'll</span>
<span id="cb42-972"><a href="#cb42-972" aria-hidden="true" tabindex="-1"></a>calculate the average household income in Oakland using <span class="in">`survey`</span>, and it</span>
<span id="cb42-973"><a href="#cb42-973" aria-hidden="true" tabindex="-1"></a>will default to returning a standard error via the Taylor series method.</span>
<span id="cb42-974"><a href="#cb42-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-977"><a href="#cb42-977" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-978"><a href="#cb42-978" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-wrong-se</span></span>
<span id="cb42-979"><a href="#cb42-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Taylor Series Method Standard Error"</span></span>
<span id="cb42-980"><a href="#cb42-980" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-981"><a href="#cb42-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb42-982"><a href="#cb42-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb42-983"><a href="#cb42-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-984"><a href="#cb42-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-985"><a href="#cb42-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-986"><a href="#cb42-986" aria-hidden="true" tabindex="-1"></a>This standard error is off from ours by about \$1, which could be due to</span>
<span id="cb42-987"><a href="#cb42-987" aria-hidden="true" tabindex="-1"></a>other corrections applied in the package's variance calculation. We</span>
<span id="cb42-988"><a href="#cb42-988" aria-hidden="true" tabindex="-1"></a>needn't be too worried about this discrepancy, though. While the Taylor</span>
<span id="cb42-989"><a href="#cb42-989" aria-hidden="true" tabindex="-1"></a>series method is popular in survey analysis, [IPUMS</span>
<span id="cb42-990"><a href="#cb42-990" aria-hidden="true" tabindex="-1"></a>recommends](https://usa.ipums.org/usa/repwt.shtml) that we use the</span>
<span id="cb42-991"><a href="#cb42-991" aria-hidden="true" tabindex="-1"></a>replication weights method when working with ACS microdata.</span>
<span id="cb42-992"><a href="#cb42-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-993"><a href="#cb42-993" aria-hidden="true" tabindex="-1"></a><span class="fu">### Replication weights</span></span>
<span id="cb42-994"><a href="#cb42-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-995"><a href="#cb42-995" aria-hidden="true" tabindex="-1"></a>In theory, the [standard</span>
<span id="cb42-996"><a href="#cb42-996" aria-hidden="true" tabindex="-1"></a>error](https://en.wikipedia.org/wiki/Standard_error) of an estimate</span>
<span id="cb42-997"><a href="#cb42-997" aria-hidden="true" tabindex="-1"></a>measures the variation of a statistic across multiple samples from a</span>
<span id="cb42-998"><a href="#cb42-998" aria-hidden="true" tabindex="-1"></a>given population. Our sample standard error above, calculated using just</span>
<span id="cb42-999"><a href="#cb42-999" aria-hidden="true" tabindex="-1"></a>the one sample, is an estimate of that theoretical standard error.</span>
<span id="cb42-1000"><a href="#cb42-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1001"><a href="#cb42-1001" aria-hidden="true" tabindex="-1"></a>Replicate methods operate under the assumption that one sample can be</span>
<span id="cb42-1002"><a href="#cb42-1002" aria-hidden="true" tabindex="-1"></a>conceived of as a miniature version of the population. Instead of taking</span>
<span id="cb42-1003"><a href="#cb42-1003" aria-hidden="true" tabindex="-1"></a>multiple samples from the population to construct a variance estimator,</span>
<span id="cb42-1004"><a href="#cb42-1004" aria-hidden="true" tabindex="-1"></a>one may simply resample from the full, original sample to mimic the</span>
<span id="cb42-1005"><a href="#cb42-1005" aria-hidden="true" tabindex="-1"></a>theoretical basis of standard errors <span class="co">[</span><span class="ot">@lohr_sampling_2021, chap 9.1</span><span class="co">]</span>.</span>
<span id="cb42-1006"><a href="#cb42-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1007"><a href="#cb42-1007" aria-hidden="true" tabindex="-1"></a>In practice, we don't explicitly do any resampling, instead relying on</span>
<span id="cb42-1008"><a href="#cb42-1008" aria-hidden="true" tabindex="-1"></a>"replicate weights" that the census pre-computes. Here we can see what</span>
<span id="cb42-1009"><a href="#cb42-1009" aria-hidden="true" tabindex="-1"></a>replicate weights (in this case, household replicate weights) look like</span>
<span id="cb42-1010"><a href="#cb42-1010" aria-hidden="true" tabindex="-1"></a>in our data. Each of <span class="in">`REPWT`</span>, 1 through 80, is a set of alternative</span>
<span id="cb42-1011"><a href="#cb42-1011" aria-hidden="true" tabindex="-1"></a>household weights, slightly different from the "production weight,"</span>
<span id="cb42-1012"><a href="#cb42-1012" aria-hidden="true" tabindex="-1"></a><span class="in">`HHWT`</span>.</span>
<span id="cb42-1013"><a href="#cb42-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1016"><a href="#cb42-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1017"><a href="#cb42-1017" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rep-weights</span></span>
<span id="cb42-1018"><a href="#cb42-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "ACS Replicate Household Weights"</span></span>
<span id="cb42-1019"><a href="#cb42-1019" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-1020"><a href="#cb42-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1021"><a href="#cb42-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(HHINCOME, HHWT, REPWT1, REPWT2, <span class="st">`</span><span class="at"> </span><span class="st">`</span>, REPWT79, REPWT80)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1022"><a href="#cb42-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb42-1023"><a href="#cb42-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1024"><a href="#cb42-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1025"><a href="#cb42-1025" aria-hidden="true" tabindex="-1"></a>We can use replicate weights in a variety of alternative variance</span>
<span id="cb42-1026"><a href="#cb42-1026" aria-hidden="true" tabindex="-1"></a>estimates. In the IPUMS documentation on ACS replicate weights, they</span>
<span id="cb42-1027"><a href="#cb42-1027" aria-hidden="true" tabindex="-1"></a>outline a [variance estimation</span>
<span id="cb42-1028"><a href="#cb42-1028" aria-hidden="true" tabindex="-1"></a>procedure](https://usa.ipums.org/usa/repwt.shtml#:~:text=can%20change%20substantially.-,HOW%20DO%20I%20OBTAIN%20REPLICATE%20STANDARD%20ERRORS%20FROM%20IPUMS%2DUSA%20DATA%3F,-There%20are%203)</span>
<span id="cb42-1029"><a href="#cb42-1029" aria-hidden="true" tabindex="-1"></a>that matches the "successive difference replication (SDR) variance"</span>
<span id="cb42-1030"><a href="#cb42-1030" aria-hidden="true" tabindex="-1"></a>method. We obtain SDR variance by calculating our statistic of interest</span>
<span id="cb42-1031"><a href="#cb42-1031" aria-hidden="true" tabindex="-1"></a>with the production weights (e.g. <span class="in">`HHWT`</span>) as follows:\</span>
<span id="cb42-1032"><a href="#cb42-1032" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-1033"><a href="#cb42-1033" aria-hidden="true" tabindex="-1"></a>\bar{X}_w = \frac{\sum_{i=1}^{n}\text{HHWT}_ix_i}{\sum_{i=1}^{n}\text{HHWT}_i}</span>
<span id="cb42-1034"><a href="#cb42-1034" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-1035"><a href="#cb42-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1036"><a href="#cb42-1036" aria-hidden="true" tabindex="-1"></a>Then, for each of the 80 household replicate weights (e.g. <span class="in">`REPWT1`</span>), we</span>
<span id="cb42-1037"><a href="#cb42-1037" aria-hidden="true" tabindex="-1"></a>calculate the weighted average income using the replicate weight\</span>
<span id="cb42-1038"><a href="#cb42-1038" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-1039"><a href="#cb42-1039" aria-hidden="true" tabindex="-1"></a>\bar{X}_r = \frac{\sum_{i=1}^{n}\text{REPWT}_{ri}x_i}{\sum_{i=1}^{n}\text{REPWT}_{ri}}</span>
<span id="cb42-1040"><a href="#cb42-1040" aria-hidden="true" tabindex="-1"></a>$$ and sum the squared deviations between that "replicate-weighted"</span>
<span id="cb42-1041"><a href="#cb42-1041" aria-hidden="true" tabindex="-1"></a>estimate, $\bar{X}_r$, and the production weighted estimate.</span>
<span id="cb42-1042"><a href="#cb42-1042" aria-hidden="true" tabindex="-1"></a>Specifically: $$</span>
<span id="cb42-1043"><a href="#cb42-1043" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1044"><a href="#cb42-1044" aria-hidden="true" tabindex="-1"></a>\hat{\text{Var}}(\bar{X}_w) &amp;= \frac{4}{80} \sum_{r=1}^{80} (\bar{X}_r - \bar{X}_w)^2</span>
<span id="cb42-1045"><a href="#cb42-1045" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1046"><a href="#cb42-1046" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-1047"><a href="#cb42-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1048"><a href="#cb42-1048" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@fay_aspects_1995</span><span class="co">]</span> initially proposed that variance estimator and</span>
<span id="cb42-1049"><a href="#cb42-1049" aria-hidden="true" tabindex="-1"></a>[their</span>
<span id="cb42-1050"><a href="#cb42-1050" aria-hidden="true" tabindex="-1"></a>paper](https://www.census.gov/content/dam/Census/library/working-papers/1995/demo/faytrain95.pdf)</span>
<span id="cb42-1051"><a href="#cb42-1051" aria-hidden="true" tabindex="-1"></a>gives the full derivation. The standard error is once again just the</span>
<span id="cb42-1052"><a href="#cb42-1052" aria-hidden="true" tabindex="-1"></a>square root of that variance.</span>
<span id="cb42-1053"><a href="#cb42-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1054"><a href="#cb42-1054" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-1055"><a href="#cb42-1055" aria-hidden="true" tabindex="-1"></a>\hat{\text{SE}}(\bar{X}_w) = \sqrt{\hat{\text{Var}}(\bar{X}_w)}</span>
<span id="cb42-1056"><a href="#cb42-1056" aria-hidden="true" tabindex="-1"></a>$$ In code, calculated via a for-loop, we'd get the following:</span>
<span id="cb42-1057"><a href="#cb42-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1060"><a href="#cb42-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1061"><a href="#cb42-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X_r</span></span>
<span id="cb42-1062"><a href="#cb42-1062" aria-hidden="true" tabindex="-1"></a>X_r <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb42-1063"><a href="#cb42-1063" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>){</span>
<span id="cb42-1064"><a href="#cb42-1064" aria-hidden="true" tabindex="-1"></a>  X_r[r] <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-1065"><a href="#cb42-1065" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span><span class="fu">glue</span>(<span class="st">"REPWT"</span>, r)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1066"><a href="#cb42-1066" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1067"><a href="#cb42-1067" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb42-1068"><a href="#cb42-1068" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1069"><a href="#cb42-1069" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate X</span></span>
<span id="cb42-1070"><a href="#cb42-1070" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span></span>
<span id="cb42-1071"><a href="#cb42-1071" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_survey</span>(<span class="at">weights=</span>HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb42-1072"><a href="#cb42-1072" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1073"><a href="#cb42-1073" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>weighted_mean</span>
<span id="cb42-1074"><a href="#cb42-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1075"><a href="#cb42-1075" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum over r</span></span>
<span id="cb42-1076"><a href="#cb42-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>) <span class="sc">*</span> <span class="fu">sum</span>( (X_r <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> ) )</span>
<span id="cb42-1077"><a href="#cb42-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1078"><a href="#cb42-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1079"><a href="#cb42-1079" aria-hidden="true" tabindex="-1"></a>To be clear, we don't do that manually in practice -- <span class="in">`survey`</span> supports</span>
<span id="cb42-1080"><a href="#cb42-1080" aria-hidden="true" tabindex="-1"></a>specifying survey designs with replicate weights. The following is an</span>
<span id="cb42-1081"><a href="#cb42-1081" aria-hidden="true" tabindex="-1"></a>implementation of the same standard error calculation procedure. Note</span>
<span id="cb42-1082"><a href="#cb42-1082" aria-hidden="true" tabindex="-1"></a>the identical output.</span>
<span id="cb42-1083"><a href="#cb42-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1086"><a href="#cb42-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1087"><a href="#cb42-1087" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1088"><a href="#cb42-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb42-1089"><a href="#cb42-1089" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb42-1090"><a href="#cb42-1090" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb42-1091"><a href="#cb42-1091" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"successive-difference"</span>,</span>
<span id="cb42-1092"><a href="#cb42-1092" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1093"><a href="#cb42-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb42-1094"><a href="#cb42-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1095"><a href="#cb42-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1096"><a href="#cb42-1096" aria-hidden="true" tabindex="-1"></a>There are a few different replicate methods for variance estimation,</span>
<span id="cb42-1097"><a href="#cb42-1097" aria-hidden="true" tabindex="-1"></a>several of which are equivalent. For example, the successive-difference</span>
<span id="cb42-1098"><a href="#cb42-1098" aria-hidden="true" tabindex="-1"></a>standard error above is equivalent to using [Fay's Balanced Repeated</span>
<span id="cb42-1099"><a href="#cb42-1099" aria-hidden="true" tabindex="-1"></a>Replication</span>
<span id="cb42-1100"><a href="#cb42-1100" aria-hidden="true" tabindex="-1"></a>method](https://documentation.sas.com/doc/en/statug/15.2/statug_surveyphreg_details29.htm)</span>
<span id="cb42-1101"><a href="#cb42-1101" aria-hidden="true" tabindex="-1"></a>with the Faye coefficient set to $\epsilon=.5$.</span>
<span id="cb42-1102"><a href="#cb42-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1105"><a href="#cb42-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1106"><a href="#cb42-1106" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1107"><a href="#cb42-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb42-1108"><a href="#cb42-1108" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT ,</span>
<span id="cb42-1109"><a href="#cb42-1109" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb42-1110"><a href="#cb42-1110" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Fay"</span>,</span>
<span id="cb42-1111"><a href="#cb42-1111" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho=</span>.<span class="dv">5</span>,</span>
<span id="cb42-1112"><a href="#cb42-1112" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1113"><a href="#cb42-1113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb42-1114"><a href="#cb42-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1115"><a href="#cb42-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1116"><a href="#cb42-1116" aria-hidden="true" tabindex="-1"></a>IPUMS' documentation <span class="co">[</span><span class="ot">recommends</span><span class="co">](https://usa.ipums.org/usa/repwt.shtml)</span></span>
<span id="cb42-1117"><a href="#cb42-1117" aria-hidden="true" tabindex="-1"></a>the following specification, where the replicate method is set to "ACS."</span>
<span id="cb42-1118"><a href="#cb42-1118" aria-hidden="true" tabindex="-1"></a>This has the same output as the previous two specifications, and is</span>
<span id="cb42-1119"><a href="#cb42-1119" aria-hidden="true" tabindex="-1"></a>presumably implementing SDR variance.</span>
<span id="cb42-1120"><a href="#cb42-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1123"><a href="#cb42-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1124"><a href="#cb42-1124" aria-hidden="true" tabindex="-1"></a>households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1125"><a href="#cb42-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb42-1126"><a href="#cb42-1126" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT,</span>
<span id="cb42-1127"><a href="#cb42-1127" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb42-1128"><a href="#cb42-1128" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb42-1129"><a href="#cb42-1129" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1130"><a href="#cb42-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weighted_mean =</span> <span class="fu">survey_mean</span>(HHINCOME))</span>
<span id="cb42-1131"><a href="#cb42-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1132"><a href="#cb42-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1133"><a href="#cb42-1133" aria-hidden="true" tabindex="-1"></a>Now that we have the methods established, we'll return to the median,</span>
<span id="cb42-1134"><a href="#cb42-1134" aria-hidden="true" tabindex="-1"></a>rather than the mean, household income. Some of the above formulas would</span>
<span id="cb42-1135"><a href="#cb42-1135" aria-hidden="true" tabindex="-1"></a>be different for the median, but the code and package implementations</span>
<span id="cb42-1136"><a href="#cb42-1136" aria-hidden="true" tabindex="-1"></a>are the same. Here we will calculate the median household income in</span>
<span id="cb42-1137"><a href="#cb42-1137" aria-hidden="true" tabindex="-1"></a>Oakland, and the standard error for that statistic using three methods:</span>
<span id="cb42-1138"><a href="#cb42-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1139"><a href="#cb42-1139" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>ACS aggregate data retrieval</span>
<span id="cb42-1140"><a href="#cb42-1140" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Estimation via IPUMS microdata with Taylor series variance/standard</span>
<span id="cb42-1141"><a href="#cb42-1141" aria-hidden="true" tabindex="-1"></a>    error</span>
<span id="cb42-1142"><a href="#cb42-1142" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Estimation via IPUMS microdata with replicate weight</span>
<span id="cb42-1143"><a href="#cb42-1143" aria-hidden="true" tabindex="-1"></a>    variance/standard error</span>
<span id="cb42-1144"><a href="#cb42-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1147"><a href="#cb42-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1148"><a href="#cb42-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-1149"><a href="#cb42-1149" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> oakland_stats <span class="sc">%&gt;%</span> </span>
<span id="cb42-1150"><a href="#cb42-1150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> moe<span class="sc">/</span><span class="fl">1.645</span>, <span class="at">Method =</span> <span class="st">'Aggregate Data'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1151"><a href="#cb42-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">'median_hh_income'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1152"><a href="#cb42-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, estimate, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1153"><a href="#cb42-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> estimate)</span>
<span id="cb42-1154"><a href="#cb42-1154" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1155"><a href="#cb42-1155" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey</span>(</span>
<span id="cb42-1156"><a href="#cb42-1156" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> HHWT) <span class="sc">%&gt;%</span></span>
<span id="cb42-1157"><a href="#cb42-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1158"><a href="#cb42-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Weighted Median HH Income_se</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1159"><a href="#cb42-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">'Microdata w/ Taylor Series Method'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1160"><a href="#cb42-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, <span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span>, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>))</span>
<span id="cb42-1161"><a href="#cb42-1161" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1162"><a href="#cb42-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb42-1163"><a href="#cb42-1163" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> HHWT,</span>
<span id="cb42-1164"><a href="#cb42-1164" aria-hidden="true" tabindex="-1"></a>  <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb42-1165"><a href="#cb42-1165" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb42-1166"><a href="#cb42-1166" aria-hidden="true" tabindex="-1"></a>  <span class="at">mse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1167"><a href="#cb42-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">survey_median</span>(HHINCOME)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1168"><a href="#cb42-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Weighted Median HH Income_se</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1169"><a href="#cb42-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">'Microdata w/ Replicate Weights'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1170"><a href="#cb42-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Method, <span class="st">`</span><span class="at">Weighted Median HH Income</span><span class="st">`</span>, <span class="st">`</span><span class="at">Standard Error</span><span class="st">`</span>))</span>
<span id="cb42-1171"><a href="#cb42-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1172"><a href="#cb42-1172" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3)</span>
<span id="cb42-1173"><a href="#cb42-1173" aria-hidden="true" tabindex="-1"></a>combined_df</span>
<span id="cb42-1174"><a href="#cb42-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1175"><a href="#cb42-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1176"><a href="#cb42-1176" aria-hidden="true" tabindex="-1"></a>In IPUMS testing of ACS/PRCS data, replicate weights usually increase</span>
<span id="cb42-1177"><a href="#cb42-1177" aria-hidden="true" tabindex="-1"></a>standard errors, though in our case the replicate weights produced a</span>
<span id="cb42-1178"><a href="#cb42-1178" aria-hidden="true" tabindex="-1"></a>slightly smaller standard error than the Taylor series method.</span>
<span id="cb42-1179"><a href="#cb42-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1180"><a href="#cb42-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Production Workflow</span></span>
<span id="cb42-1181"><a href="#cb42-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1182"><a href="#cb42-1182" aria-hidden="true" tabindex="-1"></a>Putting all of this post together, here is production code that I would</span>
<span id="cb42-1183"><a href="#cb42-1183" aria-hidden="true" tabindex="-1"></a>use to build a dataset for analyzing household-level variables in</span>
<span id="cb42-1184"><a href="#cb42-1184" aria-hidden="true" tabindex="-1"></a>Oakland, leaning on the IPUMS and geocorr helper functions I defined</span>
<span id="cb42-1185"><a href="#cb42-1185" aria-hidden="true" tabindex="-1"></a>above, and specifying replicate weights and "ACS" variance.</span>
<span id="cb42-1186"><a href="#cb42-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1189"><a href="#cb42-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1190"><a href="#cb42-1190" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-1191"><a href="#cb42-1191" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the IPUMS data for California</span></span>
<span id="cb42-1192"><a href="#cb42-1192" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">ipums_data</span>(<span class="st">"us2022a"</span>, variables, <span class="st">"Incomes by PUMA"</span>)</span>
<span id="cb42-1193"><a href="#cb42-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the geographic correspondence for places -&gt; pumas</span></span>
<span id="cb42-1194"><a href="#cb42-1194" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="fu">geocorr_2022</span>(<span class="st">"Ca06"</span>, <span class="st">"puma22"</span>, <span class="st">"place"</span>, <span class="st">"pop20"</span>)</span>
<span id="cb42-1195"><a href="#cb42-1195" aria-hidden="true" tabindex="-1"></a><span class="co"># isolate pumas that correspond to oakland and have oak population</span></span>
<span id="cb42-1196"><a href="#cb42-1196" aria-hidden="true" tabindex="-1"></a>oak_pumas <span class="ot">&lt;-</span> csv_data <span class="sc">%&gt;%</span></span>
<span id="cb42-1197"><a href="#cb42-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state, stab, place, PUMA22name)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1198"><a href="#cb42-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaceName <span class="sc">==</span> <span class="st">'Oakland city, CA'</span>, afact <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1199"><a href="#cb42-1199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(puma22) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1200"><a href="#cb42-1200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb42-1201"><a href="#cb42-1201" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the IPUMS data to those pumas</span></span>
<span id="cb42-1202"><a href="#cb42-1202" aria-hidden="true" tabindex="-1"></a>oak_hh_w_inc <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb42-1203"><a href="#cb42-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PUMA <span class="sc">%in%</span> oak_pumas) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1204"><a href="#cb42-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SAMPLE, SERIAL, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1205"><a href="#cb42-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHINCOME <span class="sc">!=</span> <span class="dv">9999999</span>, HHINCOME <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1206"><a href="#cb42-1206" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>()</span>
<span id="cb42-1207"><a href="#cb42-1207" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the IPUMS data to a survey dataset</span></span>
<span id="cb42-1208"><a href="#cb42-1208" aria-hidden="true" tabindex="-1"></a>oak_hh_inc_svy <span class="ot">&lt;-</span> households_w_income <span class="sc">%&gt;%</span> </span>
<span id="cb42-1209"><a href="#cb42-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb42-1210"><a href="#cb42-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> HHWT,</span>
<span id="cb42-1211"><a href="#cb42-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">repweights =</span> <span class="fu">matches</span>(<span class="st">"REPWT[0-9]+"</span>),</span>
<span id="cb42-1212"><a href="#cb42-1212" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"ACS"</span>,</span>
<span id="cb42-1213"><a href="#cb42-1213" aria-hidden="true" tabindex="-1"></a>    <span class="at">mse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1214"><a href="#cb42-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1215"><a href="#cb42-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1216"><a href="#cb42-1216" aria-hidden="true" tabindex="-1"></a>And here is the median household income.</span>
<span id="cb42-1217"><a href="#cb42-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1220"><a href="#cb42-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1221"><a href="#cb42-1221" aria-hidden="true" tabindex="-1"></a>oak_hh_inc_svy <span class="sc">%&gt;%</span></span>
<span id="cb42-1222"><a href="#cb42-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_hh_inc =</span> <span class="fu">survey_median</span>(HHINCOME))</span>
<span id="cb42-1223"><a href="#cb42-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1224"><a href="#cb42-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1227"><a href="#cb42-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1228"><a href="#cb42-1228" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb42-1229"><a href="#cb42-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb42-1230"><a href="#cb42-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="st">'base'</span>)</span>
<span id="cb42-1231"><a href="#cb42-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1232"><a href="#cb42-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1235"><a href="#cb42-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb42-1236"><a href="#cb42-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb42-1237"><a href="#cb42-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb42-1238"><a href="#cb42-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb42-1239"><a href="#cb42-1239" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb42-1240"><a href="#cb42-1240" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb42-1241"><a href="#cb42-1241" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb42-1242"><a href="#cb42-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1243"><a href="#cb42-1243" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(r[<span class="st">'oak_hh_w_inc'</span>])</span>
<span id="cb42-1244"><a href="#cb42-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1245"><a href="#cb42-1245" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb42-1246"><a href="#cb42-1246" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'HHINCOME'</span>, weights<span class="op">=</span><span class="st">"HHWT"</span>, ax<span class="op">=</span>ax, fill<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">.5</span>, log_scale<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>)</span>
<span id="cb42-1247"><a href="#cb42-1247" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb42-1248"><a href="#cb42-1248" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="fl">8e2</span>, <span class="fl">10e6</span>)</span>
<span id="cb42-1249"><a href="#cb42-1249" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_xlim(-1, 1e6)</span></span>
<span id="cb42-1250"><a href="#cb42-1250" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb42-1251"><a href="#cb42-1251" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"thumbnail.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb42-1252"><a href="#cb42-1252" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span>
<span id="cb42-1253"><a href="#cb42-1253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Peter Amerkhanian</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>